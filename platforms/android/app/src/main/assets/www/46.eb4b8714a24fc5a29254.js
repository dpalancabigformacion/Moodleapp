(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{"617G":function(e,t,n){"use strict";n.r(t),n.d(t,"AddonMessagesContactsPageModule",(function(){return w}));var s=n("tyNb"),o=n("vY5A"),a=n("muSn"),i=n("Y+03"),c=n("L3Fv"),r=n("mrSG"),d=n("fjkH"),g=n("9+EE"),l=n("KMk0"),_=n("pHTc"),m=n("3LXp"),u=n("fXoL"),f=n("TEn/"),h=n("ACYt"),M=n("3CSS"),C=n("nt/U"),P=n("46ml"),p=n("vWwc"),O=n("JYLr"),b=n("PgjG"),v=n("ofXK"),x=n("xpMl"),q=n("FeAf"),A=n("hMzs"),T=n("r8G5"),E=n("sYmb");function AddonMessagesContactsPage_ng_template_18_ion_list_4_ion_item_1_ion_icon_5_Template(e,t){1&e&&(u.zc(0,"ion-icon",20),u.Pc(1,"translate")),2&e&&u.mc("aria-label",u.Qc(1,1,"addon.messages.contactblocked"))}function AddonMessagesContactsPage_ng_template_18_ion_list_4_ion_item_1_Template(e,t){if(1&e){const e=u.Fc();u.Ec(0,"ion-item",15),u.Mc("click",(function AddonMessagesContactsPage_ng_template_18_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){u.fd(e);const n=t.$implicit;return u.Oc(3).selectUser(n.id)})),u.zc(1,"core-user-avatar",16),u.Ec(2,"ion-label"),u.Ec(3,"p",17),u.zc(4,"core-format-text",18),u.nd(5,AddonMessagesContactsPage_ng_template_18_ion_list_4_ion_item_1_ion_icon_5_Template,2,3,"ion-icon",19),u.Dc(),u.Dc(),u.Dc()}if(2&e){const e=t.$implicit,n=u.Oc(3);u.mc("aria-label",e.fullname)("aria-current",e.id==n.selectedUserId?"page":"false"),u.lc(1),u.Vc("user",e)("checkOnline",e.showonlinestatus)("linkProfile",!1),u.lc(3),u.Vc("text",e.fullname)("contextInstanceId",0),u.lc(1),u.Vc("ngIf",e.isblocked)}}function AddonMessagesContactsPage_ng_template_18_ion_list_4_Template(e,t){if(1&e&&(u.Ec(0,"ion-list",13),u.nd(1,AddonMessagesContactsPage_ng_template_18_ion_list_4_ion_item_1_Template,6,8,"ion-item",14),u.Dc()),2&e){const e=u.Oc(2);u.lc(1),u.Vc("ngForOf",e.confirmedContacts)}}function AddonMessagesContactsPage_ng_template_18_core_empty_box_5_Template(e,t){1&e&&(u.zc(0,"core-empty-box",21),u.Pc(1,"translate")),2&e&&u.Vc("message",u.Qc(1,1,"addon.messages.nocontactsgetstarted"))}function AddonMessagesContactsPage_ng_template_18_Template(e,t){if(1&e){const e=u.Fc();u.Ec(0,"ion-refresher",8),u.Mc("ionRefresh",(function AddonMessagesContactsPage_ng_template_18_Template_ion_refresher_ionRefresh_0_listener(t){u.fd(e);return u.Oc().refreshData(t.target)})),u.zc(1,"ion-refresher-content",9),u.Pc(2,"translate"),u.Dc(),u.Ec(3,"core-loading",5),u.nd(4,AddonMessagesContactsPage_ng_template_18_ion_list_4_Template,2,1,"ion-list",10),u.nd(5,AddonMessagesContactsPage_ng_template_18_core_empty_box_5_Template,2,3,"core-empty-box",11),u.Ec(6,"core-infinite-loading",12),u.Mc("action",(function AddonMessagesContactsPage_ng_template_18_Template_core_infinite_loading_action_6_listener(t){u.fd(e);return u.Oc().loadMore(t)})),u.Dc(),u.Dc()}if(2&e){const e=u.Oc();u.Vc("disabled",!e.confirmedLoaded),u.lc(1),u.Wc("pullingText",u.Qc(2,7,"core.pulltorefresh")),u.lc(2),u.Vc("hideUntil",e.confirmedLoaded),u.lc(1),u.Vc("ngIf",e.confirmedContacts.length),u.lc(1),u.Vc("ngIf",!e.confirmedContacts.length),u.lc(1),u.Vc("enabled",e.confirmedCanLoadMore)("error",e.confirmedLoadMoreError)}}function AddonMessagesContactsPage_ng_template_21_ion_list_4_ion_item_1_p_4_Template(e,t){1&e&&(u.Ec(0,"p"),u.pd(1),u.Pc(2,"translate"),u.Dc()),2&e&&(u.lc(1),u.rd(" ",u.Qc(2,1,"addon.messages.wouldliketocontactyou")," "))}function AddonMessagesContactsPage_ng_template_21_ion_list_4_ion_item_1_Template(e,t){if(1&e){const e=u.Fc();u.Ec(0,"ion-item",15),u.Mc("click",(function AddonMessagesContactsPage_ng_template_21_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){u.fd(e);const n=t.$implicit;return u.Oc(3).selectUser(n.id)})),u.zc(1,"core-user-avatar",22),u.Ec(2,"ion-label"),u.zc(3,"core-format-text",18),u.nd(4,AddonMessagesContactsPage_ng_template_21_ion_list_4_ion_item_1_p_4_Template,3,3,"p",23),u.Dc(),u.Dc()}if(2&e){const e=t.$implicit,n=u.Oc(3);u.mc("aria-label",e.fullname)("aria-current",e.id==n.selectedUserId?"page":"false"),u.lc(1),u.Vc("user",e)("linkProfile",!1),u.lc(2),u.Vc("text",e.fullname)("contextInstanceId",0),u.lc(1),u.Vc("ngIf",!e.iscontact)}}function AddonMessagesContactsPage_ng_template_21_ion_list_4_Template(e,t){if(1&e&&(u.Ec(0,"ion-list",13),u.nd(1,AddonMessagesContactsPage_ng_template_21_ion_list_4_ion_item_1_Template,5,7,"ion-item",14),u.Dc()),2&e){const e=u.Oc(2);u.lc(1),u.Vc("ngForOf",e.requests)}}function AddonMessagesContactsPage_ng_template_21_core_empty_box_5_Template(e,t){1&e&&(u.zc(0,"core-empty-box",21),u.Pc(1,"translate")),2&e&&u.Vc("message",u.Qc(1,1,"addon.messages.nocontactrequests"))}function AddonMessagesContactsPage_ng_template_21_Template(e,t){if(1&e){const e=u.Fc();u.Ec(0,"ion-refresher",8),u.Mc("ionRefresh",(function AddonMessagesContactsPage_ng_template_21_Template_ion_refresher_ionRefresh_0_listener(t){u.fd(e);return u.Oc().refreshData(t.target)})),u.zc(1,"ion-refresher-content",9),u.Pc(2,"translate"),u.Dc(),u.Ec(3,"core-loading",5),u.nd(4,AddonMessagesContactsPage_ng_template_21_ion_list_4_Template,2,1,"ion-list",10),u.nd(5,AddonMessagesContactsPage_ng_template_21_core_empty_box_5_Template,2,3,"core-empty-box",11),u.Ec(6,"core-infinite-loading",12),u.Mc("action",(function AddonMessagesContactsPage_ng_template_21_Template_core_infinite_loading_action_6_listener(t){u.fd(e);return u.Oc().loadMore(t)})),u.Dc(),u.Dc()}if(2&e){const e=u.Oc();u.Vc("disabled",!e.requestsLoaded),u.lc(1),u.Wc("pullingText",u.Qc(2,7,"core.pulltorefresh")),u.lc(2),u.Vc("hideUntil",e.requestsLoaded),u.lc(1),u.Vc("ngIf",e.requests.length),u.lc(1),u.Vc("ngIf",!e.requests.length),u.lc(1),u.Vc("enabled",e.requestsCanLoadMore)("error",e.requestsLoadMoreError)}}let y=(()=>{class AddonMessagesContactsPage{constructor(){this.selected="confirmed",this.requestsBadge="",this.confirmedLoaded=!1,this.confirmedInitialising=!1,this.confirmedCanLoadMore=!1,this.confirmedLoadMoreError=!1,this.confirmedContacts=[],this.requestsLoaded=!1,this.requestsInitialising=!1,this.requestsCanLoadMore=!1,this.requestsLoadMoreError=!1,this.requests=[],this.siteId=g.b.getCurrentSiteId(),this.contactRequestsCountObserver=d.b.on(l.b.CONTACT_REQUESTS_COUNT_EVENT,(e=>{this.requestsBadge=e.count>0?String(e.count):""}),this.siteId),this.memberInfoObserver=d.b.on(l.b.MEMBER_INFO_CHANGED_EVENT,(e=>{if(e.userBlocked||e.userUnblocked){const t=this.confirmedContacts.find((t=>t.id==e.userId));t&&(t.isblocked=!!e.userBlocked)}else if(e.contactRemoved){const t=this.confirmedContacts.findIndex((t=>t.id==e.userId));t>=0&&this.confirmedContacts.splice(t,1)}else e.contactRequestConfirmed&&this.confirmedFetchData(!0);if(e.contactRequestConfirmed||e.contactRequestDeclined){const t=this.requests.findIndex((t=>t.id==e.userId));t>=0&&this.requests.splice(t,1)}}),g.b.getCurrentSiteId())}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){l.a.getContactRequestsCount(this.siteId),"confirmed"===this.selected?yield this.initConfirmed():yield this.initRequests()}))}initConfirmed(){return Object(r.a)(this,void 0,void 0,(function*(){if(!this.confirmedInitialising)try{this.confirmedInitialising=!0,yield this.confirmedFetchData(),this.confirmedContacts.length&&i.a.isTablet&&this.selectUser(this.confirmedContacts[0].id,!0)}finally{this.confirmedInitialising=!1,this.confirmedLoaded=!0}}))}initRequests(){return Object(r.a)(this,void 0,void 0,(function*(){if(!this.requestsInitialising)try{this.requestsInitialising=!0,yield this.requestsFetchData(),this.requests.length&&i.a.isTablet&&this.selectUser(this.requests[0].id,!0)}finally{this.requestsInitialising=!1,this.requestsLoaded=!0}}))}confirmedFetchData(e=!1){return Object(r.a)(this,void 0,void 0,(function*(){this.confirmedLoadMoreError=!1;const t=e?0:this.confirmedContacts.length;0===t&&(yield l.a.invalidateUserContacts());try{const n=yield l.a.getUserContacts(t);this.confirmedContacts=e?n.contacts:this.confirmedContacts.concat(n.contacts),this.confirmedCanLoadMore=n.canLoadMore}catch(e){this.confirmedLoadMoreError=!0,m.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))}requestsFetchData(e=!1){return Object(r.a)(this,void 0,void 0,(function*(){this.requestsLoadMoreError=!1;const t=e?0:this.requests.length;0===t&&(yield l.a.invalidateContactRequestsCache());try{const n=yield l.a.getContactRequests(t);this.requests=e?n.requests:this.requests.concat(n.requests),this.requestsCanLoadMore=n.canLoadMore}catch(e){this.requestsLoadMoreError=!0,m.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))}refreshData(e){return Object(r.a)(this,void 0,void 0,(function*(){try{"confirmed"==this.selected?yield this.confirmedFetchData(!0):(l.a.refreshContactRequestsCount(),yield this.requestsFetchData(!0))}finally{null==e?void 0:e.complete()}}))}loadMore(e){return Object(r.a)(this,void 0,void 0,(function*(){try{"confirmed"==this.selected?yield this.confirmedFetchData():yield this.requestsFetchData()}finally{e&&e()}}))}gotoSearch(){_.a.navigateToSitePath("search")}selectTab(e){"confirmed"!==e&&"requests"!==e||(this.selected=e,"confirmed"!=this.selected||this.confirmedLoaded||this.initConfirmed(),"requests"!=this.selected||this.requestsLoaded||this.initRequests())}selectUser(e,t=!1){if(e==this.selectedUserId&&i.a.isTablet)return;if(t&&i.a.isMobile)return;this.selectedUserId=e;const n=_.a.isCurrentPathInTablet("**/messages/contacts/discussion");_.a.navigate((n?"../":"")+"discussion",{params:{userId:e}})}ngOnDestroy(){var e;null===(e=this.contactRequestsCountObserver)||void 0===e?void 0:e.off()}}return AddonMessagesContactsPage.ɵfac=function AddonMessagesContactsPage_Factory(e){return new(e||AddonMessagesContactsPage)},AddonMessagesContactsPage.ɵcmp=u.sc({type:AddonMessagesContactsPage,selectors:[["page-addon-messages-contacts"]],decls:22,vars:17,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["name","fas-search","slot","icon-only","aria-hidden","true"],[3,"hideUntil"],[3,"title","ionSelect"],["badgeA11yText","addon.messages.pendingcontactrequests",3,"title","badge","ionSelect"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["class","ion-no-margin",4,"ngIf"],["icon","far-address-book",3,"message",4,"ngIf"],["position","bottom",3,"enabled","error","action"],[1,"ion-no-margin"],["class","ion-text-wrap addon-messages-conversation-item","button","","detail","true",3,"click",4,"ngFor","ngForOf"],["button","","detail","true",1,"ion-text-wrap","addon-messages-conversation-item",3,"click"],["slot","start",3,"user","checkOnline","linkProfile"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash","slot","end",4,"ngIf"],["name","fas-user-slash","slot","end"],["icon","far-address-book",3,"message"],["slot","start",3,"user","linkProfile"],[4,"ngIf"]],template:function AddonMessagesContactsPage_Template(e,t){1&e&&(u.Ec(0,"ion-header"),u.Ec(1,"ion-toolbar"),u.Ec(2,"ion-buttons",0),u.zc(3,"ion-back-button",1),u.Pc(4,"translate"),u.Dc(),u.Ec(5,"ion-title"),u.Ec(6,"h1"),u.pd(7),u.Pc(8,"translate"),u.Dc(),u.Dc(),u.Ec(9,"ion-buttons",2),u.Ec(10,"ion-button",3),u.Mc("click",(function AddonMessagesContactsPage_Template_ion_button_click_10_listener(){return t.gotoSearch()})),u.Pc(11,"translate"),u.zc(12,"ion-icon",4),u.Dc(),u.Dc(),u.Dc(),u.Dc(),u.Ec(13,"ion-content"),u.Ec(14,"core-split-view"),u.Ec(15,"core-tabs",5),u.Ec(16,"core-tab",6),u.Mc("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_16_listener(){return t.selectTab("confirmed")})),u.Pc(17,"translate"),u.nd(18,AddonMessagesContactsPage_ng_template_18_Template,7,9,"ng-template"),u.Dc(),u.Ec(19,"core-tab",7),u.Mc("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_19_listener(){return t.selectTab("requests")})),u.Pc(20,"translate"),u.nd(21,AddonMessagesContactsPage_ng_template_21_Template,7,9,"ng-template"),u.Dc(),u.Dc(),u.Dc(),u.Dc()),2&e&&(u.lc(3),u.Vc("text",u.Qc(4,7,"core.back")),u.lc(4),u.qd(u.Qc(8,9,"addon.messages.contacts")),u.lc(3),u.mc("aria-label",u.Qc(11,11,"addon.messages.searchcombined")),u.lc(5),u.Vc("hideUntil",!0),u.lc(1),u.Vc("title",u.Qc(17,13,"addon.messages.contacts")),u.lc(3),u.Vc("title",u.Qc(20,15,"addon.messages.requests"))("badge",t.requestsBadge))},directives:[f.C,f.Ab,f.m,f.h,f.i,f.yb,h.a,f.l,f.D,M.a,C.a,f.v,P.a,p.a,O.a,f.bb,f.cb,b.a,v.t,x.a,f.P,v.s,f.I,q.a,f.O,A.a,T.a],pipes:[E.d],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContactsPage})();const D=[{path:"",component:y},a.AddonMessagesDiscussionRoute],I=[{path:"",component:y,children:[a.AddonMessagesDiscussionRoute]}],k=[...Object(o.c)(D,(()=>i.a.isMobile)),...Object(o.c)(I,(()=>i.a.isTablet))];let w=(()=>{class AddonMessagesContactsPageModule{}return AddonMessagesContactsPageModule.ɵmod=u.wc({type:AddonMessagesContactsPageModule}),AddonMessagesContactsPageModule.ɵinj=u.vc({factory:function AddonMessagesContactsPageModule_Factory(e){return new(e||AddonMessagesContactsPageModule)},imports:[[s.m.forChild(k),c.a],s.m]}),AddonMessagesContactsPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&u.kd(w,{declarations:[y],imports:[s.m,c.a],exports:[s.m]}))}}]);