{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{MncD:function(e,n,t){\"use strict\";t.r(n),t.d(n,\"AddonCalendarDayPageModule\",(function(){return $}));var a=t(\"tyNb\"),o=t(\"L3Fv\"),i=t(\"9Xwr\"),d=t(\"mrSG\"),r=t(\"GGba\"),c=t(\"fjkH\"),l=t(\"9+EE\"),s=t(\"3LXp\"),m=t(\"Q98t\"),_=t(\"SmTL\"),u=t(\"Lc7R\"),g=t(\"n6RP\"),v=t(\"+lfu\"),h=t(\"Xzvb\"),f=t(\"ZSwf\"),y=t(\"kLT3\"),p=t(\"f0Wu\"),E=t.n(p),D=t(\"j3ag\"),b=t(\"pHTc\"),C=t(\"bFG1\"),P=t(\"BaYo\"),O=t(\"xQjX\"),I=t(\"MpCO\"),A=t(\"+0Ti\"),T=t(\"baaQ\"),M=t(\"51vF\"),S=t(\"fXoL\"),x=t(\"TEn/\"),w=t(\"ACYt\"),k=t(\"3CSS\"),N=t(\"fQ68\"),V=t(\"ofXK\"),j=t(\"8/N+\"),F=t(\"nt/U\"),z=t(\"PgjG\"),L=t(\"r8G5\"),Q=t(\"hMzs\"),R=t(\"eAud\"),U=t(\"yNDK\"),G=t(\"sYmb\");function AddonCalendarDayPage_core_context_menu_item_14_Template(e,n){if(1&e){const e=S.Fc();S.Ec(0,\"core-context-menu-item\",20),S.Mc(\"action\",(function AddonCalendarDayPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){S.fd(e);return S.Oc().goToCurrentDay()})),S.Pc(1,\"translate\"),S.Dc()}2&e&&S.Vc(\"priority\",900)(\"content\",S.Qc(1,2,\"addon.calendar.today\"))}const _c0=function(e){return{$a:e}};function AddonCalendarDayPage_ng_template_37_ion_card_1_Template(e,n){1&e&&(S.Ec(0,\"ion-card\",24),S.Ec(1,\"ion-item\"),S.zc(2,\"ion-icon\",25),S.Ec(3,\"ion-label\"),S.pd(4),S.Pc(5,\"translate\"),S.Pc(6,\"translate\"),S.Dc(),S.Dc(),S.Dc()),2&e&&(S.lc(4),S.qd(S.Rc(5,1,\"core.hasdatatosync\",S.ad(6,_c0,S.Qc(6,4,\"core.day\")))))}function AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template(e,n){1&e&&(S.zc(0,\"core-empty-box\",26),S.Pc(1,\"translate\")),2&e&&S.Vc(\"message\",S.Qc(1,1,\"addon.calendar.noevents\"))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template(e,n){if(1&e&&S.zc(0,\"core-mod-icon\",38),2&e){const e=S.Oc().$implicit;S.Vc(\"modicon\",e.moduleIcon)(\"showAlt\",!1)(\"modname\",e.modulename)(\"componentId\",e.instance)(\"purpose\",e.purpose)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template(e,n){if(1&e&&S.zc(0,\"ion-icon\",39),2&e){const e=S.Oc().$implicit;S.Vc(\"name\",e.eventIcon)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template(e,n){if(1&e&&(S.Ec(0,\"span\",32),S.pd(1),S.Dc()),2&e){const e=S.Oc().$implicit;S.lc(1),S.qd(e.iconTitle)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_13_Template(e,n){1&e&&(S.Ec(0,\"ion-note\",2),S.zc(1,\"ion-icon\",40),S.Ec(2,\"span\",41),S.pd(3),S.Pc(4,\"translate\"),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.qd(S.Qc(4,1,\"core.notsent\")))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template(e,n){1&e&&(S.Ec(0,\"ion-note\",2),S.zc(1,\"ion-icon\",42),S.Ec(2,\"span\",41),S.pd(3),S.Pc(4,\"translate\"),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.qd(S.Qc(4,1,\"core.deletedoffline\")))}const _c1=function(e){return[e]};function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template(e,n){if(1&e){const e=S.Fc();S.Cc(0),S.Ec(1,\"ion-card\"),S.Ec(2,\"ion-item\",29),S.Mc(\"click\",(function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template_ion_item_click_2_listener(){S.fd(e);const t=n.$implicit,a=S.Oc(2).item;return S.Oc().gotoEvent(t.id,a)})),S.nd(3,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template,1,5,\"core-mod-icon\",30),S.nd(4,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template,1,1,\"ion-icon\",31),S.Ec(5,\"ion-label\"),S.Ec(6,\"span\",32),S.pd(7),S.Pc(8,\"translate\"),S.nd(9,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template,2,1,\"span\",33),S.Dc(),S.Ec(10,\"p\",34),S.zc(11,\"core-format-text\",35),S.Dc(),S.zc(12,\"p\",36),S.Dc(),S.nd(13,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_13_Template,5,3,\"ion-note\",37),S.nd(14,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template,5,3,\"ion-note\",37),S.Dc(),S.Dc(),S.Bc()}if(2&e){const e=n.$implicit;S.lc(2),S.qc(\"item-dimmed\",e.ispast),S.Vc(\"ngClass\",S.ad(17,_c1,\"addon-calendar-eventtype-\"+e.eventtype))(\"detail\",!1),S.mc(\"aria-label\",e.name),S.lc(1),S.Vc(\"ngIf\",e.moduleIcon),S.lc(1),S.Vc(\"ngIf\",e.eventIcon&&!e.moduleIcon),S.lc(3),S.rd(\" \",S.Qc(8,15,\"addon.calendar.type\"+e.formattedType),\" \"),S.lc(2),S.Vc(\"ngIf\",e.moduleIcon&&e.iconTitle),S.lc(2),S.Vc(\"text\",e.name)(\"contextLevel\",e.contextLevel)(\"contextInstanceId\",e.contextInstanceId),S.lc(1),S.Vc(\"innerHTML\",e.formattedtime,S.gd),S.lc(1),S.Vc(\"ngIf\",e.offline&&!e.deleted),S.lc(1),S.Vc(\"ngIf\",e.deleted)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_Template(e,n){if(1&e&&(S.Ec(0,\"ion-list\",27),S.nd(1,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template,15,19,\"ng-container\",28),S.Dc()),2&e){const e=S.Oc().item;S.lc(1),S.Vc(\"ngForOf\",e.filteredEvents)}}function AddonCalendarDayPage_ng_template_37_Template(e,n){if(1&e&&(S.Ec(0,\"core-loading\",9),S.nd(1,AddonCalendarDayPage_ng_template_37_ion_card_1_Template,7,8,\"ion-card\",21),S.nd(2,AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template,2,3,\"core-empty-box\",22),S.nd(3,AddonCalendarDayPage_ng_template_37_ion_list_3_Template,2,1,\"ion-list\",23),S.Dc()),2&e){const e=n.item;S.Vc(\"hideUntil\",e.loaded),S.lc(1),S.Vc(\"ngIf\",e.hasOffline),S.lc(1),S.Vc(\"ngIf\",!e.filteredEvents||!e.filteredEvents.length),S.lc(1),S.Vc(\"ngIf\",e.filteredEvents&&e.filteredEvents.length)}}function AddonCalendarDayPage_ion_fab_38_Template(e,n){if(1&e){const e=S.Fc();S.Ec(0,\"ion-fab\",43),S.Ec(1,\"ion-fab-button\",44),S.Mc(\"click\",(function AddonCalendarDayPage_ion_fab_38_Template_ion_fab_button_click_1_listener(){S.fd(e);return S.Oc().openEdit()})),S.Pc(2,\"translate\"),S.zc(3,\"ion-icon\",45),S.Ec(4,\"span\",32),S.pd(5),S.Pc(6,\"translate\"),S.Dc(),S.Dc(),S.Dc()}2&e&&(S.lc(1),S.mc(\"aria-label\",S.Qc(2,2,\"addon.calendar.newevent\")),S.lc(4),S.qd(S.Qc(6,4,\"addon.calendar.newevent\")))}let q=(()=>{class AddonCalendarDayPage{constructor(){this.loaded=!1,this.isOnline=!1,this.syncIcon=P.a.ICON_LOADING,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=l.b.getCurrentSiteId(),this.newEventObserver=c.b.on(_.c.NEW_EVENT_EVENT,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId),this.discardedObserver=c.b.on(_.c.NEW_EVENT_DISCARDED_EVENT,(()=>{var e;null===(e=this.manager)||void 0===e?void 0:e.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0)}),this.currentSiteId),this.editEventObserver=c.b.on(_.c.EDIT_EVENT_EVENT,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId),this.syncObserver=c.b.on(v.b.AUTO_SYNCED,(()=>{var e;null===(e=this.manager)||void 0===e?void 0:e.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0)}),this.currentSiteId),this.manualSyncObserver=c.b.on(v.b.MANUAL_SYNCED,(e=>{var n,t;const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();!e||\"day\"==e.source&&a&&e.moment&&a.moment.isSame(e.moment,\"day\")||(null===(t=this.manager)||void 0===t?void 0:t.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId),this.deleteEventObserver=c.b.on(_.c.DELETED_EVENT_EVENT,(e=>{var n,t;e&&!e.sent?null===(n=this.manager)||void 0===n?void 0:n.getSource().markAsDeleted(e.eventId,!0):(null===(t=this.manager)||void 0===t?void 0:t.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId),this.undeleteEventObserver=c.b.on(_.c.UNDELETED_EVENT_EVENT,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAsDeleted(e.eventId,!1))}),this.currentSiteId),this.filterChangedObserver=c.b.on(_.c.FILTER_CHANGED_EVENT,(e=>Object(d.a)(this,void 0,void 0,(function*(){var n,t;this.filter=e,yield null===(n=this.manager)||void 0===n?void 0:n.getSource().loadCanCreate(this.filter.courseId),null===(t=this.manager)||void 0===t||t.getSource().filterAllDayEvents(this.filter)})))),this.onlineObserver=r.a.onChange().subscribe((()=>{D.A.run((()=>{this.isOnline=r.a.isOnline()}))}))}ngOnInit(){const e=[];C.a.enumKeys(_.b).forEach((n=>{var t;const a=_.b[n];this.filter[n]=null===(t=b.a.getRouteBooleanParam(n))||void 0===t||t,e.push(a)})),this.filter.courseId=b.a.getRouteNumberParam(\"courseId\"),this.filter.categoryId=b.a.getRouteNumberParam(\"categoryId\"),this.filter.filtered=void 0!==this.filter.courseId||e.some((e=>!this.filter[e]));const n=b.a.getRouteNumberParam(\"month\"),t=new day_page_AddonCalendarDaySlidesItemsManagerSource(this,E()({year:b.a.getRouteNumberParam(\"year\"),month:n?n-1:void 0,date:b.a.getRouteNumberParam(\"day\")}));this.manager=new O.a(t),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onDayViewed(e)}}),this.fetchData(!0)}get canCreate(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().canCreate)||!1}get timeFormat(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().timeFormat)||\"core.strftimetime\"}fetchData(e){var n,t,a;return Object(d.a)(this,void 0,void 0,(function*(){this.syncIcon=P.a.ICON_LOADING,this.isOnline=r.a.isOnline(),e&&(yield this.sync());try{yield null===(n=this.manager)||void 0===n?void 0:n.getSource().fetchData(this.filter.courseId),yield null===(t=this.manager)||void 0===t?void 0:t.getSource().load(null===(a=this.manager)||void 0===a?void 0:a.getSelectedItem())}catch(e){s.a.showErrorModalDefault(e,\"addon.calendar.errorloadevents\",!0)}this.loaded=!0,this.syncIcon=P.a.ICON_SYNC}))}onDayViewed(e){this.periodName=m.a.userDate(1e3*e.moment.unix(),\"core.strftimedaydate\")}doRefresh(e,n){return Object(d.a)(this,void 0,void 0,(function*(){this.loaded&&(yield this.refreshData(!0).finally((()=>{null==e?void 0:e.complete(),n&&n()})))}))}refreshData(e,n){var t,a;return Object(d.a)(this,void 0,void 0,(function*(){this.syncIcon=P.a.ICON_LOADING;const o=(null===(t=this.manager)||void 0===t?void 0:t.getSelectedItem())||null;yield null===(a=this.manager)||void 0===a?void 0:a.getSource().invalidateContent(o,!n),yield this.fetchData(e)}))}sync(e){var n,t;return Object(d.a)(this,void 0,void 0,(function*(){try{const e=yield v.a.syncEvents();if(e.warnings&&e.warnings.length&&s.a.showErrorModal(e.warnings[0]),e.updated){const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();e.source=\"day\",e.moment=null==a?void 0:a.moment,null===(t=this.manager)||void 0===t||t.getSource().markAllItemsUnloaded(),c.b.trigger(v.b.MANUAL_SYNCED,e,this.currentSiteId)}}catch(n){e&&s.a.showErrorModalDefault(n,\"core.errorsync\",!0)}}))}selectedDayIsCurrent(){var e,n;return!!(null===(n=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem())||void 0===n?void 0:n.isCurrentDay)}gotoEvent(e,n){b.a.navigateToSitePath(`/calendar/event/${e}`,{params:{date:n.moment.format(\"MMDDY\")}})}openFilter(){var e;return Object(d.a)(this,void 0,void 0,(function*(){yield s.a.openSideModal({component:y.a,componentProps:{courses:null===(e=this.manager)||void 0===e?void 0:e.getSource().courses,filter:this.filter}})}))}openEdit(e){var n;const t={};if(!e){e=0;const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();if(a){const e=E()();t.timestamp=1e3*a.moment.clone().set({hour:e.hour(),minute:e.minute()}).unix()}}this.filter.courseId&&(t.courseId=this.filter.courseId),b.a.navigateToSitePath(`/calendar/edit/${e}`,{params:t})}selectedDayHasOffline(){var e;const n=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();return!!(null==n?void 0:n.hasOffline)}goToCurrentDay(){return Object(d.a)(this,void 0,void 0,(function*(){const e=this.manager,n=this.slides;if(!e||!n)return;const t={moment:E()()};this.loaded=!1;try{yield e.getSource().loadItem(t),n.slideToItem(t)}catch(e){s.a.showErrorModalDefault(e,\"addon.calendar.errorloadevents\",!0)}finally{this.loaded=!0}}))}loadNext(){var e;return Object(d.a)(this,void 0,void 0,(function*(){null===(e=this.slides)||void 0===e?void 0:e.slideNext()}))}loadPrevious(){var e;return Object(d.a)(this,void 0,void 0,(function*(){null===(e=this.slides)||void 0===e?void 0:e.slidePrev()}))}ngOnDestroy(){var e,n,t,a,o,i,d,r,c,l,s;null===(e=this.newEventObserver)||void 0===e?void 0:e.off(),null===(n=this.discardedObserver)||void 0===n||n.off(),null===(t=this.editEventObserver)||void 0===t||t.off(),null===(a=this.deleteEventObserver)||void 0===a||a.off(),null===(o=this.undeleteEventObserver)||void 0===o||o.off(),null===(i=this.syncObserver)||void 0===i||i.off(),null===(d=this.manualSyncObserver)||void 0===d||d.off(),null===(r=this.onlineObserver)||void 0===r||r.unsubscribe(),null===(c=this.filterChangedObserver)||void 0===c||c.off(),null===(l=this.manager)||void 0===l||l.getSource().forgetRelatedSources(),null===(s=this.manager)||void 0===s||s.destroy(),this.managerUnsubscribe&&this.managerUnsubscribe()}}return AddonCalendarDayPage.ɵfac=function AddonCalendarDayPage_Factory(e){return new(e||AddonCalendarDayPage)},AddonCalendarDayPage.ɵcmp=S.sc({type:AddonCalendarDayPage,selectors:[[\"page-addon-calendar-day\"]],viewQuery:function AddonCalendarDayPage_Query(e,n){var t;(1&e&&S.ud(I.a,!0),2&e)&&(S.dd(t=S.Nc())&&(n.slides=t.first))},decls:39,vars:31,consts:[[\"slot\",\"start\"],[3,\"text\"],[\"slot\",\"end\"],[\"fill\",\"clear\",3,\"click\"],[\"slot\",\"icon-only\",\"name\",\"fas-filter\",\"aria-hidden\",\"true\"],[\"iconAction\",\"fas-calendar-day\",3,\"priority\",\"content\",\"action\",4,\"ngIf\"],[3,\"hidden\",\"priority\",\"content\",\"iconAction\",\"closeOnClick\",\"action\"],[\"slot\",\"fixed\",3,\"disabled\",\"ionRefresh\"],[3,\"pullingText\"],[3,\"hideUntil\"],[1,\"core-swipe-slides-container\"],[1,\"ion-no-padding\",\"safe-area-padding\"],[1,\"ion-align-items-center\"],[1,\"ion-text-start\"],[\"name\",\"fas-chevron-left\",\"slot\",\"icon-only\",\"aria-hidden\",\"true\"],[1,\"ion-text-center\",\"addon-calendar-period\"],[1,\"ion-text-end\"],[\"name\",\"fas-chevron-right\",\"slot\",\"icon-only\",\"aria-hidden\",\"true\"],[3,\"manager\"],[\"slot\",\"fixed\",\"core-fab\",\"\",\"vertical\",\"bottom\",\"horizontal\",\"end\",4,\"ngIf\"],[\"iconAction\",\"fas-calendar-day\",3,\"priority\",\"content\",\"action\"],[\"class\",\"core-warning-card list-item-limited-width\",4,\"ngIf\"],[\"icon\",\"fas-calendar\",3,\"message\",4,\"ngIf\"],[\"class\",\"list-item-limited-width\",4,\"ngIf\"],[1,\"core-warning-card\",\"list-item-limited-width\"],[\"name\",\"fas-exclamation-triangle\",\"slot\",\"start\",\"aria-hidden\",\"true\"],[\"icon\",\"fas-calendar\",3,\"message\"],[1,\"list-item-limited-width\"],[4,\"ngFor\",\"ngForOf\"],[\"button\",\"\",1,\"addon-calendar-event\",\"ion-text-wrap\",3,\"ngClass\",\"detail\",\"click\"],[\"slot\",\"start\",3,\"modicon\",\"showAlt\",\"modname\",\"componentId\",\"purpose\",4,\"ngIf\"],[\"slot\",\"start\",\"aria-hidden\",\"true\",3,\"name\",4,\"ngIf\"],[1,\"sr-only\"],[\"class\",\"sr-only\",4,\"ngIf\"],[1,\"item-heading\"],[3,\"text\",\"contextLevel\",\"contextInstanceId\"],[3,\"innerHTML\"],[\"slot\",\"end\",4,\"ngIf\"],[\"slot\",\"start\",3,\"modicon\",\"showAlt\",\"modname\",\"componentId\",\"purpose\"],[\"slot\",\"start\",\"aria-hidden\",\"true\",3,\"name\"],[\"name\",\"fas-clock\",\"aria-hidden\",\"true\"],[1,\"ion-text-wrap\"],[\"name\",\"fas-trash\",\"aria-hidden\",\"true\"],[\"slot\",\"fixed\",\"core-fab\",\"\",\"vertical\",\"bottom\",\"horizontal\",\"end\"],[3,\"click\"],[\"name\",\"fas-plus\",\"aria-hidden\",\"true\"]],template:function AddonCalendarDayPage_Template(e,n){1&e&&(S.Ec(0,\"ion-header\"),S.Ec(1,\"ion-toolbar\"),S.Ec(2,\"ion-buttons\",0),S.zc(3,\"ion-back-button\",1),S.Pc(4,\"translate\"),S.Dc(),S.Ec(5,\"ion-title\"),S.Ec(6,\"h1\"),S.pd(7),S.Pc(8,\"translate\"),S.Dc(),S.Dc(),S.Ec(9,\"ion-buttons\",2),S.Ec(10,\"ion-button\",3),S.Mc(\"click\",(function AddonCalendarDayPage_Template_ion_button_click_10_listener(){return n.openFilter()})),S.Pc(11,\"translate\"),S.zc(12,\"ion-icon\",4),S.Dc(),S.Ec(13,\"core-context-menu\"),S.nd(14,AddonCalendarDayPage_core_context_menu_item_14_Template,2,4,\"core-context-menu-item\",5),S.Ec(15,\"core-context-menu-item\",6),S.Mc(\"action\",(function AddonCalendarDayPage_Template_core_context_menu_item_action_15_listener(e){return n.doRefresh(void 0,e)})),S.Pc(16,\"translate\"),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Ec(17,\"ion-content\"),S.Ec(18,\"ion-refresher\",7),S.Mc(\"ionRefresh\",(function AddonCalendarDayPage_Template_ion_refresher_ionRefresh_18_listener(e){return n.doRefresh(e.target)})),S.zc(19,\"ion-refresher-content\",8),S.Pc(20,\"translate\"),S.Dc(),S.Ec(21,\"core-loading\",9),S.Ec(22,\"div\",10),S.Ec(23,\"ion-grid\",11),S.Ec(24,\"ion-row\",12),S.Ec(25,\"ion-col\",13),S.Ec(26,\"ion-button\",3),S.Mc(\"click\",(function AddonCalendarDayPage_Template_ion_button_click_26_listener(){return n.loadPrevious()})),S.Pc(27,\"translate\"),S.zc(28,\"ion-icon\",14),S.Dc(),S.Dc(),S.Ec(29,\"ion-col\",15),S.Ec(30,\"h3\"),S.pd(31),S.Dc(),S.Dc(),S.Ec(32,\"ion-col\",16),S.Ec(33,\"ion-button\",3),S.Mc(\"click\",(function AddonCalendarDayPage_Template_ion_button_click_33_listener(){return n.loadNext()})),S.Pc(34,\"translate\"),S.zc(35,\"ion-icon\",17),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Ec(36,\"core-swipe-slides\",18),S.nd(37,AddonCalendarDayPage_ng_template_37_Template,4,4,\"ng-template\"),S.Dc(),S.Dc(),S.Dc(),S.nd(38,AddonCalendarDayPage_ion_fab_38_Template,7,6,\"ion-fab\",19),S.Dc()),2&e&&(S.lc(3),S.Vc(\"text\",S.Qc(4,17,\"core.back\")),S.lc(4),S.qd(S.Qc(8,19,\"addon.calendar.calendarevents\")),S.lc(3),S.mc(\"aria-label\",S.Qc(11,21,\"core.filter\")),S.lc(4),S.Vc(\"ngIf\",!n.selectedDayIsCurrent()),S.lc(1),S.Vc(\"hidden\",!n.loaded||!n.selectedDayHasOffline()||!n.isOnline)(\"priority\",400)(\"content\",S.Qc(16,23,\"core.settings.synchronizenow\"))(\"iconAction\",n.syncIcon)(\"closeOnClick\",!1),S.lc(3),S.Vc(\"disabled\",!n.loaded),S.lc(1),S.Wc(\"pullingText\",S.Qc(20,25,\"core.pulltorefresh\")),S.lc(2),S.Vc(\"hideUntil\",n.loaded),S.lc(5),S.mc(\"aria-label\",S.Qc(27,27,\"addon.calendar.dayprev\")),S.lc(5),S.qd(n.periodName),S.lc(2),S.mc(\"aria-label\",S.Qc(34,29,\"addon.calendar.daynext\")),S.lc(3),S.Vc(\"manager\",n.manager),S.lc(2),S.Vc(\"ngIf\",n.canCreate&&n.loaded))},directives:[x.C,x.Ab,x.m,x.h,x.i,x.yb,w.a,x.l,x.D,k.a,N.a,V.t,j.a,F.a,x.v,x.bb,x.cb,z.a,x.B,x.hb,x.u,I.a,x.n,x.I,x.O,L.a,x.P,V.s,V.q,Q.a,R.a,x.W,x.x,U.a,x.y],pipes:[G.d],styles:[\"[_nghost-%COMP%]{--addon-calendar-blank-day-background-color:var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical:12px;--margin-end:12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-right:var(--margin-end)}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:var(--margin-end);margin-inline-end:var(--margin-end)}}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}\",\"[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{flex:none;width:100%}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]{flex-grow:3}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:10px;font-size:1.2rem}\"]}),AddonCalendarDayPage})();class day_page_AddonCalendarDaySlidesItemsManagerSource extends A.a{constructor(e,n){super({moment:n}),this.courses=[],this.eventsSources=new Set,this.offlineEvents={},this.offlineEditedEventsIds=[],this.canCreate=!1,this.dayPage=e}fetchData(e){return Object(d.a)(this,void 0,void 0,(function*(){yield Promise.all([this.loadCourses(e),this.loadCanCreate(e),this.loadCategories(),this.loadOfflineEvents(),this.loadOfflineDeletedEvents(),this.loadTimeFormat()])}))}filterAllDayEvents(e){var n;null===(n=this.getItems())||void 0===n?void 0:n.forEach((n=>this.filterEvents(n,e)))}filterEvents(e,n){e.filteredEvents=g.b.getFilteredEvents(e.events||[],n,this.categories||{}),this.rememberEventsList(e)}loadCourses(e){return Object(d.a)(this,void 0,void 0,(function*(){const n=yield f.a.getCoursesForPopover(e);this.courses=n.courses}))}loadCanCreate(e){return Object(d.a)(this,void 0,void 0,(function*(){this.canCreate=yield g.b.canEditEvents(e)}))}loadCategories(){return Object(d.a)(this,void 0,void 0,(function*(){if(!this.categories)try{const e=yield h.a.getCategories(0,!0);this.categories=C.a.arrayToObject(e,\"id\")}catch(e){}}))}loadOfflineEvents(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield u.a.getAllEditedEvents();this.offlineEvents=g.b.classifyIntoMonths(e),this.offlineEditedEventsIds=e.filter((e=>e.id>0)).map((e=>e.id))}))}loadOfflineDeletedEvents(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield u.a.getAllDeletedEventsIds();this.deletedEvents=new Set(e)}))}loadTimeFormat(){return Object(d.a)(this,void 0,void 0,(function*(){this.timeFormat=yield _.a.getCalendarTimeFormat()}))}getItemId(e){return g.b.getDayId(e.moment)}getPreviousItem(e){return{moment:e.moment.clone().subtract(1,\"day\")}}getNextItem(e){return{moment:e.moment.clone().add(1,\"day\")}}loadItemData(e,n=!1){return Object(d.a)(this,void 0,void 0,(function*(){const t=Object.assign(Object.assign({},e),{hasOffline:!1,events:[],onlineEvents:[],filteredEvents:[],isCurrentDay:e.moment.isSame(E()(),\"day\"),isPastDay:e.moment.isBefore(E()(),\"day\")});if(n)return t;let a;try{a=yield _.a.getDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date()),t.onlineEvents=a.events.map((e=>g.b.formatEventData(e)))}catch(e){if(r.a.isOnline())throw e}t.events=this.mergeEvents(t),this.filterEvents(t,this.dayPage.filter);const o=1e3*e.moment.unix(),i=m.a.timestamp(),c=t.events.map((e=>Object(d.a)(this,void 0,void 0,(function*(){e.ispast=t.isPastDay||t.isCurrentDay&&this.isEventPast(e,i),e.formattedtime=yield _.a.formatEventTime(e,this.dayPage.timeFormat,!0,o)}))));return yield Promise.all(c),t}))}isEventPast(e,n){return e.timestart+e.timeduration<n}mergeEvents(e){var n,t,a;if(e.hasOffline=!1,!Object.keys(this.offlineEvents).length&&!(null===(n=this.deletedEvents)||void 0===n?void 0:n.size))return e.onlineEvents||[];const o=this.offlineEvents[g.b.getMonthId(e.moment)],i=o&&o[e.moment.date()];let d=e.onlineEvents||[];return(null===(t=this.deletedEvents)||void 0===t?void 0:t.size)&&d.forEach((n=>{var t;n.deleted=null===(t=this.deletedEvents)||void 0===t?void 0:t.has(n.id),n.deleted&&(e.hasOffline=!0)})),this.offlineEditedEventsIds.length&&(d=d.filter((e=>-1==this.offlineEditedEventsIds.indexOf(e.id))),d.length!=(null===(a=e.onlineEvents)||void 0===a?void 0:a.length)&&(e.hasOffline=!0)),i&&i.length&&(e.hasOffline=!0,d=g.b.sortEvents(d.concat(i))),d}invalidateContent(e,n){return Object(d.a)(this,void 0,void 0,(function*(){const t=[];n&&e&&t.push(_.a.invalidateDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date())),t.push(_.a.invalidateAllowedEventTypes()),t.push(h.a.invalidateCategories(0,!0)),t.push(_.a.invalidateTimeFormat()),this.categories=void 0,e&&(e.dirty=!0),yield Promise.all(t)}))}markAsDeleted(e,n){var t,a,o;null===(t=this.getItems())||void 0===t?void 0:t.some((t=>{var a,o,i,d;const r=null===(a=t.onlineEvents)||void 0===a?void 0:a.find((n=>n.id==e));return!!r&&(r.deleted=n,t.hasOffline=!!n||((null===(o=t.events)||void 0===o?void 0:o.length)!=(null===(i=t.onlineEvents)||void 0===i?void 0:i.length)||(null===(d=t.events)||void 0===d?void 0:d.some((e=>e.deleted||e.offline)))),!0)})),n?null===(a=this.deletedEvents)||void 0===a||a.add(e):null===(o=this.deletedEvents)||void 0===o||o.delete(e)}forgetRelatedSources(){for(const e of this.eventsSources)T.a.removeReference(e,this)}rememberEventsList(e){var n;return Object(d.a)(this,void 0,void 0,(function*(){const t=T.a.getOrCreateSource(M.a,[e.moment.format(\"MMDDY\")]);this.eventsSources.has(t)||(this.eventsSources.add(t),T.a.addReference(t,this)),t.setEvents(null!==(n=e.filteredEvents)&&void 0!==n?n:[]),yield t.reload()}))}}const Y=[{path:\"\",component:q}];let $=(()=>{class AddonCalendarDayPageModule{}return AddonCalendarDayPageModule.ɵmod=S.wc({type:AddonCalendarDayPageModule}),AddonCalendarDayPageModule.ɵinj=S.vc({factory:function AddonCalendarDayPageModule_Factory(e){return new(e||AddonCalendarDayPageModule)},imports:[[a.m.forChild(Y),o.a,i.a],a.m]}),AddonCalendarDayPageModule})();void((\"undefined\"==typeof ngJitMode||ngJitMode)&&S.kd($,{declarations:[q],imports:[a.m,o.a,i.a],exports:[a.m]}))}}]);","name":"37.4070007e5cc84f890350.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[37],{\n\n/***/ \"MncD\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"AddonCalendarDayPageModule\", function() { return /* binding */ day_module_AddonCalendarDayPageModule; });\n\n// EXTERNAL MODULE: ./node_modules/@angular/router/__ivy_ngcc__/fesm2015/router.js + 10 modules\nvar router = __webpack_require__(\"tyNb\");\n\n// EXTERNAL MODULE: ./src/core/shared.module.ts + 3 modules\nvar shared_module = __webpack_require__(\"L3Fv\");\n\n// EXTERNAL MODULE: ./src/addons/calendar/components/components.module.ts\nvar components_module = __webpack_require__(\"9Xwr\");\n\n// EXTERNAL MODULE: ./node_modules/tslib/tslib.es6.js\nvar tslib_es6 = __webpack_require__(\"mrSG\");\n\n// EXTERNAL MODULE: ./src/core/services/network.ts + 2 modules\nvar network = __webpack_require__(\"GGba\");\n\n// EXTERNAL MODULE: ./src/core/singletons/events.ts\nvar singletons_events = __webpack_require__(\"fjkH\");\n\n// EXTERNAL MODULE: ./src/core/services/sites.ts\nvar sites = __webpack_require__(\"9+EE\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/dom.ts + 2 modules\nvar dom = __webpack_require__(\"3LXp\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/time.ts\nvar time = __webpack_require__(\"Q98t\");\n\n// EXTERNAL MODULE: ./src/addons/calendar/services/calendar.ts\nvar calendar = __webpack_require__(\"SmTL\");\n\n// EXTERNAL MODULE: ./src/addons/calendar/services/calendar-offline.ts\nvar calendar_offline = __webpack_require__(\"Lc7R\");\n\n// EXTERNAL MODULE: ./src/addons/calendar/services/calendar-helper.ts\nvar calendar_helper = __webpack_require__(\"n6RP\");\n\n// EXTERNAL MODULE: ./src/addons/calendar/services/calendar-sync.ts\nvar calendar_sync = __webpack_require__(\"+lfu\");\n\n// EXTERNAL MODULE: ./src/core/features/courses/services/courses.ts\nvar courses = __webpack_require__(\"Xzvb\");\n\n// EXTERNAL MODULE: ./src/core/features/courses/services/courses-helper.ts\nvar courses_helper = __webpack_require__(\"ZSwf\");\n\n// EXTERNAL MODULE: ./src/addons/calendar/components/filter/filter.ts\nvar filter_filter = __webpack_require__(\"kLT3\");\n\n// EXTERNAL MODULE: ./node_modules/moment-timezone/index.js\nvar moment_timezone = __webpack_require__(\"f0Wu\");\nvar moment_timezone_default = /*#__PURE__*/__webpack_require__.n(moment_timezone);\n\n// EXTERNAL MODULE: ./src/core/singletons/index.ts\nvar singletons = __webpack_require__(\"j3ag\");\n\n// EXTERNAL MODULE: ./src/core/services/navigator.ts\nvar services_navigator = __webpack_require__(\"pHTc\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/utils.ts\nvar utils = __webpack_require__(\"bFG1\");\n\n// EXTERNAL MODULE: ./src/core/constants.ts\nvar constants = __webpack_require__(\"BaYo\");\n\n// EXTERNAL MODULE: ./src/core/classes/items-management/swipe-slides-dynamic-items-manager.ts\nvar swipe_slides_dynamic_items_manager = __webpack_require__(\"xQjX\");\n\n// EXTERNAL MODULE: ./src/core/components/swipe-slides/swipe-slides.ts\nvar swipe_slides = __webpack_require__(\"MpCO\");\n\n// EXTERNAL MODULE: ./src/core/classes/items-management/swipe-slides-dynamic-items-manager-source.ts\nvar swipe_slides_dynamic_items_manager_source = __webpack_require__(\"+0Ti\");\n\n// EXTERNAL MODULE: ./src/core/classes/items-management/routed-items-manager-sources-tracker.ts\nvar routed_items_manager_sources_tracker = __webpack_require__(\"baaQ\");\n\n// EXTERNAL MODULE: ./src/addons/calendar/classes/events-source.ts\nvar events_source = __webpack_require__(\"51vF\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/core/__ivy_ngcc__/fesm2015/core.js\nvar core = __webpack_require__(\"fXoL\");\n\n// EXTERNAL MODULE: ./node_modules/@ionic/angular/__ivy_ngcc__/fesm2015/ionic-angular.js + 5 modules\nvar ionic_angular = __webpack_require__(\"TEn/\");\n\n// EXTERNAL MODULE: ./src/core/directives/update-non-reactive-attributes.ts\nvar update_non_reactive_attributes = __webpack_require__(\"ACYt\");\n\n// EXTERNAL MODULE: ./src/core/directives/fa-icon.ts\nvar fa_icon = __webpack_require__(\"3CSS\");\n\n// EXTERNAL MODULE: ./src/core/components/context-menu/context-menu.ts + 4 modules\nvar context_menu = __webpack_require__(\"fQ68\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/common/__ivy_ngcc__/fesm2015/common.js\nvar common = __webpack_require__(\"ofXK\");\n\n// EXTERNAL MODULE: ./src/core/components/context-menu/context-menu-item.ts\nvar context_menu_item = __webpack_require__(\"8/N+\");\n\n// EXTERNAL MODULE: ./src/core/directives/content.ts\nvar content = __webpack_require__(\"nt/U\");\n\n// EXTERNAL MODULE: ./src/core/components/loading/loading.ts\nvar loading = __webpack_require__(\"PgjG\");\n\n// EXTERNAL MODULE: ./src/core/components/empty-box/empty-box.ts\nvar empty_box = __webpack_require__(\"r8G5\");\n\n// EXTERNAL MODULE: ./src/core/directives/format-text.ts\nvar format_text = __webpack_require__(\"hMzs\");\n\n// EXTERNAL MODULE: ./src/core/components/mod-icon/mod-icon.ts\nvar mod_icon = __webpack_require__(\"eAud\");\n\n// EXTERNAL MODULE: ./src/core/directives/fab.ts\nvar fab = __webpack_require__(\"yNDK\");\n\n// EXTERNAL MODULE: ./node_modules/@ngx-translate/core/__ivy_ngcc__/fesm2015/ngx-translate-core.js + 8 modules\nvar ngx_translate_core = __webpack_require__(\"sYmb\");\n\n// CONCATENATED MODULE: ./src/addons/calendar/pages/day/day.page.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonCalendarDayPage_core_context_menu_item_14_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r4 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"core-context-menu-item\", 20);\n        core[\"Mc\" /* ɵɵlistener */](\"action\", function AddonCalendarDayPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r4); const ctx_r3 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r3.goToCurrentDay(); });\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"Vc\" /* ɵɵproperty */](\"priority\", 900)(\"content\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 2, \"addon.calendar.today\"));\n    }\n}\nconst _c0 = function (a0) { return { $a: a0 }; };\nfunction AddonCalendarDayPage_ng_template_37_ion_card_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-card\", 24);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-item\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 25);\n        core[\"Ec\" /* ɵɵelementStart */](3, \"ion-label\");\n        core[\"pd\" /* ɵɵtext */](4);\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Pc\" /* ɵɵpipe */](6, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](4);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Rc\" /* ɵɵpipeBind2 */](5, 1, \"core.hasdatatosync\", core[\"ad\" /* ɵɵpureFunction1 */](6, _c0, core[\"Qc\" /* ɵɵpipeBind1 */](6, 4, \"core.day\"))));\n    }\n}\nfunction AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-empty-box\", 26);\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n    }\n    if (rf & 2) {\n        core[\"Vc\" /* ɵɵproperty */](\"message\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"addon.calendar.noevents\"));\n    }\n}\nfunction AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-mod-icon\", 38);\n    }\n    if (rf & 2) {\n        const event_r10 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"Vc\" /* ɵɵproperty */](\"modicon\", event_r10.moduleIcon)(\"showAlt\", false)(\"modname\", event_r10.modulename)(\"componentId\", event_r10.instance)(\"purpose\", event_r10.purpose);\n    }\n}\nfunction AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"ion-icon\", 39);\n    }\n    if (rf & 2) {\n        const event_r10 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"Vc\" /* ɵɵproperty */](\"name\", event_r10.eventIcon);\n    }\n}\nfunction AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"span\", 32);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const event_r10 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"qd\" /* ɵɵtextInterpolate */](event_r10.iconTitle);\n    }\n}\nfunction AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_13_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-note\", 2);\n        core[\"zc\" /* ɵɵelement */](1, \"ion-icon\", 40);\n        core[\"Ec\" /* ɵɵelementStart */](2, \"span\", 41);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](4, 1, \"core.notsent\"));\n    }\n}\nfunction AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-note\", 2);\n        core[\"zc\" /* ɵɵelement */](1, \"ion-icon\", 42);\n        core[\"Ec\" /* ɵɵelementStart */](2, \"span\", 41);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](4, 1, \"core.deletedoffline\"));\n    }\n}\nconst _c1 = function (a0) { return [a0]; };\nfunction AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r21 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-card\");\n        core[\"Ec\" /* ɵɵelementStart */](2, \"ion-item\", 29);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template_ion_item_click_2_listener() { core[\"fd\" /* ɵɵrestoreView */](_r21); const event_r10 = ctx.$implicit; const day_r5 = core[\"Oc\" /* ɵɵnextContext */](2).item; const ctx_r19 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r19.gotoEvent(event_r10.id, day_r5); });\n        core[\"nd\" /* ɵɵtemplate */](3, AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template, 1, 5, \"core-mod-icon\", 30);\n        core[\"nd\" /* ɵɵtemplate */](4, AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template, 1, 1, \"ion-icon\", 31);\n        core[\"Ec\" /* ɵɵelementStart */](5, \"ion-label\");\n        core[\"Ec\" /* ɵɵelementStart */](6, \"span\", 32);\n        core[\"pd\" /* ɵɵtext */](7);\n        core[\"Pc\" /* ɵɵpipe */](8, \"translate\");\n        core[\"nd\" /* ɵɵtemplate */](9, AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template, 2, 1, \"span\", 33);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](10, \"p\", 34);\n        core[\"zc\" /* ɵɵelement */](11, \"core-format-text\", 35);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"zc\" /* ɵɵelement */](12, \"p\", 36);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](13, AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_13_Template, 5, 3, \"ion-note\", 37);\n        core[\"nd\" /* ɵɵtemplate */](14, AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template, 5, 3, \"ion-note\", 37);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const event_r10 = ctx.$implicit;\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"qc\" /* ɵɵclassProp */](\"item-dimmed\", event_r10.ispast);\n        core[\"Vc\" /* ɵɵproperty */](\"ngClass\", core[\"ad\" /* ɵɵpureFunction1 */](17, _c1, \"addon-calendar-eventtype-\" + event_r10.eventtype))(\"detail\", false);\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", event_r10.name);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", event_r10.moduleIcon);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", event_r10.eventIcon && !event_r10.moduleIcon);\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](8, 15, \"addon.calendar.type\" + event_r10.formattedType), \" \");\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", event_r10.moduleIcon && event_r10.iconTitle);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"text\", event_r10.name)(\"contextLevel\", event_r10.contextLevel)(\"contextInstanceId\", event_r10.contextInstanceId);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"innerHTML\", event_r10.formattedtime, core[\"gd\" /* ɵɵsanitizeHtml */]);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", event_r10.offline && !event_r10.deleted);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", event_r10.deleted);\n    }\n}\nfunction AddonCalendarDayPage_ng_template_37_ion_list_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-list\", 27);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template, 15, 19, \"ng-container\", 28);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const day_r5 = core[\"Oc\" /* ɵɵnextContext */]().item;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", day_r5.filteredEvents);\n    }\n}\nfunction AddonCalendarDayPage_ng_template_37_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"core-loading\", 9);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonCalendarDayPage_ng_template_37_ion_card_1_Template, 7, 8, \"ion-card\", 21);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template, 2, 3, \"core-empty-box\", 22);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonCalendarDayPage_ng_template_37_ion_list_3_Template, 2, 1, \"ion-list\", 23);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const day_r5 = ctx.item;\n        core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", day_r5.loaded);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", day_r5.hasOffline);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !day_r5.filteredEvents || !day_r5.filteredEvents.length);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", day_r5.filteredEvents && day_r5.filteredEvents.length);\n    }\n}\nfunction AddonCalendarDayPage_ion_fab_38_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r24 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-fab\", 43);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-fab-button\", 44);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonCalendarDayPage_ion_fab_38_Template_ion_fab_button_click_1_listener() { core[\"fd\" /* ɵɵrestoreView */](_r24); const ctx_r23 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r23.openEdit(); });\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"zc\" /* ɵɵelement */](3, \"ion-icon\", 45);\n        core[\"Ec\" /* ɵɵelementStart */](4, \"span\", 32);\n        core[\"pd\" /* ɵɵtext */](5);\n        core[\"Pc\" /* ɵɵpipe */](6, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](2, 2, \"addon.calendar.newevent\"));\n        core[\"lc\" /* ɵɵadvance */](4);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](6, 4, \"addon.calendar.newevent\"));\n    }\n}\n/**\n * Page that displays the calendar events for a certain day.\n */\nlet day_page_AddonCalendarDayPage = /*@__PURE__*/ (() => {\n    class AddonCalendarDayPage {\n        constructor() {\n            this.loaded = false;\n            this.isOnline = false;\n            this.syncIcon = constants[\"a\" /* CoreConstants */].ICON_LOADING;\n            this.filter = {\n                filtered: false,\n                courseId: undefined,\n                categoryId: undefined,\n                course: true,\n                group: true,\n                site: true,\n                user: true,\n                category: true,\n            };\n            this.currentSiteId = sites[\"b\" /* CoreSites */].getCurrentSiteId();\n            // Listen for events added. When an event is added, reload the data.\n            this.newEventObserver = singletons_events[\"b\" /* CoreEvents */].on(calendar[\"c\" /* AddonCalendarProvider */].NEW_EVENT_EVENT, (data) => {\n                var _a;\n                if (data && data.eventId) {\n                    (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().markAllItemsUnloaded();\n                    this.refreshData(true, true);\n                }\n            }, this.currentSiteId);\n            // Listen for new event discarded event. When it does, reload the data.\n            this.discardedObserver = singletons_events[\"b\" /* CoreEvents */].on(calendar[\"c\" /* AddonCalendarProvider */].NEW_EVENT_DISCARDED_EVENT, () => {\n                var _a;\n                (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().markAllItemsUnloaded();\n                this.refreshData(true, true);\n            }, this.currentSiteId);\n            // Listen for events edited. When an event is edited, reload the data.\n            this.editEventObserver = singletons_events[\"b\" /* CoreEvents */].on(calendar[\"c\" /* AddonCalendarProvider */].EDIT_EVENT_EVENT, (data) => {\n                var _a;\n                if (data && data.eventId) {\n                    (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().markAllItemsUnloaded();\n                    this.refreshData(true, true);\n                }\n            }, this.currentSiteId);\n            // Refresh data if calendar events are synchronized automatically.\n            this.syncObserver = singletons_events[\"b\" /* CoreEvents */].on(calendar_sync[\"b\" /* AddonCalendarSyncProvider */].AUTO_SYNCED, () => {\n                var _a;\n                (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().markAllItemsUnloaded();\n                this.refreshData(false, true);\n            }, this.currentSiteId);\n            // Refresh data if calendar events are synchronized manually but not by this page.\n            this.manualSyncObserver = singletons_events[\"b\" /* CoreEvents */].on(calendar_sync[\"b\" /* AddonCalendarSyncProvider */].MANUAL_SYNCED, (data) => {\n                var _a, _b;\n                const selectedDay = (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSelectedItem();\n                if (data && (data.source != 'day' || !selectedDay || !data.moment || !selectedDay.moment.isSame(data.moment, 'day'))) {\n                    (_b = this.manager) === null || _b === void 0 ? void 0 : _b.getSource().markAllItemsUnloaded();\n                    this.refreshData(false, true);\n                }\n            }, this.currentSiteId);\n            // Update the events when an event is deleted.\n            this.deleteEventObserver = singletons_events[\"b\" /* CoreEvents */].on(calendar[\"c\" /* AddonCalendarProvider */].DELETED_EVENT_EVENT, (data) => {\n                var _a, _b;\n                if (data && !data.sent) {\n                    // Event was deleted in offline. Just mark it as deleted, no need to refresh.\n                    (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().markAsDeleted(data.eventId, true);\n                }\n                else {\n                    (_b = this.manager) === null || _b === void 0 ? void 0 : _b.getSource().markAllItemsUnloaded();\n                    this.refreshData(false, true);\n                }\n            }, this.currentSiteId);\n            // Listen for events \"undeleted\" (offline).\n            this.undeleteEventObserver = singletons_events[\"b\" /* CoreEvents */].on(calendar[\"c\" /* AddonCalendarProvider */].UNDELETED_EVENT_EVENT, (data) => {\n                var _a;\n                if (!data || !data.eventId) {\n                    return;\n                }\n                // Mark it as undeleted, no need to refresh.\n                (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().markAsDeleted(data.eventId, false);\n            }, this.currentSiteId);\n            this.filterChangedObserver = singletons_events[\"b\" /* CoreEvents */].on(calendar[\"c\" /* AddonCalendarProvider */].FILTER_CHANGED_EVENT, (data) => Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                var _a, _b;\n                this.filter = data;\n                // Course viewed has changed, check if the user can create events for this course calendar.\n                yield ((_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().loadCanCreate(this.filter.courseId));\n                (_b = this.manager) === null || _b === void 0 ? void 0 : _b.getSource().filterAllDayEvents(this.filter);\n            }));\n            // Refresh online status when changes.\n            this.onlineObserver = network[\"a\" /* CoreNetwork */].onChange().subscribe(() => {\n                // Execute the callback in the Angular zone, so change detection doesn't stop working.\n                singletons[\"A\" /* NgZone */].run(() => {\n                    this.isOnline = network[\"a\" /* CoreNetwork */].isOnline();\n                });\n            });\n        }\n        /**\n         * View loaded.\n         */\n        ngOnInit() {\n            const types = [];\n            utils[\"a\" /* CoreUtils */].enumKeys(calendar[\"b\" /* AddonCalendarEventType */]).forEach((name) => {\n                var _a;\n                const value = calendar[\"b\" /* AddonCalendarEventType */][name];\n                this.filter[name] = (_a = services_navigator[\"a\" /* CoreNavigator */].getRouteBooleanParam(name)) !== null && _a !== void 0 ? _a : true;\n                types.push(value);\n            });\n            this.filter.courseId = services_navigator[\"a\" /* CoreNavigator */].getRouteNumberParam('courseId');\n            this.filter.categoryId = services_navigator[\"a\" /* CoreNavigator */].getRouteNumberParam('categoryId');\n            this.filter.filtered = this.filter.courseId !== undefined || types.some((name) => !this.filter[name]);\n            const month = services_navigator[\"a\" /* CoreNavigator */].getRouteNumberParam('month');\n            const source = new day_page_AddonCalendarDaySlidesItemsManagerSource(this, moment_timezone_default()({\n                year: services_navigator[\"a\" /* CoreNavigator */].getRouteNumberParam('year'),\n                month: month ? month - 1 : undefined,\n                date: services_navigator[\"a\" /* CoreNavigator */].getRouteNumberParam('day'),\n            }));\n            this.manager = new swipe_slides_dynamic_items_manager[\"a\" /* CoreSwipeSlidesDynamicItemsManager */](source);\n            this.managerUnsubscribe = this.manager.addListener({\n                onSelectedItemUpdated: (item) => {\n                    this.onDayViewed(item);\n                },\n            });\n            this.fetchData(true);\n        }\n        get canCreate() {\n            var _a;\n            return ((_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().canCreate) || false;\n        }\n        get timeFormat() {\n            var _a;\n            return ((_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().timeFormat) || 'core.strftimetime';\n        }\n        /**\n         * Fetch all the data required for the view.\n         *\n         * @param sync Whether it should try to synchronize offline events.\n         * @param showErrors Whether to show sync errors to the user.\n         * @return Promise resolved when done.\n         */\n        fetchData(sync) {\n            var _a, _b, _c;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                this.syncIcon = constants[\"a\" /* CoreConstants */].ICON_LOADING;\n                this.isOnline = network[\"a\" /* CoreNetwork */].isOnline();\n                if (sync) {\n                    yield this.sync();\n                }\n                try {\n                    yield ((_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().fetchData(this.filter.courseId));\n                    yield ((_b = this.manager) === null || _b === void 0 ? void 0 : _b.getSource().load((_c = this.manager) === null || _c === void 0 ? void 0 : _c.getSelectedItem()));\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'addon.calendar.errorloadevents', true);\n                }\n                this.loaded = true;\n                this.syncIcon = constants[\"a\" /* CoreConstants */].ICON_SYNC;\n            });\n        }\n        /**\n         * Update data related to day being viewed.\n         *\n         * @param day Day viewed.\n         */\n        onDayViewed(day) {\n            this.periodName = time[\"a\" /* CoreTimeUtils */].userDate(day.moment.unix() * 1000, 'core.strftimedaydate');\n        }\n        /**\n         * Refresh the data.\n         *\n         * @param refresher Refresher.\n         * @param done Function to call when done.\n         * @return Promise resolved when done.\n         */\n        doRefresh(refresher, done) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.loaded) {\n                    return;\n                }\n                yield this.refreshData(true).finally(() => {\n                    refresher === null || refresher === void 0 ? void 0 : refresher.complete();\n                    done && done();\n                });\n            });\n        }\n        /**\n         * Refresh the data.\n         *\n         * @param sync Whether it should try to synchronize offline events.\n         * @param afterChange Whether the refresh is done after an event has changed or has been synced.\n         * @return Promise resolved when done.\n         */\n        refreshData(sync, afterChange) {\n            var _a, _b;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                this.syncIcon = constants[\"a\" /* CoreConstants */].ICON_LOADING;\n                const selectedDay = ((_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSelectedItem()) || null;\n                // Don't invalidate day events after a change, it has already been handled.\n                yield ((_b = this.manager) === null || _b === void 0 ? void 0 : _b.getSource().invalidateContent(selectedDay, !afterChange));\n                yield this.fetchData(sync);\n            });\n        }\n        /**\n         * Try to synchronize offline events.\n         *\n         * @param showErrors Whether to show sync errors to the user.\n         * @return Promise resolved when done.\n         */\n        sync(showErrors) {\n            var _a, _b;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    const result = yield calendar_sync[\"a\" /* AddonCalendarSync */].syncEvents();\n                    if (result.warnings && result.warnings.length) {\n                        dom[\"a\" /* CoreDomUtils */].showErrorModal(result.warnings[0]);\n                    }\n                    if (result.updated) {\n                        // Trigger a manual sync event.\n                        const selectedDay = (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSelectedItem();\n                        result.source = 'day';\n                        result.moment = selectedDay === null || selectedDay === void 0 ? void 0 : selectedDay.moment;\n                        (_b = this.manager) === null || _b === void 0 ? void 0 : _b.getSource().markAllItemsUnloaded();\n                        singletons_events[\"b\" /* CoreEvents */].trigger(calendar_sync[\"b\" /* AddonCalendarSyncProvider */].MANUAL_SYNCED, result, this.currentSiteId);\n                    }\n                }\n                catch (error) {\n                    if (showErrors) {\n                        dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.errorsync', true);\n                    }\n                }\n            });\n        }\n        /**\n         * Check whether selected day is current day.\n         */\n        selectedDayIsCurrent() {\n            var _a, _b;\n            return !!((_b = (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSelectedItem()) === null || _b === void 0 ? void 0 : _b.isCurrentDay);\n        }\n        /**\n         * Navigate to a particular event.\n         *\n         * @param eventId Event to load.\n         * @param day Day.\n         */\n        gotoEvent(eventId, day) {\n            services_navigator[\"a\" /* CoreNavigator */].navigateToSitePath(`/calendar/event/${eventId}`, { params: { date: day.moment.format('MMDDY') } });\n        }\n        /**\n         * Show the filter menu.\n         */\n        openFilter() {\n            var _a;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                yield dom[\"a\" /* CoreDomUtils */].openSideModal({\n                    component: filter_filter[\"a\" /* AddonCalendarFilterComponent */],\n                    componentProps: {\n                        courses: (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSource().courses,\n                        filter: this.filter,\n                    },\n                });\n            });\n        }\n        /**\n         * Open page to create/edit an event.\n         *\n         * @param eventId Event ID to edit.\n         */\n        openEdit(eventId) {\n            var _a;\n            const params = {};\n            if (!eventId) {\n                // It's a new event, set the time.\n                eventId = 0;\n                const selectedDay = (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSelectedItem();\n                if (selectedDay) {\n                    // Use current time but in the specified day.\n                    const now = moment_timezone_default()();\n                    params.timestamp = selectedDay.moment.clone().set({ hour: now.hour(), minute: now.minute() }).unix() * 1000;\n                }\n            }\n            if (this.filter.courseId) {\n                params.courseId = this.filter.courseId;\n            }\n            services_navigator[\"a\" /* CoreNavigator */].navigateToSitePath(`/calendar/edit/${eventId}`, { params });\n        }\n        /**\n         * Check whether selected day has offline data.\n         *\n         * @return Whether selected day has offline data.\n         */\n        selectedDayHasOffline() {\n            var _a;\n            const selectedDay = (_a = this.manager) === null || _a === void 0 ? void 0 : _a.getSelectedItem();\n            return !!(selectedDay === null || selectedDay === void 0 ? void 0 : selectedDay.hasOffline);\n        }\n        /**\n         * Go to current day.\n         */\n        goToCurrentDay() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const manager = this.manager;\n                const slides = this.slides;\n                if (!manager || !slides) {\n                    return;\n                }\n                const currentDay = {\n                    moment: moment_timezone_default()(),\n                };\n                this.loaded = false;\n                try {\n                    // Make sure the day is loaded.\n                    yield manager.getSource().loadItem(currentDay);\n                    slides.slideToItem(currentDay);\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'addon.calendar.errorloadevents', true);\n                }\n                finally {\n                    this.loaded = true;\n                }\n            });\n        }\n        /**\n         * Load next day.\n         */\n        loadNext() {\n            var _a;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                (_a = this.slides) === null || _a === void 0 ? void 0 : _a.slideNext();\n            });\n        }\n        /**\n         * Load previous day.\n         */\n        loadPrevious() {\n            var _a;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                (_a = this.slides) === null || _a === void 0 ? void 0 : _a.slidePrev();\n            });\n        }\n        /**\n         * Page destroyed.\n         */\n        ngOnDestroy() {\n            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;\n            (_a = this.newEventObserver) === null || _a === void 0 ? void 0 : _a.off();\n            (_b = this.discardedObserver) === null || _b === void 0 ? void 0 : _b.off();\n            (_c = this.editEventObserver) === null || _c === void 0 ? void 0 : _c.off();\n            (_d = this.deleteEventObserver) === null || _d === void 0 ? void 0 : _d.off();\n            (_e = this.undeleteEventObserver) === null || _e === void 0 ? void 0 : _e.off();\n            (_f = this.syncObserver) === null || _f === void 0 ? void 0 : _f.off();\n            (_g = this.manualSyncObserver) === null || _g === void 0 ? void 0 : _g.off();\n            (_h = this.onlineObserver) === null || _h === void 0 ? void 0 : _h.unsubscribe();\n            (_j = this.filterChangedObserver) === null || _j === void 0 ? void 0 : _j.off();\n            (_k = this.manager) === null || _k === void 0 ? void 0 : _k.getSource().forgetRelatedSources();\n            (_l = this.manager) === null || _l === void 0 ? void 0 : _l.destroy();\n            this.managerUnsubscribe && this.managerUnsubscribe();\n        }\n    }\n    AddonCalendarDayPage.ɵfac = function AddonCalendarDayPage_Factory(t) { return new (t || AddonCalendarDayPage)(); };\n    AddonCalendarDayPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonCalendarDayPage, selectors: [[\"page-addon-calendar-day\"]], viewQuery: function AddonCalendarDayPage_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"ud\" /* ɵɵviewQuery */](swipe_slides[\"a\" /* CoreSwipeSlidesComponent */], true);\n            }\n            if (rf & 2) {\n                var _t;\n                core[\"dd\" /* ɵɵqueryRefresh */](_t = core[\"Nc\" /* ɵɵloadQuery */]()) && (ctx.slides = _t.first);\n            }\n        }, decls: 39, vars: 31, consts: [[\"slot\", \"start\"], [3, \"text\"], [\"slot\", \"end\"], [\"fill\", \"clear\", 3, \"click\"], [\"slot\", \"icon-only\", \"name\", \"fas-filter\", \"aria-hidden\", \"true\"], [\"iconAction\", \"fas-calendar-day\", 3, \"priority\", \"content\", \"action\", 4, \"ngIf\"], [3, \"hidden\", \"priority\", \"content\", \"iconAction\", \"closeOnClick\", \"action\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"hideUntil\"], [1, \"core-swipe-slides-container\"], [1, \"ion-no-padding\", \"safe-area-padding\"], [1, \"ion-align-items-center\"], [1, \"ion-text-start\"], [\"name\", \"fas-chevron-left\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [1, \"ion-text-center\", \"addon-calendar-period\"], [1, \"ion-text-end\"], [\"name\", \"fas-chevron-right\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [3, \"manager\"], [\"slot\", \"fixed\", \"core-fab\", \"\", \"vertical\", \"bottom\", \"horizontal\", \"end\", 4, \"ngIf\"], [\"iconAction\", \"fas-calendar-day\", 3, \"priority\", \"content\", \"action\"], [\"class\", \"core-warning-card list-item-limited-width\", 4, \"ngIf\"], [\"icon\", \"fas-calendar\", 3, \"message\", 4, \"ngIf\"], [\"class\", \"list-item-limited-width\", 4, \"ngIf\"], [1, \"core-warning-card\", \"list-item-limited-width\"], [\"name\", \"fas-exclamation-triangle\", \"slot\", \"start\", \"aria-hidden\", \"true\"], [\"icon\", \"fas-calendar\", 3, \"message\"], [1, \"list-item-limited-width\"], [4, \"ngFor\", \"ngForOf\"], [\"button\", \"\", 1, \"addon-calendar-event\", \"ion-text-wrap\", 3, \"ngClass\", \"detail\", \"click\"], [\"slot\", \"start\", 3, \"modicon\", \"showAlt\", \"modname\", \"componentId\", \"purpose\", 4, \"ngIf\"], [\"slot\", \"start\", \"aria-hidden\", \"true\", 3, \"name\", 4, \"ngIf\"], [1, \"sr-only\"], [\"class\", \"sr-only\", 4, \"ngIf\"], [1, \"item-heading\"], [3, \"text\", \"contextLevel\", \"contextInstanceId\"], [3, \"innerHTML\"], [\"slot\", \"end\", 4, \"ngIf\"], [\"slot\", \"start\", 3, \"modicon\", \"showAlt\", \"modname\", \"componentId\", \"purpose\"], [\"slot\", \"start\", \"aria-hidden\", \"true\", 3, \"name\"], [\"name\", \"fas-clock\", \"aria-hidden\", \"true\"], [1, \"ion-text-wrap\"], [\"name\", \"fas-trash\", \"aria-hidden\", \"true\"], [\"slot\", \"fixed\", \"core-fab\", \"\", \"vertical\", \"bottom\", \"horizontal\", \"end\"], [3, \"click\"], [\"name\", \"fas-plus\", \"aria-hidden\", \"true\"]], template: function AddonCalendarDayPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"pd\" /* ɵɵtext */](7);\n                core[\"Pc\" /* ɵɵpipe */](8, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-buttons\", 2);\n                core[\"Ec\" /* ɵɵelementStart */](10, \"ion-button\", 3);\n                core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonCalendarDayPage_Template_ion_button_click_10_listener() { return ctx.openFilter(); });\n                core[\"Pc\" /* ɵɵpipe */](11, \"translate\");\n                core[\"zc\" /* ɵɵelement */](12, \"ion-icon\", 4);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](13, \"core-context-menu\");\n                core[\"nd\" /* ɵɵtemplate */](14, AddonCalendarDayPage_core_context_menu_item_14_Template, 2, 4, \"core-context-menu-item\", 5);\n                core[\"Ec\" /* ɵɵelementStart */](15, \"core-context-menu-item\", 6);\n                core[\"Mc\" /* ɵɵlistener */](\"action\", function AddonCalendarDayPage_Template_core_context_menu_item_action_15_listener($event) { return ctx.doRefresh(undefined, $event); });\n                core[\"Pc\" /* ɵɵpipe */](16, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](17, \"ion-content\");\n                core[\"Ec\" /* ɵɵelementStart */](18, \"ion-refresher\", 7);\n                core[\"Mc\" /* ɵɵlistener */](\"ionRefresh\", function AddonCalendarDayPage_Template_ion_refresher_ionRefresh_18_listener($event) { return ctx.doRefresh($event.target); });\n                core[\"zc\" /* ɵɵelement */](19, \"ion-refresher-content\", 8);\n                core[\"Pc\" /* ɵɵpipe */](20, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](21, \"core-loading\", 9);\n                core[\"Ec\" /* ɵɵelementStart */](22, \"div\", 10);\n                core[\"Ec\" /* ɵɵelementStart */](23, \"ion-grid\", 11);\n                core[\"Ec\" /* ɵɵelementStart */](24, \"ion-row\", 12);\n                core[\"Ec\" /* ɵɵelementStart */](25, \"ion-col\", 13);\n                core[\"Ec\" /* ɵɵelementStart */](26, \"ion-button\", 3);\n                core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonCalendarDayPage_Template_ion_button_click_26_listener() { return ctx.loadPrevious(); });\n                core[\"Pc\" /* ɵɵpipe */](27, \"translate\");\n                core[\"zc\" /* ɵɵelement */](28, \"ion-icon\", 14);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](29, \"ion-col\", 15);\n                core[\"Ec\" /* ɵɵelementStart */](30, \"h3\");\n                core[\"pd\" /* ɵɵtext */](31);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](32, \"ion-col\", 16);\n                core[\"Ec\" /* ɵɵelementStart */](33, \"ion-button\", 3);\n                core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonCalendarDayPage_Template_ion_button_click_33_listener() { return ctx.loadNext(); });\n                core[\"Pc\" /* ɵɵpipe */](34, \"translate\");\n                core[\"zc\" /* ɵɵelement */](35, \"ion-icon\", 17);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](36, \"core-swipe-slides\", 18);\n                core[\"nd\" /* ɵɵtemplate */](37, AddonCalendarDayPage_ng_template_37_Template, 4, 4, \"ng-template\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"nd\" /* ɵɵtemplate */](38, AddonCalendarDayPage_ion_fab_38_Template, 7, 6, \"ion-fab\", 19);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 17, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](8, 19, \"addon.calendar.calendarevents\"));\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](11, 21, \"core.filter\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !ctx.selectedDayIsCurrent());\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"hidden\", !ctx.loaded || !ctx.selectedDayHasOffline() || !ctx.isOnline)(\"priority\", 400)(\"content\", core[\"Qc\" /* ɵɵpipeBind1 */](16, 23, \"core.settings.synchronizenow\"))(\"iconAction\", ctx.syncIcon)(\"closeOnClick\", false);\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", !ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Wc\" /* ɵɵpropertyInterpolate */](\"pullingText\", core[\"Qc\" /* ɵɵpipeBind1 */](20, 25, \"core.pulltorefresh\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](5);\n                core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](27, 27, \"addon.calendar.dayprev\"));\n                core[\"lc\" /* ɵɵadvance */](5);\n                core[\"qd\" /* ɵɵtextInterpolate */](ctx.periodName);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](34, 29, \"addon.calendar.daynext\"));\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"manager\", ctx.manager);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.canCreate && ctx.loaded);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], update_non_reactive_attributes[\"a\" /* CoreUpdateNonReactiveAttributesDirective */], ionic_angular[\"l\" /* IonButton */], ionic_angular[\"D\" /* IonIcon */], fa_icon[\"a\" /* CoreFaIconDirective */], context_menu[\"a\" /* CoreContextMenuComponent */], common[\"t\" /* NgIf */], context_menu_item[\"a\" /* CoreContextMenuItemComponent */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], ionic_angular[\"bb\" /* IonRefresher */], ionic_angular[\"cb\" /* IonRefresherContent */], loading[\"a\" /* CoreLoadingComponent */], ionic_angular[\"B\" /* IonGrid */], ionic_angular[\"hb\" /* IonRow */], ionic_angular[\"u\" /* IonCol */], swipe_slides[\"a\" /* CoreSwipeSlidesComponent */], ionic_angular[\"n\" /* IonCard */], ionic_angular[\"I\" /* IonItem */], ionic_angular[\"O\" /* IonLabel */], empty_box[\"a\" /* CoreEmptyBoxComponent */], ionic_angular[\"P\" /* IonList */], common[\"s\" /* NgForOf */], common[\"q\" /* NgClass */], format_text[\"a\" /* CoreFormatTextDirective */], mod_icon[\"a\" /* CoreModIconComponent */], ionic_angular[\"W\" /* IonNote */], ionic_angular[\"x\" /* IonFab */], fab[\"a\" /* CoreFabDirective */], ionic_angular[\"y\" /* IonFabButton */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */]], styles: [\"[_nghost-%COMP%]{--addon-calendar-blank-day-background-color:var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical:12px;--margin-end:12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-right:var(--margin-end)}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:var(--margin-end);margin-inline-end:var(--margin-end)}}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}\", \"[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{flex:none;width:100%}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]{flex-grow:3}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:10px;font-size:1.2rem}\"] });\n    return AddonCalendarDayPage;\n})();\n/**\n * Helper to manage swiping within days.\n */\nclass day_page_AddonCalendarDaySlidesItemsManagerSource extends swipe_slides_dynamic_items_manager_source[\"a\" /* CoreSwipeSlidesDynamicItemsManagerSource */] {\n    constructor(page, initialMoment) {\n        super({ moment: initialMoment });\n        this.courses = [];\n        this.eventsSources = new Set();\n        // Offline events classified in month & day.\n        this.offlineEvents = {};\n        this.offlineEditedEventsIds = []; // IDs of events edited in offline.\n        this.canCreate = false;\n        this.dayPage = page;\n    }\n    /**\n     * Fetch data.\n     *\n     * @param courseId Current selected course id (if any).\n     * @return Promise resolved when done.\n     */\n    fetchData(courseId) {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            yield Promise.all([\n                this.loadCourses(courseId),\n                this.loadCanCreate(courseId),\n                this.loadCategories(),\n                this.loadOfflineEvents(),\n                this.loadOfflineDeletedEvents(),\n                this.loadTimeFormat(),\n            ]);\n        });\n    }\n    /**\n     * Filter all loaded days events based on the filter popover.\n     *\n     * @param filter Filter to apply.\n     */\n    filterAllDayEvents(filter) {\n        var _a;\n        (_a = this.getItems()) === null || _a === void 0 ? void 0 : _a.forEach(day => this.filterEvents(day, filter));\n    }\n    /**\n     * Filter events of a certain day based on the filter popover.\n     *\n     * @param day Day with the events.\n     * @param filter Filter to apply.\n     */\n    filterEvents(day, filter) {\n        day.filteredEvents = calendar_helper[\"b\" /* AddonCalendarHelper */].getFilteredEvents(day.events || [], filter, this.categories || {});\n        this.rememberEventsList(day);\n    }\n    /**\n     * Load courses.\n     *\n     * @param courseId Current selected course id (if any).\n     * @return Promise resolved when done.\n     */\n    loadCourses(courseId) {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            const data = yield courses_helper[\"a\" /* CoreCoursesHelper */].getCoursesForPopover(courseId);\n            this.courses = data.courses;\n        });\n    }\n    /**\n     * Load whether user can create events.\n     *\n     * @param courseId Current selected course id (if any).\n     * @return Promise resolved when done.\n     */\n    loadCanCreate(courseId) {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            this.canCreate = yield calendar_helper[\"b\" /* AddonCalendarHelper */].canEditEvents(courseId);\n        });\n    }\n    /**\n     * Load categories to be able to filter events.\n     *\n     * @return Promise resolved when done.\n     */\n    loadCategories() {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            if (this.categories) {\n                // Already retrieved, stop.\n                return;\n            }\n            try {\n                const categories = yield courses[\"a\" /* CoreCourses */].getCategories(0, true);\n                // Index categories by ID.\n                this.categories = utils[\"a\" /* CoreUtils */].arrayToObject(categories, 'id');\n            }\n            catch (_a) {\n                // Ignore errors.\n            }\n        });\n    }\n    /**\n     * Load events created or edited in offline.\n     *\n     * @return Promise resolved when done.\n     */\n    loadOfflineEvents() {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            // Get offline events.\n            const events = yield calendar_offline[\"a\" /* AddonCalendarOffline */].getAllEditedEvents();\n            // Classify them by month & day.\n            this.offlineEvents = calendar_helper[\"b\" /* AddonCalendarHelper */].classifyIntoMonths(events);\n            // Get the IDs of events edited in offline.\n            this.offlineEditedEventsIds = events.filter((event) => event.id > 0).map((event) => event.id);\n        });\n    }\n    /**\n     * Load events deleted in offline.\n     *\n     * @return Promise resolved when done.\n     */\n    loadOfflineDeletedEvents() {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            const deletedEventsIds = yield calendar_offline[\"a\" /* AddonCalendarOffline */].getAllDeletedEventsIds();\n            this.deletedEvents = new Set(deletedEventsIds);\n        });\n    }\n    /**\n     * Load time format.\n     *\n     * @return Promise resolved when done.\n     */\n    loadTimeFormat() {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            this.timeFormat = yield calendar[\"a\" /* AddonCalendar */].getCalendarTimeFormat();\n        });\n    }\n    /**\n     * @inheritdoc\n     */\n    getItemId(item) {\n        return calendar_helper[\"b\" /* AddonCalendarHelper */].getDayId(item.moment);\n    }\n    /**\n     * @inheritdoc\n     */\n    getPreviousItem(item) {\n        return {\n            moment: item.moment.clone().subtract(1, 'day'),\n        };\n    }\n    /**\n     * @inheritdoc\n     */\n    getNextItem(item) {\n        return {\n            moment: item.moment.clone().add(1, 'day'),\n        };\n    }\n    /**\n     * @inheritdoc\n     */\n    loadItemData(day, preload = false) {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            const preloadedDay = Object.assign(Object.assign({}, day), { hasOffline: false, events: [], onlineEvents: [], filteredEvents: [], isCurrentDay: day.moment.isSame(moment_timezone_default()(), 'day'), isPastDay: day.moment.isBefore(moment_timezone_default()(), 'day') });\n            if (preload) {\n                return preloadedDay;\n            }\n            let result;\n            try {\n                // Don't pass courseId and categoryId, we'll filter them locally.\n                result = yield calendar[\"a\" /* AddonCalendar */].getDayEvents(day.moment.year(), day.moment.month() + 1, day.moment.date());\n                preloadedDay.onlineEvents = result.events.map((event) => calendar_helper[\"b\" /* AddonCalendarHelper */].formatEventData(event));\n            }\n            catch (error) {\n                // Allow navigating to non-cached days in offline (behave as if using emergency cache).\n                if (network[\"a\" /* CoreNetwork */].isOnline()) {\n                    throw error;\n                }\n            }\n            // Merge the online events with offline data.\n            preloadedDay.events = this.mergeEvents(preloadedDay);\n            // Filter events by course.\n            this.filterEvents(preloadedDay, this.dayPage.filter);\n            // Re-calculate the formatted time so it uses the device date.\n            const dayTime = day.moment.unix() * 1000;\n            const currentTime = time[\"a\" /* CoreTimeUtils */].timestamp();\n            const promises = preloadedDay.events.map((event) => Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                event.ispast = preloadedDay.isPastDay || (preloadedDay.isCurrentDay && this.isEventPast(event, currentTime));\n                event.formattedtime = yield calendar[\"a\" /* AddonCalendar */].formatEventTime(event, this.dayPage.timeFormat, true, dayTime);\n            }));\n            yield Promise.all(promises);\n            return preloadedDay;\n        });\n    }\n    /**\n     * Returns if the event is in the past or not.\n     *\n     * @param event Event object.\n     * @param currentTime Current time.\n     * @return True if it's in the past.\n     */\n    isEventPast(event, currentTime) {\n        return (event.timestart + event.timeduration) < currentTime;\n    }\n    /**\n     * Merge online events with the offline events of that period.\n     *\n     * @param day Day with the events.\n     * @return Merged events.\n     */\n    mergeEvents(day) {\n        var _a, _b, _c;\n        day.hasOffline = false;\n        if (!Object.keys(this.offlineEvents).length && !((_a = this.deletedEvents) === null || _a === void 0 ? void 0 : _a.size)) {\n            // No offline events, nothing to merge.\n            return day.onlineEvents || [];\n        }\n        const monthOfflineEvents = this.offlineEvents[calendar_helper[\"b\" /* AddonCalendarHelper */].getMonthId(day.moment)];\n        const dayOfflineEvents = monthOfflineEvents && monthOfflineEvents[day.moment.date()];\n        let result = day.onlineEvents || [];\n        if ((_b = this.deletedEvents) === null || _b === void 0 ? void 0 : _b.size) {\n            // Mark as deleted the events that were deleted in offline.\n            result.forEach((event) => {\n                var _a;\n                event.deleted = (_a = this.deletedEvents) === null || _a === void 0 ? void 0 : _a.has(event.id);\n                if (event.deleted) {\n                    day.hasOffline = true;\n                }\n            });\n        }\n        if (this.offlineEditedEventsIds.length) {\n            // Remove the online events that were modified in offline.\n            result = result.filter((event) => this.offlineEditedEventsIds.indexOf(event.id) == -1);\n            if (result.length != ((_c = day.onlineEvents) === null || _c === void 0 ? void 0 : _c.length)) {\n                day.hasOffline = true;\n            }\n        }\n        if (dayOfflineEvents && dayOfflineEvents.length) {\n            // Add the offline events (either new or edited).\n            day.hasOffline = true;\n            result = calendar_helper[\"b\" /* AddonCalendarHelper */].sortEvents(result.concat(dayOfflineEvents));\n        }\n        return result;\n    }\n    /**\n     * Invalidate content.\n     *\n     * @param selectedDay The current selected day.\n     * @param invalidateDayEvents Whether to invalidate selected day events.\n     * @return Promise resolved when done.\n     */\n    invalidateContent(selectedDay, invalidateDayEvents) {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            const promises = [];\n            if (invalidateDayEvents && selectedDay) {\n                promises.push(calendar[\"a\" /* AddonCalendar */].invalidateDayEvents(selectedDay.moment.year(), selectedDay.moment.month() + 1, selectedDay.moment.date()));\n            }\n            promises.push(calendar[\"a\" /* AddonCalendar */].invalidateAllowedEventTypes());\n            promises.push(courses[\"a\" /* CoreCourses */].invalidateCategories(0, true));\n            promises.push(calendar[\"a\" /* AddonCalendar */].invalidateTimeFormat());\n            this.categories = undefined; // Get categories again.\n            if (selectedDay) {\n                selectedDay.dirty = true;\n            }\n            yield Promise.all(promises);\n        });\n    }\n    /**\n     * Find an event and mark it as deleted.\n     *\n     * @param eventId Event ID.\n     * @param deleted Whether to mark it as deleted or not.\n     */\n    markAsDeleted(eventId, deleted) {\n        var _a, _b, _c;\n        // Mark the event as deleted or not.\n        (_a = this.getItems()) === null || _a === void 0 ? void 0 : _a.some(day => {\n            var _a, _b, _c, _d;\n            const event = (_a = day.onlineEvents) === null || _a === void 0 ? void 0 : _a.find((event) => event.id == eventId);\n            if (!event) {\n                return false;\n            }\n            event.deleted = deleted;\n            if (deleted) {\n                day.hasOffline = true;\n            }\n            else {\n                // Re-calculate \"hasOffline\".\n                day.hasOffline = ((_b = day.events) === null || _b === void 0 ? void 0 : _b.length) != ((_c = day.onlineEvents) === null || _c === void 0 ? void 0 : _c.length) || ((_d = day.events) === null || _d === void 0 ? void 0 : _d.some((event) => event.deleted || event.offline));\n            }\n            return true;\n        });\n        // Add it or remove it from the list of deleted events.\n        if (deleted) {\n            (_b = this.deletedEvents) === null || _b === void 0 ? void 0 : _b.add(eventId);\n        }\n        else {\n            (_c = this.deletedEvents) === null || _c === void 0 ? void 0 : _c.delete(eventId);\n        }\n    }\n    /**\n     * Forget other sources that where created whilst using this one.\n     */\n    forgetRelatedSources() {\n        for (const source of this.eventsSources) {\n            routed_items_manager_sources_tracker[\"a\" /* CoreRoutedItemsManagerSourcesTracker */].removeReference(source, this);\n        }\n    }\n    /**\n     * Remember the list of events in a day to be used in a different context.\n     *\n     * @param day Day containing the events list.\n     */\n    rememberEventsList(day) {\n        var _a;\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            const source = routed_items_manager_sources_tracker[\"a\" /* CoreRoutedItemsManagerSourcesTracker */].getOrCreateSource(events_source[\"a\" /* AddonCalendarEventsSource */], [\n                day.moment.format('MMDDY'),\n            ]);\n            if (!this.eventsSources.has(source)) {\n                this.eventsSources.add(source);\n                routed_items_manager_sources_tracker[\"a\" /* CoreRoutedItemsManagerSourcesTracker */].addReference(source, this);\n            }\n            source.setEvents((_a = day.filteredEvents) !== null && _a !== void 0 ? _a : []);\n            yield source.reload();\n        });\n    }\n}\n\n// CONCATENATED MODULE: ./src/addons/calendar/pages/day/day.module.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\nconst routes = [\n    {\n        path: '',\n        component: day_page_AddonCalendarDayPage,\n    },\n];\nlet day_module_AddonCalendarDayPageModule = /*@__PURE__*/ (() => {\n    class AddonCalendarDayPageModule {\n    }\n    AddonCalendarDayPageModule.ɵmod = core[\"wc\" /* ɵɵdefineNgModule */]({ type: AddonCalendarDayPageModule });\n    AddonCalendarDayPageModule.ɵinj = core[\"vc\" /* ɵɵdefineInjector */]({ factory: function AddonCalendarDayPageModule_Factory(t) { return new (t || AddonCalendarDayPageModule)(); }, imports: [[\n                router[\"m\" /* RouterModule */].forChild(routes),\n                shared_module[\"a\" /* CoreSharedModule */],\n                components_module[\"a\" /* AddonCalendarComponentsModule */],\n            ], router[\"m\" /* RouterModule */]] });\n    return AddonCalendarDayPageModule;\n})();\n(function () {\n    (typeof ngJitMode === \"undefined\" || ngJitMode) && core[\"kd\" /* ɵɵsetNgModuleScope */](day_module_AddonCalendarDayPageModule, { declarations: [day_page_AddonCalendarDayPage], imports: [router[\"m\" /* RouterModule */], shared_module[\"a\" /* CoreSharedModule */],\n            components_module[\"a\" /* AddonCalendarComponentsModule */]], exports: [router[\"m\" /* RouterModule */]] });\n})();\n\n\n/***/ })\n\n}]);","inputSourceMap":null}