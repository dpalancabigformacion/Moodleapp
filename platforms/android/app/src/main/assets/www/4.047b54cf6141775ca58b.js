(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"+uFs":function(t,e,o){"use strict";o.r(e),o.d(e,"AddonModGlossaryEditPageModule",(function(){return B}));var i=o("mrSG"),n=o("3Pt+"),a=o("93ts"),s=o("baaQ"),d=o("hSQQ"),c=o("pHTc"),r=o("9+EE"),l=o("3LXp"),h=o("vuGA"),g=o("bFG1"),m=o("j3ag"),u=o("fjkH"),y=o("4reR"),p=o("fcHg"),f=o("1VuZ"),_=o("gjmY"),v=o("BZ3K"),E=o("7DS8"),M=o("fXoL"),b=o("tyNb"),I=o("46ml"),P=o("TEn/"),D=o("ofXK"),C=o("nt/U"),O=o("OZH1"),A=o("PgjG"),w=o("hMzs"),G=o("N5Lt"),k=o("d0nH"),T=o("M9y5"),x=o("ACYt"),S=o("sYmb");const V=["editFormEl"];function AddonModGlossaryEditPage_h1_6_Template(t,e){if(1&t&&(M.Ec(0,"h1"),M.zc(1,"core-format-text",5),M.Dc()),2&t){const t=M.Oc();M.lc(1),M.Vc("text",t.glossary.name)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModGlossaryEditPage_form_9_ion_item_14_ion_select_option_7_Template(t,e){if(1&t&&(M.Ec(0,"ion-select-option",17),M.pd(1),M.Dc()),2&t){const t=e.$implicit;M.Vc("value",t.id),M.lc(1),M.rd(" ",t.name," ")}}const _c1=function(t){return{header:t}};function AddonModGlossaryEditPage_form_9_ion_item_14_Template(t,e){if(1&t){const t=M.Fc();M.Ec(0,"ion-item"),M.Ec(1,"ion-label",14),M.pd(2),M.Pc(3,"translate"),M.Dc(),M.Ec(4,"ion-select",15),M.Mc("ngModelChange",(function AddonModGlossaryEditPage_form_9_ion_item_14_Template_ion_select_ngModelChange_4_listener(e){M.fd(t);return M.Oc(2).options.categories=e})),M.Pc(5,"translate"),M.Pc(6,"translate"),M.nd(7,AddonModGlossaryEditPage_form_9_ion_item_14_ion_select_option_7_Template,2,2,"ion-select-option",16),M.Dc(),M.Dc()}if(2&t){const t=M.Oc(2);M.lc(2),M.rd(" ",M.Qc(3,5,"addon.mod_glossary.categories")," "),M.lc(2),M.Vc("ngModel",t.options.categories)("placeholder",M.Qc(5,7,"addon.mod_glossary.categories"))("interfaceOptions",M.ad(11,_c1,M.Qc(6,9,"addon.mod_glossary.categories"))),M.lc(3),M.Vc("ngForOf",t.categories)}}function AddonModGlossaryEditPage_form_9_ng_container_26_Template(t,e){if(1&t){const t=M.Fc();M.Cc(0),M.Ec(1,"ion-item-divider"),M.Ec(2,"ion-label"),M.Ec(3,"h2"),M.pd(4),M.Pc(5,"translate"),M.Dc(),M.Dc(),M.Dc(),M.Ec(6,"ion-item",18),M.Ec(7,"ion-label"),M.pd(8),M.Pc(9,"translate"),M.Dc(),M.Ec(10,"ion-toggle",19),M.Mc("ngModelChange",(function AddonModGlossaryEditPage_form_9_ng_container_26_Template_ion_toggle_ngModelChange_10_listener(e){M.fd(t);return M.Oc(2).options.usedynalink=e})),M.Dc(),M.Dc(),M.Ec(11,"ion-item",18),M.Ec(12,"ion-label"),M.pd(13),M.Pc(14,"translate"),M.Dc(),M.Ec(15,"ion-toggle",20),M.Mc("ngModelChange",(function AddonModGlossaryEditPage_form_9_ng_container_26_Template_ion_toggle_ngModelChange_15_listener(e){M.fd(t);return M.Oc(2).options.casesensitive=e})),M.Dc(),M.Dc(),M.Ec(16,"ion-item",18),M.Ec(17,"ion-label"),M.pd(18),M.Pc(19,"translate"),M.Dc(),M.Ec(20,"ion-toggle",21),M.Mc("ngModelChange",(function AddonModGlossaryEditPage_form_9_ng_container_26_Template_ion_toggle_ngModelChange_20_listener(e){M.fd(t);return M.Oc(2).options.fullmatch=e})),M.Dc(),M.Dc(),M.Bc()}if(2&t){const t=M.Oc(2);M.lc(4),M.qd(M.Qc(5,9,"addon.mod_glossary.linking")),M.lc(4),M.qd(M.Qc(9,11,"addon.mod_glossary.entryusedynalink")),M.lc(2),M.Vc("ngModel",t.options.usedynalink),M.lc(3),M.qd(M.Qc(14,13,"addon.mod_glossary.casesensitive")),M.lc(2),M.Vc("disabled",!t.options.usedynalink)("ngModel",t.options.casesensitive),M.lc(3),M.qd(M.Qc(19,15,"addon.mod_glossary.fullmatch")),M.lc(2),M.Vc("disabled",!t.options.usedynalink)("ngModel",t.options.fullmatch)}}function AddonModGlossaryEditPage_form_9_Template(t,e){if(1&t){const t=M.Fc();M.Ec(0,"form",null,6),M.Ec(2,"ion-item"),M.Ec(3,"ion-label",7),M.pd(4),M.Pc(5,"translate"),M.Dc(),M.Ec(6,"ion-input",8),M.Mc("ngModelChange",(function AddonModGlossaryEditPage_form_9_Template_ion_input_ngModelChange_6_listener(e){M.fd(t);return M.Oc().entry.concept=e})),M.Pc(7,"translate"),M.Dc(),M.Dc(),M.Ec(8,"ion-item"),M.Ec(9,"ion-label",7),M.pd(10),M.Pc(11,"translate"),M.Dc(),M.Ec(12,"core-rich-text-editor",9),M.Mc("contentChanged",(function AddonModGlossaryEditPage_form_9_Template_core_rich_text_editor_contentChanged_12_listener(e){M.fd(t);return M.Oc().onDefinitionChange(e)})),M.Pc(13,"translate"),M.Dc(),M.Dc(),M.nd(14,AddonModGlossaryEditPage_form_9_ion_item_14_Template,8,13,"ion-item",2),M.Ec(15,"ion-item"),M.Ec(16,"ion-label",10),M.pd(17),M.Pc(18,"translate"),M.Dc(),M.Ec(19,"ion-textarea",11),M.Mc("ngModelChange",(function AddonModGlossaryEditPage_form_9_Template_ion_textarea_ngModelChange_19_listener(e){M.fd(t);return M.Oc().options.aliases=e})),M.Dc(),M.Dc(),M.Ec(20,"ion-item-divider"),M.Ec(21,"ion-label"),M.Ec(22,"h2"),M.pd(23),M.Pc(24,"translate"),M.Dc(),M.Dc(),M.Dc(),M.zc(25,"core-attachments",12),M.nd(26,AddonModGlossaryEditPage_form_9_ng_container_26_Template,21,17,"ng-container",2),M.Ec(27,"ion-button",13),M.Mc("click",(function AddonModGlossaryEditPage_form_9_Template_ion_button_click_27_listener(){M.fd(t);return M.Oc().save()})),M.pd(28),M.Pc(29,"translate"),M.Dc(),M.Dc()}if(2&t){const t=M.Oc();M.lc(4),M.qd(M.Qc(5,24,"addon.mod_glossary.concept")),M.lc(2),M.Vc("placeholder",M.Qc(7,26,"addon.mod_glossary.concept"))("ngModel",t.entry.concept),M.lc(4),M.qd(M.Qc(11,28,"addon.mod_glossary.definition")),M.lc(2),M.Vc("control",t.definitionControl)("placeholder",M.Qc(13,30,"addon.mod_glossary.definition"))("component",t.component)("componentId",t.cmId)("autoSave",!0)("contextInstanceId",t.cmId)("draftExtraParams",t.editorExtraParams),M.lc(2),M.Vc("ngIf",t.categories.length>0),M.lc(3),M.rd(" ",M.Qc(18,32,"addon.mod_glossary.aliases")," "),M.lc(2),M.Vc("ngModel",t.options.aliases)("core-auto-rows",t.options.aliases),M.lc(4),M.qd(M.Qc(24,34,"addon.mod_glossary.attachment")),M.lc(2),M.Vc("files",t.attachments)("component",t.component)("componentId",t.glossary.coursemodule)("allowOffline",!0)("courseId",t.courseId),M.lc(1),M.Vc("ngIf",t.glossary.usedynalink),M.lc(1),M.Vc("disabled",!t.entry.concept||!t.entry.definition),M.lc(1),M.rd(" ",M.Qc(29,36,"core.save")," ")}}let F=(()=>{class AddonModGlossaryEditPage{constructor(t,e){this.route=t,this.splitView=e,this.component=_.b.COMPONENT,this.loaded=!1,this.attachments=[],this.definitionControl=new n.g,this.categories=[],this.editorExtraParams={},this.entry={concept:"",definition:"",timecreated:0},this.options={categories:[],aliases:"",usedynalink:!1,casesensitive:!1,fullmatch:!1},this.concept="",this.isDestroyed=!1,this.saved=!1}ngOnInit(){var t,e;return Object(i.a)(this,void 0,void 0,(function*(){try{const o=this.route.snapshot.data;if(this.cmId=c.a.getRequiredRouteNumberParam("cmId"),this.courseId=c.a.getRequiredRouteNumberParam("courseId"),this.timecreated=c.a.getRequiredRouteNumberParam("timecreated"),this.concept=c.a.getRouteParam("concept")||"",this.editorExtraParams.timecreated=this.timecreated,0!==this.timecreated&&(null===(t=o.swipeEnabled)||void 0===t||t)){const t=s.a.getOrCreateSource(p.a,[this.courseId,this.cmId,null!==(e=o.glossaryPathPrefix)&&void 0!==e?e:""]);this.entries=new edit_AddonModGlossaryEditEntriesSwipeManager(t),yield this.entries.start()}}catch(t){return l.a.showErrorModal(t),this.goBack(),void 0}this.fetchData()}))}ngOnDestroy(){var t;null===(t=this.entries)||void 0===t?void 0:t.destroy()}fetchData(){return Object(i.a)(this,void 0,void 0,(function*(){try{this.glossary=yield _.a.getGlossary(this.courseId,this.cmId),this.timecreated>0&&(yield this.loadOfflineData()),this.categories=yield _.a.getAllCategories(this.glossary.id,{cmId:this.cmId}),this.loaded=!0}catch(t){l.a.showErrorModalDefault(t,"addon.mod_glossary.errorloadingglossary",!0),this.goBack()}}))}loadOfflineData(){var t;return Object(i.a)(this,void 0,void 0,(function*(){if(!this.glossary)return;const e=yield E.a.getNewEntry(this.glossary.id,this.concept,this.timecreated);this.entry.concept=e.concept||"",this.entry.definition=e.definition||"",this.entry.timecreated=e.timecreated,this.originalData={concept:this.entry.concept,definition:this.entry.definition,files:[],timecreated:e.timecreated},e.options&&(this.options.categories=e.options.categories&&e.options.categories.split(",")||[],this.options.aliases=e.options.aliases||"",this.options.usedynalink=!!e.options.usedynalink,this.options.usedynalink&&(this.options.casesensitive=!!e.options.casesensitive,this.options.fullmatch=!!e.options.fullmatch)),(null===(t=e.attachments)||void 0===t?void 0:t.offline)&&(this.attachments=yield v.a.getStoredFiles(this.glossary.id,e.concept,e.timecreated),this.originalData.files=this.attachments.slice()),this.definitionControl.setValue(this.entry.definition)}))}resetForm(){this.entry.concept="",this.entry.definition="",this.entry.timecreated=0,this.originalData=void 0,this.options.categories=[],this.options.aliases="",this.options.usedynalink=!1,this.options.casesensitive=!1,this.options.fullmatch=!1,this.attachments.length=0,this.definitionControl.setValue("")}onDefinitionChange(t){this.entry.definition=t}canLeave(){return Object(i.a)(this,void 0,void 0,(function*(){return this.saved||(v.a.hasEntryDataChanged(this.entry,this.attachments,this.originalData)&&(yield l.a.showConfirm(m.J.instant("core.confirmcanceledit"))),d.a.clearTmpFiles(this.attachments),y.a.triggerFormCancelledEvent(this.formElement,r.b.getCurrentSiteId())),!0}))}save(){var t;return Object(i.a)(this,void 0,void 0,(function*(){let e,o=this.entry.definition;const i=this.entry.timecreated||Date.now();if(!this.entry.concept||!o)return l.a.showErrorModal("addon.mod_glossary.fillfields",!0),void 0;const n=yield l.a.showModalLoading("core.sending",!0);o=h.a.formatHtmlLines(o);try{if(!this.glossary)return;const{saveOffline:s,attachmentsResult:l}=yield this.uploadAttachments(i),h={aliases:this.options.aliases,categories:this.options.categories.join(",")};if(this.glossary.usedynalink&&(h.usedynalink=this.options.usedynalink?1:0,this.options.usedynalink&&(h.casesensitive=this.options.casesensitive?1:0,h.fullmatch=this.options.fullmatch?1:0)),s){if(this.entry&&!this.glossary.allowduplicatedentries){if(yield _.a.isConceptUsed(this.glossary.id,this.entry.concept,{timeCreated:this.entry.timecreated,cmId:this.cmId}))throw new a.a(m.J.instant("addon.mod_glossary.errconceptalreadyexists"))}yield E.a.addNewEntry(this.glossary.id,this.entry.concept,o,this.courseId,h,l,i,void 0,void 0,this.entry)}else yield _.a.addEntry(this.glossary.id,this.entry.concept,o,this.courseId,h,l,{timeCreated:i,discardEntry:this.entry,allowOffline:!this.attachments.length,checkDuplicates:!this.glossary.allowduplicatedentries});d.a.clearTmpFiles(this.attachments),u.b.trigger(_.b.ADD_ENTRY_EVENT,{glossaryId:this.glossary.id,entryId:e},r.b.getCurrentSiteId()),y.a.triggerFormSubmittedEvent(this.formElement,!1,r.b.getCurrentSiteId()),(null===(t=this.splitView)||void 0===t?void 0:t.outletActivated)?this.timecreated>0?yield this.loadOfflineData():this.resetForm():(this.saved=!0,c.a.back())}catch(t){l.a.showErrorModalDefault(t,"addon.mod_glossary.cannoteditentry",!0)}finally{n.dismiss()}}))}uploadAttachments(t){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.attachments.length||!this.glossary)return{saveOffline:!1};try{return{saveOffline:!1,attachmentsResult:yield d.a.uploadOrReuploadFiles(this.attachments,_.b.COMPONENT,this.glossary.id)}}catch(e){if(g.a.isWebServiceError(e))throw e;return{saveOffline:!0,attachmentsResult:yield v.a.storeFiles(this.glossary.id,this.entry.concept,t,this.attachments)}}}))}goBack(){var t;(null===(t=this.splitView)||void 0===t?void 0:t.outletActivated)?c.a.navigate("../../"):c.a.back()}}return AddonModGlossaryEditPage.ɵfac=function AddonModGlossaryEditPage_Factory(t){return new(t||AddonModGlossaryEditPage)(M.yc(b.a),M.yc(I.a,8))},AddonModGlossaryEditPage.ɵcmp=M.sc({type:AddonModGlossaryEditPage,selectors:[["page-addon-mod-glossary-edit"]],viewQuery:function AddonModGlossaryEditPage_Query(t,e){var o;(1&t&&M.ud(V,!0),2&t)&&(M.dd(o=M.Nc())&&(e.formElement=o.first))},decls:10,vars:7,consts:[["slot","start"],[3,"text"],[4,"ngIf"],[3,"core-swipe-navigation"],[3,"hideUntil"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["editFormEl",""],["position","stacked"],["type","text","name","concept",3,"placeholder","ngModel","ngModelChange"],["name","addon_mod_glossary_edit","contextLevel","module","elementId","definition_editor",3,"control","placeholder","component","componentId","autoSave","contextInstanceId","draftExtraParams","contentChanged"],["position","stacked","id","addon-mod-glossary-aliases-label"],["rows","1","aria-labelledby","addon-mod-glossary-aliases-label","name","aliases",3,"ngModel","core-auto-rows","ngModelChange"],[3,"files","component","componentId","allowOffline","courseId"],["expand","block",1,"ion-margin",3,"disabled","click"],["position","stacked","id","addon-mod-glossary-categories-label"],["multiple","true","aria-labelledby","addon-mod-glossary-categories-label","interface","action-sheet","name","categories",3,"ngModel","placeholder","interfaceOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"ion-text-wrap"],["name","usedynalink",3,"ngModel","ngModelChange"],["name","casesensitive",3,"disabled","ngModel","ngModelChange"],["name","fullmatch",3,"disabled","ngModel","ngModelChange"]],template:function AddonModGlossaryEditPage_Template(t,e){1&t&&(M.Ec(0,"ion-header"),M.Ec(1,"ion-toolbar"),M.Ec(2,"ion-buttons",0),M.zc(3,"ion-back-button",1),M.Pc(4,"translate"),M.Dc(),M.Ec(5,"ion-title"),M.nd(6,AddonModGlossaryEditPage_h1_6_Template,2,3,"h1",2),M.Dc(),M.Dc(),M.Dc(),M.Ec(7,"ion-content",3),M.Ec(8,"core-loading",4),M.nd(9,AddonModGlossaryEditPage_form_9_Template,30,38,"form",2),M.Dc(),M.Dc()),2&t&&(M.lc(3),M.Vc("text",M.Qc(4,5,"core.back")),M.lc(3),M.Vc("ngIf",e.glossary),M.lc(1),M.Vc("core-swipe-navigation",e.entries),M.lc(1),M.Vc("hideUntil",e.loaded),M.lc(1),M.Vc("ngIf",e.glossary))},directives:[P.C,P.Ab,P.m,P.h,P.i,P.yb,D.t,C.a,P.v,O.a,A.a,w.a,n.H,n.s,n.t,P.I,P.O,P.H,P.Pb,n.r,n.u,G.a,P.wb,k.a,P.J,T.a,x.a,P.l,P.lb,P.Ob,D.s,P.mb,P.zb,P.d],pipes:[S.d],encapsulation:2}),AddonModGlossaryEditPage})();class edit_AddonModGlossaryEditEntriesSwipeManager extends f.a{getSelectedItemPathFromRoute(t){return`${this.getSource().GLOSSARY_PATH_PREFIX}edit/${t.params.timecreated}`}}var j=o("L3Fv"),Q=o("ekpb"),R=o("MLi9");const N=[{path:"",component:F,canDeactivate:[R.a]}];let B=(()=>{class AddonModGlossaryEditPageModule{}return AddonModGlossaryEditPageModule.ɵmod=M.wc({type:AddonModGlossaryEditPageModule}),AddonModGlossaryEditPageModule.ɵinj=M.vc({factory:function AddonModGlossaryEditPageModule_Factory(t){return new(t||AddonModGlossaryEditPageModule)},imports:[[b.m.forChild(N),j.a,Q.a]]}),AddonModGlossaryEditPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&M.kd(B,{declarations:[F],imports:[b.m,j.a,Q.a]}))},eoiU:function(t,e,o){"use strict";o.d(e,"a",(function(){return CoreSwipeNavigationItemsManager}));var i=o("mrSG"),n=o("pHTc"),a=o("CtbY");class CoreSwipeNavigationItemsManager extends a.a{start(){return Object(i.a)(this,void 0,void 0,(function*(){this.updateSelectedItem()}))}navigateToNextItem(){return Object(i.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(1,"forward")}))}navigateToPreviousItem(){return Object(i.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(-1,"back")}))}hasNextItem(){return Object(i.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(1))}))}hasPreviousItem(){return Object(i.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(-1))}))}getCurrentPageRoute(){return n.a.getCurrentRoute()}getSelectedItemPathFromRoute(t){const e=[];for(;t&&(e.push(...t.url),t.firstChild);)t=t.firstChild;return e.map((t=>t.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(t,e){return Object(i.a)(this,void 0,void 0,(function*(){const o=yield this.getItemBy(t);o&&(yield this.navigateToItem(o,{animationDirection:e,replace:!0}))}))}getItemBy(t){var e;return Object(i.a)(this,void 0,void 0,(function*(){const o=this.getSource().getItems(),i=null!==(e=this.selectedItem&&(null==o?void 0:o.indexOf(this.selectedItem)))&&void 0!==e?e:-1;if(-1===i||null===o)return null;const n=t>0?1:-1;let a=i,s=0;for(;s!==t&&(a+=n,!(a<0||a>=o.length));)this.skipItemInSwipe(o[a])||(s+=n);return s===t?o[a]:this.getSource().isCompleted()?null:(yield this.getSource().load(),this.getItemBy(t))}))}skipItemInSwipe(t){return!1}}}}]);