(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{M7Gs:function(i,s,e){"use strict";e.r(s),e.d(s,"AddonModAssignLazyModule",(function(){return di}));var t=e("vY5A"),n=e("L3Fv"),o=e("tyNb"),a=e("MLi9"),d=e("Y+03"),c=e("sYk5"),r=e("mrSG"),u=e("93ts"),l=e("2tv+"),m=e("pHTc"),g=e("9+EE"),h=e("uT8i"),b=e("3LXp"),_=e("4reR"),p=e("j3ag"),f=e("fjkH"),I=e("djuo"),A=e("JDIg"),v=e("W4Cf"),S=e("jQ6G"),M=e("bFG1"),E=e("fXoL"),y=e("TEn/"),P=e("hMzs"),T=e("ACYt"),D=e("nt/U"),O=e("PgjG"),x=e("ofXK"),w=e("3Pt+"),C=e("rztj"),L=e("5450"),V=e("akXa"),R=e("sYmb");const k=["editSubmissionForm"],_c1=function(){return[300,900]};function AddonModAssignEditPage_ion_list_14_core_timer_1_Template(i,s){if(1&i){const i=E.Fc();E.Ec(0,"core-timer",12),E.Mc("finished",(function AddonModAssignEditPage_ion_list_14_core_timer_1_Template_core_timer_finished_0_listener(){E.fd(i);return E.Oc(2).timeUp()})),E.Pc(1,"translate"),E.Dc()}if(2&i){const i=E.Oc(2);E.Vc("endTime",i.timeLimitEndTime)("timerText",E.Qc(1,5,"addon.mod_assign.assigntimeleft"))("align","center")("timeLeftClassThreshold",-1)("underTimeClassThresholds",E.Zc(7,_c1))}}function AddonModAssignEditPage_ion_list_14_ion_item_2_Template(i,s){if(1&i&&(E.Ec(0,"ion-item",13),E.Ec(1,"ion-label"),E.zc(2,"core-format-text",14),E.Dc(),E.Dc()),2&i){const i=E.Oc(2);E.lc(2),E.Vc("text",i.activityInstructions)("component",i.component)("componentId",i.moduleId)("contextInstanceId",i.moduleId)("courseId",i.courseId)("maxHeight",120)}}function AddonModAssignEditPage_ion_list_14_ng_container_3_core_file_1_Template(i,s){if(1&i&&E.zc(0,"core-file",16),2&i){const i=s.$implicit,e=E.Oc(3);E.Vc("file",i)("component",e.component)("componentId",e.moduleId)}}function AddonModAssignEditPage_ion_list_14_ng_container_3_Template(i,s){if(1&i&&(E.Cc(0),E.nd(1,AddonModAssignEditPage_ion_list_14_ng_container_3_core_file_1_Template,1,3,"core-file",15),E.Bc()),2&i){const i=E.Oc(2);E.lc(1),E.Vc("ngForOf",i.introAttachments)}}function AddonModAssignEditPage_ion_list_14_ion_item_6_Template(i,s){if(1&i){const i=E.Fc();E.Ec(0,"ion-item",13),E.Ec(1,"ion-label"),E.zc(2,"core-format-text",17),E.Dc(),E.Ec(3,"ion-checkbox",18),E.Mc("ngModelChange",(function AddonModAssignEditPage_ion_list_14_ion_item_6_Template_ion_checkbox_ngModelChange_3_listener(s){E.fd(i);return E.Oc(2).submissionStatementAccepted=s})),E.Dc(),E.zc(4,"input",19),E.Dc()}if(2&i){const i=E.Oc(2);E.lc(2),E.Vc("text",i.submissionStatement)("filter",!1),E.lc(1),E.Vc("ngModel",i.submissionStatementAccepted),E.lc(1),E.Vc("ngModel",i.submissionStatementAccepted)}}function AddonModAssignEditPage_ion_list_14_addon_mod_assign_submission_plugin_7_Template(i,s){if(1&i&&E.zc(0,"addon-mod-assign-submission-plugin",20),2&i){const i=s.$implicit,e=E.Oc(2);E.Vc("assign",e.assign)("submission",e.userSubmission)("plugin",i)("edit",!0)("allowOffline",e.allowOffline)}}function AddonModAssignEditPage_ion_list_14_Template(i,s){if(1&i&&(E.Ec(0,"ion-list"),E.nd(1,AddonModAssignEditPage_ion_list_14_core_timer_1_Template,2,8,"core-timer",7),E.nd(2,AddonModAssignEditPage_ion_list_14_ion_item_2_Template,3,6,"ion-item",8),E.nd(3,AddonModAssignEditPage_ion_list_14_ng_container_3_Template,2,1,"ng-container",6),E.Ec(4,"form",9,10),E.nd(6,AddonModAssignEditPage_ion_list_14_ion_item_6_Template,5,4,"ion-item",8),E.nd(7,AddonModAssignEditPage_ion_list_14_addon_mod_assign_submission_plugin_7_Template,1,5,"addon-mod-assign-submission-plugin",11),E.Dc(),E.Dc()),2&i){const i=E.Oc();E.lc(1),E.Vc("ngIf",i.timeLimitEndTime>0),E.lc(1),E.Vc("ngIf",i.activityInstructions),E.lc(1),E.Vc("ngIf",null==i.assign?null:i.assign.submissionattachments),E.lc(3),E.Vc("ngIf",i.submissionStatement),E.lc(1),E.Vc("ngForOf",i.userSubmission.plugins)}}let N=(()=>{class AddonModAssignEditPage{constructor(i){this.route=i,this.allowOffline=!1,this.submissionStatementAccepted=!1,this.loaded=!1,this.timeLimitEndTime=0,this.component=I.d.COMPONENT,this.isBlind=!1,this.saveOffline=!1,this.hasOffline=!1,this.isDestroyed=!1,this.forceLeave=!1,this.userId=g.b.getCurrentSiteUserId(),this.editText=p.J.instant("addon.mod_assign.editsubmission"),this.title=this.editText}ngOnInit(){try{this.moduleId=m.a.getRequiredRouteNumberParam("cmId"),this.courseId=m.a.getRequiredRouteNumberParam("courseId"),this.isBlind=!!m.a.getRouteNumberParam("blindId")}catch(i){return b.a.showErrorModal(i),m.a.back(),void 0}this.fetchAssignment().finally((()=>{this.loaded=!0}))}canLeave(){return Object(r.a)(this,void 0,void 0,(function*(){if(this.forceLeave)return!0;return(yield this.hasDataChanged())&&(yield b.a.showConfirm(p.J.instant("core.confirmcanceledit"))),A.a.clearSubmissionPluginTmpData(this.assign,this.userSubmission,this.getInputData()),_.a.triggerFormCancelledEvent(this.formElement,g.b.getCurrentSiteId()),!0}))}fetchAssignment(){var i,s,e,t,n,o,a;return Object(r.a)(this,void 0,void 0,(function*(){const d=g.b.getCurrentSiteUserId();try{this.assign=yield I.a.getAssignment(this.courseId,this.moduleId),this.title=this.assign.name||this.title,this.isDestroyed||h.a.blockOperation(I.d.COMPONENT,this.assign.id),yield S.a.waitForSync(this.assign.id);const c={userId:this.userId,isBlind:this.isBlind,cmId:this.assign.cmid,filter:!1,readingStrategy:2};let r;try{r=yield I.a.getSubmissionStatus(this.assign.id,c),this.userSubmission=I.a.getSubmissionObjectFromAttempt(this.assign,r.lastattempt)}catch(i){c.filter=!0,c.readingStrategy=1,r=yield I.a.getSubmissionStatus(this.assign.id,c),this.userSubmission=I.a.getSubmissionObjectFromAttempt(this.assign,r.lastattempt);if(!(yield A.a.canEditSubmissionOffline(this.assign,this.userSubmission)))throw this.allowOffline=!1,i}if(!(null===(i=r.lastattempt)||void 0===i?void 0:i.canedit))throw new u.a(p.J.instant("core.nopermissions",{$a:this.editText}));if(r=yield this.startSubmissionIfNeeded(r,c),null===(s=r.assignmentdata)||void 0===s?void 0:s.activity){const i=c.filter?r:yield I.a.getSubmissionStatus(this.assign.id,Object.assign(Object.assign({},c),{filter:!0}));this.activityInstructions=null===(e=i.assignmentdata)||void 0===e?void 0:e.activity}this.introAttachments=null!==(o=null===(n=null===(t=r.assignmentdata)||void 0===t?void 0:t.attachments)||void 0===n?void 0:n.intro)&&void 0!==o?o:this.assign.introattachments,this.allowOffline=!0,this.submissionStatement=this.assign.requiresubmissionstatement&&!this.assign.submissiondrafts&&this.userId==d?this.assign.submissionstatement:void 0,this.timeLimitEndTime=this.assign.timelimit&&(null===(a=this.userSubmission)||void 0===a?void 0:a.timestarted)?A.a.calculateEndTime(this.assign,this.userSubmission):0;try{const i=yield v.a.getSubmission(this.assign.id,this.userId);this.hasOffline=(null==i?void 0:i.plugindata)&&Object.keys(i.plugindata).length>0}catch(i){this.hasOffline=!1}}catch(i){b.a.showErrorModalDefault(i,"Error getting assigment data."),this.leaveWithoutCheck()}}))}startSubmissionIfNeeded(i,s){return Object(r.a)(this,void 0,void 0,(function*(){if(!this.assign||!this.assign.timelimit)return i;if(this.userSubmission&&this.userSubmission.status!==I.e.NEW&&this.userSubmission.status!==I.e.REOPENED)return i;yield I.a.startSubmission(this.assign.id),f.b.trigger(I.d.STARTED_EVENT,{assignmentId:this.assign.id},g.b.getCurrentSiteId());const e=yield I.a.getSubmissionStatus(this.assign.id,Object.assign(Object.assign({},s),{readingStrategy:2}));return this.userSubmission=I.a.getSubmissionObjectFromAttempt(this.assign,e.lastattempt),e}))}getInputData(){return _.a.getDataFromForm(document.forms["addon-mod_assign-edit-form"])}hasDataChanged(){return Object(r.a)(this,void 0,void 0,(function*(){const i=yield b.a.showModalLoading(),s=this.getInputData();return A.a.hasSubmissionDataChanged(this.assign,this.userSubmission,s).finally((()=>{i.dismiss()}))}))}leaveWithoutCheck(){this.forceLeave=!0,m.a.back()}prepareSubmissionData(i){return Object(r.a)(this,void 0,void 0,(function*(){this.saveOffline=this.hasOffline;try{return yield A.a.prepareSubmissionPluginData(this.assign,this.userSubmission,i,this.hasOffline)}catch(s){if(this.allowOffline&&!this.saveOffline&&!M.a.isWebServiceError(s))return this.saveOffline=!0,A.a.prepareSubmissionPluginData(this.assign,this.userSubmission,i,!0);throw s}}))}save(){return Object(r.a)(this,void 0,void 0,(function*(){if(!(yield this.hasDataChanged()))return this.leaveWithoutCheck(),void 0;try{yield this.saveSubmission(),this.leaveWithoutCheck()}catch(i){b.a.showErrorModalDefault(i,"Error saving submission.")}}))}saveSubmission(){return Object(r.a)(this,void 0,void 0,(function*(){const i=this.getInputData();if(this.submissionStatement&&(!i.submissionstatement||"false"===i.submissionstatement))throw p.J.instant("addon.mod_assign.acceptsubmissionstatement");let s=yield b.a.showModalLoading(),e=-1;try{e=yield A.a.getSubmissionSizeForEdit(this.assign,this.userSubmission,i)}catch(i){e=-1}s.dismiss();try{yield l.a.confirmUploadFile(e,!0,this.allowOffline),s=yield b.a.showModalLoading("core.sending",!0);const t=yield this.prepareSubmissionData(i);if(!Object.keys(t).length)return;let n;this.saveOffline?(n=!1,yield v.a.saveSubmission(this.assign.id,this.courseId,t,this.userSubmission.timemodified,!this.assign.submissiondrafts,this.userId)):n=yield I.a.saveSubmission(this.assign.id,this.courseId,t,this.allowOffline,this.userSubmission.timemodified,!!this.assign.submissiondrafts,this.userId),A.a.clearSubmissionPluginTmpData(this.assign,this.userSubmission,i),n&&f.b.trigger(f.b.ACTIVITY_DATA_SENT,{module:"assign"}),_.a.triggerFormSubmittedEvent(this.formElement,n,g.b.getCurrentSiteId()),f.b.trigger(I.d.SUBMISSION_SAVED_EVENT,{assignmentId:this.assign.id,submissionId:this.userSubmission.id,userId:this.userId},g.b.getCurrentSiteId()),this.assign.submissiondrafts||f.b.trigger(I.d.SUBMITTED_FOR_GRADING_EVENT,{assignmentId:this.assign.id,submissionId:this.userSubmission.id,userId:this.userId},g.b.getCurrentSiteId())}finally{s.dismiss()}}))}timeUp(){return Object(r.a)(this,void 0,void 0,(function*(){this.timeUpToast=yield b.a.showToastWithOptions({message:p.J.instant("addon.mod_assign.caneditsubmission"),duration:b.c.STICKY,buttons:[p.J.instant("core.dismiss")],cssClass:"core-danger-toast"})}))}ngOnDestroy(){var i;this.isDestroyed=!0,null===(i=this.timeUpToast)||void 0===i||i.dismiss(),this.assign&&h.a.unblockOperation(I.d.COMPONENT,this.assign.id)}}return AddonModAssignEditPage.ɵfac=function AddonModAssignEditPage_Factory(i){return new(i||AddonModAssignEditPage)(E.yc(o.a))},AddonModAssignEditPage.ɵcmp=E.sc({type:AddonModAssignEditPage,selectors:[["page-addon-mod-assign-edit"]],viewQuery:function AddonModAssignEditPage_Query(i,s){var e;(1&i&&E.ud(k,!0),2&i)&&(E.dd(e=E.Nc())&&(s.formElement=e.first))},decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"click"],[3,"hideUntil"],[4,"ngIf"],["timeUpText","00:00:00","class","ion-margin-horizontal",3,"endTime","timerText","align","timeLeftClassThreshold","underTimeClassThresholds","finished",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["name","addon-mod_assign-edit-form"],["editSubmissionForm",""],[3,"assign","submission","plugin","edit","allowOffline",4,"ngFor","ngForOf"],["timeUpText","00:00:00",1,"ion-margin-horizontal",3,"endTime","timerText","align","timeLeftClassThreshold","underTimeClassThresholds","finished"],[1,"ion-text-wrap"],["contextLevel","module",3,"text","component","componentId","contextInstanceId","courseId","maxHeight"],[3,"file","component","componentId",4,"ngFor","ngForOf"],[3,"file","component","componentId"],[3,"text","filter"],["slot","end","name","submissionstatement",3,"ngModel","ngModelChange"],["type","hidden","name","submissionstatement",3,"ngModel"],[3,"assign","submission","plugin","edit","allowOffline"]],template:function AddonModAssignEditPage_Template(i,s){1&i&&(E.Ec(0,"ion-header"),E.Ec(1,"ion-toolbar"),E.Ec(2,"ion-buttons",0),E.zc(3,"ion-back-button",1),E.Pc(4,"translate"),E.Dc(),E.Ec(5,"ion-title"),E.Ec(6,"h1"),E.zc(7,"core-format-text",2),E.Dc(),E.Dc(),E.Ec(8,"ion-buttons",3),E.Ec(9,"ion-button",4),E.Mc("click",(function AddonModAssignEditPage_Template_ion_button_click_9_listener(){return s.save()})),E.pd(10),E.Pc(11,"translate"),E.Dc(),E.Dc(),E.Dc(),E.Dc(),E.Ec(12,"ion-content"),E.Ec(13,"core-loading",5),E.nd(14,AddonModAssignEditPage_ion_list_14_Template,8,5,"ion-list",6),E.Dc(),E.Dc()),2&i&&(E.lc(3),E.Vc("text",E.Qc(4,7,"core.back")),E.lc(4),E.Vc("text",s.title)("contextInstanceId",s.moduleId)("courseId",s.courseId),E.lc(3),E.rd(" ",E.Qc(11,9,"core.save")," "),E.lc(3),E.Vc("hideUntil",s.loaded),E.lc(1),E.Vc("ngIf",s.userSubmission&&s.userSubmission.plugins&&s.userSubmission.plugins.length))},directives:[y.C,y.Ab,y.m,y.h,y.i,y.yb,P.a,T.a,y.l,D.a,y.v,O.a,x.t,y.P,w.H,w.s,w.t,x.s,C.a,y.I,y.O,L.a,y.s,y.d,w.r,w.u,w.c,V.a],pipes:[R.d],styles:["[_nghost-%COMP%]     core-timer{display:block}[_nghost-%COMP%]     core-timer .core-timer.core-timer-under-300{background-color:var(--danger-tint);color:var(--danger-shade)}[_nghost-%COMP%]     core-timer .core-timer.core-timer-under-900{background-color:var(--warning-tint);color:var(--warning-shade)}"]}),AddonModAssignEditPage})();var j=e("ghUQ"),F=e("FltD"),z=e("4JiN");let U=(()=>{class AddonModAssignIndexPage extends j.a{}return AddonModAssignIndexPage.ɵfac=function AddonModAssignIndexPage_Factory(i){return Q(i||AddonModAssignIndexPage)},AddonModAssignIndexPage.ɵcmp=E.sc({type:AddonModAssignIndexPage,selectors:[["page-addon-mod-assign-index"]],viewQuery:function AddonModAssignIndexPage_Query(i,s){var e;(1&i&&E.ud(F.a,!0),2&i)&&(E.dd(e=E.Nc())&&(s.activityComponent=e.first))},features:[E.ic],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","dataRetrieved"]],template:function AddonModAssignIndexPage_Template(i,s){1&i&&(E.Ec(0,"ion-header",0),E.Ec(1,"ion-toolbar"),E.Ec(2,"ion-buttons",1),E.zc(3,"ion-back-button",2),E.Pc(4,"translate"),E.Dc(),E.Ec(5,"ion-title"),E.Ec(6,"h1"),E.zc(7,"core-format-text",3),E.Dc(),E.Dc(),E.zc(8,"ion-buttons",4),E.Dc(),E.Dc(),E.Ec(9,"ion-content",5),E.Ec(10,"ion-refresher",6),E.Mc("ionRefresh",(function AddonModAssignIndexPage_Template_ion_refresher_ionRefresh_10_listener(i){return null==s.activityComponent?null:s.activityComponent.doRefresh(i.target)})),E.zc(11,"ion-refresher-content",7),E.Pc(12,"translate"),E.Dc(),E.Ec(13,"addon-mod-assign-index",8),E.Mc("dataRetrieved",(function AddonModAssignIndexPage_Template_addon_mod_assign_index_dataRetrieved_13_listener(i){return s.updateData(i)})),E.Dc(),E.Dc()),2&i&&(E.lc(3),E.Vc("text",E.Qc(4,8,"core.back")),E.lc(4),E.Vc("text",s.title)("contextInstanceId",null==s.module?null:s.module.id)("courseId",s.courseId),E.lc(3),E.Vc("disabled",null==s.activityComponent?null:s.activityComponent.showLoading),E.lc(1),E.Wc("pullingText",E.Qc(12,10,"core.pulltorefresh")),E.lc(2),E.Vc("module",s.module)("courseId",s.courseId))},directives:[y.C,z.b,y.Ab,y.m,y.h,y.i,y.yb,P.a,D.a,y.v,y.bb,y.cb,F.a],pipes:[R.d],encapsulation:2}),AddonModAssignIndexPage})();const Q=E.Gc(U);var G=e("EoRH"),B=e("baaQ"),J=e("46ml"),W=e("PI6X"),$=e("WPIK"),q=e("FeAf"),Y=e("r8G5");function AddonModAssignSubmissionListPage_ng_container_17_p_4_Template(i,s){if(1&i&&(E.Ec(0,"p",14),E.pd(1),E.Dc()),2&i){const i=E.Oc().$implicit;E.lc(1),E.qd(i.userfullname)}}function AddonModAssignSubmissionListPage_ng_container_17_p_5_Template(i,s){if(1&i&&(E.Ec(0,"p",14),E.pd(1),E.Pc(2,"translate"),E.Dc()),2&i){const i=E.Oc().$implicit;E.lc(1),E.sd(" ",E.Qc(2,2,"addon.mod_assign.hiddenuser"),"",i.blindid," ")}}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_1_Template(i,s){if(1&i&&(E.Ec(0,"span",17),E.pd(1),E.Dc()),2&i){const i=E.Oc(2).$implicit;E.lc(1),E.rd(" ",i.groupname," ")}}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_2_Template(i,s){1&i&&(E.Ec(0,"span",18),E.pd(1),E.Pc(2,"translate"),E.Dc()),2&i&&(E.lc(1),E.rd(" ",E.Qc(2,1,"addon.mod_assign.noteam")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_3_Template(i,s){1&i&&(E.Ec(0,"span",18),E.pd(1),E.Pc(2,"translate"),E.Dc()),2&i&&(E.lc(1),E.rd(" ",E.Qc(2,1,"addon.mod_assign.multipleteams")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_4_Template(i,s){1&i&&(E.Ec(0,"span"),E.pd(1),E.Pc(2,"translate"),E.Dc()),2&i&&(E.lc(1),E.rd(" ",E.Qc(2,1,"addon.mod_assign.defaultteam")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_Template(i,s){if(1&i&&(E.Ec(0,"p"),E.nd(1,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_1_Template,2,1,"span",15),E.nd(2,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_2_Template,3,3,"span",16),E.nd(3,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_3_Template,3,3,"span",16),E.nd(4,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_4_Template,3,3,"span",13),E.Dc()),2&i){const i=E.Oc().$implicit,s=E.Oc();E.lc(1),E.Vc("ngIf",i.groupname),E.lc(1),E.Vc("ngIf",s.assign.preventsubmissionnotingroup&&!i.groupname&&i.noGroups&&!i.blindid),E.lc(1),E.Vc("ngIf",s.assign.preventsubmissionnotingroup&&!i.groupname&&i.manyGroups&&!i.blindid),E.lc(1),E.Vc("ngIf",!s.assign.preventsubmissionnotingroup&&!i.groupname)}}function AddonModAssignSubmissionListPage_ng_container_17_p_7_Template(i,s){if(1&i&&(E.Ec(0,"p"),E.Ec(1,"ion-badge",19),E.pd(2),E.Dc(),E.Dc()),2&i){const i=E.Oc().$implicit;E.lc(1),E.Vc("color",i.statusColor),E.lc(1),E.rd(" ",i.statusTranslated," ")}}function AddonModAssignSubmissionListPage_ng_container_17_p_8_Template(i,s){if(1&i&&(E.Ec(0,"p"),E.Ec(1,"ion-badge",19),E.pd(2),E.Pc(3,"translate"),E.Dc(),E.Dc()),2&i){const i=E.Oc().$implicit;E.lc(1),E.Vc("color",i.gradingColor),E.lc(1),E.rd(" ",E.Qc(3,2,i.gradingStatusTranslationId)," ")}}function AddonModAssignSubmissionListPage_ng_container_17_Template(i,s){if(1&i){const i=E.Fc();E.Cc(0),E.Ec(1,"ion-item",10),E.Mc("click",(function AddonModAssignSubmissionListPage_ng_container_17_Template_ion_item_click_1_listener(){E.fd(i);const e=s.$implicit;return E.Oc().submissions.select(e)})),E.zc(2,"core-user-avatar",11),E.Ec(3,"ion-label"),E.nd(4,AddonModAssignSubmissionListPage_ng_container_17_p_4_Template,2,1,"p",12),E.nd(5,AddonModAssignSubmissionListPage_ng_container_17_p_5_Template,3,4,"p",12),E.nd(6,AddonModAssignSubmissionListPage_ng_container_17_p_6_Template,5,4,"p",13),E.nd(7,AddonModAssignSubmissionListPage_ng_container_17_p_7_Template,3,2,"p",13),E.nd(8,AddonModAssignSubmissionListPage_ng_container_17_p_8_Template,4,4,"p",13),E.Dc(),E.Dc(),E.Bc()}if(2&i){const i=s.$implicit,e=E.Oc();E.lc(1),E.mc("aria-current",e.submissions.getItemAriaCurrent(i)),E.lc(1),E.Vc("user",i)("linkProfile",!1),E.lc(2),E.Vc("ngIf",i.userfullname),E.lc(1),E.Vc("ngIf",!i.userfullname),E.lc(1),E.Vc("ngIf",e.assign&&e.assign.teamsubmission),E.lc(1),E.Vc("ngIf",i.statusTranslated),E.lc(1),E.Vc("ngIf",i.gradingStatusTranslationId)}}function AddonModAssignSubmissionListPage_core_empty_box_18_Template(i,s){1&i&&(E.zc(0,"core-empty-box",20),E.Pc(1,"translate")),2&i&&E.Vc("message",E.Qc(1,1,"addon.mod_assign.submissionstatus_"))}let H=(()=>{class AddonModAssignSubmissionListPage{constructor(){this.title="",this.gradedObserver=f.b.on(I.d.GRADED_EVENT,(i=>{var s;this.submissions.loaded&&this.submissions.getSource().assign&&i.assignmentId==(null===(s=this.submissions.getSource().assign)||void 0===s?void 0:s.id)&&i.userId==g.b.getCurrentSiteUserId()&&this.refreshAllData(!0)}),g.b.getCurrentSiteId());this.syncObserver=f.b.onMultiple([S.b.AUTO_SYNCED,S.b.MANUAL_SYNCED],(i=>{!this.submissions.loaded||"context"in i&&"submission-list"==i.context||this.refreshAllData(!1)}),g.b.getCurrentSiteId());try{const i=m.a.getRequiredRouteNumberParam("cmId"),s=m.a.getRequiredRouteNumberParam("courseId"),e=m.a.getRouteNumberParam("groupId")||0,t=m.a.getRouteParam("status"),n=B.a.getOrCreateSource(W.b,[s,i,t]);n.groupId=e,this.sourceUnsubscribe=n.addListener({onItemsUpdated:()=>{var i;this.title=(null===(i=this.submissions.getSource().assign)||void 0===i?void 0:i.name)||this.title}}),this.submissions=new G.a(n,AddonModAssignSubmissionListPage)}catch(i){return b.a.showErrorModal(i),m.a.back(),void 0}}get assign(){return this.submissions.getSource().assign}get groupInfo(){return this.submissions.getSource().groupInfo}get moduleId(){return this.submissions.getSource().MODULE_ID}get courseId(){return this.submissions.getSource().COURSE_ID}get groupId(){return this.submissions.getSource().groupId}set groupId(i){this.submissions.getSource().groupId=i}ngAfterViewInit(){const i=this.submissions.getSource().SELECTED_STATUS;this.title=p.J.instant(i?i===W.a.NEED_GRADING?"addon.mod_assign.numberofsubmissionsneedgrading":`addon.mod_assign.submissionstatus_${i}`:"addon.mod_assign.numberofparticipants"),this.fetchAssignment(!0).finally((()=>{this.submissions.start(this.splitView)}))}fetchAssignment(i=!1){return Object(r.a)(this,void 0,void 0,(function*(){try{yield this.submissions.getSource().loadAssignment(i)}catch(i){b.a.showErrorModalDefault(i,"Error getting assigment data.")}}))}refreshAllData(i){return Object(r.a)(this,void 0,void 0,(function*(){try{yield this.submissions.getSource().invalidateCache()}finally{this.fetchAssignment(i)}}))}refreshList(i){this.refreshAllData(!0).finally((()=>{null==i?void 0:i.complete()}))}reloadSubmissions(){return Object(r.a)(this,void 0,void 0,(function*(){yield this.submissions.reload()}))}ngOnDestroy(){var i,s;null===(i=this.gradedObserver)||void 0===i?void 0:i.off(),null===(s=this.syncObserver)||void 0===s||s.off(),this.submissions.destroy(),this.sourceUnsubscribe&&this.sourceUnsubscribe()}}return AddonModAssignSubmissionListPage.ɵfac=function AddonModAssignSubmissionListPage_Factory(i){return new(i||AddonModAssignSubmissionListPage)},AddonModAssignSubmissionListPage.ɵcmp=E.sc({type:AddonModAssignSubmissionListPage,selectors:[["page-addon-mod-assign-submission-list"]],viewQuery:function AddonModAssignSubmissionListPage_Query(i,s){var e;(1&i&&E.ud(J.a,!0),2&i)&&(E.dd(e=E.Nc())&&(s.splitView=e.first))},decls:19,vars:15,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"groupInfo","selected","selectedChange"],[4,"ngFor","ngForOf"],["icon","fas-file-signature",3,"message",4,"ngIf"],["button","","detail","true",1,"ion-text-wrap",3,"click"],["slot","start",3,"user","linkProfile"],["class","item-heading",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["class","core-groupname",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"core-groupname"],[1,"text-danger"],[1,"ion-text-center","ion-text-wrap",3,"color"],["icon","fas-file-signature",3,"message"]],template:function AddonModAssignSubmissionListPage_Template(i,s){1&i&&(E.Ec(0,"ion-header"),E.Ec(1,"ion-toolbar"),E.Ec(2,"ion-buttons",0),E.zc(3,"ion-back-button",1),E.Pc(4,"translate"),E.Dc(),E.Ec(5,"ion-title"),E.Ec(6,"h1"),E.zc(7,"core-format-text",2),E.Dc(),E.Dc(),E.zc(8,"ion-buttons",3),E.Dc(),E.Dc(),E.Ec(9,"ion-content"),E.Ec(10,"core-split-view"),E.Ec(11,"ion-refresher",4),E.Mc("ionRefresh",(function AddonModAssignSubmissionListPage_Template_ion_refresher_ionRefresh_11_listener(i){return s.refreshList(i.target)})),E.zc(12,"ion-refresher-content",5),E.Pc(13,"translate"),E.Dc(),E.Ec(14,"core-loading",6),E.Ec(15,"ion-list"),E.Ec(16,"core-group-selector",7),E.Mc("selectedChange",(function AddonModAssignSubmissionListPage_Template_core_group_selector_selectedChange_16_listener(i){return s.groupId=i}))("selectedChange",(function AddonModAssignSubmissionListPage_Template_core_group_selector_selectedChange_16_listener(){return s.reloadSubmissions()})),E.Dc(),E.nd(17,AddonModAssignSubmissionListPage_ng_container_17_Template,9,8,"ng-container",8),E.Dc(),E.nd(18,AddonModAssignSubmissionListPage_core_empty_box_18_Template,2,3,"core-empty-box",9),E.Dc(),E.Dc(),E.Dc()),2&i&&(E.lc(3),E.Vc("text",E.Qc(4,11,"core.back")),E.lc(4),E.Vc("text",s.title)("contextInstanceId",s.moduleId)("courseId",s.courseId),E.lc(4),E.Vc("disabled",!s.submissions.loaded),E.lc(1),E.Wc("pullingText",E.Qc(13,13,"core.pulltorefresh")),E.lc(2),E.Vc("hideUntil",s.submissions.loaded),E.lc(2),E.Vc("groupInfo",s.groupInfo)("selected",s.groupId),E.lc(1),E.Vc("ngForOf",s.submissions.items),E.lc(1),E.Vc("ngIf",!s.submissions||s.submissions.empty))},directives:[y.C,y.Ab,y.m,y.h,y.i,y.yb,P.a,D.a,y.v,J.a,y.bb,y.cb,O.a,y.P,$.a,x.s,x.t,y.I,q.a,y.O,y.k,Y.a],pipes:[R.d],encapsulation:2}),AddonModAssignSubmissionListPage})();var X=e("eoiU"),K=e("ULAo"),Z=e("q/1B"),ii=e("ACV2"),si=e("OZH1");function AddonModAssignSubmissionReviewPage_addon_mod_assign_submission_18_Template(i,s){if(1&i&&E.zc(0,"addon-mod-assign-submission",10),2&i){const i=E.Oc();E.Vc("courseId",i.courseId)("moduleId",i.moduleId)("submitId",i.submitId)("blindId",i.blindId)}}let ei=(()=>{class AddonModAssignSubmissionReviewPage{constructor(i){this.route=i,this.title="",this.loaded=!1,this.canSaveGrades=!1,this.blindMarking=!1,this.forceLeave=!1}ngOnInit(){this.route.queryParams.subscribe((i=>{var s;try{this.moduleId=m.a.getRequiredRouteNumberParam("cmId"),this.courseId=m.a.getRequiredRouteNumberParam("courseId"),this.submitId=m.a.getRouteNumberParam("submitId")||0,this.blindId=m.a.getRouteNumberParam("blindId",{params:i});const e=m.a.getRequiredRouteNumberParam("groupId"),t=m.a.getRouteParam("selectedStatus"),n=B.a.getOrCreateSource(W.b,[this.courseId,this.moduleId,t]);null===(s=this.submissions)||void 0===s?void 0:s.destroy(),n.groupId=e,this.submissions=new submission_review_AddonModAssignSubmissionSwipeItemsManager(n),this.submissions.start()}catch(i){return b.a.showErrorModal(i),m.a.back(),void 0}this.fetchSubmission().finally((()=>{this.loaded=!0}))}))}ngOnDestroy(){var i;null===(i=this.submissions)||void 0===i?void 0:i.destroy()}canLeave(){return Object(r.a)(this,void 0,void 0,(function*(){return!(this.submissionComponent&&!this.forceLeave)||this.submissionComponent.canLeave()}))}ionViewDidEnter(){var i;null===(i=this.submissionComponent)||void 0===i?void 0:i.ionViewDidEnter()}ionViewDidLeave(){var i;null===(i=this.submissionComponent)||void 0===i?void 0:i.ionViewDidLeave()}fetchSubmission(){return Object(r.a)(this,void 0,void 0,(function*(){this.assign=yield I.a.getAssignment(this.courseId,this.moduleId),this.title=this.assign.name,this.blindMarking=!!this.assign.blindmarking&&!this.assign.revealidentities;const i=yield K.a.getModuleBasicGradeInfo(this.moduleId);if(i)if(i.advancedgrading&&i.advancedgrading[0]&&void 0!==i.advancedgrading[0].method){this.canSaveGrades="simple"==(i.advancedgrading[0].method||"simple")}else this.canSaveGrades=!0}))}refreshAllData(){return Object(r.a)(this,void 0,void 0,(function*(){const i=[];i.push(I.a.invalidateAssignmentData(this.courseId)),this.assign&&(i.push(I.a.invalidateSubmissionData(this.assign.id)),i.push(I.a.invalidateAssignmentUserMappingsData(this.assign.id)),i.push(I.a.invalidateSubmissionStatusData(this.assign.id,this.submitId,void 0,this.blindMarking)));try{yield Promise.all(i)}finally{this.submissionComponent&&this.submissionComponent.invalidateAndRefresh(!0),yield this.fetchSubmission()}}))}refreshSubmission(i){this.refreshAllData().finally((()=>{null==i?void 0:i.complete()}))}submitGrade(){return Object(r.a)(this,void 0,void 0,(function*(){if(this.submissionComponent)try{yield this.submissionComponent.submitGrade(),d.a.isTablet||(this.forceLeave=!0,m.a.back())}catch(i){b.a.showErrorModalDefault(i,"core.error",!0)}}))}}return AddonModAssignSubmissionReviewPage.ɵfac=function AddonModAssignSubmissionReviewPage_Factory(i){return new(i||AddonModAssignSubmissionReviewPage)(E.yc(o.a))},AddonModAssignSubmissionReviewPage.ɵcmp=E.sc({type:AddonModAssignSubmissionReviewPage,selectors:[["page-addon-mod-assign-submission-review"]],viewQuery:function AddonModAssignSubmissionReviewPage_Query(i,s){var e;(1&i&&E.ud(Z.a,!0),2&i)&&(E.dd(e=E.Nc())&&(s.submissionComponent=e.first))},decls:19,vars:17,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"hidden","click"],[3,"core-swipe-navigation"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"courseId","moduleId","submitId","blindId",4,"ngIf"],[3,"courseId","moduleId","submitId","blindId"]],template:function AddonModAssignSubmissionReviewPage_Template(i,s){1&i&&(E.Ec(0,"ion-header"),E.Ec(1,"ion-toolbar"),E.Ec(2,"ion-buttons",0),E.zc(3,"ion-back-button",1),E.Pc(4,"translate"),E.Dc(),E.Ec(5,"ion-title"),E.Ec(6,"h1"),E.zc(7,"core-format-text",2),E.Dc(),E.Dc(),E.zc(8,"ion-buttons",3),E.Dc(),E.Ec(9,"core-navbar-buttons",3),E.Ec(10,"ion-button",4),E.Mc("click",(function AddonModAssignSubmissionReviewPage_Template_ion_button_click_10_listener(){return s.submitGrade()})),E.pd(11),E.Pc(12,"translate"),E.Dc(),E.Dc(),E.Dc(),E.Ec(13,"ion-content",5),E.Ec(14,"ion-refresher",6),E.Mc("ionRefresh",(function AddonModAssignSubmissionReviewPage_Template_ion_refresher_ionRefresh_14_listener(i){return s.refreshSubmission(i.target)})),E.zc(15,"ion-refresher-content",7),E.Pc(16,"translate"),E.Dc(),E.Ec(17,"core-loading",8),E.nd(18,AddonModAssignSubmissionReviewPage_addon_mod_assign_submission_18_Template,1,4,"addon-mod-assign-submission",9),E.Dc(),E.Dc()),2&i&&(E.lc(3),E.Vc("text",E.Qc(4,11,"core.back")),E.lc(4),E.Vc("text",s.title)("contextInstanceId",s.moduleId)("courseId",s.courseId),E.lc(3),E.Vc("hidden",!s.canSaveGrades),E.lc(1),E.rd(" ",E.Qc(12,13,"core.done")," "),E.lc(2),E.Vc("core-swipe-navigation",s.submissions),E.lc(1),E.Vc("disabled",!s.loaded),E.lc(1),E.Wc("pullingText",E.Qc(16,15,"core.pulltorefresh")),E.lc(2),E.Vc("hideUntil",s.loaded),E.lc(1),E.Vc("ngIf",s.loaded))},directives:[y.C,y.Ab,y.m,y.h,y.i,y.yb,P.a,ii.a,T.a,y.l,D.a,y.v,si.a,y.bb,y.cb,O.a,x.t,Z.a],pipes:[R.d],encapsulation:2}),AddonModAssignSubmissionReviewPage})();class submission_review_AddonModAssignSubmissionSwipeItemsManager extends X.a{getSelectedItemPathFromRoute(i){return i.params.submitId}}const ti=[{path:":courseId/:cmId",component:U},{path:":courseId/:cmId/edit",component:N,canDeactivate:[a.a]}],ni=[...ti,{path:":courseId/:cmId/submission",component:H},{path:":courseId/:cmId/submission/:submitId",component:ei,canDeactivate:[a.a]}],oi=[...ti,{path:":courseId/:cmId/submission",component:H,children:[{path:":submitId",component:ei,canDeactivate:[a.a]}]}],ai=[...Object(t.c)(ni,(()=>d.a.isMobile)),...Object(t.c)(oi,(()=>d.a.isTablet))];let di=(()=>{class AddonModAssignLazyModule{}return AddonModAssignLazyModule.ɵmod=E.wc({type:AddonModAssignLazyModule}),AddonModAssignLazyModule.ɵinj=E.vc({factory:function AddonModAssignLazyModule_Factory(i){return new(i||AddonModAssignLazyModule)},imports:[[o.m.forChild(ai),n.a,c.a]]}),AddonModAssignLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&E.kd(di,{declarations:[U,H,ei,N],imports:[o.m,n.a,c.a]}))},eoiU:function(i,s,e){"use strict";e.d(s,"a",(function(){return CoreSwipeNavigationItemsManager}));var t=e("mrSG"),n=e("pHTc"),o=e("CtbY");class CoreSwipeNavigationItemsManager extends o.a{start(){return Object(t.a)(this,void 0,void 0,(function*(){this.updateSelectedItem()}))}navigateToNextItem(){return Object(t.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(1,"forward")}))}navigateToPreviousItem(){return Object(t.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(-1,"back")}))}hasNextItem(){return Object(t.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(1))}))}hasPreviousItem(){return Object(t.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(-1))}))}getCurrentPageRoute(){return n.a.getCurrentRoute()}getSelectedItemPathFromRoute(i){const s=[];for(;i&&(s.push(...i.url),i.firstChild);)i=i.firstChild;return s.map((i=>i.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(i,s){return Object(t.a)(this,void 0,void 0,(function*(){const e=yield this.getItemBy(i);e&&(yield this.navigateToItem(e,{animationDirection:s,replace:!0}))}))}getItemBy(i){var s;return Object(t.a)(this,void 0,void 0,(function*(){const e=this.getSource().getItems(),t=null!==(s=this.selectedItem&&(null==e?void 0:e.indexOf(this.selectedItem)))&&void 0!==s?s:-1;if(-1===t||null===e)return null;const n=i>0?1:-1;let o=t,a=0;for(;a!==i&&(o+=n,!(o<0||o>=e.length));)this.skipItemInSwipe(e[o])||(a+=n);return a===i?e[o]:this.getSource().isCompleted()?null:(yield this.getSource().load(),this.getItemBy(i))}))}skipItemInSwipe(i){return!1}}}}]);