(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{NNBU:function(i,t,n){"use strict";n.r(t),n.d(t,"AddonNotificationsListPageModule",(function(){return Q}));var o=n("tyNb"),e=n("L3Fv"),a=n("mrSG"),c=n("3LXp"),r=n("bFG1"),s=n("fjkH"),d=n("yjU1"),l=n("pHTc"),_=n("46ml"),f=n("baaQ"),g=n("2eZG"),m=n("9+EE"),p=n("YyYz"),u=n("Q98t"),h=n("VUQF"),b=n("EoRH"),P=n("qkYQ"),A=n("fXoL"),v=n("TEn/"),N=n("C1x5"),M=n("nt/U"),O=n("PgjG"),x=n("ofXK"),C=n("xpMl"),k=n("3jOR"),w=n("hMzs"),L=n("FeAf"),E=n("eAud"),y=n("3CSS"),T=n("r8G5"),V=n("sYmb"),I=n("lAaw");function AddonNotificationsListPage_ion_item_17_core_user_avatar_2_div_1_Template(i,t){if(1&i&&(A.Ec(0,"div",20),A.zc(1,"img",21),A.Dc()),2&i){const i=A.Oc(2).$implicit;A.lc(1),A.Vc("src",i.iconurl,A.id)}}function AddonNotificationsListPage_ion_item_17_core_user_avatar_2_core_mod_icon_2_Template(i,t){if(1&i&&A.zc(0,"core-mod-icon",22),2&i){const i=A.Oc(2).$implicit;A.Vc("modicon",i.iconurl)("modname",i.modname)("showAlt",!1)}}function AddonNotificationsListPage_ion_item_17_core_user_avatar_2_Template(i,t){if(1&i&&(A.Ec(0,"core-user-avatar",17),A.nd(1,AddonNotificationsListPage_ion_item_17_core_user_avatar_2_div_1_Template,2,1,"div",18),A.nd(2,AddonNotificationsListPage_ion_item_17_core_user_avatar_2_core_mod_icon_2_Template,1,3,"core-mod-icon",19),A.Dc()),2&i){const i=A.Oc().$implicit;A.Vc("user",i)("profileUrl",i.profileimageurlfrom)("fullname",i.userfromfullname)("userId",i.useridfrom),A.lc(1),A.Vc("ngIf",i.iconurl&&!i.modname),A.lc(1),A.Vc("ngIf",i.modname)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_div_1_Template(i,t){if(1&i&&(A.Ec(0,"div",25),A.zc(1,"img",21),A.Dc()),2&i){const i=A.Oc(2).$implicit;A.lc(1),A.Vc("src",i.iconurl,A.id)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_core_mod_icon_2_Template(i,t){if(1&i&&A.zc(0,"core-mod-icon",26),2&i){const i=A.Oc(2).$implicit;A.Vc("modicon",i.iconurl)("modname",i.modname)("showAlt",!1)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_Template(i,t){if(1&i&&(A.Cc(0),A.nd(1,AddonNotificationsListPage_ion_item_17_ng_container_3_div_1_Template,2,1,"div",23),A.nd(2,AddonNotificationsListPage_ion_item_17_ng_container_3_core_mod_icon_2_Template,1,3,"core-mod-icon",24),A.Bc()),2&i){const i=A.Oc().$implicit;A.lc(1),A.Vc("ngIf",!i.modname),A.lc(1),A.Vc("ngIf",i.modname)}}function AddonNotificationsListPage_ion_item_17_ng_container_10_Template(i,t){if(1&i&&(A.Cc(0),A.pd(1),A.Bc()),2&i){const i=A.Oc().$implicit;A.lc(1),A.rd(" · ",i.userfromfullname,"")}}function AddonNotificationsListPage_ion_item_17_ion_note_11_Template(i,t){1&i&&(A.Ec(0,"ion-note",2),A.zc(1,"ion-icon",27),A.Dc())}const _c0=function(i){return{$a:i}};function AddonNotificationsListPage_ion_item_17_Template(i,t){if(1&i){const i=A.Fc();A.Ec(0,"ion-item",11),A.Mc("click",(function AddonNotificationsListPage_ion_item_17_Template_ion_item_click_0_listener(){A.fd(i);const n=t.$implicit;return A.Oc().notifications.select(n)})),A.Pc(1,"translate"),A.nd(2,AddonNotificationsListPage_ion_item_17_core_user_avatar_2_Template,3,6,"core-user-avatar",12),A.nd(3,AddonNotificationsListPage_ion_item_17_ng_container_3_Template,3,2,"ng-container",13),A.Ec(4,"ion-label"),A.Ec(5,"p",14),A.zc(6,"core-format-text",15),A.Dc(),A.Ec(7,"p"),A.pd(8),A.Pc(9,"coreTimeAgo"),A.nd(10,AddonNotificationsListPage_ion_item_17_ng_container_10_Template,2,1,"ng-container",13),A.Dc(),A.Dc(),A.nd(11,AddonNotificationsListPage_ion_item_17_ion_note_11_Template,2,0,"ion-note",16),A.Dc()}if(2&i){const i=t.$implicit,n=A.Oc();A.Vc("detail",!1),A.mc("aria-current",n.notifications.getItemAriaCurrent(i))("aria-label",i.timeread?i.subject:A.Rc(1,11,"addon.notifications.unreadnotification",A.ad(16,_c0,i.subject))),A.lc(2),A.Vc("ngIf",i.useridfrom>0),A.lc(1),A.Vc("ngIf",i.useridfrom<=0&&i.iconurl),A.lc(3),A.Vc("text",i.subject)("contextInstanceId",0)("wsNotFiltered",!0),A.lc(2),A.qd(A.Qc(9,14,i.timecreated)),A.lc(2),A.Vc("ngIf",i.useridfrom>0),A.lc(1),A.Vc("ngIf",!i.timeread)}}function AddonNotificationsListPage_core_empty_box_18_Template(i,t){1&i&&(A.zc(0,"core-empty-box",28),A.Pc(1,"translate")),2&i&&A.Vc("message",A.Qc(1,1,"addon.notifications.therearentnotificationsyet"))}function AddonNotificationsListPage_ion_chip_21_ion_icon_1_Template(i,t){1&i&&A.zc(0,"ion-icon",31)}function AddonNotificationsListPage_ion_chip_21_ion_spinner_2_Template(i,t){1&i&&(A.zc(0,"ion-spinner"),A.Pc(1,"translate")),2&i&&A.mc("aria-label",A.Qc(1,1,"core.loading"))}function AddonNotificationsListPage_ion_chip_21_Template(i,t){if(1&i){const i=A.Fc();A.Ec(0,"ion-chip",29),A.Mc("click",(function AddonNotificationsListPage_ion_chip_21_Template_ion_chip_click_0_listener(){A.fd(i);return A.Oc().markAllNotificationsAsRead()})),A.nd(1,AddonNotificationsListPage_ion_chip_21_ion_icon_1_Template,1,0,"ion-icon",30),A.nd(2,AddonNotificationsListPage_ion_chip_21_ion_spinner_2_Template,2,3,"ion-spinner",13),A.pd(3),A.Pc(4,"translate"),A.Dc()}if(2&i){const i=A.Oc();A.Vc("disabled",i.loadingMarkAllNotificationsAsRead),A.lc(1),A.Vc("ngIf",!i.loadingMarkAllNotificationsAsRead),A.lc(1),A.Vc("ngIf",i.loadingMarkAllNotificationsAsRead),A.lc(1),A.rd(" ",A.Qc(4,4,"addon.notifications.markallread")," ")}}let z=(()=>{class AddonNotificationsListPage{constructor(){this.fetchMoreNotificationsFailed=!1,this.canMarkAllNotificationsAsRead=!1,this.loadingMarkAllNotificationsAsRead=!1,this.pendingRefresh=!1;try{const i=f.a.getOrCreateSource(m.b.getRequiredCurrentSite().isVersionGreaterEqualThan("4.0")?h.a:P.a,[]);this.notifications=new b.a(i,AddonNotificationsListPage)}catch(i){c.a.showErrorModal(i),l.a.back()}}ngAfterViewInit(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.fetchInitialNotifications(),this.notifications.start(this.splitView),this.cronObserver=s.b.on(d.c.READ_CRON_EVENT,(()=>{this.isCurrentView&&this.refreshNotifications()}),m.b.getCurrentSiteId()),this.pushObserver=g.a.on("receive").subscribe((i=>{if(!this.isCurrentView)return this.pendingRefresh=!0,void 0;r.a.isTrueOrOne(i.notif)&&m.b.isCurrentSite(i.site)&&this.refreshNotifications()})),this.readObserver=s.b.on(d.c.READ_CHANGED_EVENT,(i=>{if(!i.id)return;const t=this.notifications.items.find((t=>t.id===i.id));t&&(t.read=!0,t.timeread=i.time,this.loadMarkAllAsReadButton())}));(new p.a).treatLink()}))}fetchNotifications(i){return Object(a.a)(this,void 0,void 0,(function*(){i?yield this.notifications.reload():yield this.notifications.load(),this.fetchMoreNotificationsFailed=!1,this.loadMarkAllAsReadButton()}))}fetchInitialNotifications(){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.fetchNotifications(!0)}catch(i){c.a.showErrorModalDefault(i,"Error loading notifications"),this.notifications.reset()}}))}fetchMoreNotifications(i){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.fetchNotifications(!1)}catch(i){c.a.showErrorModalDefault(i,"Error loading more notifications"),this.fetchMoreNotificationsFailed=!0}i()}))}markAllNotificationsAsRead(){return Object(a.a)(this,void 0,void 0,(function*(){this.loadingMarkAllNotificationsAsRead=!0,yield r.a.ignoreErrors(d.a.markAllNotificationsAsRead()),s.b.trigger(d.c.READ_CHANGED_EVENT,{time:u.a.timestamp()},m.b.getCurrentSiteId()),yield this.refreshNotifications()}))}loadMarkAllAsReadButton(){return Object(a.a)(this,void 0,void 0,(function*(){try{this.loadingMarkAllNotificationsAsRead=!0;const i=yield d.a.getUnreadNotificationsCount();this.canMarkAllNotificationsAsRead=i.count>0}finally{this.loadingMarkAllNotificationsAsRead=!1}}))}refreshNotifications(i){return Object(a.a)(this,void 0,void 0,(function*(){yield r.a.ignoreErrors(d.a.invalidateNotificationsList()),yield r.a.ignoreErrors(this.fetchNotifications(!0)),null==i||i.complete()}))}ionViewDidEnter(){this.isCurrentView=!0,this.pendingRefresh&&(this.pendingRefresh=!1,this.refreshNotifications())}ionViewDidLeave(){this.isCurrentView=!1}ngOnDestroy(){var i,t,n,o;null===(i=this.cronObserver)||void 0===i?void 0:i.off(),null===(t=this.readObserver)||void 0===t||t.off(),null===(n=this.pushObserver)||void 0===n||n.unsubscribe(),null===(o=this.notifications)||void 0===o||o.destroy()}}return AddonNotificationsListPage.ɵfac=function AddonNotificationsListPage_Factory(i){return new(i||AddonNotificationsListPage)},AddonNotificationsListPage.ɵcmp=A.sc({type:AddonNotificationsListPage,selectors:[["page-addon-notifications-list"]],viewQuery:function AddonNotificationsListPage_Query(i,t){var n;(1&i&&A.ud(_.a,!0),2&i)&&(A.dd(n=A.Nc())&&(t.splitView=n.first))},decls:22,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap","button","","lines","full",3,"detail","click",4,"ngFor","ngForOf"],["icon","far-bell",3,"message",4,"ngIf"],[3,"enabled","error","action"],["slot","fixed","collapsible-footer","","appearOnBottom","",1,"mark-all-as-read"],["color","primary",3,"disabled","click",4,"ngIf"],["button","","lines","full",1,"ion-text-wrap",3,"detail","click"],["slot","start",3,"user","profileUrl","fullname","userId",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId","wsNotFiltered"],["slot","end",4,"ngIf"],["slot","start",3,"user","profileUrl","fullname","userId"],["class","core-avatar-extra-img",4,"ngIf"],[3,"modicon","modname","showAlt",4,"ngIf"],[1,"core-avatar-extra-img"],["alt","","role","presentation",3,"src"],[3,"modicon","modname","showAlt"],["class","core-notification-icon","slot","start",4,"ngIf"],["class","core-notification-icon","slot","start",3,"modicon","modname","showAlt",4,"ngIf"],["slot","start",1,"core-notification-icon"],["slot","start",1,"core-notification-icon",3,"modicon","modname","showAlt"],["name","fas-circle","color","primary","aria-hidden","true"],["icon","far-bell",3,"message"],["color","primary",3,"disabled","click"],["name","fas-eye","aria-hidden","true",4,"ngIf"],["name","fas-eye","aria-hidden","true"]],template:function AddonNotificationsListPage_Template(i,t){1&i&&(A.Ec(0,"ion-header"),A.Ec(1,"ion-toolbar"),A.Ec(2,"ion-buttons",0),A.zc(3,"ion-back-button",1),A.Pc(4,"translate"),A.Dc(),A.Ec(5,"ion-title"),A.Ec(6,"h1"),A.pd(7),A.Pc(8,"translate"),A.Dc(),A.Dc(),A.Ec(9,"ion-buttons",2),A.zc(10,"core-user-menu-button"),A.Dc(),A.Dc(),A.Dc(),A.Ec(11,"ion-content"),A.Ec(12,"core-split-view"),A.Ec(13,"ion-refresher",3),A.Mc("ionRefresh",(function AddonNotificationsListPage_Template_ion_refresher_ionRefresh_13_listener(i){return t.refreshNotifications(i.target)})),A.zc(14,"ion-refresher-content",4),A.Pc(15,"translate"),A.Dc(),A.Ec(16,"core-loading",5),A.nd(17,AddonNotificationsListPage_ion_item_17_Template,12,18,"ion-item",6),A.nd(18,AddonNotificationsListPage_core_empty_box_18_Template,2,3,"core-empty-box",7),A.Ec(19,"core-infinite-loading",8),A.Mc("action",(function AddonNotificationsListPage_Template_core_infinite_loading_action_19_listener(i){return t.fetchMoreNotifications(i)})),A.Dc(),A.Dc(),A.Ec(20,"div",9),A.nd(21,AddonNotificationsListPage_ion_chip_21_Template,5,6,"ion-chip",10),A.Dc(),A.Dc(),A.Dc()),2&i&&(A.lc(3),A.Vc("text",A.Qc(4,10,"core.back")),A.lc(4),A.qd(A.Qc(8,12,"addon.notifications.notifications")),A.lc(6),A.Vc("disabled",!t.notifications.loaded),A.lc(1),A.Wc("pullingText",A.Qc(15,14,"core.pulltorefresh")),A.lc(2),A.Vc("hideUntil",t.notifications.loaded),A.lc(1),A.Vc("ngForOf",t.notifications.items),A.lc(1),A.Vc("ngIf",!t.notifications||t.notifications.empty),A.lc(1),A.Vc("enabled",t.notifications.loaded&&!t.notifications.completed)("error",t.fetchMoreNotificationsFailed),A.lc(2),A.Vc("ngIf",t.notifications.loaded&&t.canMarkAllNotificationsAsRead))},directives:[v.C,v.Ab,v.m,v.h,v.i,v.yb,N.a,M.a,v.v,_.a,v.bb,v.cb,O.a,x.s,x.t,C.a,k.a,v.I,v.O,w.a,L.a,E.a,v.W,v.D,y.a,T.a,v.t,v.qb],pipes:[V.d,I.a],styles:["ion-item[_ngcontent-%COMP%]{--icon-size:16px;--extra-icon-size:12px;--core-avatar-size:32px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]{font-size:var(--text-size);-webkit-line-clamp:3;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;display:-webkit-box}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin:0;padding-left:8px;padding-right:0;padding-top:12px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{padding-left:unset;padding-right:unset;-webkit-padding-start:8px;padding-inline-start:8px;-webkit-padding-end:0;padding-inline-end:0}}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:6px;vertical-align:middle}ion-item[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{align-self:start;margin-top:16px}ion-item[_ngcontent-%COMP%]   core-mod-icon.core-notification-icon[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:8px;max-width:var(--core-avatar-size);max-height:var(--core-avatar-size)}.mark-all-as-read[_ngcontent-%COMP%]{padding-bottom:16px;bottom:0;left:0;right:0;display:flex;background:transparent;box-shadow:none;pointer-events:none}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]{pointer-events:all;margin:0 auto;box-shadow:0 2px 4px rgba(0,0,0,.4)}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:16px;height:16px;margin-left:0;margin-right:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:44px}","[_nghost-%COMP%]{--extra-icon-size:16px;--icon-size:24px}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img, [_nghost-%COMP%]     core-user-avatar core-mod-icon{margin:0!important;position:absolute;right:-4px;bottom:-4px;padding:.2rem}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img{background:var(--background-color);border-radius:var(--medium-radius)}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img img{max-width:var(--extra-icon-size);max-height:var(--extra-icon-size);display:block}[_nghost-%COMP%]     core-user-avatar core-mod-icon{--size:var(--extra-icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:.7rem;background:var(--background-color);border-radius:var(--small-radius)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:var(--icon-size);height:var(--icon-size)}[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{--module-icon-size:var(--icon-size);margin:6px 8px 6px 0}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}"]}),AddonNotificationsListPage})();var D=n("dQ3M"),R=n("vY5A"),F=n("Y+03");const j=[{path:"",component:z,children:Object(R.c)([{path:":id",loadChildren:()=>n.e(11).then(n.bind(null,"csSw")).then((i=>i.AddonNotificationsNotificationPageModule))}],(()=>F.a.isTablet))}];let Q=(()=>{class AddonNotificationsListPageModule{}return AddonNotificationsListPageModule.ɵmod=A.wc({type:AddonNotificationsListPageModule}),AddonNotificationsListPageModule.ɵinj=A.vc({factory:function AddonNotificationsListPageModule_Factory(i){return new(i||AddonNotificationsListPageModule)},imports:[[o.m.forChild(j),e.a,D.a],o.m]}),AddonNotificationsListPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&A.kd(Q,{declarations:[z],imports:[o.m,e.a,D.a],exports:[o.m]}))}}]);