(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{QXg6:function(n,e,o){"use strict";o.r(e),o.d(e,"CoreLoginReconnectPageModule",(function(){return D}));var t=o("tyNb"),i=o("L3Fv"),c=o("mrSG"),r=o("3Pt+"),a=o("nvXB"),s=o("GGba"),g=o("9+EE"),l=o("3LXp"),d=o("bFG1"),_=o("mv9v"),u=o("fjkH"),m=o("93ts"),p=o("pHTc"),f=o("4reR"),h=o("fXoL"),P=o("TEn/"),C=o("nt/U"),O=o("ofXK"),b=o("NcPy"),M=o("hMzs"),v=o("3CSS"),w=o("lqoc"),k=o("ACYt"),R=o("sYmb");const L=["reconnectForm"],_c1=function(n){return{$a:n}};function CoreLoginReconnectPage_img_12_Template(n,e){if(1&n&&(h.zc(0,"img",14),h.Pc(1,"translate")),2&n){const n=h.Oc();h.Wc("alt",h.Rc(1,3,"core.pictureof",h.ad(6,_c1,n.userFullName))),h.Vc("src",n.userAvatar,h.id)("siteId",n.siteId)}}function CoreLoginReconnectPage_div_13_img_1_Template(n,e){if(1&n&&h.zc(0,"img",18),2&n){const n=h.Oc(2);h.Vc("src",n.logoUrl,h.id)}}function CoreLoginReconnectPage_div_13_img_2_Template(n,e){1&n&&h.zc(0,"img",19)}function CoreLoginReconnectPage_div_13_Template(n,e){if(1&n&&(h.Ec(0,"div",15),h.nd(1,CoreLoginReconnectPage_div_13_img_1_Template,1,1,"img",16),h.nd(2,CoreLoginReconnectPage_div_13_img_2_Template,1,0,"img",17),h.Dc()),2&n){const n=h.Oc();h.lc(1),h.Vc("ngIf",n.logoUrl),h.lc(1),h.Vc("ngIf",!n.logoUrl)}}function CoreLoginReconnectPage_p_14_Template(n,e){if(1&n&&(h.Ec(0,"p",20),h.zc(1,"core-format-text",21),h.Dc()),2&n){const n=h.Oc();h.lc(1),h.Vc("text",n.siteName)("filter",!1)}}function CoreLoginReconnectPage_ion_card_17_Template(n,e){1&n&&(h.Ec(0,"ion-card",22),h.Ec(1,"ion-item"),h.zc(2,"ion-icon",23),h.Ec(3,"ion-label"),h.Ec(4,"p"),h.pd(5),h.Pc(6,"translate"),h.Dc(),h.Dc(),h.Dc(),h.Dc()),2&n&&(h.lc(5),h.qd(h.Qc(6,1,"core.lostconnection")))}function CoreLoginReconnectPage_form_18_ng_container_20_Template(n,e){if(1&n){const n=h.Fc();h.Cc(0),h.Ec(1,"div",34),h.pd(2),h.Pc(3,"translate"),h.Dc(),h.Ec(4,"ion-button",35),h.Mc("click",(function CoreLoginReconnectPage_form_18_ng_container_20_Template_ion_button_click_4_listener(){h.fd(n);return h.Oc(2).showInstructionsAndScanQR()})),h.zc(5,"ion-icon",36),h.pd(6),h.Pc(7,"translate"),h.Dc(),h.Bc()}2&n&&(h.lc(2),h.qd(h.Qc(3,2,"core.login.or")),h.lc(4),h.rd(" ",h.Qc(7,4,"core.scanqr")," "))}function CoreLoginReconnectPage_form_18_Template(n,e){if(1&n){const n=h.Fc();h.Ec(0,"form",24,25),h.Mc("ngSubmit",(function CoreLoginReconnectPage_form_18_Template_form_ngSubmit_0_listener(e){h.fd(n);return h.Oc().login(e)})),h.Ec(2,"ion-item",26),h.Ec(3,"ion-label"),h.Ec(4,"p"),h.pd(5),h.Dc(),h.Dc(),h.Dc(),h.Ec(6,"ion-item",27),h.Ec(7,"ion-label",28),h.pd(8),h.Pc(9,"translate"),h.Dc(),h.Ec(10,"core-show-password",29),h.zc(11,"ion-input",30),h.Pc(12,"translate"),h.Dc(),h.Dc(),h.Ec(13,"div",31),h.Ec(14,"ion-button",32),h.Mc("click",(function CoreLoginReconnectPage_form_18_Template_ion_button_click_14_listener(e){h.fd(n);return h.Oc().cancel(e)})),h.pd(15),h.Pc(16,"translate"),h.Dc(),h.Ec(17,"ion-button",33),h.pd(18),h.Pc(19,"translate"),h.Dc(),h.Dc(),h.nd(20,CoreLoginReconnectPage_form_18_ng_container_20_Template,8,6,"ng-container",13),h.Dc()}if(2&n){const n=h.Oc();h.Vc("formGroup",n.credForm),h.lc(5),h.qd(n.username),h.lc(3),h.qd(h.Qc(9,9,"core.login.password")),h.lc(3),h.Wc("placeholder",h.Qc(12,11,"core.login.password")),h.Vc("clearOnEdit",!1),h.lc(4),h.rd(" ",h.Qc(16,13,"core.login.cancel")," "),h.lc(2),h.Vc("disabled",!n.credForm.valid),h.lc(1),h.rd(" ",h.Qc(19,15,"core.login.loginbutton")," "),h.lc(2),h.Vc("ngIf",n.showScanQR)}}function CoreLoginReconnectPage_ion_button_19_Template(n,e){if(1&n){const n=h.Fc();h.Ec(0,"ion-button",37),h.Mc("click",(function CoreLoginReconnectPage_ion_button_19_Template_ion_button_click_0_listener(){h.fd(n);return h.Oc().forgottenPassword()})),h.pd(1),h.Pc(2,"translate"),h.Dc()}2&n&&(h.lc(1),h.rd(" ",h.Qc(2,1,"core.login.forgotten")," "))}function CoreLoginReconnectPage_ion_list_20_ion_button_6_Template(n,e){if(1&n){const n=h.Fc();h.Ec(0,"ion-button",42),h.Mc("click",(function CoreLoginReconnectPage_ion_list_20_ion_button_6_Template_ion_button_click_0_listener(){h.fd(n);const o=e.$implicit;return h.Oc(2).oauthClicked(o)})),h.zc(1,"img",43),h.Ec(2,"ion-label"),h.pd(3),h.Dc(),h.Dc()}if(2&n){const n=e.$implicit;h.mc("aria-label",n.name),h.lc(1),h.Vc("src",n.iconurl,h.id),h.lc(2),h.qd(n.name)}}function CoreLoginReconnectPage_ion_list_20_Template(n,e){if(1&n&&(h.Ec(0,"ion-list",38),h.Ec(1,"ion-item",39),h.Ec(2,"ion-label"),h.Ec(3,"h3",40),h.pd(4),h.Pc(5,"translate"),h.Dc(),h.Dc(),h.Dc(),h.nd(6,CoreLoginReconnectPage_ion_list_20_ion_button_6_Template,4,3,"ion-button",41),h.Dc()),2&n){const n=h.Oc();h.lc(4),h.qd(h.Qc(5,2,"core.login.potentialidps")),h.lc(2),h.Vc("ngForOf",n.identityProviders)}}function CoreLoginReconnectPage_ion_list_21_Template(n,e){if(1&n){const n=h.Fc();h.Ec(0,"ion-list"),h.Ec(1,"ion-button",35),h.Mc("click",(function CoreLoginReconnectPage_ion_list_21_Template_ion_button_click_1_listener(e){h.fd(n);return h.Oc().cancel(e)})),h.pd(2),h.Pc(3,"translate"),h.Dc(),h.Dc()}2&n&&(h.lc(2),h.rd(" ",h.Qc(3,1,"core.login.cancel")," "))}const _c2=function(n){return{"item-avatar-center":n}};let E=(()=>{class CoreLoginReconnectPage{constructor(n){this.fb=n,this.showForgottenPassword=!0,this.showSiteAvatar=!1,this.isOAuth=!1,this.showScanQR=!1,this.viewLeft=!1,this.eventThrown=!1,this.loginSuccessful=!1;const e=g.b.getCurrentSite();this.isLoggedOut=!e||e.isLoggedOut(),this.credForm=n.group({password:["",r.F.required]})}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){try{this.siteId=p.a.getRequiredRouteParam("siteId");const n=p.a.getRouteParam("redirectPath"),e=p.a.getRouteParam("urlToOpen");(n||e)&&(this.redirectData={redirectPath:n,redirectOptions:p.a.getRouteParam("redirectOptions"),urlToOpen:e});const o=yield g.b.getSite(this.siteId);if(!o.infos)throw new m.a("Invalid site");this.username=o.infos.username,this.userFullName=o.infos.fullname,this.userAvatar=o.infos.userpictureurl,this.siteUrl=o.infos.siteurl,this.siteName=o.getSiteName(),this.isOAuth=o.isOAuth(),this.showSiteAvatar=!!this.userAvatar&&!_.a.getFixedSites(),this.checkSiteConfig(o)}catch(n){return l.a.showErrorModal(n),this.cancel()}}))}ngOnDestroy(){this.viewLeft=!0,u.b.trigger(u.b.LOGIN_SITE_UNCHECKED,{config:this.siteConfig,loginSuccessful:this.loginSuccessful},this.siteId)}checkSiteConfig(n){var e;return Object(c.a)(this,void 0,void 0,(function*(){if(this.siteConfig=yield d.a.ignoreErrors(n.getPublicConfig({readingStrategy:3})),!this.siteConfig)return;const o=_.a.getDisabledFeatures(this.siteConfig);this.identityProviders=_.a.getValidIdentityProviders(this.siteConfig,o),this.showForgottenPassword=!_.a.isForgottenPasswordDisabled(this.siteConfig),this.eventThrown||this.viewLeft||(this.eventThrown=!0,u.b.trigger(u.b.LOGIN_SITE_CHECKED,{config:this.siteConfig})),this.showScanQR=_.a.displayQRInSiteScreen()||_.a.displayQRInCredentialsScreen(this.siteConfig.tool_mobile_qrcodetype),yield g.b.checkApplication(this.siteConfig),(null===(e=this.userAvatar)||void 0===e?void 0:e.startsWith(this.siteUrl+"/theme/image.php"))&&(this.showSiteAvatar=!1),this.logoUrl=_.a.getLogoUrl(this.siteConfig)}))}cancel(n){n&&(n.preventDefault(),n.stopPropagation()),this.isLoggedOut&&p.a.navigate("/login/sites",{reset:!0}),g.b.logout()}login(n){return Object(c.a)(this,void 0,void 0,(function*(){n.preventDefault(),n.stopPropagation(),a.a.closeKeyboard();const e=this.credForm.value.password;if(!e)return l.a.showErrorModal("core.login.passwordrequired",!0),void 0;if(!s.a.isOnline())return l.a.showErrorModal("core.networkerrormsg",!0),void 0;const o=yield l.a.showModalLoading();try{const n=yield g.b.getUserToken(this.siteUrl,this.username,e);yield g.b.updateSiteToken(this.siteUrl,this.username,n.token,n.privateToken),f.a.triggerFormSubmittedEvent(this.formElement,!0),yield g.b.updateSiteInfoByUrl(this.siteUrl,this.username),this.credForm.controls.password.reset(),this.loginSuccessful=!0,yield p.a.navigateToSiteHome({params:this.redirectData})}catch(n){_.a.treatUserTokenError(this.siteUrl,n,this.username,e),n.loggedout?this.cancel():"forcepasswordchangenotice"==n.errorcode&&this.credForm.controls.password.reset()}finally{o.dismiss()}}))}forgottenPassword(){_.a.forgottenPasswordClicked(this.siteUrl,this.username,this.siteConfig)}oauthClicked(n){var e;_.a.openBrowserForOAuthLogin(this.siteUrl,n,null===(e=this.siteConfig)||void 0===e?void 0:e.launchurl,this.redirectData)||l.a.showErrorModal("Invalid data.")}showInstructionsAndScanQR(){return Object(c.a)(this,void 0,void 0,(function*(){try{yield _.a.showScanQRInstructions(),yield _.a.scanQR()}catch(n){}}))}keyDown(n){"Escape"==n.key&&(n.preventDefault(),n.stopPropagation())}keyUp(n){"Escape"==n.key&&this.cancel(n)}}return CoreLoginReconnectPage.ɵfac=function CoreLoginReconnectPage_Factory(n){return new(n||CoreLoginReconnectPage)(h.yc(r.f))},CoreLoginReconnectPage.ɵcmp=h.sc({type:CoreLoginReconnectPage,selectors:[["page-core-login-reconnect"]],viewQuery:function CoreLoginReconnectPage_Query(n,e){var o;(1&n&&h.ud(L,!0),2&n)&&(h.dd(o=h.Nc())&&(e.formElement=o.first))},decls:22,vars:18,consts:[["slot","start"],[3,"text"],[1,"ion-padding",3,"keydown","keyup"],[1,"list-item-limited-width"],[1,"ion-text-wrap","ion-text-center","ion-margin-bottom",3,"ngClass"],["class","large-avatar","core-external-content","","onError","this.src='assets/img/user-avatar.png'",3,"src","siteId","alt",4,"ngIf"],["class","core-login-site-logo",4,"ngIf"],["class","ion-padding core-sitename",4,"ngIf"],[1,"core-siteurl"],["class","core-danger-card core-login-reconnect-warning",4,"ngIf"],["class","core-login-form",3,"formGroup","ngSubmit",4,"ngIf"],["expand","block","fill","clear","class","core-login-forgotten-password core-button-as-link ion-text-wrap",3,"click",4,"ngIf"],["class","ion-padding-top core-login-identity-providers",4,"ngIf"],[4,"ngIf"],["core-external-content","","onError","this.src='assets/img/user-avatar.png'",1,"large-avatar",3,"src","siteId","alt"],[1,"core-login-site-logo"],["role","presentation","onError","this.src='assets/img/login_logo.png'","alt","",3,"src",4,"ngIf"],["src","assets/img/login_logo.png","role","presentation","alt","",4,"ngIf"],["role","presentation","onError","this.src='assets/img/login_logo.png'","alt","",3,"src"],["src","assets/img/login_logo.png","role","presentation","alt",""],[1,"ion-padding","core-sitename"],[3,"text","filter"],[1,"core-danger-card","core-login-reconnect-warning"],["name","fas-exclamation-circle","slot","start","aria-hidden","true"],[1,"core-login-form",3,"formGroup","ngSubmit"],["reconnectForm",""],[1,"ion-text-wrap","core-username","item-interactive"],[1,"ion-margin-bottom"],[1,"sr-only"],["name","password"],["name","password","type","password","formControlName","password","autocomplete","current-password","enterkeyhint","go","required","true",1,"core-ioninput-password",3,"placeholder","clearOnEdit"],[1,"adaptable-buttons-row"],["expand","block","fill","outline",1,"ion-margin","ion-text-wrap",3,"click"],["type","submit","expand","block",1,"ion-margin","core-login-login-button","ion-text-wrap",3,"disabled"],[1,"ion-text-center","ion-padding"],["expand","block","fill","outline",1,"ion-margin",3,"click"],["slot","start","name","fas-qrcode","aria-hidden","true"],["expand","block","fill","clear",1,"core-login-forgotten-password","core-button-as-link","ion-text-wrap",3,"click"],[1,"ion-padding-top","core-login-identity-providers"],[1,"ion-text-wrap"],[1,"item-heading"],["fill","outline","class","ion-text-wrap ion-margin core-oauth-provider","expand","block",3,"click",4,"ngFor","ngForOf"],["fill","outline","expand","block",1,"ion-text-wrap","ion-margin","core-oauth-provider",3,"click"],["alt","","width","32","height","32","slot","start",3,"src"]],template:function CoreLoginReconnectPage_Template(n,e){1&n&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-buttons",0),h.zc(3,"ion-back-button",1),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"ion-title"),h.Ec(6,"h1"),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Ec(9,"ion-content",2),h.Mc("keydown",(function CoreLoginReconnectPage_Template_ion_content_keydown_9_listener(n){return e.keyDown(n)}))("keyup",(function CoreLoginReconnectPage_Template_ion_content_keyup_9_listener(n){return e.keyUp(n)})),h.Ec(10,"div",3),h.Ec(11,"div",4),h.nd(12,CoreLoginReconnectPage_img_12_Template,2,8,"img",5),h.nd(13,CoreLoginReconnectPage_div_13_Template,3,2,"div",6),h.nd(14,CoreLoginReconnectPage_p_14_Template,2,2,"p",7),h.Ec(15,"p",8),h.pd(16),h.Dc(),h.nd(17,CoreLoginReconnectPage_ion_card_17_Template,7,3,"ion-card",9),h.Dc(),h.nd(18,CoreLoginReconnectPage_form_18_Template,21,17,"form",10),h.nd(19,CoreLoginReconnectPage_ion_button_19_Template,3,3,"ion-button",11),h.nd(20,CoreLoginReconnectPage_ion_list_20_Template,7,4,"ion-list",12),h.nd(21,CoreLoginReconnectPage_ion_list_21_Template,4,3,"ion-list",13),h.Dc(),h.Dc()),2&n&&(h.lc(3),h.Vc("text",h.Qc(4,12,"core.back")),h.lc(4),h.qd(h.Qc(8,14,"core.login.reconnect")),h.lc(4),h.Vc("ngClass",h.ad(16,_c2,e.showSiteAvatar)),h.lc(1),h.Vc("ngIf",e.showSiteAvatar),h.lc(1),h.Vc("ngIf",!e.showSiteAvatar),h.lc(1),h.Vc("ngIf",e.siteName),h.lc(2),h.qd(e.siteUrl),h.lc(1),h.Vc("ngIf",!e.isLoggedOut),h.lc(1),h.Vc("ngIf",!e.isOAuth),h.lc(1),h.Vc("ngIf",e.showForgottenPassword&&!e.isOAuth),h.lc(1),h.Vc("ngIf",e.identityProviders&&e.identityProviders.length),h.lc(1),h.Vc("ngIf",e.isOAuth))},directives:[P.C,P.Ab,P.m,P.h,P.i,P.yb,C.a,P.v,O.q,O.t,b.a,M.a,P.n,P.I,P.D,v.a,P.O,r.H,r.s,r.k,w.a,P.H,P.Pb,r.r,r.i,r.C,k.a,P.l,P.P,O.s],pipes:[R.d],styles:["[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background:var(--core-login-background);--ion-item-background:var(--core-login-background)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color:var(--core-login-text-color);-webkit-text-decoration-color:var(--core-login-text-color);text-decoration-color:var(--core-login-text-color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item.item-input[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.ios[_ngcontent-%COMP%]{--inner-border-width:0 0 1px 0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background:var(--core-login-input-background);--color:var(--core-login-input-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:unset;-webkit-padding-start:8px;padding-inline-start:8px}}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%] + .core-siteurl[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:0}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:5px auto}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}body.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], body.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background:var(--core-login-background-dark);--loading-text-color:#fff;--loading-spinner:#fff}"]}),CoreLoginReconnectPage})();const y=[{path:"",component:E}];let D=(()=>{class CoreLoginReconnectPageModule{}return CoreLoginReconnectPageModule.ɵmod=h.wc({type:CoreLoginReconnectPageModule}),CoreLoginReconnectPageModule.ɵinj=h.vc({factory:function CoreLoginReconnectPageModule_Factory(n){return new(n||CoreLoginReconnectPageModule)},imports:[[t.m.forChild(y),i.a],t.m]}),CoreLoginReconnectPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&h.kd(D,{declarations:[E],imports:[t.m,i.a],exports:[t.m]}))}}]);