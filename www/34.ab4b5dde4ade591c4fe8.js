(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{eJtl:function(e,t,o){"use strict";o.r(t),o.d(t,"AddonModFeedbackLazyModule",(function(){return z}));var n=o("tyNb"),d=o("L3Fv"),a=o("1IpS"),c=o("ghUQ"),i=o("pHTc"),s=o("hYz8"),r=o("fXoL"),l=o("TEn/"),u=o("4JiN"),m=o("hMzs"),p=o("nt/U"),b=o("sYmb");let h=(()=>{class AddonModFeedbackIndexPage extends c.a{ngOnInit(){super.ngOnInit(),this.selectedTab=i.a.getRouteParam("tab"),this.selectedGroup=i.a.getRouteNumberParam("group")}}return AddonModFeedbackIndexPage.ɵfac=function AddonModFeedbackIndexPage_Factory(e){return g(e||AddonModFeedbackIndexPage)},AddonModFeedbackIndexPage.ɵcmp=r.sc({type:AddonModFeedbackIndexPage,selectors:[["page-addon-mod-feedback-index"]],viewQuery:function AddonModFeedbackIndexPage_Query(e,t){var o;(1&e&&r.ud(s.a,!0),2&e)&&(r.dd(o=r.Nc())&&(t.activityComponent=o.first))},features:[r.ic],decls:14,vars:14,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","group","tab","dataRetrieved"]],template:function AddonModFeedbackIndexPage_Template(e,t){1&e&&(r.Ec(0,"ion-header",0),r.Ec(1,"ion-toolbar"),r.Ec(2,"ion-buttons",1),r.zc(3,"ion-back-button",2),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"ion-title"),r.Ec(6,"h1"),r.zc(7,"core-format-text",3),r.Dc(),r.Dc(),r.zc(8,"ion-buttons",4),r.Dc(),r.Dc(),r.Ec(9,"ion-content",5),r.Ec(10,"ion-refresher",6),r.Mc("ionRefresh",(function AddonModFeedbackIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==t.activityComponent?null:t.activityComponent.doRefresh(e.target)})),r.zc(11,"ion-refresher-content",7),r.Pc(12,"translate"),r.Dc(),r.Ec(13,"addon-mod-feedback-index",8),r.Mc("dataRetrieved",(function AddonModFeedbackIndexPage_Template_addon_mod_feedback_index_dataRetrieved_13_listener(e){return t.updateData(e)})),r.Dc(),r.Dc()),2&e&&(r.lc(3),r.Vc("text",r.Qc(4,10,"core.back")),r.lc(4),r.Vc("text",t.title)("contextInstanceId",null==t.module?null:t.module.id)("courseId",t.courseId),r.lc(3),r.Vc("disabled",null==t.activityComponent?null:t.activityComponent.showLoading),r.lc(1),r.Wc("pullingText",r.Qc(12,12,"core.pulltorefresh")),r.lc(2),r.Vc("module",t.module)("courseId",t.courseId)("group",t.selectedGroup)("tab",t.selectedTab))},directives:[l.C,u.b,l.Ab,l.m,l.h,l.i,l.yb,m.a,p.a,l.v,l.bb,l.cb,s.a],pipes:[b.d],encapsulation:2}),AddonModFeedbackIndexPage})();const g=r.Gc(h);var _=o("mrSG"),f=o("baaQ"),A=o("EoRH"),M=o("FYaz"),k=o("46ml"),v=o("3LXp"),F=o("bFG1"),P=o("jVvP"),y=o("PgjG"),I=o("WPIK"),D=o("ofXK"),E=o("xpMl"),T=o("FeAf"),x=o("uYHD");function AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_p_5_Template(e,t){if(1&e&&(r.Ec(0,"p"),r.pd(1),r.Pc(2,"coreFormatDate"),r.Dc()),2&e){const e=r.Oc().$implicit;r.lc(1),r.qd(r.Qc(2,1,1e3*e.timemodified))}}function AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_Template(e,t){if(1&e){const e=r.Fc();r.Ec(0,"ion-item",10),r.Mc("click",(function AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_Template_ion_item_click_0_listener(){r.fd(e);const o=t.$implicit,n=r.Oc(2);return null==n.attempts?null:n.attempts.select(o)})),r.zc(1,"core-user-avatar",11),r.Ec(2,"ion-label"),r.Ec(3,"p",12),r.pd(4),r.Dc(),r.nd(5,AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_p_5_Template,3,3,"p",7),r.Dc(),r.Dc()}if(2&e){const e=t.$implicit,o=r.Oc(2);r.mc("aria-current",null==o.attempts?null:o.attempts.getItemAriaCurrent(e)),r.lc(1),r.Vc("user",e)("linkProfile",!1),r.lc(3),r.qd(e.fullname),r.lc(1),r.Vc("ngIf",e.timemodified)}}const _c0=function(e){return{$a:e}};function AddonModFeedbackAttemptsPage_ng_container_17_Template(e,t){if(1&e&&(r.Cc(0),r.Ec(1,"ion-item-divider"),r.Ec(2,"ion-label"),r.Ec(3,"h2"),r.pd(4),r.Pc(5,"translate"),r.Dc(),r.Dc(),r.Dc(),r.nd(6,AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_Template,6,5,"ion-item",9),r.Bc()),2&e){const e=r.Oc();r.lc(4),r.qd(r.Rc(5,2,"addon.mod_feedback.non_anonymous_entries",r.ad(5,_c0,e.identifiableAttemptsTotal))),r.lc(2),r.Vc("ngForOf",e.identifiableAttempts)}}function AddonModFeedbackAttemptsPage_ng_container_18_ion_item_6_Template(e,t){if(1&e){const e=r.Fc();r.Ec(0,"ion-item",10),r.Mc("click",(function AddonModFeedbackAttemptsPage_ng_container_18_ion_item_6_Template_ion_item_click_0_listener(){r.fd(e);const o=t.$implicit,n=r.Oc(2);return null==n.attempts?null:n.attempts.select(o)})),r.zc(1,"core-user-avatar",13),r.Ec(2,"ion-label"),r.Ec(3,"p",12),r.pd(4),r.Pc(5,"translate"),r.Dc(),r.Ec(6,"p"),r.pd(7),r.Pc(8,"translate"),r.Dc(),r.Dc(),r.Dc()}if(2&e){const e=t.$implicit,o=r.Oc(2);r.mc("aria-current",null==o.attempts?null:o.attempts.getItemAriaCurrent(e)),r.lc(1),r.Vc("linkProfile",!1),r.lc(3),r.qd(r.Qc(5,5,"addon.mod_feedback.anonymous_user")),r.lc(3),r.sd("",r.Qc(8,7,"addon.mod_feedback.response_nr"),": ",e.number,"")}}function AddonModFeedbackAttemptsPage_ng_container_18_Template(e,t){if(1&e&&(r.Cc(0),r.Ec(1,"ion-item-divider"),r.Ec(2,"ion-label"),r.Ec(3,"h2"),r.pd(4),r.Pc(5,"translate"),r.Dc(),r.Dc(),r.Dc(),r.nd(6,AddonModFeedbackAttemptsPage_ng_container_18_ion_item_6_Template,9,9,"ion-item",9),r.Bc()),2&e){const e=r.Oc();r.lc(4),r.qd(r.Rc(5,2,"addon.mod_feedback.anonymous_entries",r.ad(5,_c0,e.anonymousAttemptsTotal))),r.lc(2),r.Vc("ngForOf",e.anonymousAttempts)}}let C=(()=>{class AddonModFeedbackAttemptsPage{constructor(e){this.route=e,this.fetchFailed=!1,this.promisedAttempts=new M.a}get attempts(){return this.promisedAttempts.value}get groupInfo(){var e;return null===(e=this.attempts)||void 0===e?void 0:e.getSource().groupInfo}get selectedGroup(){var e;return null===(e=this.attempts)||void 0===e?void 0:e.getSource().selectedGroup}set selectedGroup(e){this.attempts&&(this.attempts.getSource().selectedGroup=e,this.attempts.getSource().setDirty(!0))}get identifiableAttempts(){var e,t;return null!==(t=null===(e=this.attempts)||void 0===e?void 0:e.getSource().identifiable)&&void 0!==t?t:[]}get identifiableAttemptsTotal(){var e,t;return null!==(t=null===(e=this.attempts)||void 0===e?void 0:e.getSource().identifiableTotal)&&void 0!==t?t:0}get anonymousAttempts(){var e,t;return null!==(t=null===(e=this.attempts)||void 0===e?void 0:e.getSource().anonymous)&&void 0!==t?t:[]}get anonymousAttemptsTotal(){var e,t;return null!==(t=null===(e=this.attempts)||void 0===e?void 0:e.getSource().anonymousTotal)&&void 0!==t?t:0}ngAfterViewInit(){return Object(_.a)(this,void 0,void 0,(function*(){try{const e=i.a.getRequiredRouteNumberParam("cmId"),t=i.a.getRequiredRouteNumberParam("courseId"),o=f.a.getOrCreateSource(P.a,[t,e]);o.selectedGroup=i.a.getRouteNumberParam("group")||0,this.promisedAttempts.resolve(new attempts_AddonModFeedbackAttemptsManager(o,this.route.component))}catch(e){return v.a.showErrorModal(e),i.a.back(),void 0}const e=yield this.promisedAttempts;try{this.fetchFailed=!1,yield e.getSource().loadFeedback(),yield e.load()}catch(e){this.fetchFailed=!0,v.a.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}yield e.start(this.splitView)}))}ngOnDestroy(){var e;null===(e=this.attempts)||void 0===e?void 0:e.destroy()}fetchMoreAttempts(e){return Object(_.a)(this,void 0,void 0,(function*(){const t=yield this.promisedAttempts;try{this.fetchFailed=!1,yield t.load()}catch(e){this.fetchFailed=!0,v.a.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}finally{e&&e()}}))}refreshFeedback(e){return Object(_.a)(this,void 0,void 0,(function*(){const t=yield this.promisedAttempts;try{this.fetchFailed=!1,yield F.a.ignoreErrors(t.getSource().invalidateCache()),yield t.getSource().loadFeedback(),yield t.reload()}catch(e){this.fetchFailed=!0,v.a.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}finally{e.complete()}}))}reloadAttempts(){return Object(_.a)(this,void 0,void 0,(function*(){const e=yield this.promisedAttempts;yield e.reload()}))}}return AddonModFeedbackAttemptsPage.ɵfac=function AddonModFeedbackAttemptsPage_Factory(e){return new(e||AddonModFeedbackAttemptsPage)(r.yc(n.a))},AddonModFeedbackAttemptsPage.ɵcmp=r.sc({type:AddonModFeedbackAttemptsPage,selectors:[["page-addon-mod-feedback-attempts"]],viewQuery:function AddonModFeedbackAttemptsPage_Query(e,t){var o;(1&e&&r.ud(k.a,!0),2&e)&&(r.dd(o=r.Nc())&&(t.splitView=o.first))},decls:20,vars:17,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"ion-no-margin"],[3,"groupInfo","selected","selectedChange"],[4,"ngIf"],[3,"enabled","error","action"],["class","ion-text-wrap","button","","detail","true",3,"click",4,"ngFor","ngForOf"],["button","","detail","true",1,"ion-text-wrap",3,"click"],["slot","start",3,"user","linkProfile"],[1,"item-heading"],["slot","start",3,"linkProfile"]],template:function AddonModFeedbackAttemptsPage_Template(e,t){1&e&&(r.Ec(0,"ion-header"),r.Ec(1,"ion-toolbar"),r.Ec(2,"ion-buttons",0),r.zc(3,"ion-back-button",1),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"ion-title"),r.Ec(6,"h1"),r.pd(7),r.Pc(8,"translate"),r.Dc(),r.Dc(),r.Dc(),r.Dc(),r.Ec(9,"ion-content"),r.Ec(10,"core-split-view"),r.Ec(11,"ion-refresher",2),r.Mc("ionRefresh",(function AddonModFeedbackAttemptsPage_Template_ion_refresher_ionRefresh_11_listener(e){return t.refreshFeedback(e.target)})),r.zc(12,"ion-refresher-content",3),r.Pc(13,"translate"),r.Dc(),r.Ec(14,"core-loading",4),r.Ec(15,"ion-list",5),r.Ec(16,"core-group-selector",6),r.Mc("selectedChange",(function AddonModFeedbackAttemptsPage_Template_core_group_selector_selectedChange_16_listener(e){return t.selectedGroup=e}))("selectedChange",(function AddonModFeedbackAttemptsPage_Template_core_group_selector_selectedChange_16_listener(){return t.reloadAttempts()})),r.Dc(),r.nd(17,AddonModFeedbackAttemptsPage_ng_container_17_Template,7,7,"ng-container",7),r.nd(18,AddonModFeedbackAttemptsPage_ng_container_18_Template,7,7,"ng-container",7),r.Ec(19,"core-infinite-loading",8),r.Mc("action",(function AddonModFeedbackAttemptsPage_Template_core_infinite_loading_action_19_listener(e){return t.fetchMoreAttempts(e)})),r.Dc(),r.Dc(),r.Dc(),r.Dc(),r.Dc()),2&e&&(r.lc(3),r.Vc("text",r.Qc(4,11,"core.back")),r.lc(4),r.qd(r.Qc(8,13,"addon.mod_feedback.responses")),r.lc(4),r.Vc("disabled",!t.attempts||!t.attempts.loaded),r.lc(1),r.Wc("pullingText",r.Qc(13,15,"core.pulltorefresh")),r.lc(2),r.Vc("hideUntil",t.attempts&&t.attempts.loaded),r.lc(2),r.Vc("groupInfo",t.groupInfo)("selected",t.selectedGroup),r.lc(1),r.Vc("ngIf",t.identifiableAttemptsTotal>0),r.lc(1),r.Vc("ngIf",t.identifiableAttemptsTotal===t.identifiableAttempts.length&&t.anonymousAttemptsTotal>0),r.lc(1),r.Vc("enabled",t.attempts&&t.attempts.loaded&&!t.attempts.completed)("error",t.fetchFailed))},directives:[l.C,l.Ab,l.m,l.h,l.i,l.yb,p.a,l.v,k.a,l.bb,l.cb,y.a,l.P,I.a,D.t,E.a,l.J,l.O,D.s,l.I,T.a],pipes:[b.d,x.a],encapsulation:2}),AddonModFeedbackAttemptsPage})();class attempts_AddonModFeedbackAttemptsManager extends A.a{}var w=o("vY5A"),R=o("Y+03");const O=[{path:":courseId/:cmId",component:h},{path:":courseId/:cmId/form",loadChildren:()=>Promise.all([o.e(0),o.e(57)]).then(o.bind(null,"HFvr")).then((e=>e.AddonModFeedbackFormPageModule))},{path:":courseId/:cmId/nonrespondents",loadChildren:()=>o.e(58).then(o.bind(null,"B1At")).then((e=>e.AddonModFeedbackNonRespondentsPageModule))}],G=[...O,{path:":courseId/:cmId/attempts",component:C},{path:":courseId/:cmId/attempts/:attemptId",loadChildren:()=>o.e(13).then(o.bind(null,"LXV0")).then((e=>e.AddonModFeedbackAttemptPageModule))}],V=[...O,{path:":courseId/:cmId/attempts",component:C,children:[{path:":attemptId",loadChildren:()=>o.e(13).then(o.bind(null,"LXV0")).then((e=>e.AddonModFeedbackAttemptPageModule))}]}],S=[...Object(w.c)(G,(()=>R.a.isMobile)),...Object(w.c)(V,(()=>R.a.isTablet))];let z=(()=>{class AddonModFeedbackLazyModule{}return AddonModFeedbackLazyModule.ɵmod=r.wc({type:AddonModFeedbackLazyModule}),AddonModFeedbackLazyModule.ɵinj=r.vc({factory:function AddonModFeedbackLazyModule_Factory(e){return new(e||AddonModFeedbackLazyModule)},imports:[[n.m.forChild(S),d.a,a.a]]}),AddonModFeedbackLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.kd(z,{declarations:[h,C],imports:[n.m,d.a,a.a]}))},jVvP:function(e,t,o){"use strict";o.d(t,"a",(function(){return AddonModFeedbackAttemptsSource}));var n=o("mrSG"),d=o("CvRw"),a=o("mWdr"),c=o("MNPK"),i=o("96hm");class AddonModFeedbackAttemptsSource extends d.a{constructor(e,t){super(),this.COURSE_ID=e,this.CM_ID=t}getItemPath(e){return e.id.toString()}getPagesLoaded(){if(!this.identifiable||!this.anonymous)return 0;const e=this.getPageLength();return Math.ceil(Math.max(this.anonymous.length,this.identifiable.length)/e)}isIdentifiableAttempt(e){return"fullname"in e}isAnonymousAttempt(e){return"number"in e}invalidateCache(){return Object(n.a)(this,void 0,void 0,(function*(){yield Promise.all([a.a.invalidateActivityGroupInfo(this.CM_ID),this.feedback&&c.a.invalidateResponsesAnalysisData(this.feedback.id)])}))}loadFeedback(){return Object(n.a)(this,void 0,void 0,(function*(){this.feedback=yield c.a.getFeedback(this.COURSE_ID,this.CM_ID),this.groupInfo=yield a.a.getActivityGroupInfo(this.CM_ID),this.selectedGroup=a.a.validateGroupId(this.selectedGroup,this.groupInfo)}))}getPageLength(){return c.b.PER_PAGE}loadPageItems(e){return Object(n.a)(this,void 0,void 0,(function*(){if(!this.feedback)throw new Error("Can't load attempts without feeback");const t=yield i.a.getResponsesAnalysis(this.feedback.id,{page:e,groupId:this.selectedGroup,cmId:this.CM_ID});0===e&&(this.identifiableTotal=t.totalattempts,this.anonymousTotal=t.totalanonattempts);const o=this.getPageLength()*(e+1);return{items:[...0===e||t.totalattempts>c.b.PER_PAGE?t.attempts:[],...0===e||t.totalanonattempts>c.b.PER_PAGE?t.anonattempts:[]],hasMoreItems:t.totalattempts>o||t.totalanonattempts>o}}))}setItems(e,t){this.identifiable=e.filter(this.isIdentifiableAttempt),this.anonymous=e.filter(this.isAnonymousAttempt),super.setItems(this.identifiable.concat(this.anonymous),t)}}}}]);