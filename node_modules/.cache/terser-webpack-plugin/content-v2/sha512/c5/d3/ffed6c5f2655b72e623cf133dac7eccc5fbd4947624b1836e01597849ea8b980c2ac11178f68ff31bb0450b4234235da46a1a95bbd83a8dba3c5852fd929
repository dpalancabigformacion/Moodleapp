{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{IODR:function(e,t,n){\"use strict\";n.r(t),n.d(t,\"AddonModChatLazyModule\",(function(){return te}));var o=n(\"tyNb\"),s=n(\"L3Fv\"),a=n(\"ef6k\"),i=n(\"ghUQ\"),c=n(\"e1dt\"),d=n(\"fXoL\"),r=n(\"TEn/\"),l=n(\"4JiN\"),g=n(\"hMzs\"),_=n(\"nt/U\"),h=n(\"sYmb\");let m=(()=>{class AddonModChatIndexPage extends i.a{}return AddonModChatIndexPage.ɵfac=function AddonModChatIndexPage_Factory(e){return u(e||AddonModChatIndexPage)},AddonModChatIndexPage.ɵcmp=d.sc({type:AddonModChatIndexPage,selectors:[[\"page-addon-mod-chat-index\"]],viewQuery:function AddonModChatIndexPage_Query(e,t){var n;(1&e&&d.ud(c.a,!0),2&e)&&(d.dd(n=d.Nc())&&(t.activityComponent=n.first))},features:[d.ic],decls:14,vars:12,consts:[[\"collapsible\",\"\"],[\"slot\",\"start\"],[3,\"text\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\"],[\"slot\",\"end\"],[1,\"limited-width\"],[\"slot\",\"fixed\",3,\"disabled\",\"ionRefresh\"],[3,\"pullingText\"],[3,\"module\",\"courseId\",\"dataRetrieved\"]],template:function AddonModChatIndexPage_Template(e,t){1&e&&(d.Ec(0,\"ion-header\",0),d.Ec(1,\"ion-toolbar\"),d.Ec(2,\"ion-buttons\",1),d.zc(3,\"ion-back-button\",2),d.Pc(4,\"translate\"),d.Dc(),d.Ec(5,\"ion-title\"),d.Ec(6,\"h1\"),d.zc(7,\"core-format-text\",3),d.Dc(),d.Dc(),d.zc(8,\"ion-buttons\",4),d.Dc(),d.Dc(),d.Ec(9,\"ion-content\",5),d.Ec(10,\"ion-refresher\",6),d.Mc(\"ionRefresh\",(function AddonModChatIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==t.activityComponent?null:t.activityComponent.doRefresh(e.target)})),d.zc(11,\"ion-refresher-content\",7),d.Pc(12,\"translate\"),d.Dc(),d.Ec(13,\"addon-mod-chat-index\",8),d.Mc(\"dataRetrieved\",(function AddonModChatIndexPage_Template_addon_mod_chat_index_dataRetrieved_13_listener(e){return t.updateData(e)})),d.Dc(),d.Dc()),2&e&&(d.lc(3),d.Vc(\"text\",d.Qc(4,8,\"core.back\")),d.lc(4),d.Vc(\"text\",t.title)(\"contextInstanceId\",null==t.module?null:t.module.id)(\"courseId\",t.courseId),d.lc(3),d.Vc(\"disabled\",null==t.activityComponent?null:t.activityComponent.showLoading),d.lc(1),d.Wc(\"pullingText\",d.Qc(12,10,\"core.pulltorefresh\")),d.lc(2),d.Vc(\"module\",t.module)(\"courseId\",t.courseId))},directives:[r.C,l.b,r.Ab,r.m,r.h,r.i,r.yb,g.a,_.a,r.v,r.bb,r.cb,c.a],pipes:[h.d],encapsulation:2}),AddonModChatIndexPage})();const u=d.Gc(m);var p=n(\"mrSG\"),f=n(\"O4u7\"),b=n(\"nvXB\"),M=n(\"GGba\"),C=n(\"pHTc\"),I=n(\"9+EE\"),P=n(\"3LXp\"),v=n(\"bFG1\"),A=n(\"j3ag\"),D=n(\"fjkH\"),y=n(\"5E3q\"),x=n(\"g4DX\"),E=n(\"btSF\"),O=n(\"ofXK\"),T=n(\"PgjG\"),S=n(\"ACYt\"),w=n(\"3CSS\"),R=n(\"9pYf\"),V=n(\"r8G5\"),k=n(\"uYHD\");function AddonModChatChatPage_ion_button_9_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,\"ion-button\",14),d.Mc(\"click\",(function AddonModChatChatPage_ion_button_9_Template_ion_button_click_0_listener(){d.fd(e);return d.Oc().showChatUsers()})),d.Pc(1,\"translate\"),d.zc(2,\"ion-icon\",15),d.Dc()}2&e&&d.mc(\"aria-label\",d.Qc(1,1,\"core.users\"))}function AddonModChatChatPage_ng_container_13_p_1_Template(e,t){if(1&e&&(d.Ec(0,\"p\",19),d.pd(1),d.Pc(2,\"coreFormatDate\"),d.Dc()),2&e){const e=d.Oc().$implicit;d.lc(1),d.rd(\" \",d.Rc(2,1,1e3*e.timestamp,\"strftimedayshort\"),\" \")}}const _c0=function(e){return{$a:e}};function AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",26),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",27),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messageenter\",d.ad(8,_c0,e.userfullname)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",28),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",29),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messageexit\",d.ad(8,_c0,e.userfullname)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",30),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",31),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messagebeepseveryone\",d.ad(8,_c0,e.userfullname)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",30),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",31),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messagebeepsyou\",d.ad(8,_c0,e.userfullname)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",32),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",31),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messageyoubeep\",d.ad(8,_c0,e.beepWho)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,\"ion-badge\",33),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",34),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Ec(5,\"strong\"),d.pd(6),d.Ec(7,\"core-format-text\",35),d.Mc(\"afterRender\",(function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template_core_format_text_afterRender_7_listener(){d.fd(e);const t=d.Oc(2).last,n=d.Oc();return t&&n.scrollToBottom()})),d.Dc(),d.Dc(),d.Dc(),d.Dc()}if(2&e){const e=d.Oc(2).$implicit,t=d.Oc();d.lc(3),d.rd(\" \",d.Rc(4,5,1e3*e.timestamp,\"strftimetime\"),\" \"),d.lc(3),d.rd(\" \",e.userfullname,\" \"),d.lc(1),d.Vc(\"text\",e.message)(\"contextInstanceId\",t.cmId)(\"courseId\",t.courseId)}}function AddonModChatChatPage_ng_container_13_div_2_Template(e,t){if(1&e&&(d.Ec(0,\"div\",20),d.nd(1,AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template,6,10,\"ion-badge\",21),d.nd(2,AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template,6,10,\"ion-badge\",22),d.nd(3,AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template,6,10,\"ion-badge\",23),d.nd(4,AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template,6,10,\"ion-badge\",23),d.nd(5,AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template,6,10,\"ion-badge\",24),d.nd(6,AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template,8,8,\"ion-badge\",25),d.Dc()),2&e){const e=d.Oc().$implicit,t=d.Oc();d.lc(1),d.Vc(\"ngIf\",e.system&&\"enter\"==e.message),d.lc(1),d.Vc(\"ngIf\",e.system&&\"exit\"==e.message),d.lc(1),d.Vc(\"ngIf\",\"all\"==e.beep),d.lc(1),d.Vc(\"ngIf\",e.userid!=t.currentUserId&&e.beep==t.currentUserId),d.lc(1),d.Vc(\"ngIf\",e.userid==t.currentUserId&&e.beep&&\"all\"!=e.beep),d.lc(1),d.Vc(\"ngIf\",!e.system&&!e.beep)}}function AddonModChatChatPage_ng_container_13_core_message_3_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,\"core-message\",36),d.Mc(\"afterRender\",(function AddonModChatChatPage_ng_container_13_core_message_3_Template_core_message_afterRender_0_listener(){d.fd(e);const t=d.Oc().last,n=d.Oc();return t&&n.scrollToBottom()})),d.Dc()}if(2&e){const e=d.Oc().$implicit,t=d.Oc();d.Vc(\"message\",e)(\"user\",e)(\"text\",e.message)(\"time\",1e3*e.timestamp)(\"instanceId\",t.cmId)(\"courseId\",t.courseId)}}function AddonModChatChatPage_ng_container_13_Template(e,t){if(1&e&&(d.Cc(0),d.nd(1,AddonModChatChatPage_ng_container_13_p_1_Template,3,4,\"p\",16),d.nd(2,AddonModChatChatPage_ng_container_13_div_2_Template,7,6,\"div\",17),d.nd(3,AddonModChatChatPage_ng_container_13_core_message_3_Template,1,6,\"core-message\",18),d.Bc()),2&e){const e=t.$implicit;d.lc(1),d.Vc(\"ngIf\",e.showDate),d.lc(1),d.Vc(\"ngIf\",e.special),d.lc(1),d.Vc(\"ngIf\",!e.special)}}function AddonModChatChatPage_core_empty_box_14_Template(e,t){1&e&&(d.zc(0,\"core-empty-box\",37),d.Pc(1,\"translate\")),2&e&&d.Vc(\"message\",d.Qc(1,1,\"addon.mod_chat.nomessages\"))}function AddonModChatChatPage_p_17_Template(e,t){1&e&&(d.Ec(0,\"p\",38),d.pd(1),d.Pc(2,\"translate\"),d.Dc()),2&e&&(d.lc(1),d.rd(\" \",d.Qc(2,1,\"addon.mod_chat.mustbeonlinetosendmessages\"),\" \"))}function AddonModChatChatPage_core_send_message_form_18_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,\"core-send-message-form\",39),d.Mc(\"onSubmit\",(function AddonModChatChatPage_core_send_message_form_18_Template_core_send_message_form_onSubmit_0_listener(t){d.fd(e);return d.Oc().sendMessage(t)})),d.Pc(1,\"translate\"),d.Dc()}if(2&e){const e=d.Oc();d.Vc(\"sendDisabled\",e.sending)(\"message\",e.newMessage)(\"placeholder\",d.Qc(1,3,\"addon.messages.newmessage\"))}}function AddonModChatChatPage_ion_button_19_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,\"ion-button\",40),d.Mc(\"click\",(function AddonModChatChatPage_ion_button_19_Template_ion_button_click_0_listener(){d.fd(e);return d.Oc().reconnect()})),d.pd(1),d.Pc(2,\"translate\"),d.Dc()}2&e&&(d.lc(1),d.rd(\" \",d.Qc(2,1,\"core.login.reconnect\"),\" \"))}let F=(()=>{class AddonModChatChatPage{constructor(){this.loaded=!1,this.title=\"\",this.messages=[],this.sending=!1,this.lastTime=0,this.oldContentHeight=0,this.viewDestroyed=!1,this.pollingRunning=!1,this.users=[],this.currentUserId=I.b.getCurrentSiteUserId(),this.isOnline=M.a.isOnline(),this.onlineSubscription=M.a.onChange().subscribe((()=>{A.A.run((()=>{this.isOnline=M.a.isOnline()}))}))}ngOnInit(){return Object(p.a)(this,void 0,void 0,(function*(){try{this.courseId=C.a.getRequiredRouteNumberParam(\"courseId\"),this.cmId=C.a.getRequiredRouteNumberParam(\"cmId\"),this.chatId=C.a.getRequiredRouteNumberParam(\"chatId\"),this.title=C.a.getRouteParam(\"title\")||\"\",yield this.loginUser(),yield this.fetchMessages(),this.startPolling()}catch(e){P.a.showErrorModalDefault(e,\"addon.mod_chat.errorwhileconnecting\",!0),C.a.back()}finally{this.loaded=!0}}))}ionViewDidEnter(){this.startPolling()}ionViewWillLeave(){D.b.trigger(D.b.ACTIVITY_DATA_SENT,{module:\"chat\"}),this.stopPolling()}loginUser(){return Object(p.a)(this,void 0,void 0,(function*(){this.sessionId=yield x.a.loginUser(this.chatId)}))}fetchMessages(){return Object(p.a)(this,void 0,void 0,(function*(){const e=yield x.a.getLatestMessages(this.sessionId,this.lastTime);this.lastTime=e.chatnewlasttime||0;const t=yield x.a.getMessagesUserData(e.messages,this.courseId);if(!t.length)return;const n=this.messages.length;this.messages=this.messages.concat(t);for(let e=n;e<this.messages.length;e++){this.messages[e]=E.a.formatMessage(this.currentUserId,this.messages[e],e>0?this.messages[e-1]:void 0);const t=this.messages[e];t.beep&&t.beep!=String(this.currentUserId)&&this.loadMessageBeepWho(t)}this.messages[this.messages.length-1].showTail=!0,this.scrollToBottom()}))}loadMessageBeepWho(e){return Object(p.a)(this,void 0,void 0,(function*(){e.beepWho=yield this.getUserFullname(e.beep)}))}showChatUsers(){var e;return Object(p.a)(this,void 0,void 0,(function*(){const t=yield P.a.openSideModal({component:y.a,componentProps:{sessionId:this.sessionId,cmId:this.cmId}});t&&(t.talkTo&&(this.newMessage=`To ${t.talkTo}: `+((null===(e=this.sendMessageForm)||void 0===e?void 0:e.message)||\"\")),t.beepTo&&this.sendMessage(\"\",t.beepTo),this.users=t.users)}))}getUserFullname(e){return Object(p.a)(this,void 0,void 0,(function*(){const t=parseInt(e,10);if(isNaN(t))return e;const n=this.users.find((e=>e.id==t));if(n)return n.fullname;try{const n=yield x.a.getChatUsers(this.sessionId,{cmId:this.cmId});this.users=n.users;const o=this.users.find((e=>e.id==t));return o?o.fullname:e}catch(t){return e}}))}startPolling(){this.polling||(this.polling=window.setInterval((()=>{v.a.ignoreErrors(this.fetchMessagesInterval())}),x.b.POLL_INTERVAL))}stopPolling(){clearInterval(this.polling),this.polling=void 0}fetchMessagesInterval(){return Object(p.a)(this,void 0,void 0,(function*(){if(this.isOnline&&!this.pollingRunning){this.pollingRunning=!0;try{yield this.fetchMessages()}catch(e){try{yield this.loginUser(),yield this.fetchMessages()}catch(e){throw this.stopPolling(),P.a.showErrorModalDefault(e,\"addon.mod_chat.errorwhileretrievingmessages\",!0),e}}finally{this.pollingRunning=!1}}}))}sendMessage(e,t=0){return Object(p.a)(this,void 0,void 0,(function*(){if(this.isOnline&&(0!==t||e.trim())){this.sending=!0;try{yield x.a.sendMessage(this.sessionId,e,t),v.a.ignoreErrors(this.fetchMessagesInterval())}catch(t){b.a.closeKeyboard(),this.newMessage=e,P.a.showErrorModalDefault(t,\"addon.mod_chat.errorwhilesendingmessage\",!0)}finally{this.sending=!1}}}))}reconnect(){return Object(p.a)(this,void 0,void 0,(function*(){const e=yield P.a.showModalLoading();try{yield this.fetchMessagesInterval(),this.startPolling()}catch(e){}finally{e.dismiss()}}))}scrollToBottom(){var e;return Object(p.a)(this,void 0,void 0,(function*(){yield v.a.nextTick(),this.viewDestroyed||null===(e=this.content)||void 0===e||e.scrollToBottom()}))}canLeave(){return Object(p.a)(this,void 0,void 0,(function*(){return!this.messages.some((e=>!e.special))||(yield P.a.showConfirm(A.J.instant(\"addon.mod_chat.confirmloss\")),!0)}))}ngOnDestroy(){this.onlineSubscription&&this.onlineSubscription.unsubscribe(),this.stopPolling(),this.viewDestroyed=!0}}return AddonModChatChatPage.ɵfac=function AddonModChatChatPage_Factory(e){return new(e||AddonModChatChatPage)},AddonModChatChatPage.ɵcmp=d.sc({type:AddonModChatChatPage,selectors:[[\"page-addon-mod-chat-chat\"]],viewQuery:function AddonModChatChatPage_Query(e,t){var n;(1&e&&(d.ud(r.v,!0),d.ud(f.a,!0)),2&e)&&(d.dd(n=d.Nc())&&(t.content=n.first),d.dd(n=d.Nc())&&(t.sendMessageForm=n.first))},decls:20,vars:14,consts:[[\"slot\",\"start\"],[3,\"text\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\"],[\"slot\",\"end\"],[\"fill\",\"clear\",3,\"click\",4,\"ngIf\"],[3,\"hideUntil\"],[\"aria-live\",\"polite\",1,\"addon-messages-discussion-container\"],[4,\"ngFor\",\"ngForOf\"],[\"icon\",\"far-comments\",3,\"message\",4,\"ngIf\"],[1,\"footer-adjustable\"],[3,\"color\"],[\"class\",\"ion-text-center\",4,\"ngIf\"],[3,\"sendDisabled\",\"message\",\"placeholder\",\"onSubmit\",4,\"ngIf\"],[\"expand\",\"block\",\"fill\",\"outline\",3,\"click\",4,\"ngIf\"],[\"fill\",\"clear\",3,\"click\"],[\"name\",\"fas-users\",\"slot\",\"icon-only\",\"aria-hidden\",\"true\"],[\"class\",\"ion-text-center addon-messages-date\",4,\"ngIf\"],[\"class\",\"ion-text-center addon-mod_chat-notice\",4,\"ngIf\"],[\"contextLevel\",\"module\",3,\"message\",\"user\",\"text\",\"time\",\"instanceId\",\"courseId\",\"afterRender\",4,\"ngIf\"],[1,\"ion-text-center\",\"addon-messages-date\"],[1,\"ion-text-center\",\"addon-mod_chat-notice\"],[\"class\",\"ion-text-wrap\",\"color\",\"success\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"danger\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"primary\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"light\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"info\",4,\"ngIf\"],[\"color\",\"success\",1,\"ion-text-wrap\"],[\"name\",\"fas-sign-in-alt\",\"aria-hidden\",\"true\"],[\"color\",\"danger\",1,\"ion-text-wrap\"],[\"name\",\"fas-sign-out-alt\",\"aria-hidden\",\"true\"],[\"color\",\"primary\",1,\"ion-text-wrap\"],[\"name\",\"fas-bell\",\"aria-hidden\",\"true\"],[\"color\",\"light\",1,\"ion-text-wrap\"],[\"color\",\"info\",1,\"ion-text-wrap\"],[\"name\",\"fas-asterisk\",\"aria-hidden\",\"true\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\",\"afterRender\"],[\"contextLevel\",\"module\",3,\"message\",\"user\",\"text\",\"time\",\"instanceId\",\"courseId\",\"afterRender\"],[\"icon\",\"far-comments\",3,\"message\"],[1,\"ion-text-center\"],[3,\"sendDisabled\",\"message\",\"placeholder\",\"onSubmit\"],[\"expand\",\"block\",\"fill\",\"outline\",3,\"click\"]],template:function AddonModChatChatPage_Template(e,t){1&e&&(d.Ec(0,\"ion-header\"),d.Ec(1,\"ion-toolbar\"),d.Ec(2,\"ion-buttons\",0),d.zc(3,\"ion-back-button\",1),d.Pc(4,\"translate\"),d.Dc(),d.Ec(5,\"ion-title\"),d.Ec(6,\"h1\"),d.zc(7,\"core-format-text\",2),d.Dc(),d.Dc(),d.Ec(8,\"ion-buttons\",3),d.nd(9,AddonModChatChatPage_ion_button_9_Template,3,3,\"ion-button\",4),d.Dc(),d.Dc(),d.Dc(),d.Ec(10,\"ion-content\"),d.Ec(11,\"core-loading\",5),d.Ec(12,\"ion-list\",6),d.nd(13,AddonModChatChatPage_ng_container_13_Template,4,3,\"ng-container\",7),d.Dc(),d.nd(14,AddonModChatChatPage_core_empty_box_14_Template,2,3,\"core-empty-box\",8),d.Dc(),d.Dc(),d.Ec(15,\"ion-footer\",9),d.Ec(16,\"ion-toolbar\",10),d.nd(17,AddonModChatChatPage_p_17_Template,3,3,\"p\",11),d.nd(18,AddonModChatChatPage_core_send_message_form_18_Template,2,5,\"core-send-message-form\",12),d.nd(19,AddonModChatChatPage_ion_button_19_Template,3,3,\"ion-button\",13),d.Dc(),d.Dc()),2&e&&(d.lc(3),d.Vc(\"text\",d.Qc(4,12,\"core.back\")),d.lc(4),d.Vc(\"text\",t.title)(\"contextInstanceId\",t.cmId)(\"courseId\",t.courseId),d.lc(2),d.Vc(\"ngIf\",t.loaded),d.lc(2),d.Vc(\"hideUntil\",t.loaded),d.lc(2),d.Vc(\"ngForOf\",t.messages),d.lc(1),d.Vc(\"ngIf\",!t.messages||t.messages.length<=0),d.lc(2),d.Vc(\"color\",t.isOnline&&t.polling&&t.loaded?\"contrast\":\"light\"),d.lc(1),d.Vc(\"ngIf\",!t.isOnline),d.lc(1),d.Vc(\"ngIf\",t.isOnline&&t.polling&&t.loaded),d.lc(1),d.Vc(\"ngIf\",t.isOnline&&!t.polling&&t.loaded))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,g.a,O.t,_.a,r.v,T.a,r.P,O.s,r.A,S.a,r.l,r.D,w.a,r.k,R.a,V.a,f.a],pipes:[h.d,k.a],styles:[\".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}\"]}),AddonModChatChatPage})();var U=n(\"4pns\");function AddonModChatSessionMessagesPage_ng_container_15_div_1_Template(e,t){if(1&e&&(d.Ec(0,\"div\",10),d.pd(1),d.Pc(2,\"coreFormatDate\"),d.Dc()),2&e){const e=d.Oc().$implicit;d.lc(1),d.rd(\" \",d.Rc(2,1,1e3*e.timestamp,\"strftimedayshort\"),\" \")}}const session_messages_c0=function(e){return{$a:e}};function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",17),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",18),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messageenter\",d.ad(8,session_messages_c0,e.userfullname)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",19),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",20),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messageexit\",d.ad(8,session_messages_c0,e.userfullname)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",21),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",22),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messagebeepseveryone\",d.ad(8,session_messages_c0,e.userfullname)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",21),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",22),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messagebeepsyou\",d.ad(8,session_messages_c0,e.userfullname)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",23),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",22),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Pc(5,\"translate\"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(\" \",d.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",d.Rc(5,5,\"addon.mod_chat.messageyoubeep\",d.ad(8,session_messages_c0,e.beepWho)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template(e,t){if(1&e&&(d.Ec(0,\"ion-badge\",24),d.Ec(1,\"span\"),d.zc(2,\"ion-icon\",25),d.pd(3),d.Pc(4,\"coreFormatDate\"),d.Ec(5,\"strong\"),d.pd(6),d.zc(7,\"core-format-text\",26),d.Dc(),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit,t=d.Oc();d.lc(3),d.rd(\" \",d.Rc(4,5,1e3*e.timestamp,\"strftimetime\"),\" \"),d.lc(3),d.rd(\" \",e.userfullname,\" \"),d.lc(1),d.Vc(\"text\",e.message)(\"contextInstanceId\",t.cmId)(\"courseId\",t.courseId)}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_Template(e,t){if(1&e&&(d.Ec(0,\"div\",11),d.nd(1,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template,6,10,\"ion-badge\",12),d.nd(2,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template,6,10,\"ion-badge\",13),d.nd(3,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template,6,10,\"ion-badge\",14),d.nd(4,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template,6,10,\"ion-badge\",14),d.nd(5,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template,6,10,\"ion-badge\",15),d.nd(6,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template,8,8,\"ion-badge\",16),d.Dc()),2&e){const e=d.Oc().$implicit,t=d.Oc();d.lc(1),d.Vc(\"ngIf\",e.issystem&&\"enter\"==e.message),d.lc(1),d.Vc(\"ngIf\",e.issystem&&\"exit\"==e.message),d.lc(1),d.Vc(\"ngIf\",\"all\"==e.beep),d.lc(1),d.Vc(\"ngIf\",e.userid!=t.currentUserId&&e.beep==t.currentUserId),d.lc(1),d.Vc(\"ngIf\",e.userid==t.currentUserId&&e.beep&&\"all\"!=e.beep),d.lc(1),d.Vc(\"ngIf\",!e.issystem&&!e.beep)}}function AddonModChatSessionMessagesPage_ng_container_15_core_message_3_Template(e,t){if(1&e&&d.zc(0,\"core-message\",27),2&e){const e=d.Oc().$implicit,t=d.Oc();d.Vc(\"message\",e)(\"user\",e)(\"text\",e.message)(\"time\",1e3*e.timestamp)(\"instanceId\",t.cmId)(\"courseId\",t.courseId)}}function AddonModChatSessionMessagesPage_ng_container_15_Template(e,t){if(1&e&&(d.Cc(0),d.nd(1,AddonModChatSessionMessagesPage_ng_container_15_div_1_Template,3,4,\"div\",7),d.nd(2,AddonModChatSessionMessagesPage_ng_container_15_div_2_Template,7,6,\"div\",8),d.nd(3,AddonModChatSessionMessagesPage_ng_container_15_core_message_3_Template,1,6,\"core-message\",9),d.Bc()),2&e){const e=t.$implicit;d.lc(1),d.Vc(\"ngIf\",e.showDate),d.lc(1),d.Vc(\"ngIf\",e.special),d.lc(1),d.Vc(\"ngIf\",!e.special)}}let z=(()=>{class AddonModChatSessionMessagesPage{constructor(){this.messages=[],this.loaded=!1}ngOnInit(){try{this.courseId=C.a.getRequiredRouteNumberParam(\"courseId\"),this.cmId=C.a.getRequiredRouteNumberParam(\"cmId\"),this.sessionStart=C.a.getRequiredRouteNumberParam(\"sessionStart\"),this.sessionEnd=C.a.getRequiredRouteNumberParam(\"sessionEnd\"),this.chatId=C.a.getRequiredRouteNumberParam(\"chatId\"),this.groupId=C.a.getRouteNumberParam(\"groupId\")||0}catch(e){return P.a.showErrorModal(e),C.a.back(),void 0}this.currentUserId=I.b.getCurrentSiteUserId(),this.fetchMessages()}fetchMessages(){return Object(p.a)(this,void 0,void 0,(function*(){try{const e=yield x.a.getSessionMessages(this.chatId,this.sessionStart,this.sessionEnd,this.groupId,{cmId:this.cmId});this.messages=yield x.a.getMessagesUserData(e,this.courseId);for(let e=0;e<this.messages.length;e++){this.messages[e]=E.a.formatMessage(this.currentUserId,this.messages[e],e>0?this.messages[e-1]:void 0);const t=this.messages[e];t.beep&&t.beep!=String(this.currentUserId)&&this.loadMessageBeepWho(t)}this.messages[this.messages.length-1].showTail=!0}catch(e){P.a.showErrorModalDefault(e,\"core.errorloadingcontent\",!0)}finally{this.loaded=!0}}))}loadMessageBeepWho(e){return Object(p.a)(this,void 0,void 0,(function*(){e.beepWho=yield this.getUserFullname(e.beep)}))}getUserFullname(e){return Object(p.a)(this,void 0,void 0,(function*(){const t=parseInt(e,10);if(isNaN(t))return e;try{return(yield U.a.getProfile(t,this.courseId,!0)).fullname}catch(t){return e}}))}refreshMessages(e){return Object(p.a)(this,void 0,void 0,(function*(){try{yield v.a.ignoreErrors(x.a.invalidateSessionMessages(this.chatId,this.sessionStart,this.groupId)),yield this.fetchMessages()}finally{e.complete()}}))}}return AddonModChatSessionMessagesPage.ɵfac=function AddonModChatSessionMessagesPage_Factory(e){return new(e||AddonModChatSessionMessagesPage)},AddonModChatSessionMessagesPage.ɵcmp=d.sc({type:AddonModChatSessionMessagesPage,selectors:[[\"page-addon-mod-chat-session-messages\"]],decls:16,vars:12,consts:[[\"slot\",\"start\"],[3,\"text\"],[\"slot\",\"fixed\",3,\"disabled\",\"ionRefresh\"],[3,\"pullingText\"],[3,\"hideUntil\"],[1,\"addon-messages-discussion-container\"],[4,\"ngFor\",\"ngForOf\"],[\"class\",\"ion-text-center addon-messages-date\",4,\"ngIf\"],[\"class\",\"ion-text-center addon-mod_chat-notice\",4,\"ngIf\"],[\"contextLevel\",\"module\",3,\"message\",\"user\",\"text\",\"time\",\"instanceId\",\"courseId\",4,\"ngIf\"],[1,\"ion-text-center\",\"addon-messages-date\"],[1,\"ion-text-center\",\"addon-mod_chat-notice\"],[\"class\",\"ion-text-wrap\",\"color\",\"success\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"danger\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"primary\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"light\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"info\",4,\"ngIf\"],[\"color\",\"success\",1,\"ion-text-wrap\"],[\"name\",\"fas-sign-in-alt\",\"aria-hidden\",\"true\"],[\"color\",\"danger\",1,\"ion-text-wrap\"],[\"name\",\"fas-sign-out-alt\",\"aria-hidden\",\"true\"],[\"color\",\"primary\",1,\"ion-text-wrap\"],[\"name\",\"fas-bell\",\"aria-hidden\",\"true\"],[\"color\",\"light\",1,\"ion-text-wrap\"],[\"color\",\"info\",1,\"ion-text-wrap\"],[\"name\",\"fas-asterisk\",\"aria-hidden\",\"true\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\"],[\"contextLevel\",\"module\",3,\"message\",\"user\",\"text\",\"time\",\"instanceId\",\"courseId\"]],template:function AddonModChatSessionMessagesPage_Template(e,t){1&e&&(d.Ec(0,\"ion-header\"),d.Ec(1,\"ion-toolbar\"),d.Ec(2,\"ion-buttons\",0),d.zc(3,\"ion-back-button\",1),d.Pc(4,\"translate\"),d.Dc(),d.Ec(5,\"ion-title\"),d.Ec(6,\"h1\"),d.pd(7),d.Pc(8,\"translate\"),d.Dc(),d.Dc(),d.Dc(),d.Dc(),d.Ec(9,\"ion-content\"),d.Ec(10,\"ion-refresher\",2),d.Mc(\"ionRefresh\",(function AddonModChatSessionMessagesPage_Template_ion_refresher_ionRefresh_10_listener(e){return t.refreshMessages(e.target)})),d.zc(11,\"ion-refresher-content\",3),d.Pc(12,\"translate\"),d.Dc(),d.Ec(13,\"core-loading\",4),d.Ec(14,\"ion-list\",5),d.nd(15,AddonModChatSessionMessagesPage_ng_container_15_Template,4,3,\"ng-container\",6),d.Dc(),d.Dc(),d.Dc()),2&e&&(d.lc(3),d.Vc(\"text\",d.Qc(4,6,\"core.back\")),d.lc(4),d.qd(d.Qc(8,8,\"addon.mod_chat.messages\")),d.lc(3),d.Vc(\"disabled\",!t.loaded),d.lc(1),d.Wc(\"pullingText\",d.Qc(12,10,\"core.pulltorefresh\")),d.lc(2),d.Vc(\"hideUntil\",t.loaded),d.lc(2),d.Vc(\"ngForOf\",t.messages))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,_.a,r.v,r.bb,r.cb,T.a,r.P,O.s,O.t,r.k,r.D,w.a,g.a,R.a],pipes:[h.d,k.a],styles:[\".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}\"]}),AddonModChatSessionMessagesPage})();var $=n(\"Y+03\"),j=n(\"vY5A\"),L=n(\"EoRH\"),Q=n(\"baaQ\"),N=n(\"46ml\"),q=n(\"CvRw\"),W=n(\"mWdr\");class chat_sessions_source_AddonModChatSessionsSource extends q.a{constructor(e,t,n){super(),this.showAll=!1,this.groupId=0,this.COURSE_ID=e,this.CHAT_ID=t,this.CM_ID=n}invalidateCache(){return Object(p.a)(this,void 0,void 0,(function*(){yield v.a.ignoreErrors(v.a.allPromises([W.a.invalidateActivityGroupInfo(this.CM_ID),x.a.invalidateSessions(this.CHAT_ID,this.groupId,this.showAll)]))}))}loadPageItems(){return Object(p.a)(this,void 0,void 0,(function*(){this.groupInfo=yield W.a.getActivityGroupInfo(this.CM_ID,!1),this.groupId=W.a.validateGroupId(this.groupId,this.groupInfo);const e=yield x.a.getSessions(this.CHAT_ID,this.groupId,this.showAll,{cmId:this.CM_ID}),t=[],n=e.map((e=>(e.duration=e.sessionend-e.sessionstart,e.sessionusers.forEach((e=>{t.push(this.loadUserFullname(e))})),e.allsessionusers=e.sessionusers,e.sessionusers.length>4&&(e.sessionusers=e.allsessionusers.slice(0,3)),e)));return yield Promise.all(t),{items:n}}))}getItemPath(e){return`${e.sessionstart}/${e.sessionend}`}getItemQueryParams(){return{chatId:this.CHAT_ID,groupId:this.groupId}}loadUserFullname(e){return Object(p.a)(this,void 0,void 0,(function*(){if(!e.userfullname)try{const t=yield U.a.getProfile(e.userid,this.COURSE_ID,!0);e.userfullname=t.fullname}catch(t){e.userfullname=A.J.instant(\"core.deleteduser\")+\" \"+e.userid}}))}}var B=n(\"WPIK\"),G=n(\"3Pt+\"),H=n(\"llyR\");function AddonModChatSessionsPage_ion_card_21_p_6_Template(e,t){if(1&e&&(d.Ec(0,\"p\"),d.pd(1),d.Pc(2,\"coreDuration\"),d.Dc()),2&e){const e=d.Oc().$implicit;d.lc(1),d.qd(d.Qc(2,1,e.duration))}}function AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template(e,t){if(1&e&&(d.Ec(0,\"span\"),d.pd(1),d.Dc()),2&e){const e=d.Oc().$implicit;d.lc(1),d.rd(\"(\",e.messagecount,\")\")}}function AddonModChatSessionsPage_ion_card_21_ion_item_8_Template(e,t){if(1&e&&(d.Ec(0,\"ion-item\"),d.Ec(1,\"ion-label\"),d.pd(2),d.nd(3,AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template,2,1,\"span\",12),d.Dc(),d.Dc()),2&e){const e=t.$implicit;d.lc(2),d.rd(\" \",e.userfullname,\" \"),d.lc(1),d.Vc(\"ngIf\",e.messagecount)}}function AddonModChatSessionsPage_ion_card_21_ion_button_9_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,\"ion-button\",15),d.Mc(\"click\",(function AddonModChatSessionsPage_ion_card_21_ion_button_9_Template_ion_button_click_0_listener(t){d.fd(e);const n=d.Oc().$implicit;return d.Oc().showMoreUsers(n,t)})),d.pd(1),d.Pc(2,\"translate\"),d.Dc()}2&e&&(d.lc(1),d.rd(\" \",d.Qc(2,1,\"core.showmore\"),\" \"))}function AddonModChatSessionsPage_ion_card_21_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,\"ion-card\",9),d.Mc(\"click\",(function AddonModChatSessionsPage_ion_card_21_Template_ion_card_click_0_listener(){d.fd(e);const n=t.$implicit;return d.Oc().sessions.select(n)})),d.Ec(1,\"ion-item\",10),d.Ec(2,\"ion-label\"),d.Ec(3,\"p\",11),d.pd(4),d.Pc(5,\"coreFormatDate\"),d.Dc(),d.nd(6,AddonModChatSessionsPage_ion_card_21_p_6_Template,3,3,\"p\",12),d.Dc(),d.Dc(),d.Ec(7,\"ion-card-content\"),d.nd(8,AddonModChatSessionsPage_ion_card_21_ion_item_8_Template,4,2,\"ion-item\",13),d.Dc(),d.nd(9,AddonModChatSessionsPage_ion_card_21_ion_button_9_Template,3,3,\"ion-button\",14),d.Dc()}if(2&e){const e=t.$implicit,n=d.Oc();d.qc(\"addon-mod-chat-session-show-more\",e.sessionusers.length<e.allsessionusers.length),d.mc(\"aria-current\",n.sessions.getItemAriaCurrent(e)),d.lc(4),d.qd(d.Qc(5,7,1e3*e.sessionstart)),d.lc(2),d.Vc(\"ngIf\",e.duration),d.lc(2),d.Vc(\"ngForOf\",e.sessionusers),d.lc(1),d.Vc(\"ngIf\",e.sessionusers.length<e.allsessionusers.length)}}function AddonModChatSessionsPage_core_empty_box_22_Template(e,t){1&e&&(d.zc(0,\"core-empty-box\",16),d.Pc(1,\"translate\")),2&e&&d.Vc(\"message\",d.Qc(1,1,\"addon.mod_chat.nosessionsfound\"))}let J=(()=>{class AddonModChatSessionsPage{constructor(){try{const e=C.a.getRequiredRouteNumberParam(\"courseId\"),t=C.a.getRequiredRouteNumberParam(\"chatId\"),n=C.a.getRequiredRouteNumberParam(\"cmId\"),o=Q.a.getOrCreateSource(chat_sessions_source_AddonModChatSessionsSource,[e,t,n]);this.sessions=new L.a(o,AddonModChatSessionsPage)}catch(e){return P.a.showErrorModal(e),C.a.back(),void 0}}get groupId(){return this.sessions.getSource().groupId}set groupId(e){this.sessions.getSource().groupId=e}get showAll(){return this.sessions.getSource().showAll}set showAll(e){this.sessions.getSource().showAll=e}get groupInfo(){return this.sessions.getSource().groupInfo}ngAfterViewInit(){return Object(p.a)(this,void 0,void 0,(function*(){yield this.fetchSessions(),this.sessions.start(this.splitView)}))}fetchSessions(){return Object(p.a)(this,void 0,void 0,(function*(){try{yield this.sessions.load()}catch(e){P.a.showErrorModalDefault(e,\"core.errorloadingcontent\",!0)}}))}reloadSessions(){return Object(p.a)(this,void 0,void 0,(function*(){const e=yield P.a.showModalLoading();try{yield this.sessions.reload()}catch(e){P.a.showErrorModalDefault(e,\"core.errorloadingcontent\",!0)}finally{e.dismiss()}}))}refreshSessions(e){return Object(p.a)(this,void 0,void 0,(function*(){try{this.sessions.getSource().setDirty(!0),yield this.sessions.getSource().invalidateCache(),yield this.fetchSessions()}finally{e.complete()}}))}showMoreUsers(e,t){e.allsessionusers&&(e.sessionusers=e.allsessionusers),t.stopPropagation()}ngOnDestroy(){this.sessions.destroy()}}return AddonModChatSessionsPage.ɵfac=function AddonModChatSessionsPage_Factory(e){return new(e||AddonModChatSessionsPage)},AddonModChatSessionsPage.ɵcmp=d.sc({type:AddonModChatSessionsPage,selectors:[[\"page-addon-mod-chat-sessions\"]],viewQuery:function AddonModChatSessionsPage_Query(e,t){var n;(1&e&&d.ud(N.a,!0),2&e)&&(d.dd(n=d.Nc())&&(t.splitView=n.first))},decls:23,vars:19,consts:[[\"slot\",\"start\"],[3,\"text\"],[\"slot\",\"fixed\",3,\"disabled\",\"ionRefresh\"],[3,\"pullingText\"],[3,\"hideUntil\"],[3,\"groupInfo\",\"selected\",\"selectedChange\"],[3,\"ngModel\",\"ngModelChange\",\"ionChange\"],[\"button\",\"\",3,\"addon-mod-chat-session-show-more\",\"click\",4,\"ngFor\",\"ngForOf\"],[\"icon\",\"far-comments\",3,\"message\",4,\"ngIf\"],[\"button\",\"\",3,\"click\"],[1,\"ion-text-wrap\"],[1,\"item-heading\"],[4,\"ngIf\"],[4,\"ngFor\",\"ngForOf\"],[\"fill\",\"clear\",\"expand\",\"block\",3,\"click\",4,\"ngIf\"],[\"fill\",\"clear\",\"expand\",\"block\",3,\"click\"],[\"icon\",\"far-comments\",3,\"message\"]],template:function AddonModChatSessionsPage_Template(e,t){1&e&&(d.Ec(0,\"ion-header\"),d.Ec(1,\"ion-toolbar\"),d.Ec(2,\"ion-buttons\",0),d.zc(3,\"ion-back-button\",1),d.Pc(4,\"translate\"),d.Dc(),d.Ec(5,\"ion-title\"),d.Ec(6,\"h1\"),d.pd(7),d.Pc(8,\"translate\"),d.Dc(),d.Dc(),d.Dc(),d.Dc(),d.Ec(9,\"ion-content\"),d.Ec(10,\"core-split-view\"),d.Ec(11,\"ion-refresher\",2),d.Mc(\"ionRefresh\",(function AddonModChatSessionsPage_Template_ion_refresher_ionRefresh_11_listener(e){return t.refreshSessions(e.target)})),d.zc(12,\"ion-refresher-content\",3),d.Pc(13,\"translate\"),d.Dc(),d.Ec(14,\"core-loading\",4),d.Ec(15,\"core-group-selector\",5),d.Mc(\"selectedChange\",(function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener(e){return t.groupId=e}))(\"selectedChange\",(function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener(){return t.reloadSessions()})),d.Dc(),d.Ec(16,\"ion-item\"),d.Ec(17,\"ion-label\"),d.pd(18),d.Pc(19,\"translate\"),d.Dc(),d.Ec(20,\"ion-toggle\",6),d.Mc(\"ngModelChange\",(function AddonModChatSessionsPage_Template_ion_toggle_ngModelChange_20_listener(e){return t.showAll=e}))(\"ionChange\",(function AddonModChatSessionsPage_Template_ion_toggle_ionChange_20_listener(){return t.reloadSessions()})),d.Dc(),d.Dc(),d.nd(21,AddonModChatSessionsPage_ion_card_21_Template,10,9,\"ion-card\",7),d.nd(22,AddonModChatSessionsPage_core_empty_box_22_Template,2,3,\"core-empty-box\",8),d.Dc(),d.Dc(),d.Dc()),2&e&&(d.lc(3),d.Vc(\"text\",d.Qc(4,11,\"core.back\")),d.lc(4),d.qd(d.Qc(8,13,\"addon.mod_chat.chatreport\")),d.lc(4),d.Vc(\"disabled\",!t.sessions.loaded),d.lc(1),d.Wc(\"pullingText\",d.Qc(13,15,\"core.pulltorefresh\")),d.lc(2),d.Vc(\"hideUntil\",t.sessions.loaded),d.lc(1),d.Vc(\"groupInfo\",t.groupInfo)(\"selected\",t.groupId),d.lc(3),d.qd(d.Qc(19,17,\"addon.mod_chat.showincompletesessions\")),d.lc(2),d.Vc(\"ngModel\",t.showAll),d.lc(1),d.Vc(\"ngForOf\",t.sessions.items),d.lc(1),d.Vc(\"ngIf\",t.sessions.empty))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,_.a,r.v,N.a,r.bb,r.cb,T.a,B.a,r.I,r.O,r.zb,r.d,G.r,G.u,O.s,O.t,r.n,r.o,S.a,r.l,V.a],pipes:[h.d,k.a,H.a],encapsulation:2}),AddonModChatSessionsPage})();var Y=n(\"MLi9\");const X=[{path:\":courseId/:cmId\",component:m},{path:\":courseId/:cmId/chat\",component:F,canDeactivate:[Y.a]}],K=[...X,{path:\":courseId/:cmId/sessions\",component:J},{path:\":courseId/:cmId/sessions/:sessionStart/:sessionEnd\",component:z}],Z=[...X,{path:\":courseId/:cmId/sessions\",component:J,children:[{path:\":sessionStart/:sessionEnd\",component:z}]}],ee=[...Object(j.c)(K,(()=>$.a.isMobile)),...Object(j.c)(Z,(()=>$.a.isTablet))];let te=(()=>{class AddonModChatLazyModule{}return AddonModChatLazyModule.ɵmod=d.wc({type:AddonModChatLazyModule}),AddonModChatLazyModule.ɵinj=d.vc({factory:function AddonModChatLazyModule_Factory(e){return new(e||AddonModChatLazyModule)},imports:[[o.m.forChild(ee),s.a,a.a]]}),AddonModChatLazyModule})();void((\"undefined\"==typeof ngJitMode||ngJitMode)&&d.kd(te,{declarations:[m,F,J,z],imports:[o.m,s.a,a.a]}))}}]);","name":"54.68c22c6f33a2f2b3d18b.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[54],{\n\n/***/ \"IODR\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"AddonModChatLazyModule\", function() { return /* binding */ chat_lazy_module_AddonModChatLazyModule; });\n\n// EXTERNAL MODULE: ./node_modules/@angular/router/__ivy_ngcc__/fesm2015/router.js + 10 modules\nvar router = __webpack_require__(\"tyNb\");\n\n// EXTERNAL MODULE: ./src/core/shared.module.ts + 3 modules\nvar shared_module = __webpack_require__(\"L3Fv\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/components/components.module.ts\nvar components_module = __webpack_require__(\"ef6k\");\n\n// EXTERNAL MODULE: ./src/core/features/course/classes/main-activity-page.ts\nvar main_activity_page = __webpack_require__(\"ghUQ\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/components/index/index.ts\nvar components_index = __webpack_require__(\"e1dt\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/core/__ivy_ngcc__/fesm2015/core.js\nvar core = __webpack_require__(\"fXoL\");\n\n// EXTERNAL MODULE: ./node_modules/@ionic/angular/__ivy_ngcc__/fesm2015/ionic-angular.js + 5 modules\nvar ionic_angular = __webpack_require__(\"TEn/\");\n\n// EXTERNAL MODULE: ./src/core/directives/collapsible-header.ts\nvar collapsible_header = __webpack_require__(\"4JiN\");\n\n// EXTERNAL MODULE: ./src/core/directives/format-text.ts\nvar format_text = __webpack_require__(\"hMzs\");\n\n// EXTERNAL MODULE: ./src/core/directives/content.ts\nvar content = __webpack_require__(\"nt/U\");\n\n// EXTERNAL MODULE: ./node_modules/@ngx-translate/core/__ivy_ngcc__/fesm2015/ngx-translate-core.js + 8 modules\nvar ngx_translate_core = __webpack_require__(\"sYmb\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/pages/index/index.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n/**\n * Page that displays a chat.\n */\nlet index_AddonModChatIndexPage = /*@__PURE__*/ (() => {\n    class AddonModChatIndexPage extends main_activity_page[\"a\" /* CoreCourseModuleMainActivityPage */] {\n    }\n    AddonModChatIndexPage.ɵfac = function AddonModChatIndexPage_Factory(t) { return ɵAddonModChatIndexPage_BaseFactory(t || AddonModChatIndexPage); };\n    AddonModChatIndexPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModChatIndexPage, selectors: [[\"page-addon-mod-chat-index\"]], viewQuery: function AddonModChatIndexPage_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"ud\" /* ɵɵviewQuery */](components_index[\"a\" /* AddonModChatIndexComponent */], true);\n            }\n            if (rf & 2) {\n                var _t;\n                core[\"dd\" /* ɵɵqueryRefresh */](_t = core[\"Nc\" /* ɵɵloadQuery */]()) && (ctx.activityComponent = _t.first);\n            }\n        }, features: [core[\"ic\" /* ɵɵInheritDefinitionFeature */]], decls: 14, vars: 12, consts: [[\"collapsible\", \"\"], [\"slot\", \"start\"], [3, \"text\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [\"slot\", \"end\"], [1, \"limited-width\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"module\", \"courseId\", \"dataRetrieved\"]], template: function AddonModChatIndexPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\", 0);\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 1);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 2);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"zc\" /* ɵɵelement */](7, \"core-format-text\", 3);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"zc\" /* ɵɵelement */](8, \"ion-buttons\", 4);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-content\", 5);\n                core[\"Ec\" /* ɵɵelementStart */](10, \"ion-refresher\", 6);\n                core[\"Mc\" /* ɵɵlistener */](\"ionRefresh\", function AddonModChatIndexPage_Template_ion_refresher_ionRefresh_10_listener($event) { return ctx.activityComponent == null ? null : ctx.activityComponent.doRefresh($event.target); });\n                core[\"zc\" /* ɵɵelement */](11, \"ion-refresher-content\", 7);\n                core[\"Pc\" /* ɵɵpipe */](12, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](13, \"addon-mod-chat-index\", 8);\n                core[\"Mc\" /* ɵɵlistener */](\"dataRetrieved\", function AddonModChatIndexPage_Template_addon_mod_chat_index_dataRetrieved_13_listener($event) { return ctx.updateData($event); });\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 8, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", ctx.title)(\"contextInstanceId\", ctx.module == null ? null : ctx.module.id)(\"courseId\", ctx.courseId);\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", ctx.activityComponent == null ? null : ctx.activityComponent.showLoading);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Wc\" /* ɵɵpropertyInterpolate */](\"pullingText\", core[\"Qc\" /* ɵɵpipeBind1 */](12, 10, \"core.pulltorefresh\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"module\", ctx.module)(\"courseId\", ctx.courseId);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], collapsible_header[\"b\" /* CoreCollapsibleHeaderDirective */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], format_text[\"a\" /* CoreFormatTextDirective */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], ionic_angular[\"bb\" /* IonRefresher */], ionic_angular[\"cb\" /* IonRefresherContent */], components_index[\"a\" /* AddonModChatIndexComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */]], encapsulation: 2 });\n    return AddonModChatIndexPage;\n})();\nconst ɵAddonModChatIndexPage_BaseFactory = /*@__PURE__*/ core[\"Gc\" /* ɵɵgetInheritedFactory */](index_AddonModChatIndexPage);\n\n// EXTERNAL MODULE: ./node_modules/tslib/tslib.es6.js\nvar tslib_es6 = __webpack_require__(\"mrSG\");\n\n// EXTERNAL MODULE: ./src/core/components/send-message-form/send-message-form.ts\nvar send_message_form = __webpack_require__(\"O4u7\");\n\n// EXTERNAL MODULE: ./src/core/services/app.ts + 1 modules\nvar app = __webpack_require__(\"nvXB\");\n\n// EXTERNAL MODULE: ./src/core/services/network.ts + 2 modules\nvar network = __webpack_require__(\"GGba\");\n\n// EXTERNAL MODULE: ./src/core/services/navigator.ts\nvar services_navigator = __webpack_require__(\"pHTc\");\n\n// EXTERNAL MODULE: ./src/core/services/sites.ts\nvar sites = __webpack_require__(\"9+EE\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/dom.ts + 2 modules\nvar dom = __webpack_require__(\"3LXp\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/utils.ts\nvar utils = __webpack_require__(\"bFG1\");\n\n// EXTERNAL MODULE: ./src/core/singletons/index.ts\nvar singletons = __webpack_require__(\"j3ag\");\n\n// EXTERNAL MODULE: ./src/core/singletons/events.ts\nvar events = __webpack_require__(\"fjkH\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/components/users-modal/users-modal.ts\nvar users_modal = __webpack_require__(\"5E3q\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/services/chat.ts\nvar chat = __webpack_require__(\"g4DX\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/services/chat-helper.ts\nvar chat_helper = __webpack_require__(\"btSF\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/common/__ivy_ngcc__/fesm2015/common.js\nvar common = __webpack_require__(\"ofXK\");\n\n// EXTERNAL MODULE: ./src/core/components/loading/loading.ts\nvar loading = __webpack_require__(\"PgjG\");\n\n// EXTERNAL MODULE: ./src/core/directives/update-non-reactive-attributes.ts\nvar update_non_reactive_attributes = __webpack_require__(\"ACYt\");\n\n// EXTERNAL MODULE: ./src/core/directives/fa-icon.ts\nvar fa_icon = __webpack_require__(\"3CSS\");\n\n// EXTERNAL MODULE: ./src/core/components/message/message.ts\nvar message_message = __webpack_require__(\"9pYf\");\n\n// EXTERNAL MODULE: ./src/core/components/empty-box/empty-box.ts\nvar empty_box = __webpack_require__(\"r8G5\");\n\n// EXTERNAL MODULE: ./src/core/pipes/format-date.ts\nvar format_date = __webpack_require__(\"uYHD\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/pages/chat/chat.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonModChatChatPage_ion_button_9_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r7 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 14);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModChatChatPage_ion_button_9_Template_ion_button_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r7); const ctx_r6 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r6.showChatUsers(); });\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 15);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"core.users\"));\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_p_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"p\", 19);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"coreFormatDate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](2, 1, message_r8.timestamp * 1000, \"strftimedayshort\"), \" \");\n    }\n}\nconst _c0 = function (a0) { return { $a: a0 }; };\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 26);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 27);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageenter\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.userfullname)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 28);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 29);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageexit\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.userfullname)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 30);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 31);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messagebeepseveryone\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.userfullname)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 30);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 31);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messagebeepsyou\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.userfullname)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 32);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 31);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageyoubeep\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.beepWho)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r28 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 33);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 34);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Ec\" /* ɵɵelementStart */](5, \"strong\");\n        core[\"pd\" /* ɵɵtext */](6);\n        core[\"Ec\" /* ɵɵelementStart */](7, \"core-format-text\", 35);\n        core[\"Mc\" /* ɵɵlistener */](\"afterRender\", function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template_core_format_text_afterRender_7_listener() { core[\"fd\" /* ɵɵrestoreView */](_r28); const last_r10 = core[\"Oc\" /* ɵɵnextContext */](2).last; const ctx_r26 = core[\"Oc\" /* ɵɵnextContext */](); return last_r10 && ctx_r26.scrollToBottom(); });\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        const ctx_r20 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 5, message_r8.timestamp * 1000, \"strftimetime\"), \" \");\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", message_r8.userfullname, \" \");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"text\", message_r8.message)(\"contextInstanceId\", ctx_r20.cmId)(\"courseId\", ctx_r20.courseId);\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\", 20);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template, 6, 10, \"ion-badge\", 21);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template, 6, 10, \"ion-badge\", 22);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template, 6, 10, \"ion-badge\", 23);\n        core[\"nd\" /* ɵɵtemplate */](4, AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template, 6, 10, \"ion-badge\", 23);\n        core[\"nd\" /* ɵɵtemplate */](5, AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template, 6, 10, \"ion-badge\", 24);\n        core[\"nd\" /* ɵɵtemplate */](6, AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template, 8, 8, \"ion-badge\", 25);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r12 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.system && message_r8.message == \"enter\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.system && message_r8.message == \"exit\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.beep == \"all\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.userid != ctx_r12.currentUserId && message_r8.beep == ctx_r12.currentUserId);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.userid == ctx_r12.currentUserId && message_r8.beep && message_r8.beep != \"all\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !message_r8.system && !message_r8.beep);\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_core_message_3_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r33 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"core-message\", 36);\n        core[\"Mc\" /* ɵɵlistener */](\"afterRender\", function AddonModChatChatPage_ng_container_13_core_message_3_Template_core_message_afterRender_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r33); const last_r10 = core[\"Oc\" /* ɵɵnextContext */]().last; const ctx_r31 = core[\"Oc\" /* ɵɵnextContext */](); return last_r10 && ctx_r31.scrollToBottom(); });\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r13 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"Vc\" /* ɵɵproperty */](\"message\", message_r8)(\"user\", message_r8)(\"text\", message_r8.message)(\"time\", message_r8.timestamp * 1000)(\"instanceId\", ctx_r13.cmId)(\"courseId\", ctx_r13.courseId);\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonModChatChatPage_ng_container_13_p_1_Template, 3, 4, \"p\", 16);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatChatPage_ng_container_13_div_2_Template, 7, 6, \"div\", 17);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatChatPage_ng_container_13_core_message_3_Template, 1, 6, \"core-message\", 18);\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = ctx.$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.showDate);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.special);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !message_r8.special);\n    }\n}\nfunction AddonModChatChatPage_core_empty_box_14_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-empty-box\", 37);\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n    }\n    if (rf & 2) {\n        core[\"Vc\" /* ɵɵproperty */](\"message\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"addon.mod_chat.nomessages\"));\n    }\n}\nfunction AddonModChatChatPage_p_17_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"p\", 38);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"addon.mod_chat.mustbeonlinetosendmessages\"), \" \");\n    }\n}\nfunction AddonModChatChatPage_core_send_message_form_18_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r36 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"core-send-message-form\", 39);\n        core[\"Mc\" /* ɵɵlistener */](\"onSubmit\", function AddonModChatChatPage_core_send_message_form_18_Template_core_send_message_form_onSubmit_0_listener($event) { core[\"fd\" /* ɵɵrestoreView */](_r36); const ctx_r35 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r35.sendMessage($event); });\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r4 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"Vc\" /* ɵɵproperty */](\"sendDisabled\", ctx_r4.sending)(\"message\", ctx_r4.newMessage)(\"placeholder\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 3, \"addon.messages.newmessage\"));\n    }\n}\nfunction AddonModChatChatPage_ion_button_19_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r38 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 40);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModChatChatPage_ion_button_19_Template_ion_button_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r38); const ctx_r37 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r37.reconnect(); });\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.login.reconnect\"), \" \");\n    }\n}\n/**\n * Page that displays a chat session.\n */\nlet chat_AddonModChatChatPage = /*@__PURE__*/ (() => {\n    class AddonModChatChatPage {\n        constructor() {\n            this.loaded = false;\n            this.title = '';\n            this.messages = [];\n            this.sending = false;\n            this.lastTime = 0;\n            this.oldContentHeight = 0;\n            this.viewDestroyed = false;\n            this.pollingRunning = false;\n            this.users = [];\n            this.currentUserId = sites[\"b\" /* CoreSites */].getCurrentSiteUserId();\n            this.isOnline = network[\"a\" /* CoreNetwork */].isOnline();\n            this.onlineSubscription = network[\"a\" /* CoreNetwork */].onChange().subscribe(() => {\n                // Execute the callback in the Angular zone, so change detection doesn't stop working.\n                singletons[\"A\" /* NgZone */].run(() => {\n                    this.isOnline = network[\"a\" /* CoreNetwork */].isOnline();\n                });\n            });\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnInit() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    this.courseId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('courseId');\n                    this.cmId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('cmId');\n                    this.chatId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('chatId');\n                    this.title = services_navigator[\"a\" /* CoreNavigator */].getRouteParam('title') || '';\n                    yield this.loginUser();\n                    yield this.fetchMessages();\n                    this.startPolling();\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'addon.mod_chat.errorwhileconnecting', true);\n                    services_navigator[\"a\" /* CoreNavigator */].back();\n                }\n                finally {\n                    this.loaded = true;\n                }\n            });\n        }\n        /**\n         * Runs when the page has fully entered and is now the active page.\n         * This event will fire, whether it was the first load or a cached page.\n         */\n        ionViewDidEnter() {\n            this.startPolling();\n        }\n        /**\n         * Runs when the page is about to leave and no longer be the active page.\n         */\n        ionViewWillLeave() {\n            events[\"b\" /* CoreEvents */].trigger(events[\"b\" /* CoreEvents */].ACTIVITY_DATA_SENT, { module: 'chat' });\n            this.stopPolling();\n        }\n        /**\n         * Convenience function to login the user.\n         *\n         * @return Promise resolved when done.\n         */\n        loginUser() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                this.sessionId = yield chat[\"a\" /* AddonModChat */].loginUser(this.chatId);\n            });\n        }\n        /**\n         * Convenience function to fetch chat messages.\n         *\n         * @return Promise resolved when done.\n         */\n        fetchMessages() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const messagesInfo = yield chat[\"a\" /* AddonModChat */].getLatestMessages(this.sessionId, this.lastTime);\n                this.lastTime = messagesInfo.chatnewlasttime || 0;\n                const messages = yield chat[\"a\" /* AddonModChat */].getMessagesUserData(messagesInfo.messages, this.courseId);\n                if (!messages.length) {\n                    // No messages yet, nothing else to do.\n                    return;\n                }\n                const previousLength = this.messages.length;\n                this.messages = this.messages.concat(messages);\n                // Calculate which messages need to display the date or user data.\n                for (let index = previousLength; index < this.messages.length; index++) {\n                    const prevMessage = index > 0 ? this.messages[index - 1] : undefined;\n                    this.messages[index] = chat_helper[\"a\" /* AddonModChatHelper */].formatMessage(this.currentUserId, this.messages[index], prevMessage);\n                    const message = this.messages[index];\n                    if (message.beep && message.beep != String(this.currentUserId)) {\n                        this.loadMessageBeepWho(message);\n                    }\n                }\n                this.messages[this.messages.length - 1].showTail = true;\n                // New messages or beeps, scroll to bottom.\n                this.scrollToBottom();\n            });\n        }\n        loadMessageBeepWho(message) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                message.beepWho = yield this.getUserFullname(message.beep);\n            });\n        }\n        /**\n         * Display the chat users modal.\n         */\n        showChatUsers() {\n            var _a;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                // Create the toc modal.\n                const modalData = yield dom[\"a\" /* CoreDomUtils */].openSideModal({\n                    component: users_modal[\"a\" /* AddonModChatUsersModalComponent */],\n                    componentProps: {\n                        sessionId: this.sessionId,\n                        cmId: this.cmId,\n                    },\n                });\n                if (modalData) {\n                    if (modalData.talkTo) {\n                        this.newMessage = `To ${modalData.talkTo}: ` + (((_a = this.sendMessageForm) === null || _a === void 0 ? void 0 : _a.message) || '');\n                    }\n                    if (modalData.beepTo) {\n                        this.sendMessage('', modalData.beepTo);\n                    }\n                    this.users = modalData.users;\n                }\n            });\n        }\n        /**\n         * Get the user fullname for a beep.\n         *\n         * @param id User Id before parsing.\n         * @return User fullname.\n         */\n        getUserFullname(id) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const idNumber = parseInt(id, 10);\n                if (isNaN(idNumber)) {\n                    return id;\n                }\n                const user = this.users.find((user) => user.id == idNumber);\n                if (user) {\n                    return user.fullname;\n                }\n                try {\n                    const data = yield chat[\"a\" /* AddonModChat */].getChatUsers(this.sessionId, { cmId: this.cmId });\n                    this.users = data.users;\n                    const user = this.users.find((user) => user.id == idNumber);\n                    if (user) {\n                        return user.fullname;\n                    }\n                    return id;\n                }\n                catch (_a) {\n                    // Ignore errors.\n                    return id;\n                }\n            });\n        }\n        /**\n         * Start the polling to get chat messages periodically.\n         */\n        startPolling() {\n            // We already have the polling in place.\n            if (this.polling) {\n                return;\n            }\n            // Start polling.\n            this.polling = window.setInterval(() => {\n                utils[\"a\" /* CoreUtils */].ignoreErrors(this.fetchMessagesInterval());\n            }, chat[\"b\" /* AddonModChatProvider */].POLL_INTERVAL);\n        }\n        /**\n         * Stop polling for messages.\n         */\n        stopPolling() {\n            clearInterval(this.polling);\n            this.polling = undefined;\n        }\n        /**\n         * Convenience function to be called every certain time to fetch chat messages.\n         *\n         * @return Promise resolved when done.\n         */\n        fetchMessagesInterval() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.isOnline || this.pollingRunning) {\n                    // Obviously we cannot check for new messages when the app is offline.\n                    return;\n                }\n                this.pollingRunning = true;\n                try {\n                    yield this.fetchMessages();\n                }\n                catch (_a) {\n                    try {\n                        // Try to login, it might have failed because the session expired.\n                        yield this.loginUser();\n                        yield this.fetchMessages();\n                    }\n                    catch (error) {\n                        // Fail again. Stop polling if needed.\n                        this.stopPolling();\n                        dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'addon.mod_chat.errorwhileretrievingmessages', true);\n                        throw error;\n                    }\n                }\n                finally {\n                    this.pollingRunning = false;\n                }\n            });\n        }\n        /**\n         * Send a message to the chat.\n         *\n         * @param text Text of the nessage.\n         * @param beep ID of the user to beep.\n         */\n        sendMessage(text, beep = 0) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.isOnline) {\n                    // Silent error, the view should prevent this.\n                    return;\n                }\n                else if (beep === 0 && !text.trim()) {\n                    // Silent error.\n                    return;\n                }\n                this.sending = true;\n                try {\n                    yield chat[\"a\" /* AddonModChat */].sendMessage(this.sessionId, text, beep);\n                    // Update messages to show the sent message.\n                    utils[\"a\" /* CoreUtils */].ignoreErrors(this.fetchMessagesInterval());\n                }\n                catch (error) {\n                    // Only close the keyboard if an error happens, we want the user to be able to send multiple\n                    // messages without the keyboard being closed.\n                    app[\"a\" /* CoreApp */].closeKeyboard();\n                    this.newMessage = text;\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'addon.mod_chat.errorwhilesendingmessage', true);\n                }\n                finally {\n                    this.sending = false;\n                }\n            });\n        }\n        /**\n         * Try to reconnect.\n         *\n         * @return Promise resolved when done.\n         */\n        reconnect() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const modal = yield dom[\"a\" /* CoreDomUtils */].showModalLoading();\n                try {\n                    // Call startPolling would take a while for the first execution, so we'll execute it manually to check if it works now.\n                    yield this.fetchMessagesInterval();\n                    // It works, start the polling again.\n                    this.startPolling();\n                }\n                catch (_a) {\n                    // Ignore errors.\n                }\n                finally {\n                    modal.dismiss();\n                }\n            });\n        }\n        /**\n         * Scroll bottom when render has finished.\n         */\n        scrollToBottom() {\n            var _a;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                // Need a timeout to leave time to the view to be rendered.\n                yield utils[\"a\" /* CoreUtils */].nextTick();\n                if (!this.viewDestroyed) {\n                    (_a = this.content) === null || _a === void 0 ? void 0 : _a.scrollToBottom();\n                }\n            });\n        }\n        /**\n         * Check if we can leave the page or not.\n         *\n         * @return Resolved with true if we can leave it, rejected if not.\n         */\n        canLeave() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.messages.some((message) => !message.special)) {\n                    return true;\n                }\n                // Modified, confirm user wants to go back.\n                yield dom[\"a\" /* CoreDomUtils */].showConfirm(singletons[\"J\" /* Translate */].instant('addon.mod_chat.confirmloss'));\n                return true;\n            });\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnDestroy() {\n            this.onlineSubscription && this.onlineSubscription.unsubscribe();\n            this.stopPolling();\n            this.viewDestroyed = true;\n        }\n    }\n    AddonModChatChatPage.ɵfac = function AddonModChatChatPage_Factory(t) { return new (t || AddonModChatChatPage)(); };\n    AddonModChatChatPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModChatChatPage, selectors: [[\"page-addon-mod-chat-chat\"]], viewQuery: function AddonModChatChatPage_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"ud\" /* ɵɵviewQuery */](ionic_angular[\"v\" /* IonContent */], true);\n                core[\"ud\" /* ɵɵviewQuery */](send_message_form[\"a\" /* CoreSendMessageFormComponent */], true);\n            }\n            if (rf & 2) {\n                var _t;\n                core[\"dd\" /* ɵɵqueryRefresh */](_t = core[\"Nc\" /* ɵɵloadQuery */]()) && (ctx.content = _t.first);\n                core[\"dd\" /* ɵɵqueryRefresh */](_t = core[\"Nc\" /* ɵɵloadQuery */]()) && (ctx.sendMessageForm = _t.first);\n            }\n        }, decls: 20, vars: 14, consts: [[\"slot\", \"start\"], [3, \"text\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [\"slot\", \"end\"], [\"fill\", \"clear\", 3, \"click\", 4, \"ngIf\"], [3, \"hideUntil\"], [\"aria-live\", \"polite\", 1, \"addon-messages-discussion-container\"], [4, \"ngFor\", \"ngForOf\"], [\"icon\", \"far-comments\", 3, \"message\", 4, \"ngIf\"], [1, \"footer-adjustable\"], [3, \"color\"], [\"class\", \"ion-text-center\", 4, \"ngIf\"], [3, \"sendDisabled\", \"message\", \"placeholder\", \"onSubmit\", 4, \"ngIf\"], [\"expand\", \"block\", \"fill\", \"outline\", 3, \"click\", 4, \"ngIf\"], [\"fill\", \"clear\", 3, \"click\"], [\"name\", \"fas-users\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [\"class\", \"ion-text-center addon-messages-date\", 4, \"ngIf\"], [\"class\", \"ion-text-center addon-mod_chat-notice\", 4, \"ngIf\"], [\"contextLevel\", \"module\", 3, \"message\", \"user\", \"text\", \"time\", \"instanceId\", \"courseId\", \"afterRender\", 4, \"ngIf\"], [1, \"ion-text-center\", \"addon-messages-date\"], [1, \"ion-text-center\", \"addon-mod_chat-notice\"], [\"class\", \"ion-text-wrap\", \"color\", \"success\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"danger\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"primary\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"light\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"info\", 4, \"ngIf\"], [\"color\", \"success\", 1, \"ion-text-wrap\"], [\"name\", \"fas-sign-in-alt\", \"aria-hidden\", \"true\"], [\"color\", \"danger\", 1, \"ion-text-wrap\"], [\"name\", \"fas-sign-out-alt\", \"aria-hidden\", \"true\"], [\"color\", \"primary\", 1, \"ion-text-wrap\"], [\"name\", \"fas-bell\", \"aria-hidden\", \"true\"], [\"color\", \"light\", 1, \"ion-text-wrap\"], [\"color\", \"info\", 1, \"ion-text-wrap\"], [\"name\", \"fas-asterisk\", \"aria-hidden\", \"true\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\", \"afterRender\"], [\"contextLevel\", \"module\", 3, \"message\", \"user\", \"text\", \"time\", \"instanceId\", \"courseId\", \"afterRender\"], [\"icon\", \"far-comments\", 3, \"message\"], [1, \"ion-text-center\"], [3, \"sendDisabled\", \"message\", \"placeholder\", \"onSubmit\"], [\"expand\", \"block\", \"fill\", \"outline\", 3, \"click\"]], template: function AddonModChatChatPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"zc\" /* ɵɵelement */](7, \"core-format-text\", 2);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](8, \"ion-buttons\", 3);\n                core[\"nd\" /* ɵɵtemplate */](9, AddonModChatChatPage_ion_button_9_Template, 3, 3, \"ion-button\", 4);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](10, \"ion-content\");\n                core[\"Ec\" /* ɵɵelementStart */](11, \"core-loading\", 5);\n                core[\"Ec\" /* ɵɵelementStart */](12, \"ion-list\", 6);\n                core[\"nd\" /* ɵɵtemplate */](13, AddonModChatChatPage_ng_container_13_Template, 4, 3, \"ng-container\", 7);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"nd\" /* ɵɵtemplate */](14, AddonModChatChatPage_core_empty_box_14_Template, 2, 3, \"core-empty-box\", 8);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](15, \"ion-footer\", 9);\n                core[\"Ec\" /* ɵɵelementStart */](16, \"ion-toolbar\", 10);\n                core[\"nd\" /* ɵɵtemplate */](17, AddonModChatChatPage_p_17_Template, 3, 3, \"p\", 11);\n                core[\"nd\" /* ɵɵtemplate */](18, AddonModChatChatPage_core_send_message_form_18_Template, 2, 5, \"core-send-message-form\", 12);\n                core[\"nd\" /* ɵɵtemplate */](19, AddonModChatChatPage_ion_button_19_Template, 3, 3, \"ion-button\", 13);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 12, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", ctx.title)(\"contextInstanceId\", ctx.cmId)(\"courseId\", ctx.courseId);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx.messages);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !ctx.messages || ctx.messages.length <= 0);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"color\", ctx.isOnline && ctx.polling && ctx.loaded ? \"contrast\" : \"light\");\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !ctx.isOnline);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.isOnline && ctx.polling && ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.isOnline && !ctx.polling && ctx.loaded);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], format_text[\"a\" /* CoreFormatTextDirective */], common[\"t\" /* NgIf */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], loading[\"a\" /* CoreLoadingComponent */], ionic_angular[\"P\" /* IonList */], common[\"s\" /* NgForOf */], ionic_angular[\"A\" /* IonFooter */], update_non_reactive_attributes[\"a\" /* CoreUpdateNonReactiveAttributesDirective */], ionic_angular[\"l\" /* IonButton */], ionic_angular[\"D\" /* IonIcon */], fa_icon[\"a\" /* CoreFaIconDirective */], ionic_angular[\"k\" /* IonBadge */], message_message[\"a\" /* CoreMessageComponent */], empty_box[\"a\" /* CoreEmptyBoxComponent */], send_message_form[\"a\" /* CoreSendMessageFormComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */], format_date[\"a\" /* CoreFormatDatePipe */]], styles: [\".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}\"] });\n    return AddonModChatChatPage;\n})();\n\n// EXTERNAL MODULE: ./src/core/features/user/services/user.ts\nvar services_user = __webpack_require__(\"4pns\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/pages/session-messages/session-messages.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\", 10);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"coreFormatDate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](2, 1, message_r1.timestamp * 1000, \"strftimedayshort\"), \" \");\n    }\n}\nconst session_messages_c0 = function (a0) { return { $a: a0 }; };\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 17);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 18);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageenter\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.userfullname)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 19);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 20);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageexit\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.userfullname)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 21);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 22);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messagebeepseveryone\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.userfullname)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 21);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 22);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messagebeepsyou\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.userfullname)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 23);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 22);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageyoubeep\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.beepWho)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 24);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 25);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Ec\" /* ɵɵelementStart */](5, \"strong\");\n        core[\"pd\" /* ɵɵtext */](6);\n        core[\"zc\" /* ɵɵelement */](7, \"core-format-text\", 26);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        const ctx_r12 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 5, message_r1.timestamp * 1000, \"strftimetime\"), \" \");\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", message_r1.userfullname, \" \");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"text\", message_r1.message)(\"contextInstanceId\", ctx_r12.cmId)(\"courseId\", ctx_r12.courseId);\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\", 11);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template, 6, 10, \"ion-badge\", 12);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template, 6, 10, \"ion-badge\", 13);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template, 6, 10, \"ion-badge\", 14);\n        core[\"nd\" /* ɵɵtemplate */](4, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template, 6, 10, \"ion-badge\", 14);\n        core[\"nd\" /* ɵɵtemplate */](5, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template, 6, 10, \"ion-badge\", 15);\n        core[\"nd\" /* ɵɵtemplate */](6, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template, 8, 8, \"ion-badge\", 16);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r4 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.issystem && message_r1.message == \"enter\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.issystem && message_r1.message == \"exit\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.beep == \"all\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.userid != ctx_r4.currentUserId && message_r1.beep == ctx_r4.currentUserId);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.userid == ctx_r4.currentUserId && message_r1.beep && message_r1.beep != \"all\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !message_r1.issystem && !message_r1.beep);\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_core_message_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-message\", 27);\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r5 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"Vc\" /* ɵɵproperty */](\"message\", message_r1)(\"user\", message_r1)(\"text\", message_r1.message)(\"time\", message_r1.timestamp * 1000)(\"instanceId\", ctx_r5.cmId)(\"courseId\", ctx_r5.courseId);\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonModChatSessionMessagesPage_ng_container_15_div_1_Template, 3, 4, \"div\", 7);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatSessionMessagesPage_ng_container_15_div_2_Template, 7, 6, \"div\", 8);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatSessionMessagesPage_ng_container_15_core_message_3_Template, 1, 6, \"core-message\", 9);\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = ctx.$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.showDate);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.special);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !message_r1.special);\n    }\n}\n/**\n * Page that displays list of chat session messages.\n */\nlet session_messages_AddonModChatSessionMessagesPage = /*@__PURE__*/ (() => {\n    class AddonModChatSessionMessagesPage {\n        constructor() {\n            this.messages = [];\n            this.loaded = false;\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnInit() {\n            try {\n                this.courseId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('courseId');\n                this.cmId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('cmId');\n                this.sessionStart = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('sessionStart');\n                this.sessionEnd = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('sessionEnd');\n                this.chatId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('chatId');\n                this.groupId = services_navigator[\"a\" /* CoreNavigator */].getRouteNumberParam('groupId') || 0;\n            }\n            catch (error) {\n                dom[\"a\" /* CoreDomUtils */].showErrorModal(error);\n                services_navigator[\"a\" /* CoreNavigator */].back();\n                return;\n            }\n            this.currentUserId = sites[\"b\" /* CoreSites */].getCurrentSiteUserId();\n            this.fetchMessages();\n        }\n        /**\n         * Fetch session messages.\n         *\n         * @return Promise resolved when done.\n         */\n        fetchMessages() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    const messages = yield chat[\"a\" /* AddonModChat */].getSessionMessages(this.chatId, this.sessionStart, this.sessionEnd, this.groupId, { cmId: this.cmId });\n                    this.messages = yield chat[\"a\" /* AddonModChat */].getMessagesUserData(messages, this.courseId);\n                    // Calculate which messages need to display the date or user data.\n                    for (let index = 0; index < this.messages.length; index++) {\n                        const prevMessage = index > 0 ? this.messages[index - 1] : undefined;\n                        this.messages[index] = chat_helper[\"a\" /* AddonModChatHelper */].formatMessage(this.currentUserId, this.messages[index], prevMessage);\n                        const message = this.messages[index];\n                        if (message.beep && message.beep != String(this.currentUserId)) {\n                            this.loadMessageBeepWho(message);\n                        }\n                    }\n                    this.messages[this.messages.length - 1].showTail = true;\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.errorloadingcontent', true);\n                }\n                finally {\n                    this.loaded = true;\n                }\n            });\n        }\n        loadMessageBeepWho(message) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                message.beepWho = yield this.getUserFullname(message.beep);\n            });\n        }\n        /**\n         * Get the user fullname for a beep.\n         *\n         * @param id User Id before parsing.\n         * @return User fullname.\n         */\n        getUserFullname(id) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const idNumber = parseInt(id, 10);\n                if (isNaN(idNumber)) {\n                    return id;\n                }\n                try {\n                    const user = yield services_user[\"a\" /* CoreUser */].getProfile(idNumber, this.courseId, true);\n                    return user.fullname;\n                }\n                catch (_a) {\n                    // Error getting profile.\n                    return id;\n                }\n            });\n        }\n        /**\n         * Refresh session messages.\n         *\n         * @param refresher Refresher.\n         */\n        refreshMessages(refresher) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    yield utils[\"a\" /* CoreUtils */].ignoreErrors(chat[\"a\" /* AddonModChat */].invalidateSessionMessages(this.chatId, this.sessionStart, this.groupId));\n                    yield this.fetchMessages();\n                }\n                finally {\n                    refresher.complete();\n                }\n            });\n        }\n    }\n    AddonModChatSessionMessagesPage.ɵfac = function AddonModChatSessionMessagesPage_Factory(t) { return new (t || AddonModChatSessionMessagesPage)(); };\n    AddonModChatSessionMessagesPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModChatSessionMessagesPage, selectors: [[\"page-addon-mod-chat-session-messages\"]], decls: 16, vars: 12, consts: [[\"slot\", \"start\"], [3, \"text\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"hideUntil\"], [1, \"addon-messages-discussion-container\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"ion-text-center addon-messages-date\", 4, \"ngIf\"], [\"class\", \"ion-text-center addon-mod_chat-notice\", 4, \"ngIf\"], [\"contextLevel\", \"module\", 3, \"message\", \"user\", \"text\", \"time\", \"instanceId\", \"courseId\", 4, \"ngIf\"], [1, \"ion-text-center\", \"addon-messages-date\"], [1, \"ion-text-center\", \"addon-mod_chat-notice\"], [\"class\", \"ion-text-wrap\", \"color\", \"success\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"danger\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"primary\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"light\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"info\", 4, \"ngIf\"], [\"color\", \"success\", 1, \"ion-text-wrap\"], [\"name\", \"fas-sign-in-alt\", \"aria-hidden\", \"true\"], [\"color\", \"danger\", 1, \"ion-text-wrap\"], [\"name\", \"fas-sign-out-alt\", \"aria-hidden\", \"true\"], [\"color\", \"primary\", 1, \"ion-text-wrap\"], [\"name\", \"fas-bell\", \"aria-hidden\", \"true\"], [\"color\", \"light\", 1, \"ion-text-wrap\"], [\"color\", \"info\", 1, \"ion-text-wrap\"], [\"name\", \"fas-asterisk\", \"aria-hidden\", \"true\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [\"contextLevel\", \"module\", 3, \"message\", \"user\", \"text\", \"time\", \"instanceId\", \"courseId\"]], template: function AddonModChatSessionMessagesPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"pd\" /* ɵɵtext */](7);\n                core[\"Pc\" /* ɵɵpipe */](8, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-content\");\n                core[\"Ec\" /* ɵɵelementStart */](10, \"ion-refresher\", 2);\n                core[\"Mc\" /* ɵɵlistener */](\"ionRefresh\", function AddonModChatSessionMessagesPage_Template_ion_refresher_ionRefresh_10_listener($event) { return ctx.refreshMessages($event.target); });\n                core[\"zc\" /* ɵɵelement */](11, \"ion-refresher-content\", 3);\n                core[\"Pc\" /* ɵɵpipe */](12, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](13, \"core-loading\", 4);\n                core[\"Ec\" /* ɵɵelementStart */](14, \"ion-list\", 5);\n                core[\"nd\" /* ɵɵtemplate */](15, AddonModChatSessionMessagesPage_ng_container_15_Template, 4, 3, \"ng-container\", 6);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 6, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](8, 8, \"addon.mod_chat.messages\"));\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", !ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Wc\" /* ɵɵpropertyInterpolate */](\"pullingText\", core[\"Qc\" /* ɵɵpipeBind1 */](12, 10, \"core.pulltorefresh\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx.messages);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], ionic_angular[\"bb\" /* IonRefresher */], ionic_angular[\"cb\" /* IonRefresherContent */], loading[\"a\" /* CoreLoadingComponent */], ionic_angular[\"P\" /* IonList */], common[\"s\" /* NgForOf */], common[\"t\" /* NgIf */], ionic_angular[\"k\" /* IonBadge */], ionic_angular[\"D\" /* IonIcon */], fa_icon[\"a\" /* CoreFaIconDirective */], format_text[\"a\" /* CoreFormatTextDirective */], message_message[\"a\" /* CoreMessageComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */], format_date[\"a\" /* CoreFormatDatePipe */]], styles: [\".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}\"] });\n    return AddonModChatSessionMessagesPage;\n})();\n\n// EXTERNAL MODULE: ./src/core/services/screen.ts\nvar screen = __webpack_require__(\"Y+03\");\n\n// EXTERNAL MODULE: ./src/app/app-routing.module.ts\nvar app_routing_module = __webpack_require__(\"vY5A\");\n\n// EXTERNAL MODULE: ./src/core/classes/items-management/list-items-manager.ts\nvar list_items_manager = __webpack_require__(\"EoRH\");\n\n// EXTERNAL MODULE: ./src/core/classes/items-management/routed-items-manager-sources-tracker.ts\nvar routed_items_manager_sources_tracker = __webpack_require__(\"baaQ\");\n\n// EXTERNAL MODULE: ./src/core/components/split-view/split-view.ts\nvar split_view = __webpack_require__(\"46ml\");\n\n// EXTERNAL MODULE: ./src/core/classes/items-management/routed-items-manager-source.ts\nvar routed_items_manager_source = __webpack_require__(\"CvRw\");\n\n// EXTERNAL MODULE: ./src/core/services/groups.ts\nvar groups = __webpack_require__(\"mWdr\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/classes/chat-sessions-source.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n/**\n * Provides a collection of sessions.\n */\nclass chat_sessions_source_AddonModChatSessionsSource extends routed_items_manager_source[\"a\" /* CoreRoutedItemsManagerSource */] {\n    constructor(courseId, chatId, cmId) {\n        super();\n        this.showAll = false;\n        this.groupId = 0;\n        this.COURSE_ID = courseId;\n        this.CHAT_ID = chatId;\n        this.CM_ID = cmId;\n    }\n    /**\n     * Invalidate chat cache.\n     */\n    invalidateCache() {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            yield utils[\"a\" /* CoreUtils */].ignoreErrors(utils[\"a\" /* CoreUtils */].allPromises([\n                groups[\"a\" /* CoreGroups */].invalidateActivityGroupInfo(this.CM_ID),\n                chat[\"a\" /* AddonModChat */].invalidateSessions(this.CHAT_ID, this.groupId, this.showAll),\n            ]));\n        });\n    }\n    /**\n     * @inheritdoc\n     */\n    loadPageItems() {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            this.groupInfo = yield groups[\"a\" /* CoreGroups */].getActivityGroupInfo(this.CM_ID, false);\n            this.groupId = groups[\"a\" /* CoreGroups */].validateGroupId(this.groupId, this.groupInfo);\n            const sessions = yield chat[\"a\" /* AddonModChat */].getSessions(this.CHAT_ID, this.groupId, this.showAll, { cmId: this.CM_ID });\n            // Fetch user profiles.\n            const promises = [];\n            const formattedSessions = sessions.map((session) => {\n                session.duration = session.sessionend - session.sessionstart;\n                session.sessionusers.forEach((sessionUser) => {\n                    // The WS does not return the user name, fetch user profile.\n                    promises.push(this.loadUserFullname(sessionUser));\n                });\n                // If session has more than 4 users we display a \"Show more\" link.\n                session.allsessionusers = session.sessionusers;\n                if (session.sessionusers.length > 4) {\n                    session.sessionusers = session.allsessionusers.slice(0, 3);\n                }\n                return session;\n            });\n            yield Promise.all(promises);\n            return { items: formattedSessions };\n        });\n    }\n    /**\n     * @inheritdoc\n     */\n    getItemPath(session) {\n        return `${session.sessionstart}/${session.sessionend}`;\n    }\n    /**\n     * @inheritdoc\n     */\n    getItemQueryParams() {\n        return {\n            chatId: this.CHAT_ID,\n            groupId: this.groupId,\n        };\n    }\n    /**\n     * Load the fullname of a user.\n     *\n     * @param id User ID.\n     * @return Promise resolved when done.\n     */\n    loadUserFullname(sessionUser) {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            if (sessionUser.userfullname) {\n                return;\n            }\n            try {\n                const user = yield services_user[\"a\" /* CoreUser */].getProfile(sessionUser.userid, this.COURSE_ID, true);\n                sessionUser.userfullname = user.fullname;\n            }\n            catch (_a) {\n                // Error getting profile, most probably the user is deleted.\n                sessionUser.userfullname = singletons[\"J\" /* Translate */].instant('core.deleteduser') + ' ' + sessionUser.userid;\n            }\n        });\n    }\n}\n\n// EXTERNAL MODULE: ./src/core/components/group-selector/group-selector.ts\nvar group_selector = __webpack_require__(\"WPIK\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/forms/__ivy_ngcc__/fesm2015/forms.js\nvar fesm2015_forms = __webpack_require__(\"3Pt+\");\n\n// EXTERNAL MODULE: ./src/core/pipes/duration.ts\nvar duration = __webpack_require__(\"llyR\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/pages/sessions/sessions.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonModChatSessionsPage_ion_card_21_p_6_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"p\");\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"coreDuration\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const session_r2 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, session_r2.duration));\n    }\n}\nfunction AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"span\");\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const user_r7 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\"(\", user_r7.messagecount, \")\");\n    }\n}\nfunction AddonModChatSessionsPage_ion_card_21_ion_item_8_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-item\");\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-label\");\n        core[\"pd\" /* ɵɵtext */](2);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template, 2, 1, \"span\", 12);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const user_r7 = ctx.$implicit;\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", user_r7.userfullname, \" \");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", user_r7.messagecount);\n    }\n}\nfunction AddonModChatSessionsPage_ion_card_21_ion_button_9_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r12 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 15);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModChatSessionsPage_ion_card_21_ion_button_9_Template_ion_button_click_0_listener($event) { core[\"fd\" /* ɵɵrestoreView */](_r12); const session_r2 = core[\"Oc\" /* ɵɵnextContext */]().$implicit; const ctx_r10 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r10.showMoreUsers(session_r2, $event); });\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.showmore\"), \" \");\n    }\n}\nfunction AddonModChatSessionsPage_ion_card_21_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r14 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-card\", 9);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModChatSessionsPage_ion_card_21_Template_ion_card_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r14); const session_r2 = ctx.$implicit; const ctx_r13 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r13.sessions.select(session_r2); });\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-item\", 10);\n        core[\"Ec\" /* ɵɵelementStart */](2, \"ion-label\");\n        core[\"Ec\" /* ɵɵelementStart */](3, \"p\", 11);\n        core[\"pd\" /* ɵɵtext */](4);\n        core[\"Pc\" /* ɵɵpipe */](5, \"coreFormatDate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](6, AddonModChatSessionsPage_ion_card_21_p_6_Template, 3, 3, \"p\", 12);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](7, \"ion-card-content\");\n        core[\"nd\" /* ɵɵtemplate */](8, AddonModChatSessionsPage_ion_card_21_ion_item_8_Template, 4, 2, \"ion-item\", 13);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](9, AddonModChatSessionsPage_ion_card_21_ion_button_9_Template, 3, 3, \"ion-button\", 14);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const session_r2 = ctx.$implicit;\n        const ctx_r0 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"qc\" /* ɵɵclassProp */](\"addon-mod-chat-session-show-more\", session_r2.sessionusers.length < session_r2.allsessionusers.length);\n        core[\"mc\" /* ɵɵattribute */](\"aria-current\", ctx_r0.sessions.getItemAriaCurrent(session_r2));\n        core[\"lc\" /* ɵɵadvance */](4);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](5, 7, session_r2.sessionstart * 1000));\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", session_r2.duration);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", session_r2.sessionusers);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", session_r2.sessionusers.length < session_r2.allsessionusers.length);\n    }\n}\nfunction AddonModChatSessionsPage_core_empty_box_22_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-empty-box\", 16);\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n    }\n    if (rf & 2) {\n        core[\"Vc\" /* ɵɵproperty */](\"message\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"addon.mod_chat.nosessionsfound\"));\n    }\n}\n/**\n * Page that displays list of chat sessions.\n */\nlet sessions_AddonModChatSessionsPage = /*@__PURE__*/ (() => {\n    class AddonModChatSessionsPage {\n        constructor() {\n            try {\n                const courseId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('courseId');\n                const chatId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('chatId');\n                const cmId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('cmId');\n                const source = routed_items_manager_sources_tracker[\"a\" /* CoreRoutedItemsManagerSourcesTracker */].getOrCreateSource(chat_sessions_source_AddonModChatSessionsSource, [courseId, chatId, cmId]);\n                this.sessions = new list_items_manager[\"a\" /* CoreListItemsManager */](source, AddonModChatSessionsPage);\n            }\n            catch (error) {\n                dom[\"a\" /* CoreDomUtils */].showErrorModal(error);\n                services_navigator[\"a\" /* CoreNavigator */].back();\n                return;\n            }\n        }\n        get groupId() {\n            return this.sessions.getSource().groupId;\n        }\n        set groupId(value) {\n            this.sessions.getSource().groupId = value;\n        }\n        get showAll() {\n            return this.sessions.getSource().showAll;\n        }\n        set showAll(value) {\n            this.sessions.getSource().showAll = value;\n        }\n        get groupInfo() {\n            return this.sessions.getSource().groupInfo;\n        }\n        /**\n         * @inheritdoc\n         */\n        ngAfterViewInit() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                yield this.fetchSessions();\n                this.sessions.start(this.splitView);\n            });\n        }\n        /**\n         * Fetch chat sessions.\n         *\n         * @param showLoading Display a loading modal.\n         */\n        fetchSessions() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    yield this.sessions.load();\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.errorloadingcontent', true);\n                }\n            });\n        }\n        /**\n         * Reload chat sessions.\n         */\n        reloadSessions() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const modal = yield dom[\"a\" /* CoreDomUtils */].showModalLoading();\n                try {\n                    yield this.sessions.reload();\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.errorloadingcontent', true);\n                }\n                finally {\n                    modal.dismiss();\n                }\n            });\n        }\n        /**\n         * Refresh chat sessions.\n         *\n         * @param refresher Refresher.\n         */\n        refreshSessions(refresher) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    this.sessions.getSource().setDirty(true);\n                    yield this.sessions.getSource().invalidateCache();\n                    yield this.fetchSessions();\n                }\n                finally {\n                    refresher.complete();\n                }\n            });\n        }\n        /**\n         * Show more session users.\n         *\n         * @param session Chat session.\n         * @param event The event.\n         */\n        showMoreUsers(session, event) {\n            if (session.allsessionusers) {\n                session.sessionusers = session.allsessionusers;\n            }\n            event.stopPropagation();\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnDestroy() {\n            this.sessions.destroy();\n        }\n    }\n    AddonModChatSessionsPage.ɵfac = function AddonModChatSessionsPage_Factory(t) { return new (t || AddonModChatSessionsPage)(); };\n    AddonModChatSessionsPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModChatSessionsPage, selectors: [[\"page-addon-mod-chat-sessions\"]], viewQuery: function AddonModChatSessionsPage_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"ud\" /* ɵɵviewQuery */](split_view[\"a\" /* CoreSplitViewComponent */], true);\n            }\n            if (rf & 2) {\n                var _t;\n                core[\"dd\" /* ɵɵqueryRefresh */](_t = core[\"Nc\" /* ɵɵloadQuery */]()) && (ctx.splitView = _t.first);\n            }\n        }, decls: 23, vars: 19, consts: [[\"slot\", \"start\"], [3, \"text\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"hideUntil\"], [3, \"groupInfo\", \"selected\", \"selectedChange\"], [3, \"ngModel\", \"ngModelChange\", \"ionChange\"], [\"button\", \"\", 3, \"addon-mod-chat-session-show-more\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"icon\", \"far-comments\", 3, \"message\", 4, \"ngIf\"], [\"button\", \"\", 3, \"click\"], [1, \"ion-text-wrap\"], [1, \"item-heading\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [\"fill\", \"clear\", \"expand\", \"block\", 3, \"click\", 4, \"ngIf\"], [\"fill\", \"clear\", \"expand\", \"block\", 3, \"click\"], [\"icon\", \"far-comments\", 3, \"message\"]], template: function AddonModChatSessionsPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"pd\" /* ɵɵtext */](7);\n                core[\"Pc\" /* ɵɵpipe */](8, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-content\");\n                core[\"Ec\" /* ɵɵelementStart */](10, \"core-split-view\");\n                core[\"Ec\" /* ɵɵelementStart */](11, \"ion-refresher\", 2);\n                core[\"Mc\" /* ɵɵlistener */](\"ionRefresh\", function AddonModChatSessionsPage_Template_ion_refresher_ionRefresh_11_listener($event) { return ctx.refreshSessions($event.target); });\n                core[\"zc\" /* ɵɵelement */](12, \"ion-refresher-content\", 3);\n                core[\"Pc\" /* ɵɵpipe */](13, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](14, \"core-loading\", 4);\n                core[\"Ec\" /* ɵɵelementStart */](15, \"core-group-selector\", 5);\n                core[\"Mc\" /* ɵɵlistener */](\"selectedChange\", function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener($event) { return ctx.groupId = $event; })(\"selectedChange\", function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener() { return ctx.reloadSessions(); });\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](16, \"ion-item\");\n                core[\"Ec\" /* ɵɵelementStart */](17, \"ion-label\");\n                core[\"pd\" /* ɵɵtext */](18);\n                core[\"Pc\" /* ɵɵpipe */](19, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](20, \"ion-toggle\", 6);\n                core[\"Mc\" /* ɵɵlistener */](\"ngModelChange\", function AddonModChatSessionsPage_Template_ion_toggle_ngModelChange_20_listener($event) { return ctx.showAll = $event; })(\"ionChange\", function AddonModChatSessionsPage_Template_ion_toggle_ionChange_20_listener() { return ctx.reloadSessions(); });\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"nd\" /* ɵɵtemplate */](21, AddonModChatSessionsPage_ion_card_21_Template, 10, 9, \"ion-card\", 7);\n                core[\"nd\" /* ɵɵtemplate */](22, AddonModChatSessionsPage_core_empty_box_22_Template, 2, 3, \"core-empty-box\", 8);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 11, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](8, 13, \"addon.mod_chat.chatreport\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", !ctx.sessions.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Wc\" /* ɵɵpropertyInterpolate */](\"pullingText\", core[\"Qc\" /* ɵɵpipeBind1 */](13, 15, \"core.pulltorefresh\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.sessions.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"groupInfo\", ctx.groupInfo)(\"selected\", ctx.groupId);\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](19, 17, \"addon.mod_chat.showincompletesessions\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngModel\", ctx.showAll);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx.sessions.items);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.sessions.empty);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], split_view[\"a\" /* CoreSplitViewComponent */], ionic_angular[\"bb\" /* IonRefresher */], ionic_angular[\"cb\" /* IonRefresherContent */], loading[\"a\" /* CoreLoadingComponent */], group_selector[\"a\" /* CoreGroupSelectorComponent */], ionic_angular[\"I\" /* IonItem */], ionic_angular[\"O\" /* IonLabel */], ionic_angular[\"zb\" /* IonToggle */], ionic_angular[\"d\" /* BooleanValueAccessor */], fesm2015_forms[\"r\" /* NgControlStatus */], fesm2015_forms[\"u\" /* NgModel */], common[\"s\" /* NgForOf */], common[\"t\" /* NgIf */], ionic_angular[\"n\" /* IonCard */], ionic_angular[\"o\" /* IonCardContent */], update_non_reactive_attributes[\"a\" /* CoreUpdateNonReactiveAttributesDirective */], ionic_angular[\"l\" /* IonButton */], empty_box[\"a\" /* CoreEmptyBoxComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */], format_date[\"a\" /* CoreFormatDatePipe */], duration[\"a\" /* CoreDurationPipe */]], encapsulation: 2 });\n    return AddonModChatSessionsPage;\n})();\n\n// EXTERNAL MODULE: ./src/core/guards/can-leave.ts\nvar can_leave = __webpack_require__(\"MLi9\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/chat-lazy.module.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst commonRoutes = [\n    {\n        path: ':courseId/:cmId',\n        component: index_AddonModChatIndexPage,\n    },\n    {\n        path: ':courseId/:cmId/chat',\n        component: chat_AddonModChatChatPage,\n        canDeactivate: [can_leave[\"a\" /* CanLeaveGuard */]],\n    },\n];\nconst mobileRoutes = [\n    ...commonRoutes,\n    {\n        path: ':courseId/:cmId/sessions',\n        component: sessions_AddonModChatSessionsPage,\n    },\n    {\n        path: ':courseId/:cmId/sessions/:sessionStart/:sessionEnd',\n        component: session_messages_AddonModChatSessionMessagesPage,\n    },\n];\nconst tabletRoutes = [\n    ...commonRoutes,\n    {\n        path: ':courseId/:cmId/sessions',\n        component: sessions_AddonModChatSessionsPage,\n        children: [\n            {\n                path: ':sessionStart/:sessionEnd',\n                component: session_messages_AddonModChatSessionMessagesPage,\n            },\n        ],\n    },\n];\nconst routes = [\n    ...Object(app_routing_module[\"c\" /* conditionalRoutes */])(mobileRoutes, () => screen[\"a\" /* CoreScreen */].isMobile),\n    ...Object(app_routing_module[\"c\" /* conditionalRoutes */])(tabletRoutes, () => screen[\"a\" /* CoreScreen */].isTablet),\n];\nlet chat_lazy_module_AddonModChatLazyModule = /*@__PURE__*/ (() => {\n    class AddonModChatLazyModule {\n    }\n    AddonModChatLazyModule.ɵmod = core[\"wc\" /* ɵɵdefineNgModule */]({ type: AddonModChatLazyModule });\n    AddonModChatLazyModule.ɵinj = core[\"vc\" /* ɵɵdefineInjector */]({ factory: function AddonModChatLazyModule_Factory(t) { return new (t || AddonModChatLazyModule)(); }, imports: [[\n                router[\"m\" /* RouterModule */].forChild(routes),\n                shared_module[\"a\" /* CoreSharedModule */],\n                components_module[\"a\" /* AddonModChatComponentsModule */],\n            ]] });\n    return AddonModChatLazyModule;\n})();\n(function () {\n    (typeof ngJitMode === \"undefined\" || ngJitMode) && core[\"kd\" /* ɵɵsetNgModuleScope */](chat_lazy_module_AddonModChatLazyModule, { declarations: [index_AddonModChatIndexPage,\n            chat_AddonModChatChatPage,\n            sessions_AddonModChatSessionsPage,\n            session_messages_AddonModChatSessionMessagesPage], imports: [router[\"m\" /* RouterModule */], shared_module[\"a\" /* CoreSharedModule */],\n            components_module[\"a\" /* AddonModChatComponentsModule */]] });\n})();\n\n\n/***/ })\n\n}]);","inputSourceMap":null}