(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{OQUD:function(n,t,e){"use strict";e.r(t),e.d(t,"CoreSettingsSynchronizationPageModule",(function(){return L}));var i=e("tyNb"),o=e("L3Fv"),c=e("mrSG"),a=e("BaYo"),r=e("fjkH"),s=e("9+EE"),_=e("3LXp"),l=e("BBqZ"),g=e("1gmh"),d=e("j3ag"),S=e("mv9v"),u=e("GGba"),m=e("pHTc"),h=e("fXoL"),p=e("TEn/"),f=e("ACV2"),y=e("ACYt"),C=e("3CSS"),P=e("nt/U"),z=e("PgjG"),O=e("3Pt+"),b=e("ofXK"),T=e("hMzs"),D=e("iSJP"),E=e("NcPy"),v=e("3zv0"),I=e("sYmb");function CoreSettingsSynchronizationPage_ion_card_28_ng_container_4_Template(n,t){1&n&&(h.Cc(0),h.pd(1),h.Pc(2,"translate"),h.Bc()),2&n&&(h.lc(1),h.rd(" ",h.Qc(2,1,"core.settings.connectwifitosync"),""))}function CoreSettingsSynchronizationPage_ion_card_28_ng_container_5_Template(n,t){1&n&&(h.Cc(0),h.pd(1),h.Pc(2,"translate"),h.Bc()),2&n&&(h.lc(1),h.qd(h.Qc(2,1,"core.settings.connecttosync")))}function CoreSettingsSynchronizationPage_ion_card_28_Template(n,t){if(1&n&&(h.Ec(0,"ion-card",14),h.Ec(1,"ion-item",8),h.zc(2,"ion-icon",15),h.Ec(3,"ion-label"),h.nd(4,CoreSettingsSynchronizationPage_ion_card_28_ng_container_4_Template,3,3,"ng-container",12),h.nd(5,CoreSettingsSynchronizationPage_ion_card_28_ng_container_5_Template,3,3,"ng-container",12),h.Dc(),h.Dc(),h.Dc()),2&n){const n=h.Oc();h.lc(4),h.Vc("ngIf",n.isOnline&&n.dataSaver&&n.limitedConnection),h.lc(1),h.Vc("ngIf",!n.isOnline)}}function CoreSettingsSynchronizationPage_ng_container_29_ion_card_6_ng_container_9_Template(n,t){1&n&&h.Ac(0)}function CoreSettingsSynchronizationPage_ng_container_29_ion_card_6_ion_item_10_ng_container_1_Template(n,t){1&n&&h.Ac(0)}const _c0=function(n){return{site:n}};function CoreSettingsSynchronizationPage_ng_container_29_ion_card_6_ion_item_10_Template(n,t){if(1&n&&(h.Ec(0,"ion-item"),h.nd(1,CoreSettingsSynchronizationPage_ng_container_29_ion_card_6_ion_item_10_ng_container_1_Template,1,0,"ng-container",21),h.Dc()),2&n){const n=t.$implicit;h.Oc(3);const e=h.ed(31);h.lc(1),h.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",h.ad(2,_c0,n))}}function CoreSettingsSynchronizationPage_ng_container_29_ion_card_6_Template(n,t){if(1&n&&(h.Ec(0,"ion-card"),h.Ec(1,"ion-item-divider",17),h.Ec(2,"ion-label"),h.Ec(3,"p",9),h.zc(4,"core-format-text",18),h.Dc(),h.Ec(5,"p"),h.Ec(6,"a",19),h.pd(7),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Ec(8,"ion-item",20),h.nd(9,CoreSettingsSynchronizationPage_ng_container_29_ion_card_6_ng_container_9_Template,1,0,"ng-container",21),h.Dc(),h.nd(10,CoreSettingsSynchronizationPage_ng_container_29_ion_card_6_ion_item_10_Template,2,4,"ion-item",16),h.Dc()),2&n){const n=h.Oc(2),t=h.ed(31);h.lc(4),h.Vc("text",n.accountsList.currentSite.siteName)("siteId",n.accountsList.currentSite.id),h.lc(2),h.Vc("href",n.accountsList.currentSite.siteUrl,h.id),h.lc(1),h.qd(n.accountsList.currentSite.siteUrlWithoutProtocol),h.lc(2),h.Vc("ngTemplateOutlet",t)("ngTemplateOutletContext",h.ad(7,_c0,n.accountsList.currentSite)),h.lc(1),h.Vc("ngForOf",n.accountsList.sameSite)}}function CoreSettingsSynchronizationPage_ng_container_29_ion_card_7_ion_item_divider_1_Template(n,t){if(1&n&&(h.Ec(0,"ion-item-divider",17),h.Ec(1,"ion-label"),h.Ec(2,"p",9),h.zc(3,"core-format-text",18),h.Dc(),h.Ec(4,"p"),h.Ec(5,"a",23),h.pd(6),h.Dc(),h.Dc(),h.Dc(),h.Dc()),2&n){const n=h.Oc().$implicit;h.lc(3),h.Vc("text",n[0].siteName)("siteId",n[0].id),h.lc(2),h.Vc("href",n[0].siteUrl,h.id),h.lc(1),h.qd(n[0].siteUrlWithoutProtocol)}}function CoreSettingsSynchronizationPage_ng_container_29_ion_card_7_ion_item_2_ng_container_1_Template(n,t){1&n&&h.Ac(0)}function CoreSettingsSynchronizationPage_ng_container_29_ion_card_7_ion_item_2_Template(n,t){if(1&n&&(h.Ec(0,"ion-item"),h.nd(1,CoreSettingsSynchronizationPage_ng_container_29_ion_card_7_ion_item_2_ng_container_1_Template,1,0,"ng-container",21),h.Dc()),2&n){const n=t.$implicit;h.Oc(3);const e=h.ed(31);h.lc(1),h.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",h.ad(2,_c0,n))}}function CoreSettingsSynchronizationPage_ng_container_29_ion_card_7_Template(n,t){if(1&n&&(h.Ec(0,"ion-card"),h.nd(1,CoreSettingsSynchronizationPage_ng_container_29_ion_card_7_ion_item_divider_1_Template,7,4,"ion-item-divider",22),h.nd(2,CoreSettingsSynchronizationPage_ng_container_29_ion_card_7_ion_item_2_Template,2,4,"ion-item",16),h.Dc()),2&n){const n=t.$implicit;h.lc(1),h.Vc("ngIf",n[0]),h.lc(1),h.Vc("ngForOf",n)}}function CoreSettingsSynchronizationPage_ng_container_29_Template(n,t){if(1&n&&(h.Cc(0),h.Ec(1,"ion-item-divider"),h.Ec(2,"ion-label"),h.Ec(3,"h2"),h.pd(4),h.Pc(5,"translate"),h.Dc(),h.Dc(),h.Dc(),h.nd(6,CoreSettingsSynchronizationPage_ng_container_29_ion_card_6_Template,11,9,"ion-card",12),h.nd(7,CoreSettingsSynchronizationPage_ng_container_29_ion_card_7_Template,3,2,"ion-card",16),h.Bc()),2&n){const n=h.Oc();h.lc(4),h.qd(h.Qc(5,3,"core.accounts")),h.lc(2),h.Vc("ngIf",n.accountsList.currentSite),h.lc(1),h.Vc("ngForOf",n.accountsList.otherSites)}}function CoreSettingsSynchronizationPage_ng_template_30_p_6_Template(n,t){1&n&&(h.Ec(0,"p",28),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&n&&(h.lc(1),h.qd(h.Qc(2,1,"core.settings.logintosync")))}function CoreSettingsSynchronizationPage_ng_template_30_core_button_with_spinner_7_Template(n,t){if(1&n){const n=h.Fc();h.Ec(0,"core-button-with-spinner",29),h.Ec(1,"ion-button",30),h.Mc("click",(function CoreSettingsSynchronizationPage_ng_template_30_core_button_with_spinner_7_Template_ion_button_click_1_listener(){h.fd(n);const t=h.Oc().site;return h.Oc().synchronize(t.id)})),h.Pc(2,"translate"),h.zc(3,"ion-icon",31),h.Dc(),h.Dc()}if(2&n){const n=h.Oc().site,t=h.Oc();h.Vc("loading",t.isSynchronizing(n.id)),h.lc(1),h.mc("aria-label",h.Qc(2,2,"core.settings.synchronizenow"))}}function CoreSettingsSynchronizationPage_ng_template_30_ion_button_8_Template(n,t){if(1&n){const n=h.Fc();h.Ec(0,"ion-button",32),h.Mc("click",(function CoreSettingsSynchronizationPage_ng_template_30_ion_button_8_Template_ion_button_click_0_listener(){h.fd(n);const t=h.Oc().site;return h.Oc().login(t.id)})),h.Pc(1,"translate"),h.zc(2,"ion-icon",33),h.Dc()}2&n&&h.mc("aria-label",h.Qc(1,1,"core.login.login"))}const _c1=function(n){return{$a:n}};function CoreSettingsSynchronizationPage_ng_template_30_Template(n,t){if(1&n&&(h.Ec(0,"ion-avatar",0),h.zc(1,"img",24),h.Pc(2,"translate"),h.Dc(),h.Ec(3,"ion-label"),h.Ec(4,"p",9),h.pd(5),h.Dc(),h.nd(6,CoreSettingsSynchronizationPage_ng_template_30_p_6_Template,3,3,"p",25),h.Dc(),h.nd(7,CoreSettingsSynchronizationPage_ng_template_30_core_button_with_spinner_7_Template,4,4,"core-button-with-spinner",26),h.nd(8,CoreSettingsSynchronizationPage_ng_template_30_ion_button_8_Template,3,3,"ion-button",27)),2&n){const n=t.site;h.lc(1),h.Wc("alt",h.Rc(2,7,"core.pictureof",h.ad(10,_c1,n.fullName))),h.Vc("src",n.avatar,h.id)("siteId",n.id),h.lc(4),h.qd(n.fullName),h.lc(1),h.Vc("ngIf",n.loggedOut),h.lc(1),h.Vc("ngIf",!n.loggedOut),h.lc(1),h.Vc("ngIf",n.loggedOut)}}let w=(()=>{class CoreSettingsSynchronizationPage{constructor(){this.accountsList={sameSite:[],otherSites:[],count:0},this.sitesLoaded=!1,this.dataSaver=!1,this.limitedConnection=!1,this.isOnline=!0,this.isDestroyed=!1,this.sitesObserver=r.b.on(r.b.SITE_UPDATED,(n=>Object(c.a)(this,void 0,void 0,(function*(){var t;const e=n.siteId;let i=e===(null===(t=this.accountsList.currentSite)||void 0===t?void 0:t.id)?this.accountsList.currentSite:void 0;if(i||(i=this.accountsList.sameSite.find((n=>n.id===e))),i||this.accountsList.otherSites.some((n=>(i=n.find((n=>n.id===e)),i))),!i)return;const o=yield s.b.getSite(e),c=o.getInfo();i.siteName=o.getSiteName(),c&&(i.siteUrl=c.siteurl,i.fullName=c.fullname)})))),this.isOnline=u.a.isOnline(),this.limitedConnection=this.isOnline&&u.a.isNetworkAccessLimited(),this.networkObserver=u.a.onChange().subscribe((()=>{d.A.run((()=>{this.isOnline=u.a.isOnline(),this.limitedConnection=this.isOnline&&u.a.isNetworkAccessLimited()}))}))}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){const n=s.b.getCurrentSiteId();try{this.accountsList=yield S.a.getAccountsList(n)}catch(n){}this.sitesLoaded=!0,this.dataSaver=yield l.a.get(a.a.SETTINGS_SYNC_ONLY_ON_WIFI,!0)}))}syncOnlyOnWifiChanged(){l.a.set(a.a.SETTINGS_SYNC_ONLY_ON_WIFI,this.dataSaver?1:0)}synchronize(n){return Object(c.a)(this,void 0,void 0,(function*(){try{yield g.a.synchronizeSite(!1,n)}catch(n){if(this.isDestroyed)return;_.a.showErrorModalDefault(n,"core.settings.sitesyncfailed",!0)}}))}login(n){return Object(c.a)(this,void 0,void 0,(function*(){yield m.a.navigateToSiteHome({preferCurrentTab:!1,siteId:n})}))}isSynchronizing(n){return!!g.a.getSiteSyncPromise(n)}showInfo(){_.a.showAlert(d.J.instant("core.help"),d.J.instant("core.settings.synchronizenowhelp"))}ngOnDestroy(){this.isDestroyed=!0,this.sitesObserver.off(),this.networkObserver.unsubscribe()}}return CoreSettingsSynchronizationPage.ɵfac=function CoreSettingsSynchronizationPage_Factory(n){return new(n||CoreSettingsSynchronizationPage)},CoreSettingsSynchronizationPage.ɵcmp=h.sc({type:CoreSettingsSynchronizationPage,selectors:[["page-core-app-settings-synchronization"]],decls:32,vars:19,consts:[["slot","start"],[3,"text"],["slot","end"],[3,"click"],["name","fas-info-circle","slot","icon-only","aria-hidden","true"],[1,"limited-width"],[3,"hideUntil"],[1,"core-sitelist","limited-width"],[1,"ion-text-wrap"],[1,"item-heading"],["slot","end",3,"ngModel","ngModelChange"],["class","core-warning-card",4,"ngIf"],[4,"ngIf"],["siteSync",""],[1,"core-warning-card"],["name","fas-exclamation-triangle","slot","start","aria-hidden","true"],[4,"ngFor","ngForOf"],["sticky","true",1,"core-sitelist-sitename"],["clean","true",3,"text","siteId"],["core-link","","autoLogin","yes",3,"href"],[1,"item-current"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["sticky","true","class","core-sitelist-sitename",4,"ngIf"],["core-link","","autoLogin","no",3,"href"],["core-external-content","","onError","this.src='assets/img/user-avatar.png'",3,"src","siteId","alt"],["class","text-danger",4,"ngIf"],["slot","end",3,"loading",4,"ngIf"],["fill","clear","slot","end",3,"click",4,"ngIf"],[1,"text-danger"],["slot","end",3,"loading"],["fill","clear",3,"click"],["name","fas-sync-alt","slot","icon-only","aria-hidden","true"],["fill","clear","slot","end",3,"click"],["name","fas-sign-in-alt","slot","icon-only","aria-hidden","true"]],template:function CoreSettingsSynchronizationPage_Template(n,t){1&n&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-buttons",0),h.zc(3,"ion-back-button",1),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"ion-title"),h.Ec(6,"h1"),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Dc(),h.Ec(9,"ion-buttons",2),h.Ec(10,"core-navbar-buttons"),h.Ec(11,"ion-button",3),h.Mc("click",(function CoreSettingsSynchronizationPage_Template_ion_button_click_11_listener(){return t.showInfo()})),h.Pc(12,"translate"),h.zc(13,"ion-icon",4),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Ec(14,"ion-content",5),h.Ec(15,"core-loading",6),h.Ec(16,"ion-list",7),h.Ec(17,"ion-item-divider"),h.Ec(18,"ion-label"),h.Ec(19,"h2"),h.pd(20),h.Pc(21,"translate"),h.Dc(),h.Dc(),h.Dc(),h.Ec(22,"ion-item",8),h.Ec(23,"ion-label"),h.Ec(24,"p",9),h.pd(25),h.Pc(26,"translate"),h.Dc(),h.Dc(),h.Ec(27,"ion-toggle",10),h.Mc("ngModelChange",(function CoreSettingsSynchronizationPage_Template_ion_toggle_ngModelChange_27_listener(n){return t.dataSaver=n}))("ngModelChange",(function CoreSettingsSynchronizationPage_Template_ion_toggle_ngModelChange_27_listener(){return t.syncOnlyOnWifiChanged()})),h.Dc(),h.Dc(),h.nd(28,CoreSettingsSynchronizationPage_ion_card_28_Template,6,2,"ion-card",11),h.nd(29,CoreSettingsSynchronizationPage_ng_container_29_Template,8,5,"ng-container",12),h.Dc(),h.Dc(),h.Dc(),h.nd(30,CoreSettingsSynchronizationPage_ng_template_30_Template,9,12,"ng-template",null,13,h.od)),2&n&&(h.lc(3),h.Vc("text",h.Qc(4,9,"core.back")),h.lc(4),h.qd(h.Qc(8,11,"core.settings.synchronization")),h.lc(4),h.mc("aria-label",h.Qc(12,13,"core.info")),h.lc(4),h.Vc("hideUntil",t.sitesLoaded),h.lc(5),h.qd(h.Qc(21,15,"core.settings.syncsettings")),h.lc(5),h.rd(" ",h.Qc(26,17,"core.settings.syncdatasaver")," "),h.lc(2),h.Vc("ngModel",t.dataSaver),h.lc(1),h.Vc("ngIf",!t.isOnline||t.dataSaver&&t.limitedConnection),h.lc(1),h.Vc("ngIf",t.isOnline&&(!t.dataSaver||!t.limitedConnection)))},directives:[p.C,p.Ab,p.m,p.h,p.i,p.yb,f.a,y.a,p.l,p.D,C.a,P.a,p.v,z.a,p.P,p.J,p.O,p.I,p.zb,p.d,O.r,O.u,b.t,p.n,b.s,T.a,D.a,b.A,p.g,E.a,v.a],pipes:[I.d],styles:["ion-list.core-sitelist[_ngcontent-%COMP%]   .core-sitelist-sitename[_ngcontent-%COMP%]{border-bottom:1px solid var(--stroke)}ion-list.core-sitelist[_ngcontent-%COMP%]   .core-sitelist-sitename[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"]}),CoreSettingsSynchronizationPage})();const M=[{path:"",component:w}];let L=(()=>{class CoreSettingsSynchronizationPageModule{}return CoreSettingsSynchronizationPageModule.ɵmod=h.wc({type:CoreSettingsSynchronizationPageModule}),CoreSettingsSynchronizationPageModule.ɵinj=h.vc({factory:function CoreSettingsSynchronizationPageModule_Factory(n){return new(n||CoreSettingsSynchronizationPageModule)},imports:[[i.m.forChild(M),o.a],i.m]}),CoreSettingsSynchronizationPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&h.kd(L,{declarations:[w],imports:[i.m,o.a],exports:[i.m]}))}}]);