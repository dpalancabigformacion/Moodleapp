(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"LfF/":function(e,t,n){"use strict";n.r(t),n.d(t,"AddonCalendarEventPageModule",(function(){return B}));var i=n("tyNb"),a=n("L3Fv"),o=n("9Xwr"),c=n("mrSG"),d=n("SmTL"),r=n("n6RP"),l=n("Lc7R"),s=n("+lfu"),v=n("GGba"),_=n("fjkH"),h=n("3LXp"),m=n("vuGA"),u=n("9+EE"),g=n("ANhT"),f=n("ULAo"),p=n("Q98t"),E=n("mWdr"),I=n("j3ag"),b=n("pHTc"),C=n("bFG1"),y=n("BaYo"),P=n("2CAT"),O=n("baaQ"),D=n("51vF"),T=n("eoiU"),A=n("fXoL"),x=n("TEn/"),M=n("4JiN"),w=n("ofXK"),N=n("fQ68"),V=n("8/N+"),S=n("nt/U"),L=n("OZH1"),k=n("PgjG"),R=n("hMzs"),j=n("3CSS"),Q=n("eAud"),U=n("iSJP"),z=n("ACYt"),q=n("sYmb");function AddonCalendarEventPage_h1_6_Template(e,t){if(1&e&&(A.Ec(0,"h1"),A.zc(1,"core-format-text",14),A.Dc()),2&e){const e=A.Oc();A.lc(1),A.Vc("text",e.event.name)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}const _c0=function(e){return{$a:e}};function AddonCalendarEventPage_ion_card_22_Template(e,t){1&e&&(A.Ec(0,"ion-card",15),A.Ec(1,"ion-item"),A.zc(2,"ion-icon",16),A.Ec(3,"ion-label"),A.pd(4),A.Pc(5,"translate"),A.Pc(6,"translate"),A.Dc(),A.Dc(),A.Dc()),2&e&&(A.lc(4),A.qd(A.Rc(5,1,"core.hasdatatosync",A.ad(6,_c0,A.Qc(6,4,"addon.calendar.calendarevent")))))}function AddonCalendarEventPage_ion_list_23_core_mod_icon_2_Template(e,t){if(1&e&&A.zc(0,"core-mod-icon",26),2&e){const e=A.Oc(2);A.Vc("modicon",e.event.moduleIcon)("showAlt",!1)("modname",e.event.modulename)("componentId",e.event.instance)("purpose",e.event.purpose)}}function AddonCalendarEventPage_ion_list_23_ion_icon_3_Template(e,t){if(1&e&&A.zc(0,"ion-icon",27),2&e){const e=A.Oc(2);A.Vc("name",e.event.eventIcon)}}function AddonCalendarEventPage_ion_list_23_span_8_Template(e,t){if(1&e&&(A.Ec(0,"span",20),A.pd(1),A.Dc()),2&e){const e=A.Oc(2);A.lc(1),A.qd(e.event.iconTitle)}}function AddonCalendarEventPage_ion_list_23_ion_note_17_Template(e,t){1&e&&(A.Ec(0,"ion-note",4),A.zc(1,"ion-icon",28),A.pd(2),A.Pc(3,"translate"),A.Dc()),2&e&&(A.lc(2),A.rd(" ",A.Qc(3,1,"core.deletedoffline")," "))}function AddonCalendarEventPage_ion_list_23_ion_item_26_Template(e,t){if(1&e&&(A.Ec(0,"ion-item",29),A.Ec(1,"ion-label"),A.Ec(2,"h2"),A.pd(3),A.Pc(4,"translate"),A.Dc(),A.Ec(5,"p"),A.zc(6,"core-format-text",30),A.Dc(),A.Dc(),A.Dc()),2&e){const e=A.Oc(2);A.Vc("href",e.courseUrl),A.lc(3),A.qd(A.Qc(4,4,"core.course")),A.lc(3),A.Vc("text",e.courseName)("contextInstanceId",e.courseId)}}function AddonCalendarEventPage_ion_list_23_ion_item_27_Template(e,t){if(1&e&&(A.Ec(0,"ion-item",31),A.Ec(1,"ion-label"),A.Ec(2,"h2"),A.pd(3),A.Pc(4,"translate"),A.Dc(),A.Ec(5,"p"),A.pd(6),A.Dc(),A.Dc(),A.Dc()),2&e){const e=A.Oc(2);A.lc(3),A.qd(A.Qc(4,2,"core.group")),A.lc(3),A.qd(e.groupName)}}function AddonCalendarEventPage_ion_list_23_ion_item_28_Template(e,t){if(1&e&&(A.Ec(0,"ion-item",32),A.Ec(1,"ion-label"),A.Ec(2,"h2"),A.pd(3),A.Pc(4,"translate"),A.Dc(),A.Ec(5,"p"),A.zc(6,"core-format-text",33),A.Dc(),A.Dc(),A.Dc()),2&e){const e=A.Oc(2);A.lc(3),A.qd(A.Qc(4,3,"core.category")),A.lc(3),A.Vc("text",e.categoryPath)("contextInstanceId",e.event.categoryid)}}function AddonCalendarEventPage_ion_list_23_ion_item_29_Template(e,t){if(1&e&&(A.Ec(0,"ion-item",32),A.Ec(1,"ion-label"),A.Ec(2,"h2"),A.pd(3),A.Pc(4,"translate"),A.Dc(),A.Ec(5,"p"),A.zc(6,"core-format-text",14),A.Dc(),A.Dc(),A.Dc()),2&e){const e=A.Oc(2);A.lc(3),A.qd(A.Qc(4,4,"core.description")),A.lc(3),A.Vc("text",e.event.description)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_23_ion_item_30_Template(e,t){if(1&e&&(A.Ec(0,"ion-item",32),A.Ec(1,"ion-label"),A.Ec(2,"h2"),A.pd(3),A.Pc(4,"translate"),A.Dc(),A.Ec(5,"p"),A.Ec(6,"a",34),A.zc(7,"core-format-text",14),A.Dc(),A.Dc(),A.Dc(),A.Dc()),2&e){const e=A.Oc(2);A.lc(3),A.qd(A.Qc(4,5,"core.location")),A.lc(3),A.Vc("href",e.event.encodedLocation,A.id),A.lc(1),A.Vc("text",e.event.location)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_23_ion_item_31_Template(e,t){if(1&e&&(A.Ec(0,"ion-item"),A.Ec(1,"ion-label"),A.Ec(2,"ion-button",35),A.pd(3),A.Pc(4,"translate"),A.Dc(),A.Dc(),A.Dc()),2&e){const e=A.Oc(2);A.lc(2),A.Vc("href",e.moduleUrl),A.lc(1),A.rd(" ",A.Qc(4,2,"addon.calendar.gotoactivity")," ")}}const _c1=function(e){return[e]};function AddonCalendarEventPage_ion_list_23_Template(e,t){if(1&e&&(A.Ec(0,"ion-list"),A.Ec(1,"ion-item",17),A.nd(2,AddonCalendarEventPage_ion_list_23_core_mod_icon_2_Template,1,5,"core-mod-icon",18),A.nd(3,AddonCalendarEventPage_ion_list_23_ion_icon_3_Template,1,1,"ion-icon",19),A.Ec(4,"ion-label"),A.Ec(5,"span",20),A.pd(6),A.Pc(7,"translate"),A.nd(8,AddonCalendarEventPage_ion_list_23_span_8_Template,2,1,"span",21),A.Dc(),A.Ec(9,"h1"),A.zc(10,"core-format-text",14),A.Dc(),A.Dc(),A.Dc(),A.Ec(11,"ion-item"),A.Ec(12,"ion-label"),A.Ec(13,"h2"),A.pd(14),A.Pc(15,"translate"),A.Dc(),A.zc(16,"core-format-text",14),A.Dc(),A.nd(17,AddonCalendarEventPage_ion_list_23_ion_note_17_Template,4,3,"ion-note",22),A.Dc(),A.Ec(18,"ion-item"),A.Ec(19,"ion-label"),A.Ec(20,"h2"),A.pd(21),A.Pc(22,"translate"),A.Dc(),A.Ec(23,"p"),A.pd(24),A.Pc(25,"translate"),A.Dc(),A.Dc(),A.Dc(),A.nd(26,AddonCalendarEventPage_ion_list_23_ion_item_26_Template,7,6,"ion-item",23),A.nd(27,AddonCalendarEventPage_ion_list_23_ion_item_27_Template,7,4,"ion-item",24),A.nd(28,AddonCalendarEventPage_ion_list_23_ion_item_28_Template,7,5,"ion-item",25),A.nd(29,AddonCalendarEventPage_ion_list_23_ion_item_29_Template,7,6,"ion-item",25),A.nd(30,AddonCalendarEventPage_ion_list_23_ion_item_30_Template,8,7,"ion-item",25),A.nd(31,AddonCalendarEventPage_ion_list_23_ion_item_31_Template,5,4,"ion-item",3),A.Dc()),2&e){const e=A.Oc();A.lc(1),A.Vc("ngClass",A.ad(29,_c1,"addon-calendar-eventtype-"+e.event.eventtype)),A.lc(1),A.Vc("ngIf",e.event.moduleIcon),A.lc(1),A.Vc("ngIf",e.event.eventIcon&&!e.event.moduleIcon),A.lc(3),A.rd(" ",A.Qc(7,21,"addon.calendar.type"+e.event.formattedType)," "),A.lc(2),A.Vc("ngIf",e.event.moduleIcon&&e.event.iconTitle),A.lc(2),A.Vc("text",e.event.name)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId),A.lc(4),A.qd(A.Qc(15,23,"addon.calendar.when")),A.lc(2),A.Vc("text",e.event.formattedtime)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId),A.lc(1),A.Vc("ngIf",e.event.deleted),A.lc(4),A.qd(A.Qc(22,25,"addon.calendar.eventtype")),A.lc(3),A.qd(A.Qc(25,27,"addon.calendar.type"+e.event.formattedType)),A.lc(2),A.Vc("ngIf",e.courseName),A.lc(1),A.Vc("ngIf",e.groupName),A.lc(1),A.Vc("ngIf",e.categoryPath),A.lc(1),A.Vc("ngIf",e.event.description),A.lc(1),A.Vc("ngIf",e.event.location),A.lc(1),A.Vc("ngIf",e.moduleUrl)}}function AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_p_4_Template(e,t){if(1&e&&(A.Ec(0,"p"),A.pd(1),A.Dc()),2&e){const e=A.Oc(2).$implicit;A.lc(1),A.qd(e.sublabel)}}function AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_Template(e,t){if(1&e){const e=A.Fc();A.Ec(0,"ion-item",32),A.Ec(1,"ion-label"),A.Ec(2,"p",38),A.pd(3),A.Dc(),A.nd(4,AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_p_4_Template,2,1,"p",3),A.Dc(),A.Ec(5,"ion-button",39),A.Mc("click",(function AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_Template_ion_button_click_5_listener(t){A.fd(e);const n=A.Oc().$implicit;return A.Oc(2).cancelNotification(n.id,t)})),A.Pc(6,"translate"),A.zc(7,"ion-icon",40),A.Dc(),A.Dc()}if(2&e){const e=A.Oc().$implicit,t=A.Oc(2);A.qc("item-dimmed",e.timestamp<=t.currentTime),A.lc(3),A.qd(e.label),A.lc(1),A.Vc("ngIf",e.sublabel),A.lc(1),A.mc("aria-label",A.Qc(6,5,"core.delete"))}}function AddonCalendarEventPage_ion_card_24_ng_container_6_Template(e,t){if(1&e&&(A.Cc(0),A.nd(1,AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_Template,8,7,"ion-item",37),A.Bc()),2&e){const e=t.$implicit;A.lc(1),A.Vc("ngIf",e.timestamp>0)}}function AddonCalendarEventPage_ion_card_24_ng_container_7_Template(e,t){if(1&e){const e=A.Fc();A.Cc(0),A.Ec(1,"ion-item"),A.Ec(2,"ion-label"),A.Ec(3,"ion-button",41),A.Mc("click",(function AddonCalendarEventPage_ion_card_24_ng_container_7_Template_ion_button_click_3_listener(){A.fd(e);return A.Oc(2).addReminder()})),A.pd(4),A.Pc(5,"translate"),A.Dc(),A.Dc(),A.Dc(),A.Bc()}2&e&&(A.lc(4),A.rd(" ",A.Qc(5,1,"addon.calendar.setnewreminder")," "))}function AddonCalendarEventPage_ion_card_24_Template(e,t){if(1&e&&(A.Ec(0,"ion-card"),A.Ec(1,"ion-item"),A.Ec(2,"ion-label"),A.Ec(3,"h2"),A.pd(4),A.Pc(5,"translate"),A.Dc(),A.Dc(),A.Dc(),A.nd(6,AddonCalendarEventPage_ion_card_24_ng_container_6_Template,2,1,"ng-container",36),A.nd(7,AddonCalendarEventPage_ion_card_24_ng_container_7_Template,6,3,"ng-container",3),A.Dc()),2&e){const e=A.Oc();A.lc(4),A.qd(A.Qc(5,3,"addon.calendar.reminders")),A.lc(2),A.Vc("ngForOf",e.reminders),A.lc(1),A.Vc("ngIf",e.event.timestart>e.currentTime)}}let F=(()=>{class AddonCalendarEventPage{constructor(e){this.route=e,this.eventLoaded=!1,this.courseName="",this.courseUrl="",this.notificationsEnabled=!1,this.moduleUrl="",this.categoryPath="",this.currentTime=-1,this.reminders=[],this.canEdit=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=y.a.ICON_LOADING,this.notificationsEnabled=g.a.isAvailable(),this.siteHomeId=u.b.getCurrentSiteHomeId(),this.currentSiteId=u.b.getCurrentSiteId(),this.canEdit=d.a.canEditEventsInSite(),this.editEventObserver=_.b.on(d.c.EDIT_EVENT_EVENT,(e=>{e&&e.eventId===this.eventId&&(this.eventLoaded=!1,this.refreshEvent(!0,!1))}),this.currentSiteId),this.newEventObserver=_.b.on(d.c.NEW_EVENT_EVENT,(e=>{this.eventId<0&&e&&(e.eventId===this.eventId||e.oldEventId===this.eventId)&&(this.eventId=e.eventId,this.eventLoaded=!1,this.refreshEvent(!0,!1))}),this.currentSiteId),this.syncObserver=_.b.on(s.b.AUTO_SYNCED,this.checkSyncResult.bind(this,!1),this.currentSiteId),this.manualSyncObserver=_.b.on(s.b.MANUAL_SYNCED,this.checkSyncResult.bind(this,!0),this.currentSiteId),this.onlineObserver=v.a.onChange().subscribe((()=>{I.A.run((()=>{this.isOnline=v.a.isOnline()}))})),this.defaultTimeChangedObserver=_.b.on(d.c.DEFAULT_NOTIFICATION_TIME_CHANGED,(()=>{this.loadReminders()}),this.currentSiteId),this.currentTime=p.a.timestamp(),this.updateCurrentTime=window.setInterval((()=>{this.currentTime=p.a.timestamp()}),5e3)}loadReminders(){return Object(c.a)(this,void 0,void 0,(function*(){if(!this.notificationsEnabled||!this.event)return;const e=yield d.a.getEventReminders(this.eventId,this.currentSiteId);this.reminders=yield r.b.formatReminders(e,this.event.timestart,this.currentSiteId)}))}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){try{this.eventId=b.a.getRequiredRouteNumberParam("id")}catch(e){return h.a.showErrorModal(e),b.a.back(),void 0}this.syncIcon=y.a.ICON_LOADING,yield this.initializeSwipeManager(),yield this.fetchEvent()}))}fetchEvent(e=!1,t=!1){return Object(c.a)(this,void 0,void 0,(function*(){if(this.isOnline=v.a.isOnline(),e){if(yield this.syncEvents(t))return}try{if(this.eventId>=0){const e=yield d.a.getEventById(this.eventId);this.event=r.b.formatEventData(e)}try{const e=r.b.formatOfflineEventData(yield l.a.getEvent(this.eventId));this.hasOffline=!0,this.event=Object.assign(this.event||{},e)}catch(e){if(this.hasOffline=!1,this.eventId<0)return h.a.showErrorModal("Event not found."),b.a.back(),void 0}if(!this.event)return;if(this.loadReminders(),this.categoryPath="",this.courseName="",this.courseUrl="",this.moduleUrl="",this.event.moduleIcon){const e=f.a.translateModuleName(this.event.modulename||"");-1===e.indexOf("core.mod_")&&(this.event.modulename=e),this.moduleUrl=this.event.url||""}const e=[],t=this.event,n=this.event.courseid;n!=this.siteHomeId&&this.event.course&&(this.courseId=this.event.course.id,this.courseName=this.event.course.fullname,this.courseUrl=this.event.course.viewurl),n&&this.event.groupid&&e.push(this.loadGroupName(this.event,n)),this.event.iscategoryevent&&this.event.category&&(this.categoryPath=this.event.category.nestedname),this.event.location&&(this.event.location=m.a.decodeHTML(this.event.location),this.event.encodedLocation=m.a.buildAddressURL(this.event.location)),e.push(l.a.isEventDeleted(this.eventId).then((e=>{t.deleted=e}))),e.push(d.a.getCalendarTimeFormat().then((e=>Object(c.a)(this,void 0,void 0,(function*(){t.formattedtime=yield d.a.formatEventTime(t,e)}))))),yield Promise.all(e)}catch(e){h.a.showErrorModalDefault(e,"addon.calendar.errorloadevent",!0)}this.eventLoaded=!0,this.syncIcon=y.a.ICON_SYNC}))}initializeSwipeManager(){return Object(c.a)(this,void 0,void 0,(function*(){const e=b.a.getRouteParam("date"),t=e&&O.a.getSource(D.a,[e]);t&&(this.events=new event_page_AddonCalendarEventsSwipeItemsManager(t),yield this.events.start())}))}syncEvents(e=!1){return Object(c.a)(this,void 0,void 0,(function*(){let t=!1;try{const e=yield s.a.syncEvents();e.warnings&&e.warnings.length&&h.a.showErrorModal(e.warnings[0]),e.deleted&&-1!=e.deleted.indexOf(this.eventId)?t=!0:this.eventId<0&&e.offlineIdMap[this.eventId]&&(this.eventId=e.offlineIdMap[this.eventId]),e.updated&&(e.source="event",_.b.trigger(s.b.MANUAL_SYNCED,e,this.currentSiteId))}catch(t){e&&h.a.showErrorModalDefault(t,"core.errorsync",!0)}return t}))}loadGroupName(e,t){return Object(c.a)(this,void 0,void 0,(function*(){try{const n=(yield E.a.getUserGroupsInCourse(t)).find((t=>t.id==e.groupid));this.groupName=n?n.name:""}catch(e){this.groupName=""}}))}addReminder(){return Object(c.a)(this,void 0,void 0,(function*(){if(!this.event||!this.event.id)return;const e=yield h.a.openModal({component:P.a});void 0!==e&&(yield d.a.addEventReminder(this.event,e,this.currentSiteId),yield this.loadReminders())}))}cancelNotification(e,t){return Object(c.a)(this,void 0,void 0,(function*(){t.preventDefault(),t.stopPropagation();try{yield h.a.showDeleteConfirm();const t=yield h.a.showModalLoading("core.deleting",!0);try{yield d.a.deleteEventReminder(e),yield this.loadReminders()}catch(e){h.a.showErrorModalDefault(e,"Error deleting reminder")}finally{t.dismiss()}}catch(e){}}))}doRefresh(e,t,n=!1){return Object(c.a)(this,void 0,void 0,(function*(){this.eventLoaded&&(yield this.refreshEvent(!0,n).finally((()=>{null==e?void 0:e.complete(),t&&t()})))}))}refreshEvent(e=!1,t=!1){return Object(c.a)(this,void 0,void 0,(function*(){this.syncIcon=y.a.ICON_LOADING;const n=[];this.eventId>0&&n.push(d.a.invalidateEvent(this.eventId)),n.push(d.a.invalidateTimeFormat()),yield C.a.allPromisesIgnoringErrors(n),yield this.fetchEvent(e,t)}))}openEdit(){b.a.navigateToSitePath(`/calendar/edit/${this.eventId}`)}deleteEvent(){return Object(c.a)(this,void 0,void 0,(function*(){if(!this.event)return;const e=I.J.instant("addon.calendar.deleteevent"),t={};let n;this.event.eventcount>1?(n=I.J.instant("addon.calendar.confirmeventseriesdelete",{$a:{name:this.event.name,count:this.event.eventcount}}),t.inputs=[{type:"radio",name:"deleteall",checked:!0,value:!1,label:I.J.instant("addon.calendar.deleteoneevent")},{type:"radio",name:"deleteall",checked:!1,value:!0,label:I.J.instant("addon.calendar.deleteallevents")}]):n=I.J.instant("addon.calendar.confirmeventdelete",{$a:this.event.name});let i=!1;try{i=yield h.a.showConfirm(n,e,void 0,void 0,t)}catch(e){return}const a=yield h.a.showModalLoading("core.sending",!0);try{let e=!1;if(this.event.id<0?yield l.a.deleteEvent(this.event.id):e=yield d.a.deleteEvent(this.event.id,this.event.name,i),e)try{yield r.b.refreshAfterChangeEvent(this.event,i?this.event.eventcount:1)}catch(e){}this.event.id<0?_.b.trigger(d.c.NEW_EVENT_DISCARDED_EVENT,{},u.b.getCurrentSiteId()):_.b.trigger(d.c.DELETED_EVENT_EVENT,{eventId:this.eventId,sent:e},u.b.getCurrentSiteId()),e||this.event.id<0?(h.a.showToast("addon.calendar.eventcalendareventdeleted",!0,h.c.LONG),b.a.back()):this.event.deleted=!0}catch(e){h.a.showErrorModalDefault(e,"Error deleting event.")}a.dismiss()}))}undoDelete(){return Object(c.a)(this,void 0,void 0,(function*(){if(!this.event)return;const e=yield h.a.showModalLoading("core.sending",!0);try{yield l.a.unmarkDeleted(this.event.id),_.b.trigger(d.c.UNDELETED_EVENT_EVENT,{eventId:this.eventId},u.b.getCurrentSiteId()),this.event.deleted=!1}catch(e){h.a.showErrorModalDefault(e,"Error undeleting event.")}e.dismiss()}))}checkSyncResult(e,t){if(t)if(t.deleted&&-1!=t.deleted.indexOf(this.eventId))h.a.showToast("addon.calendar.eventcalendareventdeleted",!0,h.c.LONG),b.a.back();else if(t.events&&(!e||"event"!=t.source))if(this.eventId<0)t.offlineIdMap[this.eventId]&&(this.eventId=t.offlineIdMap[this.eventId],this.eventLoaded=!1,this.refreshEvent());else{t.events.find((e=>e.id==this.eventId))&&(this.eventLoaded=!1,this.refreshEvent())}}ngOnDestroy(){var e;this.editEventObserver.off(),this.syncObserver.off(),this.manualSyncObserver.off(),this.onlineObserver.unsubscribe(),this.newEventObserver.off(),null===(e=this.events)||void 0===e||e.destroy(),clearInterval(this.updateCurrentTime)}}return AddonCalendarEventPage.ɵfac=function AddonCalendarEventPage_Factory(e){return new(e||AddonCalendarEventPage)(A.yc(i.a))},AddonCalendarEventPage.ɵcmp=A.sc({type:AddonCalendarEventPage,selectors:[["page-addon-calendar-event"]],decls:25,vars:35,consts:[["collapsible",""],["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["iconAction","fas-edit",3,"hidden","priority","content","action"],["iconAction","fas-trash",3,"hidden","priority","content","action"],["iconAction","fas-undo-alt",3,"hidden","priority","content","action"],[3,"core-swipe-navigation"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],[3,"text","contextLevel","contextInstanceId"],[1,"core-warning-card"],["name","fas-exclamation-triangle","slot","start","aria-hidden","true"],["collapsible","",1,"ion-text-wrap","addon-calendar-event",3,"ngClass"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose",4,"ngIf"],["aria-hidden","true","slot","start",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],["slot","end",4,"ngIf"],["class","ion-text-wrap","core-link","","capture","true",3,"href",4,"ngIf"],["class","ion-text-wrap core-groupname",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose"],["aria-hidden","true","slot","start",3,"name"],["name","fas-trash","aria-hidden","true"],["core-link","","capture","true",1,"ion-text-wrap",3,"href"],["contextLevel","course",3,"text","contextInstanceId"],[1,"ion-text-wrap","core-groupname"],[1,"ion-text-wrap"],["contextLevel","coursecat",3,"text","contextInstanceId"],["core-link","","auto-login","no",3,"href"],["expand","block","core-link","","capture","true",3,"href"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",3,"item-dimmed",4,"ngIf"],[1,"item-heading"],["fill","clear","slot","end",3,"click"],["name","fas-trash","color","danger","slot","icon-only","aria-hidden","true"],["expand","block",3,"click"]],template:function AddonCalendarEventPage_Template(e,t){1&e&&(A.Ec(0,"ion-header",0),A.Ec(1,"ion-toolbar"),A.Ec(2,"ion-buttons",1),A.zc(3,"ion-back-button",2),A.Pc(4,"translate"),A.Dc(),A.Ec(5,"ion-title"),A.nd(6,AddonCalendarEventPage_h1_6_Template,2,3,"h1",3),A.Dc(),A.Ec(7,"ion-buttons",4),A.Ec(8,"core-context-menu"),A.Ec(9,"core-context-menu-item",5),A.Mc("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_9_listener(e){return t.doRefresh(void 0,e,!0)})),A.Pc(10,"translate"),A.Dc(),A.Ec(11,"core-context-menu-item",6),A.Mc("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_11_listener(){return t.openEdit()})),A.Pc(12,"translate"),A.Dc(),A.Ec(13,"core-context-menu-item",7),A.Mc("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_13_listener(){return t.deleteEvent()})),A.Pc(14,"translate"),A.Dc(),A.Ec(15,"core-context-menu-item",8),A.Mc("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_15_listener(){return t.undoDelete()})),A.Pc(16,"translate"),A.Dc(),A.Dc(),A.Dc(),A.Dc(),A.Dc(),A.Ec(17,"ion-content",9),A.Ec(18,"ion-refresher",10),A.Mc("ionRefresh",(function AddonCalendarEventPage_Template_ion_refresher_ionRefresh_18_listener(e){return t.doRefresh(e.target)})),A.zc(19,"ion-refresher-content",11),A.Pc(20,"translate"),A.Dc(),A.Ec(21,"core-loading",12),A.nd(22,AddonCalendarEventPage_ion_card_22_Template,7,8,"ion-card",13),A.nd(23,AddonCalendarEventPage_ion_list_23_Template,32,31,"ion-list",3),A.nd(24,AddonCalendarEventPage_ion_card_24_Template,8,5,"ion-card",3),A.Dc(),A.Dc()),2&e&&(A.lc(3),A.Vc("text",A.Qc(4,23,"core.back")),A.lc(3),A.Vc("ngIf",t.event),A.lc(3),A.Vc("hidden",!t.eventLoaded||!t.hasOffline&&t.event&&!t.event.deleted||!t.isOnline)("priority",400)("content",A.Qc(10,25,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),A.lc(2),A.Vc("hidden",!t.event||!t.event.canedit||t.event.deleted||!t.canEdit&&t.event.id>0)("priority",300)("content",A.Qc(12,27,"core.edit")),A.lc(2),A.Vc("hidden",!t.event||!t.event.candelete||t.event.deleted)("priority",200)("content",A.Qc(14,29,"core.delete")),A.lc(2),A.Vc("hidden",!t.event||!t.event.deleted)("priority",200)("content",A.Qc(16,31,"core.restore")),A.lc(2),A.Vc("core-swipe-navigation",t.events),A.lc(1),A.Vc("disabled",!t.eventLoaded),A.lc(1),A.Wc("pullingText",A.Qc(20,33,"core.pulltorefresh")),A.lc(2),A.Vc("hideUntil",t.eventLoaded),A.lc(1),A.Vc("ngIf",t.hasOffline||t.event&&t.event.deleted),A.lc(1),A.Vc("ngIf",t.event),A.lc(1),A.Vc("ngIf",t.notificationsEnabled&&t.event))},directives:[x.C,M.b,x.Ab,x.m,x.h,x.i,x.yb,w.t,N.a,V.a,S.a,x.v,L.a,x.bb,x.cb,k.a,R.a,x.n,x.I,x.D,j.a,x.O,x.P,w.q,Q.a,x.W,U.a,z.a,x.l,w.s],pipes:[q.d],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color:var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical:12px;--margin-end:12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-right:var(--margin-end)}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:var(--margin-end);margin-inline-end:var(--margin-end)}}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}","[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:1.6rem}"]}),AddonCalendarEventPage})();class event_page_AddonCalendarEventsSwipeItemsManager extends T.a{getSelectedItemPathFromRoute(e){return e.params.id}}const G=[{path:"",component:F}];let B=(()=>{class AddonCalendarEventPageModule{}return AddonCalendarEventPageModule.ɵmod=A.wc({type:AddonCalendarEventPageModule}),AddonCalendarEventPageModule.ɵinj=A.vc({factory:function AddonCalendarEventPageModule_Factory(e){return new(e||AddonCalendarEventPageModule)},imports:[[i.m.forChild(G),a.a,o.a],i.m]}),AddonCalendarEventPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&A.kd(B,{declarations:[F],imports:[i.m,a.a,o.a],exports:[i.m]}))},eoiU:function(e,t,n){"use strict";n.d(t,"a",(function(){return CoreSwipeNavigationItemsManager}));var i=n("mrSG"),a=n("pHTc"),o=n("CtbY");class CoreSwipeNavigationItemsManager extends o.a{start(){return Object(i.a)(this,void 0,void 0,(function*(){this.updateSelectedItem()}))}navigateToNextItem(){return Object(i.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(1,"forward")}))}navigateToPreviousItem(){return Object(i.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(-1,"back")}))}hasNextItem(){return Object(i.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(1))}))}hasPreviousItem(){return Object(i.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(-1))}))}getCurrentPageRoute(){return a.a.getCurrentRoute()}getSelectedItemPathFromRoute(e){const t=[];for(;e&&(t.push(...e.url),e.firstChild);)e=e.firstChild;return t.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const n=yield this.getItemBy(e);n&&(yield this.navigateToItem(n,{animationDirection:t,replace:!0}))}))}getItemBy(e){var t;return Object(i.a)(this,void 0,void 0,(function*(){const n=this.getSource().getItems(),i=null!==(t=this.selectedItem&&(null==n?void 0:n.indexOf(this.selectedItem)))&&void 0!==t?t:-1;if(-1===i||null===n)return null;const a=e>0?1:-1;let o=i,c=0;for(;c!==e&&(o+=a,!(o<0||o>=n.length));)this.skipItemInSwipe(n[o])||(c+=a);return c===e?n[o]:this.getSource().isCompleted()?null:(yield this.getSource().load(),this.getItemBy(e))}))}skipItemInSwipe(e){return!1}}}}]);