(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{twN0:function(e,n,t){"use strict";t.r(n),t.d(n,"AddonMessagesGroupConversationsPageModule",(function(){return Y}));var s=t("tyNb"),o=t("vY5A"),a=t("muSn"),i=t("Y+03"),r=t("L3Fv"),d=t("mrSG"),c=t("TEn/"),l=t("fjkH"),g=t("9+EE"),u=t("KMk0"),_=t("nopL"),p=t("3LXp"),m=t("4pns"),v=t("2eZG"),f=t("j3ag"),h=t("bFG1"),C=t("pHTc"),M=t("YyYz"),P=t("r2Z7"),O=t("fXoL"),b=t("ACYt"),E=t("3CSS"),A=t("C1x5"),T=t("nt/U"),x=t("46ml"),I=t("PgjG"),G=t("ofXK"),D=t("xpMl"),y=t("hMzs"),V=t("NcPy"),k=t("FeAf"),w=t("sYmb"),N=t("Cg42");const S=["favlist"],L=["grouplist"],R=["indlist"];function AddonMessagesGroupConversationsPage_ion_badge_30_Template(e,n){if(1&e&&(O.Ec(0,"ion-badge",29),O.pd(1),O.Dc()),2&e){const e=O.Oc();O.lc(1),O.qd(e.contactRequestsCount)}}const _c3=function(e){return{$a:e}};function AddonMessagesGroupConversationsPage_span_31_Template(e,n){if(1&e&&(O.Ec(0,"span",30),O.pd(1),O.Pc(2,"translate"),O.Dc()),2&e){const e=O.Oc();O.lc(1),O.rd(" ",O.Rc(2,1,"addon.messages.pendingcontactrequests",O.ad(4,_c3,e.contactRequestsCount))," ")}}function AddonMessagesGroupConversationsPage_ion_badge_39_Template(e,n){if(1&e&&(O.Ec(0,"ion-badge",29),O.pd(1),O.Dc()),2&e){const e=O.Oc();O.lc(1),O.qd(e.favourites.unread)}}function AddonMessagesGroupConversationsPage_span_40_Template(e,n){if(1&e&&(O.Ec(0,"span",30),O.pd(1),O.Pc(2,"translate"),O.Dc()),2&e){const e=O.Oc();O.lc(1),O.rd(" ",O.Rc(2,1,"addon.messages.unreadconversations",O.ad(4,_c3,e.favourites.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_43_Template(e,n){1&e&&O.Ac(0)}function AddonMessagesGroupConversationsPage_ion_item_45_Template(e,n){1&e&&(O.Ec(0,"ion-item",31),O.Ec(1,"ion-label"),O.Ec(2,"p"),O.pd(3),O.Pc(4,"translate"),O.Dc(),O.Dc(),O.Dc()),2&e&&(O.lc(3),O.qd(O.Qc(4,1,"addon.messages.nofavourites")))}function AddonMessagesGroupConversationsPage_ion_item_46_Template(e,n){1&e&&(O.Ec(0,"ion-item",32),O.Ec(1,"ion-label"),O.zc(2,"ion-spinner"),O.Pc(3,"translate"),O.Dc(),O.Dc()),2&e&&(O.lc(2),O.mc("aria-label",O.Qc(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ion_badge_54_Template(e,n){if(1&e&&(O.Ec(0,"ion-badge",29),O.pd(1),O.Dc()),2&e){const e=O.Oc();O.lc(1),O.qd(e.group.unread)}}function AddonMessagesGroupConversationsPage_span_55_Template(e,n){if(1&e&&(O.Ec(0,"span",30),O.pd(1),O.Pc(2,"translate"),O.Dc()),2&e){const e=O.Oc();O.lc(1),O.rd(" ",O.Rc(2,1,"addon.messages.unreadconversations",O.ad(4,_c3,e.group.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_58_Template(e,n){1&e&&O.Ac(0)}function AddonMessagesGroupConversationsPage_ion_item_60_Template(e,n){1&e&&(O.Ec(0,"ion-item",31),O.Ec(1,"ion-label"),O.Ec(2,"p"),O.pd(3),O.Pc(4,"translate"),O.Dc(),O.Dc(),O.Dc()),2&e&&(O.lc(3),O.qd(O.Qc(4,1,"addon.messages.nogroupconversations")))}function AddonMessagesGroupConversationsPage_ion_item_61_Template(e,n){1&e&&(O.Ec(0,"ion-item",32),O.Ec(1,"ion-label"),O.zc(2,"ion-spinner"),O.Pc(3,"translate"),O.Dc(),O.Dc()),2&e&&(O.lc(2),O.mc("aria-label",O.Qc(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ion_badge_69_Template(e,n){if(1&e&&(O.Ec(0,"ion-badge",29),O.pd(1),O.Dc()),2&e){const e=O.Oc();O.lc(1),O.qd(e.individual.unread)}}function AddonMessagesGroupConversationsPage_span_70_Template(e,n){if(1&e&&(O.Ec(0,"span",30),O.pd(1),O.Pc(2,"translate"),O.Dc()),2&e){const e=O.Oc();O.lc(1),O.rd(" ",O.Rc(2,1,"addon.messages.unreadconversations",O.ad(4,_c3,e.individual.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_73_Template(e,n){1&e&&O.Ac(0)}function AddonMessagesGroupConversationsPage_ion_item_75_Template(e,n){1&e&&(O.Ec(0,"ion-item",31),O.Ec(1,"ion-label"),O.Ec(2,"p"),O.pd(3),O.Pc(4,"translate"),O.Dc(),O.Dc(),O.Dc()),2&e&&(O.lc(3),O.qd(O.Qc(4,1,"addon.messages.noindividualconversations")))}function AddonMessagesGroupConversationsPage_ion_item_76_Template(e,n){1&e&&(O.Ec(0,"ion-item",32),O.Ec(1,"ion-label"),O.zc(2,"ion-spinner"),O.Pc(3,"translate"),O.Dc(),O.Dc()),2&e&&(O.lc(2),O.mc("aria-label",O.Qc(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_avatar_1_Template(e,n){if(1&e&&(O.Ec(0,"ion-avatar",0),O.zc(1,"img",46),O.Dc()),2&e){const e=O.Oc().$implicit;O.lc(1),O.Vc("src",e.imageurl,O.id)("alt",e.name)}}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_core_user_avatar_2_Template(e,n){if(1&e&&O.zc(0,"core-user-avatar",47),2&e){const e=O.Oc().$implicit;O.Vc("user",e.otherUser)("linkProfile",!1)("checkOnline",e.showonlinestatus)}}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_icon_7_Template(e,n){1&e&&(O.zc(0,"ion-icon",48),O.Pc(1,"translate")),2&e&&O.Vc("title",O.Qc(1,1,"addon.messages.contactblocked"))}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_icon_8_Template(e,n){1&e&&(O.zc(0,"ion-icon",49),O.Pc(1,"translate")),2&e&&O.Vc("title",O.Qc(1,1,"addon.messages.mutedconversation"))}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_note_9_span_1_Template(e,n){if(1&e&&(O.Ec(0,"span",52),O.pd(1),O.Pc(2,"coreDateDayOrTime"),O.Dc()),2&e){const e=O.Oc(2).$implicit;O.lc(1),O.rd(" ",O.Qc(2,1,e.lastmessagedate)," ")}}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_note_9_ion_badge_2_Template(e,n){if(1&e&&(O.Ec(0,"ion-badge",53),O.pd(1),O.Dc()),2&e){const e=O.Oc(2).$implicit;O.lc(1),O.qd(e.unreadcount)}}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_note_9_span_3_Template(e,n){if(1&e&&(O.Ec(0,"span",30),O.pd(1),O.Pc(2,"translate"),O.Dc()),2&e){const e=O.Oc(2).$implicit;O.lc(1),O.rd(" ",O.Rc(2,1,"addon.messages.unreadmessages",O.ad(4,_c3,e.unreadcount))," ")}}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_note_9_Template(e,n){if(1&e&&(O.Ec(0,"ion-note"),O.nd(1,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_note_9_span_1_Template,3,3,"span",50),O.nd(2,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_note_9_ion_badge_2_Template,2,1,"ion-badge",51),O.nd(3,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_note_9_span_3_Template,3,6,"span",13),O.Dc()),2&e){const e=O.Oc().$implicit;O.lc(1),O.Vc("ngIf",e.lastmessagedate>0),O.lc(1),O.Vc("ngIf",e.unreadcount>0),O.lc(1),O.Vc("ngIf",e.unreadcount>0)}}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_p_10_Template(e,n){if(1&e&&(O.Ec(0,"p"),O.zc(1,"core-format-text",39),O.Dc()),2&e){const e=O.Oc().$implicit;O.lc(1),O.Vc("text",e.subname)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_span_12_Template(e,n){1&e&&(O.Ec(0,"span",54),O.pd(1),O.Pc(2,"translate"),O.Dc()),2&e&&(O.lc(1),O.rd(" ",O.Qc(2,1,"addon.messages.you")," "))}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_span_13_Template(e,n){if(1&e&&(O.Ec(0,"span",54),O.pd(1),O.Dc()),2&e){const e=O.Oc().$implicit;O.lc(1),O.qd(e.members[0].fullname+":")}}function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_Template(e,n){if(1&e){const e=O.Fc();O.Ec(0,"ion-item",34),O.Mc("click",(function AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_Template_ion_item_click_0_listener(){O.fd(e);const t=n.$implicit;return O.Oc(2).gotoConversation(t.id,t.userid)})),O.nd(1,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_avatar_1_Template,2,2,"ion-avatar",35),O.nd(2,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_core_user_avatar_2_Template,1,3,"core-user-avatar",36),O.Ec(3,"ion-label"),O.Ec(4,"div",37),O.Ec(5,"p",38),O.zc(6,"core-format-text",39),O.nd(7,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_icon_7_Template,2,3,"ion-icon",40),O.nd(8,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_icon_8_Template,2,3,"ion-icon",41),O.Dc(),O.nd(9,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_ion_note_9_Template,4,3,"ion-note",42),O.Dc(),O.nd(10,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_p_10_Template,2,2,"p",42),O.Ec(11,"p",43),O.nd(12,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_span_12_Template,3,3,"span",44),O.nd(13,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_span_13_Template,2,1,"span",44),O.zc(14,"core-format-text",45),O.Dc(),O.Dc(),O.Dc()}if(2&e){const e=n.$implicit,t=O.Oc(2);O.Xc("id","addon-message-conversation-",e.id?e.id:"user-"+e.userid,""),O.mc("aria-current",e.id&&e.id==t.selectedConversationId||e.userid&&e.userid==t.selectedUserId?"page":"false")("aria-label",e.name),O.lc(1),O.Vc("ngIf",e.type==t.typeGroup),O.lc(1),O.Vc("ngIf",e.type!=t.typeGroup),O.lc(4),O.Vc("text",e.name)("contextInstanceId",0),O.lc(1),O.Vc("ngIf",e.isblocked),O.lc(1),O.Vc("ngIf",e.ismuted),O.lc(1),O.Vc("ngIf",e.lastmessagedate>0||e.unreadcount),O.lc(1),O.Vc("ngIf",e.subname),O.lc(2),O.Vc("ngIf",e.sentfromcurrentuser),O.lc(1),O.Vc("ngIf",!e.sentfromcurrentuser&&e.type==t.typeGroup&&e.members[0]),O.lc(1),O.Vc("text",e.lastmessage)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_77_Template(e,n){if(1&e&&O.nd(0,AddonMessagesGroupConversationsPage_ng_template_77_ion_item_0_Template,15,15,"ion-item",33),2&e){O.Vc("ngForOf",n.conversations)}}const _c4=function(e){return{conversations:e}};let U=(()=>{class AddonMessagesGroupConversationsPage{constructor(e){this.route=e,this.loaded=!1,this.contactRequestsCount=0,this.favourites={type:void 0,favourites:!0,count:0,unread:0,conversations:[]},this.group={type:u.b.MESSAGE_CONVERSATION_TYPE_GROUP,favourites:!1,count:0,unread:0,conversations:[]},this.individual={type:u.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,favourites:!1,count:0,unread:0,conversations:[]},this.typeGroup=u.b.MESSAGE_CONVERSATION_TYPE_GROUP,this.loadingMessage=f.J.instant("core.loading"),this.siteId=g.b.getCurrentSiteId(),this.currentUserId=g.b.getCurrentSiteUserId(),this.newMessagesObserver=l.b.on(u.b.NEW_MESSAGE_EVENT,(e=>{var n;const t=this.getExpandedOption();if(t!=this.getConversationOption(e))return;const s=this.findConversation(e.conversationId,e.userId,t);if(void 0===s)return this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})),void 0;if(s.lastmessage!=e.message||s.lastmessagedate!=e.timecreated/1e3){const t=e.timecreated/1e3>(s.lastmessagedate||0);s.lastmessage=e.message,s.lastmessagedate=e.timecreated/1e3;const o=this.getConversationOption(s);o.conversations=u.a.sortConversations(o.conversations||[]),t&&(null===(n=this.content)||void 0===n||n.scrollToTop())}}),this.siteId),this.readChangedObserver=l.b.on(u.b.READ_CHANGED_EVENT,(e=>{if(e.conversationId){const n=this.findConversation(e.conversationId);void 0!==n&&(n.unreadcount=0,u.a.invalidateConversations(this.siteId),u.a.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.openConversationObserver=l.b.on(u.b.OPEN_CONVERSATION_EVENT,(e=>{(e.conversationId||e.userId)&&this.gotoConversation(e.conversationId,e.userId)}),this.siteId),this.appResumeSubscription=P.a.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})))})),this.updateConversationListObserver=l.b.on(u.b.UPDATE_CONVERSATION_LIST_EVENT,(e=>{if(e&&"mute"==e.action){const n=this.getExpandedOption();if(n&&n.conversations){const t=this.findConversation(e.conversationId,void 0,n);t&&(t.ismuted=!!e.value)}}else this.refreshData()}),this.siteId),this.pushObserver=v.a.on("receive").subscribe((e=>{h.a.isFalseOrZero(e.notif)&&e.site==this.siteId&&this.refreshData(void 0,!1)})),this.cronObserver=l.b.on(u.b.UNREAD_CONVERSATION_COUNTS_EVENT,(e=>{this.favourites.unread=e.favourites,this.individual.unread=e.individual+e.self,this.group.unread=e.group}),this.siteId),this.contactRequestsCountObserver=l.b.on(u.b.CONTACT_REQUESTS_COUNT_EVENT,(e=>{this.contactRequestsCount=e.count}),this.siteId),this.memberInfoObserver=l.b.on(u.b.MEMBER_INFO_CHANGED_EVENT,(e=>{if(!e.userBlocked&&!e.userUnblocked)return;const n=this.getExpandedOption();if(n==this.individual||n==this.favourites){if(!n.conversations||n.conversations.length<=0)return;const t=this.findConversation(void 0,e.userId,n);t&&(t.isblocked=e.userBlocked)}}),this.siteId)}ngOnInit(){return Object(d.a)(this,void 0,void 0,(function*(){this.route.queryParams.subscribe((e=>Object(d.a)(this,void 0,void 0,(function*(){const n=C.a.getRouteNumberParam("conversationId",{params:e}),t=C.a.getRouteNumberParam("userId",{params:e});(n||t)&&(this.selectedConversationId=n,this.selectedUserId=t)}))));const e=new M.a;if(yield this.fetchData(),!this.selectedConversationId&&!this.selectedUserId&&i.a.isTablet){let e;const n=this.getExpandedOption();n&&n.conversations.length&&(e=n.conversations[0],e&&(yield this.gotoConversation(e.id)))}e.treatLink()}))}fetchData(e=!0){return Object(d.a)(this,void 0,void 0,(function*(){const n=[];n.push(this.fetchConversationCounts()),n.push(u.a.getContactRequestsCount(this.siteId)),e&&n.push(u.a.refreshUnreadConversationCounts(this.siteId));try{if(yield Promise.all(n),void 0===this.favourites.expanded&&(this.selectedConversationId||this.selectedUserId)){const e=[];e.push(this.fetchDataForOption(this.favourites,!1)),e.push(this.fetchDataForOption(this.group,!1)),e.push(this.fetchDataForOption(this.individual,!1)),yield Promise.all(e);const n=this.findConversation(this.selectedConversationId,this.selectedUserId);if(n){const e=this.getConversationOption(n);return yield this.expandOption(e),this.loaded=!0,void 0}}yield this.fetchDataForExpandedOption()}catch(e){p.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}this.loaded=!0}))}fetchDataForExpandedOption(){return Object(d.a)(this,void 0,void 0,(function*(){void 0===this.favourites.expanded&&(this.favourites.expanded=0!=this.favourites.count&&!this.group.unread&&!this.individual.unread,this.group.expanded=!this.favourites.expanded&&0!=this.group.count&&!this.individual.unread,this.individual.expanded=!this.favourites.expanded&&!this.group.expanded),this.loadCurrentListElement();const e=this.getExpandedOption();e&&(yield this.fetchDataForOption(e,!1))}))}fetchDataForOption(e,n=!1,t=!1){return Object(d.a)(this,void 0,void 0,(function*(){e.loadMoreError=!1;const s=n?e.conversations.length:0,o=[];let a={conversations:[],canLoadMore:!1},i=[];o.push(u.a.invalidateConversations(this.siteId).then((()=>Object(d.a)(this,void 0,void 0,(function*(){a=yield u.a.getConversations(e.type,e.favourites,s,this.siteId)}))))),n||o.push(_.a.getAllMessages().then((e=>{i=e}))),t&&(o.push(this.fetchConversationCounts()),o.push(u.a.refreshUnreadConversationCounts(this.siteId))),yield Promise.all(o),n?(e.conversations=e.conversations.concat(a.conversations),e.canLoadMore=a.canLoadMore):(e.conversations=a.conversations,e.canLoadMore=a.canLoadMore,i&&i.length&&(yield this.loadOfflineMessages(e,i),e.conversations=u.a.sortConversations(e.conversations)))}))}fetchConversationCounts(){return Object(d.a)(this,void 0,void 0,(function*(){yield u.a.invalidateConversationCounts(this.siteId);const e=yield u.a.getConversationCounts(this.siteId);this.favourites.count=e.favourites,this.individual.count=e.individual+e.self,this.group.count=e.group}))}findConversation(e,n,t){if(e){return(t?t.conversations:this.favourites.conversations.concat(this.group.conversations).concat(this.individual.conversations)).find((n=>n.id==e))}return(t?t.conversations:this.favourites.conversations.concat(this.individual.conversations)).find((e=>e.userid==n))}getExpandedOption(){return this.favourites.expanded?this.favourites:this.group.expanded?this.group:this.individual.expanded?this.individual:void 0}gotoContacts(){C.a.navigateToSitePath("contacts")}gotoConversation(e,n,t){return Object(d.a)(this,void 0,void 0,(function*(){this.selectedConversationId=e,this.selectedUserId=n;const s={};e&&(s.conversationId=e),n&&(s.userId=n),t&&(s.message=t);const o=(C.a.isCurrentPathInTablet("**/messages/group-conversations/discussion")?"../":"")+"discussion";yield C.a.navigate(o,{params:s})}))}gotoSettings(){C.a.navigateToSitePath("../message-settings")}loadMoreConversations(e,n){return Object(d.a)(this,void 0,void 0,(function*(){try{yield this.fetchDataForOption(e,!0)}catch(n){p.a.showErrorModalDefault(n,"addon.messages.errorwhileretrievingdiscussions",!0),e.loadMoreError=!0}n&&n()}))}loadOfflineMessages(e,n){return Object(d.a)(this,void 0,void 0,(function*(){const t=[];n.forEach((n=>{var s,o,a,i,r,d,c,l,g,_;if("conversationid"in n){let t=this.findConversation(n.conversationid,void 0,e);t?(null==t.lastmessage||!t.lastmessagepending||(t.lastmessagedate||0)<=n.timecreated/1e3)&&this.addLastOfflineMessage(t,n):(t={id:n.conversationid,type:(null===(s=n.conversation)||void 0===s?void 0:s.type)||u.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,membercount:(null===(o=n.conversation)||void 0===o?void 0:o.membercount)||0,ismuted:(null===(a=n.conversation)||void 0===a?void 0:a.ismuted)||!1,isfavourite:(null===(i=n.conversation)||void 0===i?void 0:i.isfavourite)||!1,isread:(null===(r=n.conversation)||void 0===r?void 0:r.isread)||!1,members:(null===(d=n.conversation)||void 0===d?void 0:d.members)||[],messages:(null===(c=n.conversation)||void 0===c?void 0:c.messages)||[],candeletemessagesforallusers:(null===(l=n.conversation)||void 0===l?void 0:l.candeletemessagesforallusers)||!1,userid:0,name:null===(g=n.conversation)||void 0===g?void 0:g.name,imageurl:(null===(_=n.conversation)||void 0===_?void 0:_.imageurl)||""},this.getConversationOption(t)==e&&(this.addLastOfflineMessage(t,n),this.addOfflineConversation(t)))}else if(e.type==u.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL){const s=this.findConversation(void 0,n.touserid,e);n.text=n.smallmessage,s?(s.lastmessagedate||0)<=n.timecreated/1e3&&this.addLastOfflineMessage(s,n):t.push(m.a.getProfile(n.touserid,void 0,!0).catch((()=>{})).then((e=>{const t={id:0,type:u.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,membercount:0,ismuted:!1,isfavourite:!1,isread:!1,members:[],messages:[],candeletemessagesforallusers:!1,userid:n.touserid,name:e?e.fullname:String(n.touserid),imageurl:e?e.profileimageurl:""};this.addLastOfflineMessage(t,n),this.addOfflineConversation(t)})))}})),yield Promise.all(t)}))}addOfflineConversation(e){this.getConversationOption(e).conversations.unshift(e)}addLastOfflineMessage(e,n){e.lastmessage=n.text,e.lastmessagedate=n.timecreated/1e3,e.lastmessagepending=!0,e.sentfromcurrentuser=!0}getConversationOption(e){return e.isfavourite?this.favourites:e.type==u.b.MESSAGE_CONVERSATION_TYPE_GROUP?this.group:this.individual}refreshData(e,n=!0){return Object(d.a)(this,void 0,void 0,(function*(){try{yield u.a.invalidateContactRequestsCountCache(this.siteId)}finally{try{yield this.fetchData(n)}finally{e&&(null==e?void 0:e.complete())}}}))}toggle(e){e.expanded?(e.expanded=!1,this.loadCurrentListElement()):this.expandOption(e,!0).catch((e=>{p.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}))}expandOption(e,n=!1){return Object(d.a)(this,void 0,void 0,(function*(){this.favourites.expanded=!1,this.group.expanded=!1,this.individual.expanded=!1,e.expanded=!0,e.loading=!0;try{yield this.fetchDataForOption(e,!1,n),this.loadCurrentListElement()}catch(n){throw e.expanded=!1,n}finally{e.loading=!1}}))}loadCurrentListElement(){this.currentListEl=this.favourites.expanded?this.favListEl&&this.favListEl.nativeElement:this.group.expanded?this.groupListEl&&this.groupListEl.nativeElement:this.individual.expanded?this.indListEl&&this.indListEl.nativeElement:void 0}gotoSearch(){C.a.navigateToSitePath("search")}ngOnDestroy(){var e,n,t,s,o,a,i,r,d;null===(e=this.newMessagesObserver)||void 0===e?void 0:e.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe(),null===(t=this.pushObserver)||void 0===t||t.unsubscribe(),null===(s=this.readChangedObserver)||void 0===s||s.off(),null===(o=this.cronObserver)||void 0===o||o.off(),null===(a=this.openConversationObserver)||void 0===a||a.off(),null===(i=this.updateConversationListObserver)||void 0===i||i.off(),null===(r=this.contactRequestsCountObserver)||void 0===r||r.off(),null===(d=this.memberInfoObserver)||void 0===d||d.off()}}return AddonMessagesGroupConversationsPage.ɵfac=function AddonMessagesGroupConversationsPage_Factory(e){return new(e||AddonMessagesGroupConversationsPage)(O.yc(s.a))},AddonMessagesGroupConversationsPage.ɵcmp=O.sc({type:AddonMessagesGroupConversationsPage,selectors:[["page-addon-messages-group-conversations"]],viewQuery:function AddonMessagesGroupConversationsPage_Query(e,n){var t;(1&e&&(O.ud(c.v,!0),O.ud(S,!0),O.ud(L,!0),O.ud(R,!0)),2&e)&&(O.dd(t=O.Nc())&&(n.content=t.first),O.dd(t=O.Nc())&&(n.favListEl=t.first),O.dd(t=O.Nc())&&(n.groupListEl=t.first),O.dd(t=O.Nc())&&(n.indListEl=t.first))},decls:79,vars:86,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["name","fas-search","slot","icon-only","aria-hidden","true"],[3,"click"],["name","fas-cog","slot","icon-only","aria-hidden","true"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil","message"],["detail","true","button","",1,"ion-text-wrap","addon-message-discussion",3,"click"],["name","fas-address-book","slot","start","aria-hidden","true"],["slot","end","aria-hidden","true",4,"ngIf"],["class","sr-only",4,"ngIf"],["button","","sticky","true","aria-controls","addon-messages-groupconversations-favourite","role","heading","detail","false",1,"ion-text-wrap","divider",3,"click"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true",1,"expandable-status-icon"],["id","addon-messages-groupconversations-favourite",3,"hidden"],["favlist",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"enabled","error","action"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-center",4,"ngIf"],["button","","sticky","true","aria-controls","addon-messages-groupconversations-group","role","heading","detail","false",1,"divider","ion-text-wrap",3,"click"],["id","addon-messages-groupconversations-group",3,"hidden"],["grouplist",""],["button","","sticky","true","aria-controls","addon-messages-groupconversations-individual","role","heading","detail","false",1,"divider","ion-text-wrap",3,"click"],["id","addon-messages-groupconversations-individual",3,"hidden"],["indlist",""],["conversationsTemplate",""],["slot","end","aria-hidden","true"],[1,"sr-only"],[1,"ion-text-wrap"],[1,"ion-text-center"],["class","ion-text-wrap addon-message-discussion","button","","detail","false",3,"id","click",4,"ngFor","ngForOf"],["button","","detail","false",1,"ion-text-wrap","addon-message-discussion",3,"id","click"],["slot","start",4,"ngIf"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline",4,"ngIf"],[1,"flex-row","ion-justify-content-between"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash",3,"title",4,"ngIf"],["name","fas-volume-mute",3,"title",4,"ngIf"],[4,"ngIf"],[1,"addon-message-last-message"],["class","addon-message-last-message-user",4,"ngIf"],["clean","true","singleLine","true","contextLevel","system",1,"addon-message-last-message-text",3,"text","contextInstanceId"],["core-external-content","","onError","this.src='assets/img/group-avatar.svg'",3,"src","alt"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline"],["name","fas-user-slash",3,"title"],["name","fas-volume-mute",3,"title"],["class","addon-message-last-message-date",4,"ngIf"],["aria-label","true",4,"ngIf"],[1,"addon-message-last-message-date"],["aria-label","true"],[1,"addon-message-last-message-user"]],template:function AddonMessagesGroupConversationsPage_Template(e,n){if(1&e&&(O.Ec(0,"ion-header"),O.Ec(1,"ion-toolbar"),O.Ec(2,"ion-buttons",0),O.zc(3,"ion-back-button",1),O.Pc(4,"translate"),O.Dc(),O.Ec(5,"ion-title"),O.Ec(6,"h1"),O.pd(7),O.Pc(8,"translate"),O.Dc(),O.Dc(),O.Ec(9,"ion-buttons",2),O.Ec(10,"ion-button",3),O.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_10_listener(){return n.gotoSearch()})),O.Pc(11,"translate"),O.zc(12,"ion-icon",4),O.Dc(),O.Ec(13,"ion-button",5),O.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_13_listener(){return n.gotoSettings()})),O.Pc(14,"translate"),O.zc(15,"ion-icon",6),O.Dc(),O.zc(16,"core-user-menu-button"),O.Dc(),O.Dc(),O.Dc(),O.Ec(17,"ion-content"),O.Ec(18,"core-split-view"),O.Ec(19,"ion-refresher",7),O.Mc("ionRefresh",(function AddonMessagesGroupConversationsPage_Template_ion_refresher_ionRefresh_19_listener(e){return n.refreshData(e.target)})),O.zc(20,"ion-refresher-content",8),O.Pc(21,"translate"),O.Dc(),O.Ec(22,"core-loading",9),O.Ec(23,"ion-list"),O.Ec(24,"ion-item",10),O.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_24_listener(){return n.gotoContacts()})),O.zc(25,"ion-icon",11),O.Ec(26,"ion-label"),O.Ec(27,"h2"),O.pd(28),O.Pc(29,"translate"),O.Dc(),O.Dc(),O.nd(30,AddonMessagesGroupConversationsPage_ion_badge_30_Template,2,1,"ion-badge",12),O.nd(31,AddonMessagesGroupConversationsPage_span_31_Template,3,6,"span",13),O.Dc(),O.Ec(32,"ion-item",14),O.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_32_listener(){return n.toggle(n.favourites)})),O.Pc(33,"translate"),O.zc(34,"ion-icon",15),O.Ec(35,"ion-label"),O.Ec(36,"h2"),O.pd(37),O.Pc(38,"translate"),O.Dc(),O.Dc(),O.nd(39,AddonMessagesGroupConversationsPage_ion_badge_39_Template,2,1,"ion-badge",12),O.nd(40,AddonMessagesGroupConversationsPage_span_40_Template,3,6,"span",13),O.Dc(),O.Ec(41,"div",16,17),O.nd(43,AddonMessagesGroupConversationsPage_ng_container_43_Template,1,0,"ng-container",18),O.Ec(44,"core-infinite-loading",19),O.Mc("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_44_listener(e){return n.loadMoreConversations(n.favourites,e)})),O.Dc(),O.nd(45,AddonMessagesGroupConversationsPage_ion_item_45_Template,5,3,"ion-item",20),O.Dc(),O.nd(46,AddonMessagesGroupConversationsPage_ion_item_46_Template,4,3,"ion-item",21),O.Ec(47,"ion-item",22),O.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_47_listener(){return n.toggle(n.group)})),O.Pc(48,"translate"),O.zc(49,"ion-icon",15),O.Ec(50,"ion-label"),O.Ec(51,"h2"),O.pd(52),O.Pc(53,"translate"),O.Dc(),O.Dc(),O.nd(54,AddonMessagesGroupConversationsPage_ion_badge_54_Template,2,1,"ion-badge",12),O.nd(55,AddonMessagesGroupConversationsPage_span_55_Template,3,6,"span",13),O.Dc(),O.Ec(56,"div",23,24),O.nd(58,AddonMessagesGroupConversationsPage_ng_container_58_Template,1,0,"ng-container",18),O.Ec(59,"core-infinite-loading",19),O.Mc("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_59_listener(e){return n.loadMoreConversations(n.group,e)})),O.Dc(),O.nd(60,AddonMessagesGroupConversationsPage_ion_item_60_Template,5,3,"ion-item",20),O.Dc(),O.nd(61,AddonMessagesGroupConversationsPage_ion_item_61_Template,4,3,"ion-item",21),O.Ec(62,"ion-item",25),O.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_62_listener(){return n.toggle(n.individual)})),O.Pc(63,"translate"),O.zc(64,"ion-icon",15),O.Ec(65,"ion-label"),O.Ec(66,"h2"),O.pd(67),O.Pc(68,"translate"),O.Dc(),O.Dc(),O.nd(69,AddonMessagesGroupConversationsPage_ion_badge_69_Template,2,1,"ion-badge",12),O.nd(70,AddonMessagesGroupConversationsPage_span_70_Template,3,6,"span",13),O.Dc(),O.Ec(71,"div",26,27),O.nd(73,AddonMessagesGroupConversationsPage_ng_container_73_Template,1,0,"ng-container",18),O.Ec(74,"core-infinite-loading",19),O.Mc("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_74_listener(e){return n.loadMoreConversations(n.individual,e)})),O.Dc(),O.nd(75,AddonMessagesGroupConversationsPage_ion_item_75_Template,5,3,"ion-item",20),O.Dc(),O.nd(76,AddonMessagesGroupConversationsPage_ion_item_76_Template,4,3,"ion-item",21),O.Dc(),O.Dc(),O.Dc(),O.Dc(),O.nd(77,AddonMessagesGroupConversationsPage_ng_template_77_Template,1,1,"ng-template",null,28,O.od)),2&e){const e=O.ed(78);O.lc(3),O.Vc("text",O.Qc(4,56,"core.back")),O.lc(4),O.qd(O.Qc(8,58,"addon.messages.messages")),O.lc(3),O.mc("aria-label",O.Qc(11,60,"addon.messages.searchcombined")),O.lc(3),O.mc("aria-label",O.Qc(14,62,"addon.messages.messagepreferences")),O.lc(6),O.Vc("disabled",!n.loaded||!n.currentListEl),O.lc(1),O.Wc("pullingText",O.Qc(21,64,"core.pulltorefresh")),O.lc(2),O.Vc("hideUntil",n.loaded)("message",n.loadingMessage),O.lc(6),O.qd(O.Qc(29,66,"addon.messages.contacts")),O.lc(2),O.Vc("ngIf",n.contactRequestsCount>0),O.lc(1),O.Vc("ngIf",n.contactRequestsCount>0),O.lc(1),O.mc("aria-label",O.Qc(33,68,n.favourites.expanded?"core.collapse":"core.expand"))("aria-expanded",n.favourites.expanded),O.lc(2),O.qc("expandable-status-icon-expanded",n.favourites.expanded),O.lc(3),O.sd("",O.Qc(38,70,"core.favourites")," (",n.favourites.count,")"),O.lc(2),O.Vc("ngIf",n.favourites.unread),O.lc(1),O.Vc("ngIf",n.favourites.unread),O.lc(1),O.Vc("hidden",!n.favourites.conversations||!n.favourites.expanded||n.favourites.loading),O.lc(2),O.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",O.ad(80,_c4,n.favourites.conversations)),O.lc(1),O.Vc("enabled",n.favourites.canLoadMore)("error",n.favourites.loadMoreError),O.lc(1),O.Vc("ngIf",n.favourites.conversations&&0==n.favourites.conversations.length),O.lc(1),O.Vc("ngIf",n.favourites.loading),O.lc(1),O.mc("aria-label",O.Qc(48,72,n.group.expanded?"core.collapse":"core.expand"))("aria-expanded",n.group.expanded),O.lc(2),O.qc("expandable-status-icon-expanded",n.group.expanded),O.lc(3),O.sd("",O.Qc(53,74,"addon.messages.groupconversations")," (",n.group.count,")"),O.lc(2),O.Vc("ngIf",n.group.unread),O.lc(1),O.Vc("ngIf",n.group.unread),O.lc(1),O.Vc("hidden",!n.group.conversations||!n.group.expanded||n.group.loading),O.lc(2),O.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",O.ad(82,_c4,n.group.conversations)),O.lc(1),O.Vc("enabled",n.group.canLoadMore)("error",n.group.loadMoreError),O.lc(1),O.Vc("ngIf",n.group.conversations&&0==n.group.conversations.length),O.lc(1),O.Vc("ngIf",n.group.loading),O.lc(1),O.mc("aria-label",O.Qc(63,76,n.individual.expanded?"core.collapse":"core.expand"))("aria-expanded",n.individual.expanded),O.lc(2),O.qc("expandable-status-icon-expanded",n.individual.expanded),O.lc(3),O.sd("",O.Qc(68,78,"addon.messages.individualconversations")," (",n.individual.count,")"),O.lc(2),O.Vc("ngIf",n.individual.unread),O.lc(1),O.Vc("ngIf",n.individual.unread),O.lc(1),O.Vc("hidden",!n.individual.conversations||!n.individual.expanded||n.individual.loading),O.lc(2),O.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",O.ad(84,_c4,n.individual.conversations)),O.lc(1),O.Vc("enabled",n.individual.canLoadMore)("error",n.individual.loadMoreError),O.lc(1),O.Vc("ngIf",n.individual.conversations&&0==n.individual.conversations.length),O.lc(1),O.Vc("ngIf",n.individual.loading)}},directives:[c.C,c.Ab,c.m,c.h,c.i,c.yb,b.a,c.l,c.D,E.a,A.a,T.a,c.v,x.a,c.bb,c.cb,I.a,c.P,c.I,c.O,G.t,G.A,D.a,c.k,c.qb,G.s,y.a,c.g,V.a,k.a,c.W],pipes:[w.d,N.a],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesGroupConversationsPage})();var q=t("OQOI"),Q=t("dQ3M");const z=[{path:"",data:{mainMenuTabRoot:q.b.PAGE_NAME},component:U},a.AddonMessagesDiscussionRoute],j=[{path:"",data:{mainMenuTabRoot:q.b.PAGE_NAME},component:U,children:[a.AddonMessagesDiscussionRoute]}],F=[...Object(o.c)(z,(()=>i.a.isMobile)),...Object(o.c)(j,(()=>i.a.isTablet))];let Y=(()=>{class AddonMessagesGroupConversationsPageModule{}return AddonMessagesGroupConversationsPageModule.ɵmod=O.wc({type:AddonMessagesGroupConversationsPageModule}),AddonMessagesGroupConversationsPageModule.ɵinj=O.vc({factory:function AddonMessagesGroupConversationsPageModule_Factory(e){return new(e||AddonMessagesGroupConversationsPageModule)},imports:[[s.m.forChild(F),r.a,Q.a],s.m]}),AddonMessagesGroupConversationsPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&O.kd(Y,{declarations:[U],imports:[s.m,r.a,Q.a],exports:[s.m]}))}}]);