(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{MncD:function(e,n,t){"use strict";t.r(n),t.d(n,"AddonCalendarDayPageModule",(function(){return $}));var a=t("tyNb"),o=t("L3Fv"),i=t("9Xwr"),d=t("mrSG"),r=t("GGba"),c=t("fjkH"),l=t("9+EE"),s=t("3LXp"),m=t("Q98t"),_=t("SmTL"),u=t("Lc7R"),g=t("n6RP"),v=t("+lfu"),h=t("Xzvb"),f=t("ZSwf"),y=t("kLT3"),p=t("f0Wu"),E=t.n(p),D=t("j3ag"),b=t("pHTc"),C=t("bFG1"),P=t("BaYo"),O=t("xQjX"),I=t("MpCO"),A=t("+0Ti"),T=t("baaQ"),M=t("51vF"),S=t("fXoL"),x=t("TEn/"),w=t("ACYt"),k=t("3CSS"),N=t("fQ68"),V=t("ofXK"),j=t("8/N+"),F=t("nt/U"),z=t("PgjG"),L=t("r8G5"),Q=t("hMzs"),R=t("eAud"),U=t("yNDK"),G=t("sYmb");function AddonCalendarDayPage_core_context_menu_item_14_Template(e,n){if(1&e){const e=S.Fc();S.Ec(0,"core-context-menu-item",20),S.Mc("action",(function AddonCalendarDayPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){S.fd(e);return S.Oc().goToCurrentDay()})),S.Pc(1,"translate"),S.Dc()}2&e&&S.Vc("priority",900)("content",S.Qc(1,2,"addon.calendar.today"))}const _c0=function(e){return{$a:e}};function AddonCalendarDayPage_ng_template_37_ion_card_1_Template(e,n){1&e&&(S.Ec(0,"ion-card",24),S.Ec(1,"ion-item"),S.zc(2,"ion-icon",25),S.Ec(3,"ion-label"),S.pd(4),S.Pc(5,"translate"),S.Pc(6,"translate"),S.Dc(),S.Dc(),S.Dc()),2&e&&(S.lc(4),S.qd(S.Rc(5,1,"core.hasdatatosync",S.ad(6,_c0,S.Qc(6,4,"core.day")))))}function AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template(e,n){1&e&&(S.zc(0,"core-empty-box",26),S.Pc(1,"translate")),2&e&&S.Vc("message",S.Qc(1,1,"addon.calendar.noevents"))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template(e,n){if(1&e&&S.zc(0,"core-mod-icon",38),2&e){const e=S.Oc().$implicit;S.Vc("modicon",e.moduleIcon)("showAlt",!1)("modname",e.modulename)("componentId",e.instance)("purpose",e.purpose)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template(e,n){if(1&e&&S.zc(0,"ion-icon",39),2&e){const e=S.Oc().$implicit;S.Vc("name",e.eventIcon)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template(e,n){if(1&e&&(S.Ec(0,"span",32),S.pd(1),S.Dc()),2&e){const e=S.Oc().$implicit;S.lc(1),S.qd(e.iconTitle)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_13_Template(e,n){1&e&&(S.Ec(0,"ion-note",2),S.zc(1,"ion-icon",40),S.Ec(2,"span",41),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.qd(S.Qc(4,1,"core.notsent")))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template(e,n){1&e&&(S.Ec(0,"ion-note",2),S.zc(1,"ion-icon",42),S.Ec(2,"span",41),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.qd(S.Qc(4,1,"core.deletedoffline")))}const _c1=function(e){return[e]};function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template(e,n){if(1&e){const e=S.Fc();S.Cc(0),S.Ec(1,"ion-card"),S.Ec(2,"ion-item",29),S.Mc("click",(function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template_ion_item_click_2_listener(){S.fd(e);const t=n.$implicit,a=S.Oc(2).item;return S.Oc().gotoEvent(t.id,a)})),S.nd(3,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template,1,5,"core-mod-icon",30),S.nd(4,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template,1,1,"ion-icon",31),S.Ec(5,"ion-label"),S.Ec(6,"span",32),S.pd(7),S.Pc(8,"translate"),S.nd(9,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template,2,1,"span",33),S.Dc(),S.Ec(10,"p",34),S.zc(11,"core-format-text",35),S.Dc(),S.zc(12,"p",36),S.Dc(),S.nd(13,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_13_Template,5,3,"ion-note",37),S.nd(14,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template,5,3,"ion-note",37),S.Dc(),S.Dc(),S.Bc()}if(2&e){const e=n.$implicit;S.lc(2),S.qc("item-dimmed",e.ispast),S.Vc("ngClass",S.ad(17,_c1,"addon-calendar-eventtype-"+e.eventtype))("detail",!1),S.mc("aria-label",e.name),S.lc(1),S.Vc("ngIf",e.moduleIcon),S.lc(1),S.Vc("ngIf",e.eventIcon&&!e.moduleIcon),S.lc(3),S.rd(" ",S.Qc(8,15,"addon.calendar.type"+e.formattedType)," "),S.lc(2),S.Vc("ngIf",e.moduleIcon&&e.iconTitle),S.lc(2),S.Vc("text",e.name)("contextLevel",e.contextLevel)("contextInstanceId",e.contextInstanceId),S.lc(1),S.Vc("innerHTML",e.formattedtime,S.gd),S.lc(1),S.Vc("ngIf",e.offline&&!e.deleted),S.lc(1),S.Vc("ngIf",e.deleted)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_Template(e,n){if(1&e&&(S.Ec(0,"ion-list",27),S.nd(1,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template,15,19,"ng-container",28),S.Dc()),2&e){const e=S.Oc().item;S.lc(1),S.Vc("ngForOf",e.filteredEvents)}}function AddonCalendarDayPage_ng_template_37_Template(e,n){if(1&e&&(S.Ec(0,"core-loading",9),S.nd(1,AddonCalendarDayPage_ng_template_37_ion_card_1_Template,7,8,"ion-card",21),S.nd(2,AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template,2,3,"core-empty-box",22),S.nd(3,AddonCalendarDayPage_ng_template_37_ion_list_3_Template,2,1,"ion-list",23),S.Dc()),2&e){const e=n.item;S.Vc("hideUntil",e.loaded),S.lc(1),S.Vc("ngIf",e.hasOffline),S.lc(1),S.Vc("ngIf",!e.filteredEvents||!e.filteredEvents.length),S.lc(1),S.Vc("ngIf",e.filteredEvents&&e.filteredEvents.length)}}function AddonCalendarDayPage_ion_fab_38_Template(e,n){if(1&e){const e=S.Fc();S.Ec(0,"ion-fab",43),S.Ec(1,"ion-fab-button",44),S.Mc("click",(function AddonCalendarDayPage_ion_fab_38_Template_ion_fab_button_click_1_listener(){S.fd(e);return S.Oc().openEdit()})),S.Pc(2,"translate"),S.zc(3,"ion-icon",45),S.Ec(4,"span",32),S.pd(5),S.Pc(6,"translate"),S.Dc(),S.Dc(),S.Dc()}2&e&&(S.lc(1),S.mc("aria-label",S.Qc(2,2,"addon.calendar.newevent")),S.lc(4),S.qd(S.Qc(6,4,"addon.calendar.newevent")))}let q=(()=>{class AddonCalendarDayPage{constructor(){this.loaded=!1,this.isOnline=!1,this.syncIcon=P.a.ICON_LOADING,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=l.b.getCurrentSiteId(),this.newEventObserver=c.b.on(_.c.NEW_EVENT_EVENT,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId),this.discardedObserver=c.b.on(_.c.NEW_EVENT_DISCARDED_EVENT,(()=>{var e;null===(e=this.manager)||void 0===e?void 0:e.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0)}),this.currentSiteId),this.editEventObserver=c.b.on(_.c.EDIT_EVENT_EVENT,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId),this.syncObserver=c.b.on(v.b.AUTO_SYNCED,(()=>{var e;null===(e=this.manager)||void 0===e?void 0:e.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0)}),this.currentSiteId),this.manualSyncObserver=c.b.on(v.b.MANUAL_SYNCED,(e=>{var n,t;const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();!e||"day"==e.source&&a&&e.moment&&a.moment.isSame(e.moment,"day")||(null===(t=this.manager)||void 0===t?void 0:t.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId),this.deleteEventObserver=c.b.on(_.c.DELETED_EVENT_EVENT,(e=>{var n,t;e&&!e.sent?null===(n=this.manager)||void 0===n?void 0:n.getSource().markAsDeleted(e.eventId,!0):(null===(t=this.manager)||void 0===t?void 0:t.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId),this.undeleteEventObserver=c.b.on(_.c.UNDELETED_EVENT_EVENT,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAsDeleted(e.eventId,!1))}),this.currentSiteId),this.filterChangedObserver=c.b.on(_.c.FILTER_CHANGED_EVENT,(e=>Object(d.a)(this,void 0,void 0,(function*(){var n,t;this.filter=e,yield null===(n=this.manager)||void 0===n?void 0:n.getSource().loadCanCreate(this.filter.courseId),null===(t=this.manager)||void 0===t||t.getSource().filterAllDayEvents(this.filter)})))),this.onlineObserver=r.a.onChange().subscribe((()=>{D.A.run((()=>{this.isOnline=r.a.isOnline()}))}))}ngOnInit(){const e=[];C.a.enumKeys(_.b).forEach((n=>{var t;const a=_.b[n];this.filter[n]=null===(t=b.a.getRouteBooleanParam(n))||void 0===t||t,e.push(a)})),this.filter.courseId=b.a.getRouteNumberParam("courseId"),this.filter.categoryId=b.a.getRouteNumberParam("categoryId"),this.filter.filtered=void 0!==this.filter.courseId||e.some((e=>!this.filter[e]));const n=b.a.getRouteNumberParam("month"),t=new day_page_AddonCalendarDaySlidesItemsManagerSource(this,E()({year:b.a.getRouteNumberParam("year"),month:n?n-1:void 0,date:b.a.getRouteNumberParam("day")}));this.manager=new O.a(t),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onDayViewed(e)}}),this.fetchData(!0)}get canCreate(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().canCreate)||!1}get timeFormat(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().timeFormat)||"core.strftimetime"}fetchData(e){var n,t,a;return Object(d.a)(this,void 0,void 0,(function*(){this.syncIcon=P.a.ICON_LOADING,this.isOnline=r.a.isOnline(),e&&(yield this.sync());try{yield null===(n=this.manager)||void 0===n?void 0:n.getSource().fetchData(this.filter.courseId),yield null===(t=this.manager)||void 0===t?void 0:t.getSource().load(null===(a=this.manager)||void 0===a?void 0:a.getSelectedItem())}catch(e){s.a.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}this.loaded=!0,this.syncIcon=P.a.ICON_SYNC}))}onDayViewed(e){this.periodName=m.a.userDate(1e3*e.moment.unix(),"core.strftimedaydate")}doRefresh(e,n){return Object(d.a)(this,void 0,void 0,(function*(){this.loaded&&(yield this.refreshData(!0).finally((()=>{null==e?void 0:e.complete(),n&&n()})))}))}refreshData(e,n){var t,a;return Object(d.a)(this,void 0,void 0,(function*(){this.syncIcon=P.a.ICON_LOADING;const o=(null===(t=this.manager)||void 0===t?void 0:t.getSelectedItem())||null;yield null===(a=this.manager)||void 0===a?void 0:a.getSource().invalidateContent(o,!n),yield this.fetchData(e)}))}sync(e){var n,t;return Object(d.a)(this,void 0,void 0,(function*(){try{const e=yield v.a.syncEvents();if(e.warnings&&e.warnings.length&&s.a.showErrorModal(e.warnings[0]),e.updated){const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();e.source="day",e.moment=null==a?void 0:a.moment,null===(t=this.manager)||void 0===t||t.getSource().markAllItemsUnloaded(),c.b.trigger(v.b.MANUAL_SYNCED,e,this.currentSiteId)}}catch(n){e&&s.a.showErrorModalDefault(n,"core.errorsync",!0)}}))}selectedDayIsCurrent(){var e,n;return!!(null===(n=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem())||void 0===n?void 0:n.isCurrentDay)}gotoEvent(e,n){b.a.navigateToSitePath(`/calendar/event/${e}`,{params:{date:n.moment.format("MMDDY")}})}openFilter(){var e;return Object(d.a)(this,void 0,void 0,(function*(){yield s.a.openSideModal({component:y.a,componentProps:{courses:null===(e=this.manager)||void 0===e?void 0:e.getSource().courses,filter:this.filter}})}))}openEdit(e){var n;const t={};if(!e){e=0;const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();if(a){const e=E()();t.timestamp=1e3*a.moment.clone().set({hour:e.hour(),minute:e.minute()}).unix()}}this.filter.courseId&&(t.courseId=this.filter.courseId),b.a.navigateToSitePath(`/calendar/edit/${e}`,{params:t})}selectedDayHasOffline(){var e;const n=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();return!!(null==n?void 0:n.hasOffline)}goToCurrentDay(){return Object(d.a)(this,void 0,void 0,(function*(){const e=this.manager,n=this.slides;if(!e||!n)return;const t={moment:E()()};this.loaded=!1;try{yield e.getSource().loadItem(t),n.slideToItem(t)}catch(e){s.a.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}finally{this.loaded=!0}}))}loadNext(){var e;return Object(d.a)(this,void 0,void 0,(function*(){null===(e=this.slides)||void 0===e?void 0:e.slideNext()}))}loadPrevious(){var e;return Object(d.a)(this,void 0,void 0,(function*(){null===(e=this.slides)||void 0===e?void 0:e.slidePrev()}))}ngOnDestroy(){var e,n,t,a,o,i,d,r,c,l,s;null===(e=this.newEventObserver)||void 0===e?void 0:e.off(),null===(n=this.discardedObserver)||void 0===n||n.off(),null===(t=this.editEventObserver)||void 0===t||t.off(),null===(a=this.deleteEventObserver)||void 0===a||a.off(),null===(o=this.undeleteEventObserver)||void 0===o||o.off(),null===(i=this.syncObserver)||void 0===i||i.off(),null===(d=this.manualSyncObserver)||void 0===d||d.off(),null===(r=this.onlineObserver)||void 0===r||r.unsubscribe(),null===(c=this.filterChangedObserver)||void 0===c||c.off(),null===(l=this.manager)||void 0===l||l.getSource().forgetRelatedSources(),null===(s=this.manager)||void 0===s||s.destroy(),this.managerUnsubscribe&&this.managerUnsubscribe()}}return AddonCalendarDayPage.ɵfac=function AddonCalendarDayPage_Factory(e){return new(e||AddonCalendarDayPage)},AddonCalendarDayPage.ɵcmp=S.sc({type:AddonCalendarDayPage,selectors:[["page-addon-calendar-day"]],viewQuery:function AddonCalendarDayPage_Query(e,n){var t;(1&e&&S.ud(I.a,!0),2&e)&&(S.dd(t=S.Nc())&&(n.slides=t.first))},decls:39,vars:31,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-calendar-day",3,"priority","content","action",4,"ngIf"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"core-swipe-slides-container"],[1,"ion-no-padding","safe-area-padding"],[1,"ion-align-items-center"],[1,"ion-text-start"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],[1,"ion-text-center","addon-calendar-period"],[1,"ion-text-end"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"],[3,"manager"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-calendar-day",3,"priority","content","action"],["class","core-warning-card list-item-limited-width",4,"ngIf"],["icon","fas-calendar",3,"message",4,"ngIf"],["class","list-item-limited-width",4,"ngIf"],[1,"core-warning-card","list-item-limited-width"],["name","fas-exclamation-triangle","slot","start","aria-hidden","true"],["icon","fas-calendar",3,"message"],[1,"list-item-limited-width"],[4,"ngFor","ngForOf"],["button","",1,"addon-calendar-event","ion-text-wrap",3,"ngClass","detail","click"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose",4,"ngIf"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],[1,"item-heading"],[3,"text","contextLevel","contextInstanceId"],[3,"innerHTML"],["slot","end",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose"],["slot","start","aria-hidden","true",3,"name"],["name","fas-clock","aria-hidden","true"],[1,"ion-text-wrap"],["name","fas-trash","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"]],template:function AddonCalendarDayPage_Template(e,n){1&e&&(S.Ec(0,"ion-header"),S.Ec(1,"ion-toolbar"),S.Ec(2,"ion-buttons",0),S.zc(3,"ion-back-button",1),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"ion-title"),S.Ec(6,"h1"),S.pd(7),S.Pc(8,"translate"),S.Dc(),S.Dc(),S.Ec(9,"ion-buttons",2),S.Ec(10,"ion-button",3),S.Mc("click",(function AddonCalendarDayPage_Template_ion_button_click_10_listener(){return n.openFilter()})),S.Pc(11,"translate"),S.zc(12,"ion-icon",4),S.Dc(),S.Ec(13,"core-context-menu"),S.nd(14,AddonCalendarDayPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5),S.Ec(15,"core-context-menu-item",6),S.Mc("action",(function AddonCalendarDayPage_Template_core_context_menu_item_action_15_listener(e){return n.doRefresh(void 0,e)})),S.Pc(16,"translate"),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Ec(17,"ion-content"),S.Ec(18,"ion-refresher",7),S.Mc("ionRefresh",(function AddonCalendarDayPage_Template_ion_refresher_ionRefresh_18_listener(e){return n.doRefresh(e.target)})),S.zc(19,"ion-refresher-content",8),S.Pc(20,"translate"),S.Dc(),S.Ec(21,"core-loading",9),S.Ec(22,"div",10),S.Ec(23,"ion-grid",11),S.Ec(24,"ion-row",12),S.Ec(25,"ion-col",13),S.Ec(26,"ion-button",3),S.Mc("click",(function AddonCalendarDayPage_Template_ion_button_click_26_listener(){return n.loadPrevious()})),S.Pc(27,"translate"),S.zc(28,"ion-icon",14),S.Dc(),S.Dc(),S.Ec(29,"ion-col",15),S.Ec(30,"h3"),S.pd(31),S.Dc(),S.Dc(),S.Ec(32,"ion-col",16),S.Ec(33,"ion-button",3),S.Mc("click",(function AddonCalendarDayPage_Template_ion_button_click_33_listener(){return n.loadNext()})),S.Pc(34,"translate"),S.zc(35,"ion-icon",17),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Ec(36,"core-swipe-slides",18),S.nd(37,AddonCalendarDayPage_ng_template_37_Template,4,4,"ng-template"),S.Dc(),S.Dc(),S.Dc(),S.nd(38,AddonCalendarDayPage_ion_fab_38_Template,7,6,"ion-fab",19),S.Dc()),2&e&&(S.lc(3),S.Vc("text",S.Qc(4,17,"core.back")),S.lc(4),S.qd(S.Qc(8,19,"addon.calendar.calendarevents")),S.lc(3),S.mc("aria-label",S.Qc(11,21,"core.filter")),S.lc(4),S.Vc("ngIf",!n.selectedDayIsCurrent()),S.lc(1),S.Vc("hidden",!n.loaded||!n.selectedDayHasOffline()||!n.isOnline)("priority",400)("content",S.Qc(16,23,"core.settings.synchronizenow"))("iconAction",n.syncIcon)("closeOnClick",!1),S.lc(3),S.Vc("disabled",!n.loaded),S.lc(1),S.Wc("pullingText",S.Qc(20,25,"core.pulltorefresh")),S.lc(2),S.Vc("hideUntil",n.loaded),S.lc(5),S.mc("aria-label",S.Qc(27,27,"addon.calendar.dayprev")),S.lc(5),S.qd(n.periodName),S.lc(2),S.mc("aria-label",S.Qc(34,29,"addon.calendar.daynext")),S.lc(3),S.Vc("manager",n.manager),S.lc(2),S.Vc("ngIf",n.canCreate&&n.loaded))},directives:[x.C,x.Ab,x.m,x.h,x.i,x.yb,w.a,x.l,x.D,k.a,N.a,V.t,j.a,F.a,x.v,x.bb,x.cb,z.a,x.B,x.hb,x.u,I.a,x.n,x.I,x.O,L.a,x.P,V.s,V.q,Q.a,R.a,x.W,x.x,U.a,x.y],pipes:[G.d],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color:var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical:12px;--margin-end:12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-right:var(--margin-end)}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:var(--margin-end);margin-inline-end:var(--margin-end)}}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}","[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{flex:none;width:100%}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]{flex-grow:3}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:10px;font-size:1.2rem}"]}),AddonCalendarDayPage})();class day_page_AddonCalendarDaySlidesItemsManagerSource extends A.a{constructor(e,n){super({moment:n}),this.courses=[],this.eventsSources=new Set,this.offlineEvents={},this.offlineEditedEventsIds=[],this.canCreate=!1,this.dayPage=e}fetchData(e){return Object(d.a)(this,void 0,void 0,(function*(){yield Promise.all([this.loadCourses(e),this.loadCanCreate(e),this.loadCategories(),this.loadOfflineEvents(),this.loadOfflineDeletedEvents(),this.loadTimeFormat()])}))}filterAllDayEvents(e){var n;null===(n=this.getItems())||void 0===n?void 0:n.forEach((n=>this.filterEvents(n,e)))}filterEvents(e,n){e.filteredEvents=g.b.getFilteredEvents(e.events||[],n,this.categories||{}),this.rememberEventsList(e)}loadCourses(e){return Object(d.a)(this,void 0,void 0,(function*(){const n=yield f.a.getCoursesForPopover(e);this.courses=n.courses}))}loadCanCreate(e){return Object(d.a)(this,void 0,void 0,(function*(){this.canCreate=yield g.b.canEditEvents(e)}))}loadCategories(){return Object(d.a)(this,void 0,void 0,(function*(){if(!this.categories)try{const e=yield h.a.getCategories(0,!0);this.categories=C.a.arrayToObject(e,"id")}catch(e){}}))}loadOfflineEvents(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield u.a.getAllEditedEvents();this.offlineEvents=g.b.classifyIntoMonths(e),this.offlineEditedEventsIds=e.filter((e=>e.id>0)).map((e=>e.id))}))}loadOfflineDeletedEvents(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield u.a.getAllDeletedEventsIds();this.deletedEvents=new Set(e)}))}loadTimeFormat(){return Object(d.a)(this,void 0,void 0,(function*(){this.timeFormat=yield _.a.getCalendarTimeFormat()}))}getItemId(e){return g.b.getDayId(e.moment)}getPreviousItem(e){return{moment:e.moment.clone().subtract(1,"day")}}getNextItem(e){return{moment:e.moment.clone().add(1,"day")}}loadItemData(e,n=!1){return Object(d.a)(this,void 0,void 0,(function*(){const t=Object.assign(Object.assign({},e),{hasOffline:!1,events:[],onlineEvents:[],filteredEvents:[],isCurrentDay:e.moment.isSame(E()(),"day"),isPastDay:e.moment.isBefore(E()(),"day")});if(n)return t;let a;try{a=yield _.a.getDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date()),t.onlineEvents=a.events.map((e=>g.b.formatEventData(e)))}catch(e){if(r.a.isOnline())throw e}t.events=this.mergeEvents(t),this.filterEvents(t,this.dayPage.filter);const o=1e3*e.moment.unix(),i=m.a.timestamp(),c=t.events.map((e=>Object(d.a)(this,void 0,void 0,(function*(){e.ispast=t.isPastDay||t.isCurrentDay&&this.isEventPast(e,i),e.formattedtime=yield _.a.formatEventTime(e,this.dayPage.timeFormat,!0,o)}))));return yield Promise.all(c),t}))}isEventPast(e,n){return e.timestart+e.timeduration<n}mergeEvents(e){var n,t,a;if(e.hasOffline=!1,!Object.keys(this.offlineEvents).length&&!(null===(n=this.deletedEvents)||void 0===n?void 0:n.size))return e.onlineEvents||[];const o=this.offlineEvents[g.b.getMonthId(e.moment)],i=o&&o[e.moment.date()];let d=e.onlineEvents||[];return(null===(t=this.deletedEvents)||void 0===t?void 0:t.size)&&d.forEach((n=>{var t;n.deleted=null===(t=this.deletedEvents)||void 0===t?void 0:t.has(n.id),n.deleted&&(e.hasOffline=!0)})),this.offlineEditedEventsIds.length&&(d=d.filter((e=>-1==this.offlineEditedEventsIds.indexOf(e.id))),d.length!=(null===(a=e.onlineEvents)||void 0===a?void 0:a.length)&&(e.hasOffline=!0)),i&&i.length&&(e.hasOffline=!0,d=g.b.sortEvents(d.concat(i))),d}invalidateContent(e,n){return Object(d.a)(this,void 0,void 0,(function*(){const t=[];n&&e&&t.push(_.a.invalidateDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date())),t.push(_.a.invalidateAllowedEventTypes()),t.push(h.a.invalidateCategories(0,!0)),t.push(_.a.invalidateTimeFormat()),this.categories=void 0,e&&(e.dirty=!0),yield Promise.all(t)}))}markAsDeleted(e,n){var t,a,o;null===(t=this.getItems())||void 0===t?void 0:t.some((t=>{var a,o,i,d;const r=null===(a=t.onlineEvents)||void 0===a?void 0:a.find((n=>n.id==e));return!!r&&(r.deleted=n,t.hasOffline=!!n||((null===(o=t.events)||void 0===o?void 0:o.length)!=(null===(i=t.onlineEvents)||void 0===i?void 0:i.length)||(null===(d=t.events)||void 0===d?void 0:d.some((e=>e.deleted||e.offline)))),!0)})),n?null===(a=this.deletedEvents)||void 0===a||a.add(e):null===(o=this.deletedEvents)||void 0===o||o.delete(e)}forgetRelatedSources(){for(const e of this.eventsSources)T.a.removeReference(e,this)}rememberEventsList(e){var n;return Object(d.a)(this,void 0,void 0,(function*(){const t=T.a.getOrCreateSource(M.a,[e.moment.format("MMDDY")]);this.eventsSources.has(t)||(this.eventsSources.add(t),T.a.addReference(t,this)),t.setEvents(null!==(n=e.filteredEvents)&&void 0!==n?n:[]),yield t.reload()}))}}const Y=[{path:"",component:q}];let $=(()=>{class AddonCalendarDayPageModule{}return AddonCalendarDayPageModule.ɵmod=S.wc({type:AddonCalendarDayPageModule}),AddonCalendarDayPageModule.ɵinj=S.vc({factory:function AddonCalendarDayPageModule_Factory(e){return new(e||AddonCalendarDayPageModule)},imports:[[a.m.forChild(Y),o.a,i.a],a.m]}),AddonCalendarDayPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&S.kd($,{declarations:[q],imports:[a.m,o.a,i.a],exports:[a.m]}))}}]);