(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{o7gM:function(e,s,t){"use strict";t.r(s),t.d(s,"AddonMessagesDiscussionPageModule",(function(){return H}));var o=t("tyNb"),n=t("L3Fv"),i=t("mrSG"),a=t("TEn/"),r=t("fjkH"),c=t("9+EE"),d=t("KMk0"),l=t("nopL"),h=t("fTjU"),g=t("4pns"),m=t("3LXp"),u=t("bFG1"),f=t("vuGA"),_=t("3j9v"),M=t("nvXB"),v=t("xpMl"),b=t("kScs"),p=t("f0Wu"),I=t.n(p),y=t("93ts"),C=t("j3ag"),P=t("pHTc"),D=t("fXoL"),E=t("ACYt"),w=t("3CSS"),O=t("nt/U"),A=t("PgjG"),k=t("ofXK"),T=t("NcPy"),x=t("hMzs"),S=t("FeAf"),L=t("sYmb");function AddonMessagesConversationInfoComponent_ion_item_15_core_format_text_7_Template(e,s){if(1&e&&D.zc(0,"core-format-text",12),2&e){const e=D.Oc(2);D.Vc("text",e.conversation.subname)("contextInstanceId",0)}}const _c0=function(e){return{$a:e}};function AddonMessagesConversationInfoComponent_ion_item_15_Template(e,s){if(1&e&&(D.Ec(0,"ion-item",9),D.Ec(1,"ion-label"),D.Ec(2,"div",10),D.zc(3,"img",11),D.Dc(),D.Ec(4,"h2"),D.zc(5,"core-format-text",12),D.Dc(),D.Ec(6,"p"),D.nd(7,AddonMessagesConversationInfoComponent_ion_item_15_core_format_text_7_Template,1,2,"core-format-text",13),D.Dc(),D.Ec(8,"p"),D.pd(9),D.Pc(10,"translate"),D.Dc(),D.Dc(),D.Dc()),2&e){const e=D.Oc();D.lc(3),D.Vc("src",e.conversation.imageurl,D.id)("alt",e.conversation.name),D.lc(2),D.Vc("text",e.conversation.name)("contextInstanceId",0),D.lc(2),D.Vc("ngIf",e.conversation.subname),D.lc(2),D.qd(D.Rc(10,6,"addon.messages.numparticipants",D.ad(9,_c0,e.conversation.membercount)))}}function AddonMessagesConversationInfoComponent_ion_item_16_ion_icon_5_Template(e,s){1&e&&(D.zc(0,"ion-icon",18),D.Pc(1,"translate")),2&e&&D.mc("aria-label",D.Qc(1,1,"addon.messages.contactblocked"))}function AddonMessagesConversationInfoComponent_ion_item_16_Template(e,s){if(1&e){const e=D.Fc();D.Ec(0,"ion-item",14),D.Mc("click",(function AddonMessagesConversationInfoComponent_ion_item_16_Template_ion_item_click_0_listener(){D.fd(e);const t=s.$implicit;return D.Oc().closeModal(t.id)})),D.zc(1,"core-user-avatar",15),D.Ec(2,"ion-label"),D.Ec(3,"p",16),D.pd(4),D.nd(5,AddonMessagesConversationInfoComponent_ion_item_16_ion_icon_5_Template,2,3,"ion-icon",17),D.Dc(),D.Dc(),D.Dc()}if(2&e){const e=s.$implicit;D.lc(1),D.Vc("user",e)("linkProfile",!1)("checkOnline",e.showonlinestatus),D.lc(3),D.rd(" ",e.fullname," "),D.lc(1),D.Vc("ngIf",e.isblocked)}}let N=(()=>{class AddonMessagesConversationInfoComponent{constructor(e){this.route=e,this.conversationId=0,this.loaded=!1,this.members=[],this.canLoadMore=!1,this.loadMoreError=!1}ngOnInit(){this.fetchData().finally((()=>{this.loaded=!0}))}fetchData(){return Object(i.a)(this,void 0,void 0,(function*(){try{const e=yield d.a.getConversation(this.conversationId,!1,!0,0,0);this.conversation=e,yield this.fetchMembers()}catch(e){m.a.showErrorModalDefault(e,"Error getting members.")}}))}fetchMembers(e){return Object(i.a)(this,void 0,void 0,(function*(){this.loadMoreError=!1;const s=e?this.members.length:0,t=yield d.a.getConversationMembers(this.conversationId,s);this.members=e?this.members.concat(t.members):t.members,this.canLoadMore=t.canLoadMore}))}loadMoreMembers(e){return Object(i.a)(this,void 0,void 0,(function*(){try{yield this.fetchMembers(!0)}catch(e){m.a.showErrorModalDefault(e,"Error getting members."),this.loadMoreError=!0}finally{e&&e()}}))}refreshData(e){return Object(i.a)(this,void 0,void 0,(function*(){const s=[];s.push(d.a.invalidateConversation(this.conversationId)),s.push(d.a.invalidateConversationMembers(this.conversationId)),yield Promise.all(s),yield this.fetchData().finally((()=>{null==e?void 0:e.complete()}))}))}closeModal(e){C.x.dismiss(e)}}return AddonMessagesConversationInfoComponent.ɵfac=function AddonMessagesConversationInfoComponent_Factory(e){return new(e||AddonMessagesConversationInfoComponent)(D.yc(o.a))},AddonMessagesConversationInfoComponent.ɵcmp=D.sc({type:AddonMessagesConversationInfoComponent,selectors:[["page-addon-messages-conversation-info"]],inputs:{conversationId:"conversationId"},decls:18,vars:15,consts:[["slot","end"],["fill","clear",3,"click"],["name","fas-times","slot","icon-only","aria-hidden","true"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-center",4,"ngIf"],["class","ion-text-wrap addon-messages-conversation-item","detail","true","button","",3,"click",4,"ngFor","ngForOf"],[3,"enabled","error","action"],[1,"ion-text-center"],[1,"large-avatar"],["core-external-content","","onError","this.src='assets/img/group-avatar.svg'",1,"avatar",3,"src","alt"],["contextLevel","system",3,"text","contextInstanceId"],["contextLevel","system",3,"text","contextInstanceId",4,"ngIf"],["detail","true","button","",1,"ion-text-wrap","addon-messages-conversation-item",3,"click"],["slot","start",3,"user","linkProfile","checkOnline"],[1,"item-heading"],["name","fas-user-slash",4,"ngIf"],["name","fas-user-slash"]],template:function AddonMessagesConversationInfoComponent_Template(e,s){1&e&&(D.Ec(0,"ion-header"),D.Ec(1,"ion-toolbar"),D.Ec(2,"ion-title"),D.Ec(3,"h2"),D.pd(4),D.Pc(5,"translate"),D.Dc(),D.Dc(),D.Ec(6,"ion-buttons",0),D.Ec(7,"ion-button",1),D.Mc("click",(function AddonMessagesConversationInfoComponent_Template_ion_button_click_7_listener(){return s.closeModal()})),D.Pc(8,"translate"),D.zc(9,"ion-icon",2),D.Dc(),D.Dc(),D.Dc(),D.Dc(),D.Ec(10,"ion-content"),D.Ec(11,"ion-refresher",3),D.Mc("ionRefresh",(function AddonMessagesConversationInfoComponent_Template_ion_refresher_ionRefresh_11_listener(e){return s.refreshData(e.target)})),D.zc(12,"ion-refresher-content",4),D.Pc(13,"translate"),D.Dc(),D.Ec(14,"core-loading",5),D.nd(15,AddonMessagesConversationInfoComponent_ion_item_15_Template,11,11,"ion-item",6),D.nd(16,AddonMessagesConversationInfoComponent_ion_item_16_Template,6,5,"ion-item",7),D.Ec(17,"core-infinite-loading",8),D.Mc("action",(function AddonMessagesConversationInfoComponent_Template_core_infinite_loading_action_17_listener(e){return s.loadMoreMembers(e)})),D.Dc(),D.Dc(),D.Dc()),2&e&&(D.lc(4),D.qd(D.Qc(5,9,"addon.messages.groupinfo")),D.lc(3),D.mc("aria-label",D.Qc(8,11,"core.close")),D.lc(4),D.Vc("disabled",!s.loaded),D.lc(1),D.Wc("pullingText",D.Qc(13,13,"core.pulltorefresh")),D.lc(2),D.Vc("hideUntil",s.loaded),D.lc(1),D.Vc("ngIf",s.conversation),D.lc(1),D.Vc("ngForOf",s.members),D.lc(1),D.Vc("enabled",s.canLoadMore)("error",s.loadMoreError))},directives:[a.C,a.Ab,a.yb,a.m,E.a,a.l,a.D,w.a,O.a,a.v,a.bb,a.cb,A.a,k.t,k.s,v.a,a.I,a.O,T.a,x.a,S.a],pipes:[L.d],encapsulation:2}),AddonMessagesConversationInfoComponent})();var V=t("BaYo"),R=t("6s78"),q=t("ACV2"),F=t("fQ68"),j=t("8/N+"),U=t("9pYf"),B=t("r8G5"),Q=t("yNDK"),z=t("O4u7"),G=t("uYHD");function AddonMessagesDiscussionPage_img_7_Template(e,s){if(1&e&&D.zc(0,"img",25),2&e){const e=D.Oc();D.Vc("src",e.conversationImage,D.id)("siteId",e.siteId||null)}}function AddonMessagesDiscussionPage_core_user_avatar_8_Template(e,s){if(1&e&&D.zc(0,"core-user-avatar",26),2&e){const e=D.Oc();D.Vc("user",e.otherMember)("linkProfile",!1)("checkOnline",e.otherMember.showonlinestatus)}}function AddonMessagesDiscussionPage_ion_icon_10_Template(e,s){1&e&&(D.zc(0,"ion-icon",27),D.Pc(1,"translate")),2&e&&D.mc("aria-label",D.Qc(1,1,"core.favourites"))}function AddonMessagesDiscussionPage_ion_icon_11_Template(e,s){1&e&&(D.zc(0,"ion-icon",28),D.Pc(1,"translate")),2&e&&D.mc("aria-label",D.Qc(1,1,"addon.messages.mutedconversation"))}function AddonMessagesDiscussionPage_ng_container_39_Template(e,s){1&e&&(D.Cc(0),D.Ec(1,"p",29),D.pd(2),D.Pc(3,"translate"),D.Dc(),D.Ec(4,"p",29),D.Ec(5,"em"),D.pd(6),D.Pc(7,"translate"),D.Dc(),D.Dc(),D.Bc()),2&e&&(D.lc(2),D.qd(D.Qc(3,2,"addon.messages.selfconversation")),D.lc(4),D.qd(D.Qc(7,4,"addon.messages.selfconversationdefaultmessage")))}function AddonMessagesDiscussionPage_ng_container_43_h3_1_Template(e,s){if(1&e&&(D.Ec(0,"h3",33),D.pd(1),D.Pc(2,"coreFormatDate"),D.Dc()),2&e){const e=D.Oc().$implicit;D.lc(1),D.rd(" ",D.Rc(2,1,e.timecreated,"strftimedayshort")," ")}}function AddonMessagesDiscussionPage_ng_container_43_ion_chip_2_Template(e,s){1&e&&(D.Ec(0,"ion-chip",34),D.Ec(1,"ion-label"),D.pd(2),D.Pc(3,"translate"),D.Dc(),D.zc(4,"ion-icon",35),D.Dc()),2&e&&(D.lc(2),D.qd(D.Qc(3,1,"addon.messages.newmessages")))}function AddonMessagesDiscussionPage_ng_container_43_Template(e,s){if(1&e){const e=D.Fc();D.Cc(0),D.nd(1,AddonMessagesDiscussionPage_ng_container_43_h3_1_Template,3,4,"h3",30),D.nd(2,AddonMessagesDiscussionPage_ng_container_43_ion_chip_2_Template,5,3,"ion-chip",31),D.Ec(3,"core-message",32),D.Mc("afterRender",(function AddonMessagesDiscussionPage_ng_container_43_Template_core_message_afterRender_3_listener(){D.fd(e);const t=s.last,o=D.Oc();return t&&o.scrollToBottom()}))("onDeleteMessage",(function AddonMessagesDiscussionPage_ng_container_43_Template_core_message_onDeleteMessage_3_listener(){D.fd(e);const t=s.$implicit,o=s.index;return D.Oc().deleteMessage(t,o)})),D.Dc(),D.Bc()}if(2&e){const e=s.$implicit,t=D.Oc();D.lc(1),D.Vc("ngIf",e.showDate),D.lc(1),D.Vc("ngIf",t.unreadMessageFrom>0&&e.id==t.unreadMessageFrom),D.lc(1),D.Vc("message",e)("user",t.members[e.useridfrom])("text",e.text)("showDelete",t.showDelete)("time",e.timecreated)}}function AddonMessagesDiscussionPage_core_empty_box_44_Template(e,s){1&e&&(D.zc(0,"core-empty-box",36),D.Pc(1,"translate")),2&e&&D.Vc("message",D.Qc(1,1,"addon.messages.nomessagesfound"))}function AddonMessagesDiscussionPage_ion_fab_45_Template(e,s){if(1&e){const e=D.Fc();D.Ec(0,"ion-fab",37),D.Ec(1,"ion-fab-button",38),D.Mc("click",(function AddonMessagesDiscussionPage_ion_fab_45_Template_ion_fab_button_click_1_listener(){D.fd(e);return D.Oc().scrollToFirstUnreadMessage()})),D.Pc(2,"translate"),D.zc(3,"ion-icon",35),D.Ec(4,"span",19),D.pd(5),D.Pc(6,"translate"),D.Dc(),D.Dc(),D.Ec(7,"ion-badge",39),D.pd(8),D.Dc(),D.Dc()}if(2&e){const e=D.Oc();D.lc(1),D.mc("aria-label",D.Qc(2,3,"addon.messages.newmessages")),D.lc(4),D.qd(D.Qc(6,5,"addon.messages.newmessages")),D.lc(3),D.qd(e.newMessages)}}function AddonMessagesDiscussionPage_ion_footer_46_p_2_Template(e,s){1&e&&(D.Ec(0,"p",45),D.pd(1),D.Pc(2,"translate"),D.Dc()),2&e&&(D.lc(1),D.rd(" ",D.Qc(2,1,"addon.messages.unabletomessage")," "))}function AddonMessagesDiscussionPage_ion_footer_46_div_3_Template(e,s){if(1&e){const e=D.Fc();D.Ec(0,"div",46),D.Ec(1,"p",29),D.pd(2),D.Pc(3,"translate"),D.Dc(),D.Ec(4,"ion-button",47),D.Mc("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_3_Template_ion_button_click_4_listener(){D.fd(e);return D.Oc(2).unblockUser()})),D.pd(5),D.Pc(6,"translate"),D.Dc(),D.Dc()}2&e&&(D.lc(2),D.qd(D.Qc(3,2,"addon.messages.youhaveblockeduser")),D.lc(3),D.rd(" ",D.Qc(6,4,"addon.messages.unblockuser")," "))}const discussion_page_c0=function(e){return{$a:e}};function AddonMessagesDiscussionPage_ion_footer_46_div_4_Template(e,s){if(1&e){const e=D.Fc();D.Ec(0,"div",46),D.Ec(1,"p",29),D.Ec(2,"strong"),D.pd(3),D.Pc(4,"translate"),D.Dc(),D.Dc(),D.Ec(5,"p",29),D.pd(6),D.Pc(7,"translate"),D.Dc(),D.Ec(8,"ion-button",47),D.Mc("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_4_Template_ion_button_click_8_listener(){D.fd(e);return D.Oc(2).createContactRequest()})),D.pd(9),D.Pc(10,"translate"),D.Dc(),D.Dc()}if(2&e){const e=D.Oc(2);D.lc(3),D.qd(D.Rc(4,3,"addon.messages.isnotinyourcontacts",D.ad(11,discussion_page_c0,e.otherMember.fullname))),D.lc(3),D.qd(D.Rc(7,6,"addon.messages.requirecontacttomessage",D.ad(13,discussion_page_c0,e.otherMember.fullname))),D.lc(3),D.rd(" ",D.Qc(10,9,"addon.messages.sendcontactrequest")," ")}}function AddonMessagesDiscussionPage_ion_footer_46_div_5_Template(e,s){if(1&e){const e=D.Fc();D.Ec(0,"div",46),D.Ec(1,"p",29),D.pd(2),D.Pc(3,"translate"),D.Dc(),D.Ec(4,"ion-button",47),D.Mc("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_5_Template_ion_button_click_4_listener(){D.fd(e);return D.Oc(2).confirmContactRequest()})),D.pd(5),D.Pc(6,"translate"),D.Dc(),D.Ec(7,"ion-button",48),D.Mc("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_5_Template_ion_button_click_7_listener(){D.fd(e);return D.Oc(2).declineContactRequest()})),D.pd(8),D.Pc(9,"translate"),D.Dc(),D.Dc()}if(2&e){const e=D.Oc(2);D.lc(2),D.qd(D.Rc(3,3,"addon.messages.userwouldliketocontactyou",D.ad(10,discussion_page_c0,e.otherMember.fullname))),D.lc(3),D.rd(" ",D.Qc(6,6,"addon.messages.acceptandaddcontact")," "),D.lc(3),D.rd(" ",D.Qc(9,8,"addon.messages.decline")," ")}}function AddonMessagesDiscussionPage_ion_footer_46_div_6_p_5_Template(e,s){if(1&e&&(D.Ec(0,"p",29),D.pd(1),D.Pc(2,"translate"),D.Dc()),2&e){const e=D.Oc(3);D.lc(1),D.rd(" ",D.Rc(2,1,"addon.messages.yourcontactrequestpending",D.ad(4,discussion_page_c0,e.otherMember.fullname))," ")}}function AddonMessagesDiscussionPage_ion_footer_46_div_6_Template(e,s){if(1&e&&(D.Ec(0,"div",46),D.Ec(1,"p",29),D.Ec(2,"strong"),D.pd(3),D.Pc(4,"translate"),D.Dc(),D.Dc(),D.nd(5,AddonMessagesDiscussionPage_ion_footer_46_div_6_p_5_Template,3,6,"p",49),D.Dc()),2&e){const e=D.Oc(2);D.lc(3),D.qd(D.Qc(4,2,"addon.messages.contactrequestsent")),D.lc(2),D.Vc("ngIf",e.otherMember)}}function AddonMessagesDiscussionPage_ion_footer_46_core_send_message_form_7_Template(e,s){if(1&e){const e=D.Fc();D.Ec(0,"core-send-message-form",50),D.Mc("onSubmit",(function AddonMessagesDiscussionPage_ion_footer_46_core_send_message_form_7_Template_core_send_message_form_onSubmit_0_listener(s){D.fd(e);return D.Oc(2).sendMessage(s)})),D.Pc(1,"translate"),D.Dc()}if(2&e){const e=D.Oc(2);D.Vc("showKeyboard",e.showKeyboard)("placeholder",D.Qc(1,2,"addon.messages.newmessage"))}}function AddonMessagesDiscussionPage_ion_footer_46_Template(e,s){if(1&e&&(D.Ec(0,"ion-footer",40),D.Ec(1,"ion-toolbar",41),D.nd(2,AddonMessagesDiscussionPage_ion_footer_46_p_2_Template,3,3,"p",42),D.nd(3,AddonMessagesDiscussionPage_ion_footer_46_div_3_Template,7,6,"div",43),D.nd(4,AddonMessagesDiscussionPage_ion_footer_46_div_4_Template,11,15,"div",43),D.nd(5,AddonMessagesDiscussionPage_ion_footer_46_div_5_Template,10,12,"div",43),D.nd(6,AddonMessagesDiscussionPage_ion_footer_46_div_6_Template,6,4,"div",43),D.nd(7,AddonMessagesDiscussionPage_ion_footer_46_core_send_message_form_7_Template,2,4,"core-send-message-form",44),D.Dc(),D.Dc()),2&e){const e=D.Oc();D.lc(1),D.Vc("color","message"==e.footerType?"contrast":"light"),D.lc(1),D.Vc("ngIf","unable"==e.footerType),D.lc(1),D.Vc("ngIf","blocked"==e.footerType),D.lc(1),D.Vc("ngIf","requiresContact"==e.footerType&&e.otherMember),D.lc(1),D.Vc("ngIf","requestReceived"==e.footerType&&e.otherMember),D.lc(1),D.Vc("ngIf","requestSent"==e.footerType||"message"==e.footerType&&e.requestContactSent),D.lc(1),D.Vc("ngIf","message"==e.footerType)}}let J=(()=>{class AddonMessagesDiscussionPage{constructor(e,s){this.route=e,this.elementRef=s,this.fetching=!1,this.messagesBeingSent=0,this.pagesLoaded=1,this.lastMessage={text:"",timecreated:0},this.keepMessageMap={},this.oldContentHeight=0,this.scrollBottom=!0,this.viewDestroyed=!1,this.showLoadingModal=!1,this.showInfo=!1,this.loaded=!1,this.showKeyboard=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.messages=[],this.showDelete=!1,this.canDelete=!1,this.isGroup=!1,this.members={},this.favouriteIcon="fa-star",this.deleteIcon="fas-trash",this.blockIcon="fas-user-lock",this.addRemoveIcon="fas-user-plus",this.muteIcon="fas-bell-slash",this.favouriteIconSlash=!1,this.muteEnabled=!1,this.footerType="unable",this.requestContactSent=!1,this.requestContactReceived=!1,this.isSelf=!1,this.newMessages=0,this.unreadMessageFrom=0,this.initialized=!1,this.hostElement=s.nativeElement,this.siteId=c.b.getCurrentSiteId(),this.currentUserId=c.b.getCurrentSiteUserId(),this.groupMessagingEnabled=d.a.isGroupMessagingEnabled(),this.muteEnabled=d.a.isMuteConversationEnabled(),this.logger=_.a.getInstance("AddonMessagesDiscussionPage"),this.syncObserver=r.b.on(h.b.AUTO_SYNCED,(e=>{(e.userId&&e.userId==this.userId||e.conversationId&&e.conversationId==this.conversationId)&&(this.fetchMessages(),e.warnings&&e.warnings[0]&&m.a.showErrorModal(e.warnings[0]))}),this.siteId),this.memberInfoObserver=r.b.on(d.b.MEMBER_INFO_CHANGED_EVENT,(e=>{e.userId&&(this.members[e.userId]||this.otherMember&&e.userId==this.otherMember.id)&&this.fetchData()}),this.siteId)}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){this.route.queryParams.subscribe((e=>Object(i.a)(this,void 0,void 0,(function*(){const s=this.conversationId,t=this.userId;let o=!1;this.conversationId=P.a.getRouteNumberParam("conversationId",{params:e})||void 0,this.userId=P.a.getRouteNumberParam("userId",{params:e})||void 0,this.showInfo=!e.hideInfo,s==this.conversationId&&t==this.userId||(this.loaded=!1,this.initialized=!1,o=!0),this.showKeyboard=P.a.getRouteBooleanParam("showKeyboard",{params:e})||!1,yield this.fetchData(),this.scrollToBottom(o)}))))}))}ngAfterViewInit(){var e;return Object(i.a)(this,void 0,void 0,(function*(){this.scrollElement=yield null===(e=this.content)||void 0===e?void 0:e.getScrollElement()}))}addMessage(e,s=!0){e.hash=b.Md5.hashAsciiStr(String(("id"in e?e.id:"")||e.text||""))+"#"+e.timecreated+"#"+e.useridfrom;let t=!1;return void 0===this.keepMessageMap[e.hash]&&(this.messages.push(e),t=e.useridfrom!=this.currentUserId),this.keepMessageMap[e.hash]=s,t}removeMessage(e){if(this.keepMessageMap[e])return this.keepMessageMap[e]=!1,void 0;delete this.keepMessageMap[e];const s=this.messages.findIndex((s=>s.hash==e));s>=0&&this.messages.splice(s,1)}fetchData(){return Object(i.a)(this,void 0,void 0,(function*(){let e;this.showLoadingModal&&(e=yield m.a.showModalLoading()),!this.groupMessagingEnabled&&this.userId&&g.a.getProfile(this.userId,void 0,!0).then((e=>{this.title||(this.title=e.fullname),this.conversationImage=e.profileimageurl,this.members[e.id]=e})).catch((()=>{}));try{const e=yield h.a.syncDiscussion(this.conversationId,this.userId);e.warnings&&e.warnings[0]&&m.a.showErrorModal(e.warnings[0])}catch(e){}try{const s=[];if(this.groupMessagingEnabled){const e=yield this.getConversation(this.conversationId,this.userId);e&&s.push(this.fetchMessages()),this.userId?s.push(d.a.invalidateMemberInfo(this.userId).then((()=>Object(i.a)(this,void 0,void 0,(function*(){this.otherMember=yield d.a.getMemberInfo(this.userId),!e&&this.otherMember&&(this.conversationImage=this.otherMember.profileimageurl,this.title=this.otherMember.fullname),this.blockIcon=this.otherMember.isblocked?"fas-user-check":"fas-user-lock"}))))):this.otherMember=void 0}else this.userId&&s.push(g.a.getProfile(this.userId).then((e=>Object(i.a)(this,void 0,void 0,(function*(){this.otherMember={id:e.id,fullname:e.fullname,profileurl:"",profileimageurl:e.profileimageurl||"",profileimageurlsmall:e.profileimageurlsmall||"",isonline:!1,showonlinestatus:!1,isblocked:!1,iscontact:!1,isdeleted:!1,canmessageevenifblocked:!0,canmessage:!0,requirescontact:!1},this.otherMember.isblocked=yield d.a.isBlocked(this.userId),this.otherMember.iscontact=yield d.a.isContact(this.userId),this.blockIcon=this.otherMember.isblocked?"fas-user-check":"fas-user-lock"}))))),s.push(this.fetchMessages().then((()=>{if(!this.title&&this.messages.length){const e=this.messages[0];"usertofullname"in e&&(this.title=e.useridto!=this.currentUserId?e.usertofullname||"":e.userfromfullname||"")}})));yield Promise.all(s)}catch(e){m.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingmessages",!0)}finally{this.checkCanDelete(),this.loaded=!0,this.setPolling(),this.setContactRequestInfo(),this.setFooterType(),e&&e.dismiss()}}))}ionViewDidEnter(){this.setPolling()}ionViewWillLeave(){this.unsetPolling()}fetchMessages(e=!0){return Object(i.a)(this,void 0,void 0,(function*(){if(this.loadMoreError=!1,!(this.messagesBeingSent>0||this.fetching)){if(this.groupMessagingEnabled&&!this.conversationId)throw new y.a("No enough data provided to fetch messages");if(this.conversationId)this.logger.debug(`Polling new messages for conversation '${this.conversationId}'`);else{if(!this.userId)throw new y.a("No enough data provided to fetch messages");this.logger.debug(`Polling new messages for discussion with user '${this.userId}'`)}this.fetching=!0;try{yield h.a.waitForSyncConversation(this.conversationId,this.userId);let s=[];this.groupMessagingEnabled?(yield d.a.invalidateConversationMessages(this.conversationId),s=yield this.getConversationMessages(this.pagesLoaded)):(yield d.a.invalidateDiscussionCache(this.userId),s=yield this.getDiscussionMessages(this.pagesLoaded)),this.loadMessages(s,e)}finally{this.fetching=!1}}}))}loadMessages(e,s=!0){if(this.viewDestroyed)return;if(this.scrollBottom=R.a.scrollIsBottom(this.scrollElement,5),this.messagesBeingSent>0)return;const t=e.reduce(((e,s)=>e+(this.addMessage(s)?1:0)),0);s&&this.setNewMessagesBadge(this.newMessages+t);for(const e in this.keepMessageMap)this.removeMessage(e);d.a.sortMessages(this.messages),this.messages.forEach(((e,s)=>{e.showDate=this.showDate(e,this.messages[s-1]),e.showUserData=this.showUserData(e,this.messages[s-1]),e.showTail=this.showTail(e,this.messages[s+1])}));const o=this.messages[this.messages.length-1],n=this.groupMessagingEnabled&&o&&o.useridfrom!=this.currentUserId&&""!=this.lastMessage.text&&(o.text!==this.lastMessage.text||o.timecreated!==this.lastMessage.timecreated);this.notifyNewMessage(),this.markMessagesAsRead(n)}setNewMessagesBadge(e){0==this.newMessages&&e>0&&this.scrollFunction(),this.newMessages=e}scrollFunction(){var e;if(0==this.newMessages)return;if(R.a.scrollIsBottom(this.scrollElement,40))return this.setNewMessagesBadge(0),void 0;const s=null===(e=this.scrollElement)||void 0===e?void 0:e.getBoundingClientRect(),t=s&&s.bottom||0;if(0==t)return;const o=Array.from(this.hostElement.querySelectorAll("core-message:not(.is-mine)")).slice(-this.newMessages).reverse().findIndex((e=>{const s=e.getBoundingClientRect();return!!s&&s.bottom<=t}));o>0&&o<this.newMessages&&this.setNewMessagesBadge(o)}getConversation(e,s){return Object(i.a)(this,void 0,void 0,(function*(){let t;if(!e&&s)try{t=s===this.currentUserId&&d.a.isSelfConversationEnabled()?yield d.a.getSelfConversation():yield d.a.getConversationBetweenUsers(s,void 0,!0),e=t.id}catch(e){this.isSelf=s===this.currentUserId;const t=yield l.a.getMessages(s);if(t&&t.length)t.forEach((e=>{e.pending=!0,e.text=e.smallmessage})),this.loadMessages(t);else if("errorconversationdoesnotexist"!=e.errorcode)throw e;return!1}if(!e)return!1;yield d.a.invalidateConversation(e);try{this.conversation=yield d.a.getConversation(e,void 0,!0)}catch(e){if(!t)throw e;this.conversation=t}return!!this.conversation&&(this.conversationId=this.conversation.id,this.title=this.conversation.name,this.conversationImage=this.conversation.imageurl,this.isGroup=this.conversation.type==d.b.MESSAGE_CONVERSATION_TYPE_GROUP,this.favouriteIcon="fas-star",this.favouriteIconSlash=this.conversation.isfavourite,this.muteIcon=this.conversation.ismuted?"fas-bell":"fas-bell-slash",this.isGroup||(this.userId=this.conversation.userid),this.isSelf=this.conversation.type==d.b.MESSAGE_CONVERSATION_TYPE_SELF,!0)}))}getConversationMessages(e,s=0){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.conversationId)return[];const t=s>0,o=yield d.a.getConversationMessages(this.conversationId,{excludePending:t,limitFrom:s});e--,o.members&&o.members.forEach((e=>{this.members[e.id]=e}));const n=o.messages;if(e>0&&o.canLoadMore){s+=d.b.LIMIT_MESSAGES;const t=yield this.getConversationMessages(e,s);return n.concat(t)}return this.canLoadMore=!!o.canLoadMore,n}))}getDiscussionMessages(e,s=0,t=0,o=0,n=0){return Object(i.a)(this,void 0,void 0,(function*(){const i=s>0||t>0||o>0||n>0,a=yield d.a.getDiscussion(this.userId,i,s,t,o,n);if(--e>0&&a.canLoadMore){a.messages.forEach((e=>{!e.pending&&"read"in e&&(e.useridfrom==this.userId?e.read?t++:s++:e.read?n++:o++)}));const i=yield this.getDiscussionMessages(e,s,t,o,n);return a.messages.concat(i)}return this.canLoadMore=a.canLoadMore,a.messages}))}markMessagesAsRead(e){var s,t;return Object(i.a)(this,void 0,void 0,(function*(){let o=!1,n=!1;n=!!e||(this.groupMessagingEnabled?!!((null===(s=this.conversation)||void 0===s?void 0:s.unreadcount)&&(null===(t=this.conversation)||void 0===t?void 0:t.unreadcount)>0&&this.conversationId&&this.conversationId>0):this.messages.some((e=>e.useridfrom!=this.currentUserId&&"read"in e&&!e.read))),n&&(this.setUnreadLabelPosition(),this.groupMessagingEnabled?yield d.a.markAllConversationMessagesRead(this.conversationId):(yield d.a.markAllMessagesRead(this.userId),this.messages.forEach((e=>{"read"in e&&(e.read=!0)}))),o=!0),o&&r.b.trigger(d.b.READ_CHANGED_EVENT,{conversationId:this.conversationId,userId:this.userId},this.siteId)}))}notifyNewMessage(){var e,s;const t=this.messages[this.messages.length-1];let o=!1;if(t?t.text===this.lastMessage.text&&t.timecreated===this.lastMessage.timecreated||(this.lastMessage={text:t.text||"",timecreated:t.timecreated},o=!0):(this.lastMessage={text:"",timecreated:0},o=!0),o){r.b.trigger(d.b.NEW_MESSAGE_EVENT,{conversationId:this.conversationId,userId:this.userId,message:this.lastMessage.text,timecreated:this.lastMessage.timecreated,isfavourite:!!(null===(e=this.conversation)||void 0===e?void 0:e.isfavourite),type:null===(s=this.conversation)||void 0===s?void 0:s.type},this.siteId);this.canDelete!=(t&&"id"in t&&t.id&&1==this.messages.length||this.messages.length>1)&&this.checkCanDelete()}}setUnreadLabelPosition(){var e,s;if(0==this.unreadMessageFrom){if(this.groupMessagingEnabled){if(this.conversation&&(null===(e=this.conversation)||void 0===e?void 0:e.unreadcount)&&(null===(s=this.conversation)||void 0===s?void 0:s.unreadcount)>0&&this.messages){let e=0;for(let s=this.messages.length-1;s>=0;s--){const t=this.messages[s];if(!t.pending&&t.useridfrom!=this.currentUserId&&"id"in t&&(e++,e==this.conversation.unreadcount)){this.unreadMessageFrom=Number(t.id);break}}}}else{let e=!1;for(const s in this.messages){const t=this.messages[s];if(t.useridfrom!=this.currentUserId&&"read"in t){if(!t.read&&e){this.unreadMessageFrom=Number(t.id);break}e=!!t.read}}}0==this.unreadMessageFrom&&(this.unreadMessageFrom=-1)}}checkCanDelete(){const e=this.messages[0];this.canDelete=e&&!e.sending}hideUnreadLabel(){this.unreadMessageFrom>0&&(this.unreadMessageFrom=-1)}waitForFetch(){return Object(i.a)(this,void 0,void 0,(function*(){this.fetching&&(yield u.a.wait(400),yield u.a.ignoreErrors(this.waitForFetch()))}))}setPolling(){this.groupMessagingEnabled&&!this.conversationId||this.polling||(this.polling=window.setInterval((()=>{this.fetchMessages().catch((()=>{}))}),d.b.POLL_INTERVAL))}unsetPolling(){this.polling&&(this.logger.debug(`Cancelling polling for conversation with user '${this.userId}'`),clearInterval(this.polling),this.polling=void 0)}copyMessage(e){u.a.copyToClipboard(f.a.decodeHTMLEntities("smallmessage"in e?e.smallmessage||e.text||"":e.text||""))}deleteMessage(e,s){return Object(i.a)(this,void 0,void 0,(function*(){const t=this.conversation&&this.conversation.candeletemessagesforallusers,o=e.pending||t||this.isSelf?"core.areyousure":"addon.messages.deletemessageconfirmation",n={};t&&!e.pending&&(n.inputs=[{type:"checkbox",name:"deleteforall",checked:!1,value:!0,label:C.J.instant("addon.messages.deleteforeveryone")}]);try{const t=yield m.a.showConfirm(C.J.instant(o),void 0,void 0,void 0,n),i=yield m.a.showModalLoading("core.deleting",!0);try{yield d.a.deleteMessage(e,t&&t[0]),this.messages.splice(s,1),this.removeMessage(e.hash),this.notifyNewMessage(),this.fetchMessages()}finally{i.dismiss()}}catch(e){m.a.showErrorModalDefault(e,"addon.messages.errordeletemessage",!0)}}))}loadPrevious(e){var s,t,o,n;return Object(i.a)(this,void 0,void 0,(function*(){if(!this.initialized)return e&&e(),void 0;let i=(null===(s=this.infinite)||void 0===s?void 0:s.hostElement.getBoundingClientRect().height)||0;const a=(null===(t=this.scrollElement)||void 0===t?void 0:t.scrollHeight)||0;try{yield this.waitForFetch()}finally{this.pagesLoaded++;try{yield this.fetchMessages(!1);const s=a-((null===(o=this.scrollElement)||void 0===o?void 0:o.scrollTop)||0),t=(null===(n=this.infinite)||void 0===n?void 0:n.hostElement.getBoundingClientRect().height)||0;this.canLoadMore&&i&&this.infinite?i-=t:this.canLoadMore||(i=i||t),this.keepScroll(a,s,i)}catch(e){this.loadMoreError=!0,this.pagesLoaded--,m.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingmessages",!0)}finally{e&&e()}}}))}keepScroll(e,s,t,o=0){setTimeout((()=>{var n;if(((null===(n=this.scrollElement)||void 0===n?void 0:n.scrollHeight)||0)==e)return o<=10&&this.keepScroll(e,s,t,o+1),void 0;setTimeout((()=>{var e;const o=(null===(e=this.scrollElement)||void 0===e?void 0:e.scrollHeight)||0;this.content.scrollToPoint(0,o-s+t,0)}),30)}),30)}scrollToBottom(e=!1){return Object(i.a)(this,void 0,void 0,(function*(){(this.scrollBottom||e)&&(this.scrollBottom=!1,this.setNewMessagesBadge(0),yield u.a.nextTicks(5),!this.viewDestroyed&&this.content&&this.content.scrollToBottom(0),e&&(this.initialized=!0))}))}scrollToFirstUnreadMessage(){if(this.newMessages>0){const e=Array.from(this.hostElement.querySelectorAll("core-message:not(.is-mine)"));R.a.scrollToElement(e[e.length-this.newMessages])}}sendMessage(e){return Object(i.a)(this,void 0,void 0,(function*(){this.hideUnreadLabel(),this.showDelete=!1,this.scrollBottom=!0,this.setNewMessagesBadge(0);const s={id:-1,pending:!0,sending:!0,useridfrom:this.currentUserId,smallmessage:e,text:e,timecreated:Date.now()};s.showDate=this.showDate(s,this.messages[this.messages.length-1]),this.addMessage(s,!1),this.messagesBeingSent++;try{yield this.waitForFetch()}finally{try{let t;t=this.conversationId?yield d.a.sendMessageToConversation(this.conversation,e):yield d.a.sendMessage(this.userId,e),this.messagesBeingSent--;let o=!1;if(t.sent)try{if(!this.conversationId&&t.message&&"conversationid"in t.message){yield this.getConversation(t.message.conversationid,this.userId);try{yield this.fetchMessages()}finally{this.setPolling()}}else yield this.fetchMessages()}catch(e){o=!0}!o&&t.sent||(s.sending=!1,t.sent?s.pending=!1:t.message&&(s.timecreated=t.message.timecreated||0),this.notifyNewMessage())}catch(e){this.messagesBeingSent--,M.a.closeKeyboard(),m.a.showErrorModalDefault(e,"addon.messages.messagenotsent",!0),this.removeMessage(s.hash)}}}))}showDate(e,s){return!s||!I()(e.timecreated).isSame(s.timecreated,"day")}showUserData(e,s){return this.isGroup&&e.useridfrom!=this.currentUserId&&this.members[e.useridfrom||0]&&(!s||s.useridfrom!=e.useridfrom||!!e.showDate)}showTail(e,s){return!s||s.useridfrom!=e.useridfrom||!!s.showDate}viewInfo(){return Object(i.a)(this,void 0,void 0,(function*(){if(this.isGroup){const e=yield m.a.openSideModal({component:N,componentProps:{conversationId:this.conversationId}});if(void 0!==e){P.a.isCurrentPathInTablet("**/messages/**/discussion")?r.b.trigger(d.b.OPEN_CONVERSATION_EVENT,{userId:e},this.siteId):P.a.navigateToSitePath("/messages/discussion",{params:{userId:e}})}}else P.a.navigateToSitePath("/user/profile",{params:{userId:this.userId}})}))}changeFavourite(e){return Object(i.a)(this,void 0,void 0,(function*(){if(this.conversation){this.favouriteIcon=V.a.ICON_LOADING;try{yield d.a.setFavouriteConversation(this.conversation.id,!this.conversation.isfavourite),this.conversation.isfavourite=!this.conversation.isfavourite,d.a.getConversation(this.conversation.id,void 0,!0),r.b.trigger(d.b.UPDATE_CONVERSATION_LIST_EVENT,{conversationId:this.conversation.id,action:"favourite",value:this.conversation.isfavourite},this.siteId)}catch(e){m.a.showErrorModalDefault(e,"Error changing favourite state.")}finally{this.favouriteIcon="fas-star",this.favouriteIconSlash=this.conversation.isfavourite,e&&e()}}}))}changeMute(e){return Object(i.a)(this,void 0,void 0,(function*(){if(this.conversation){this.muteIcon=V.a.ICON_LOADING;try{yield d.a.muteConversation(this.conversation.id,!this.conversation.ismuted),this.conversation.ismuted=!this.conversation.ismuted,d.a.getConversation(this.conversation.id,void 0,!0),r.b.trigger(d.b.UPDATE_CONVERSATION_LIST_EVENT,{conversationId:this.conversation.id,action:"mute",value:this.conversation.ismuted},this.siteId)}catch(e){m.a.showErrorModalDefault(e,"Error changing muted state.")}finally{this.muteIcon=this.conversation.ismuted?"fas-bell":"fas-bell-slash",e&&e()}}}))}setContactRequestInfo(){var e,s;this.requestContactSent=!1,this.requestContactReceived=!1,this.otherMember&&!this.otherMember.iscontact&&(this.requestContactSent=!!(null===(e=this.otherMember.contactrequests)||void 0===e?void 0:e.some((e=>e.userid==this.currentUserId&&e.requesteduserid==this.otherMember.id))),this.requestContactReceived=!!(null===(s=this.otherMember.contactrequests)||void 0===s?void 0:s.some((e=>e.userid==this.otherMember.id&&e.requesteduserid==this.currentUserId))))}setFooterType(){this.footerType=this.otherMember?this.otherMember.isblocked?"blocked":this.requestContactReceived?"requestReceived":this.otherMember.canmessage?"message":this.requestContactSent?"requestSent":this.otherMember.requirescontact?"requiresContact":"unable":"message"}blockUser(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new y.a("No member selected to be blocked.");if(this.otherMember.canmessageevenifblocked)return m.a.showErrorModal(C.J.instant("addon.messages.cantblockuser",{$a:this.otherMember.fullname})),void 0;const e=C.J.instant("addon.messages.blockuserconfirm",{$a:this.otherMember.fullname}),s=C.J.instant("addon.messages.blockuser");try{yield m.a.showConfirm(e,void 0,s),this.blockIcon=V.a.ICON_LOADING;const t=yield m.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield d.a.blockContact(this.otherMember.id)}finally{t.dismiss(),this.showLoadingModal=!1}}catch(e){m.a.showErrorModalDefault(e,"core.error",!0)}finally{this.blockIcon=this.otherMember.isblocked?"fas-user-check":"fas-user-lock"}}catch(e){}}))}deleteConversation(e){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.conversation)return;const s="addon.messages."+(this.isSelf?"deleteallselfconfirm":"deleteallconfirm");try{yield m.a.showDeleteConfirm(s),this.deleteIcon=V.a.ICON_LOADING;try{try{yield d.a.deleteConversation(this.conversation.id),r.b.trigger(d.b.UPDATE_CONVERSATION_LIST_EVENT,{conversationId:this.conversation.id,action:"delete"},this.siteId),this.messages=[]}finally{e&&e()}}catch(e){m.a.showErrorModalDefault(e,"Error deleting conversation.")}finally{this.deleteIcon="fas-trash"}}catch(e){}}))}unblockUser(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new y.a("No member selected to be unblocked.");const e=C.J.instant("addon.messages.unblockuserconfirm",{$a:this.otherMember.fullname}),s=C.J.instant("addon.messages.unblockuser");try{yield m.a.showConfirm(e,void 0,s),this.blockIcon=V.a.ICON_LOADING;const t=yield m.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield d.a.unblockContact(this.otherMember.id)}finally{t.dismiss(),this.showLoadingModal=!1}}catch(e){m.a.showErrorModalDefault(e,"core.error",!0)}finally{this.blockIcon=this.otherMember.isblocked?"fas-user-check":"fas-user-lock"}}catch(e){}}))}createContactRequest(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new y.a("No member selected to be requested.");const e=C.J.instant("addon.messages.addcontactconfirm",{$a:this.otherMember.fullname}),s=C.J.instant("core.add");try{yield m.a.showConfirm(e,void 0,s),this.addRemoveIcon=V.a.ICON_LOADING;const t=yield m.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield d.a.createContactRequest(this.otherMember.id)}finally{t.dismiss(),this.showLoadingModal=!1}}catch(e){m.a.showErrorModalDefault(e,"core.error",!0)}finally{this.addRemoveIcon="fas-user-plus"}}catch(e){}}))}confirmContactRequest(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new y.a("No member selected to be confirmed.");const e=yield m.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield d.a.confirmContactRequest(this.otherMember.id)}finally{e.dismiss(),this.showLoadingModal=!1}}catch(e){m.a.showErrorModalDefault(e,"core.error",!0)}}))}declineContactRequest(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new y.a("No member selected to be declined.");const e=yield m.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield d.a.declineContactRequest(this.otherMember.id)}finally{e.dismiss(),this.showLoadingModal=!1}}catch(e){m.a.showErrorModalDefault(e,"core.error",!0)}}))}removeContact(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new y.a("No member selected to be removed.");const e=C.J.instant("addon.messages.removecontactconfirm",{$a:this.otherMember.fullname}),s=C.J.instant("core.remove");try{yield m.a.showConfirm(e,void 0,s),this.addRemoveIcon=V.a.ICON_LOADING;const t=yield m.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield d.a.removeContact(this.otherMember.id)}finally{t.dismiss(),this.showLoadingModal=!1}}catch(e){m.a.showErrorModalDefault(e,"core.error",!0)}finally{this.addRemoveIcon="fas-user-plus"}}catch(e){}}))}ngOnDestroy(){var e,s;this.unsetPolling(),null===(e=this.syncObserver)||void 0===e||e.off(),null===(s=this.memberInfoObserver)||void 0===s||s.off(),this.viewDestroyed=!0}}return AddonMessagesDiscussionPage.ɵfac=function AddonMessagesDiscussionPage_Factory(e){return new(e||AddonMessagesDiscussionPage)(D.yc(o.a),D.yc(D.r))},AddonMessagesDiscussionPage.ɵcmp=D.sc({type:AddonMessagesDiscussionPage,selectors:[["page-addon-messages-discussion"]],viewQuery:function AddonMessagesDiscussionPage_Query(e,s){var t;(1&e&&(D.ud(a.v,!0),D.ud(v.a,!0)),2&e)&&(D.dd(t=D.Nc())&&(s.content=t.first),D.dd(t=D.Nc())&&(s.infinite=t.first))},decls:47,vars:87,consts:[["slot","start"],[3,"text"],["class","core-bar-button-image","alt","","onError","this.src='assets/img/group-avatar.svg'","core-external-content","","role","presentation",3,"src","siteId",4,"ngIf"],["class","core-bar-button-image",3,"user","linkProfile","checkOnline",4,"ngIf"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-star",4,"ngIf"],["name","fas-bell-slash",4,"ngIf"],["slot","end"],["iconAction","fas-info-circle",3,"hidden","priority","content","action"],[3,"hidden","priority","closeOnClick","content","iconAction","iconSlash","action"],[3,"hidden","priority","content","iconAction","action"],[3,"hidden","priority","closeOnClick","content","iconAction","action"],["iconAction","toggle",3,"hidden","priority","content","toggle","toggleChange"],[3,"hidden","priority","content","closeOnClick","iconAction","action"],[3,"hidden","priority","content","iconAction","iconSlash","action"],[3,"ionScroll"],[3,"hideUntil"],["position","top",3,"enabled","error","action"],[4,"ngIf"],[1,"sr-only"],[1,"addon-messages-discussion-container"],[4,"ngFor","ngForOf"],["icon","far-comments",3,"message",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["class","footer-adjustable",4,"ngIf"],["alt","","onError","this.src='assets/img/group-avatar.svg'","core-external-content","","role","presentation",1,"core-bar-button-image",3,"src","siteId"],[1,"core-bar-button-image",3,"user","linkProfile","checkOnline"],["name","fas-star"],["name","fas-bell-slash"],[1,"ion-text-center"],["class","ion-text-center addon-messages-date",4,"ngIf"],["class","addon-messages-unreadfrom","color","light",4,"ngIf"],[3,"message","user","text","showDelete","time","afterRender","onDeleteMessage"],[1,"ion-text-center","addon-messages-date"],["color","light",1,"addon-messages-unreadfrom"],["name","fas-arrow-down","aria-hidden","true"],["icon","far-comments",3,"message"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],["size","small","color","light",3,"click"],[1,"core-discussion-messages-badge"],[1,"footer-adjustable"],[3,"color"],["class","ion-text-center ion-margin-horizontal",4,"ngIf"],["class","ion-padding-horizontal",4,"ngIf"],[3,"showKeyboard","placeholder","onSubmit",4,"ngIf"],[1,"ion-text-center","ion-margin-horizontal"],[1,"ion-padding-horizontal"],["expand","block",1,"ion-text-wrap","ion-margin-bottom",3,"click"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin-bottom",3,"click"],["class","ion-text-center",4,"ngIf"],[3,"showKeyboard","placeholder","onSubmit"]],template:function AddonMessagesDiscussionPage_Template(e,s){1&e&&(D.Ec(0,"ion-header"),D.Ec(1,"ion-toolbar"),D.Ec(2,"ion-buttons",0),D.zc(3,"ion-back-button",1),D.Pc(4,"translate"),D.Dc(),D.Ec(5,"ion-title"),D.Ec(6,"h1"),D.nd(7,AddonMessagesDiscussionPage_img_7_Template,1,2,"img",2),D.nd(8,AddonMessagesDiscussionPage_core_user_avatar_8_Template,1,3,"core-user-avatar",3),D.zc(9,"core-format-text",4),D.nd(10,AddonMessagesDiscussionPage_ion_icon_10_Template,2,3,"ion-icon",5),D.nd(11,AddonMessagesDiscussionPage_ion_icon_11_Template,2,3,"ion-icon",6),D.Dc(),D.Dc(),D.zc(12,"ion-buttons",7),D.Dc(),D.Ec(13,"core-navbar-buttons",7),D.Ec(14,"core-context-menu"),D.Pc(15,"translate"),D.Ec(16,"core-context-menu-item",8),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_16_listener(){return s.viewInfo()})),D.Pc(17,"translate"),D.Dc(),D.Ec(18,"core-context-menu-item",8),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_18_listener(){return s.viewInfo()})),D.Pc(19,"translate"),D.Dc(),D.Ec(20,"core-context-menu-item",9),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_20_listener(e){return s.changeFavourite(e)})),D.Pc(21,"translate"),D.Dc(),D.Ec(22,"core-context-menu-item",10),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_22_listener(){return s.blockUser()})),D.Pc(23,"translate"),D.Dc(),D.Ec(24,"core-context-menu-item",10),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_24_listener(){return s.unblockUser()})),D.Pc(25,"translate"),D.Dc(),D.Ec(26,"core-context-menu-item",11),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_26_listener(e){return s.changeMute(e)})),D.Pc(27,"translate"),D.Dc(),D.Ec(28,"core-context-menu-item",12),D.Mc("toggleChange",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_toggleChange_28_listener(e){return s.showDelete=e})),D.Pc(29,"translate"),D.Dc(),D.Ec(30,"core-context-menu-item",13),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_30_listener(e){return s.deleteConversation(e)})),D.Pc(31,"translate"),D.Dc(),D.Ec(32,"core-context-menu-item",10),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_32_listener(){return s.createContactRequest()})),D.Pc(33,"translate"),D.Dc(),D.Ec(34,"core-context-menu-item",14),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_34_listener(){return s.removeContact()})),D.Pc(35,"translate"),D.Dc(),D.Dc(),D.Dc(),D.Dc(),D.Ec(36,"ion-content",15),D.Mc("ionScroll",(function AddonMessagesDiscussionPage_Template_ion_content_ionScroll_36_listener(){return s.scrollFunction()})),D.Ec(37,"core-loading",16),D.Ec(38,"core-infinite-loading",17),D.Mc("action",(function AddonMessagesDiscussionPage_Template_core_infinite_loading_action_38_listener(e){return s.loadPrevious(e)})),D.Dc(),D.nd(39,AddonMessagesDiscussionPage_ng_container_39_Template,8,6,"ng-container",18),D.Ec(40,"h2",19),D.pd(41),D.Dc(),D.Ec(42,"ion-list",20),D.nd(43,AddonMessagesDiscussionPage_ng_container_43_Template,4,7,"ng-container",21),D.Dc(),D.nd(44,AddonMessagesDiscussionPage_core_empty_box_44_Template,2,3,"core-empty-box",22),D.Dc(),D.nd(45,AddonMessagesDiscussionPage_ion_fab_45_Template,9,7,"ion-fab",23),D.Dc(),D.nd(46,AddonMessagesDiscussionPage_ion_footer_46_Template,8,7,"ion-footer",24)),2&e&&(D.lc(3),D.Vc("text",D.Qc(4,63,"core.back")),D.lc(4),D.Vc("ngIf",s.loaded&&!s.otherMember&&s.conversationImage),D.lc(1),D.Vc("ngIf",s.loaded&&s.otherMember),D.lc(1),D.Vc("text",s.title)("contextInstanceId",0),D.lc(1),D.Vc("ngIf",s.conversation&&s.conversation.isfavourite),D.lc(1),D.Vc("ngIf",s.conversation&&s.conversation.ismuted),D.lc(3),D.mc("aria-label",D.Qc(15,65,"addon.messages.conversationactions")),D.lc(2),D.Vc("hidden",s.isSelf||!s.showInfo||s.isGroup)("priority",1e3)("content",D.Qc(17,67,"addon.messages.info")),D.lc(2),D.Vc("hidden",s.isSelf||!s.showInfo||!s.isGroup)("priority",1e3)("content",D.Qc(19,69,"addon.messages.groupinfo")),D.lc(2),D.Vc("hidden",!s.groupMessagingEnabled||!s.conversation)("priority",800)("closeOnClick",!1)("content",D.Qc(21,71,s.conversation&&s.conversation.isfavourite?"addon.messages.removefromfavourites":"addon.messages.addtofavourites"))("iconAction",s.favouriteIcon)("iconSlash",s.favouriteIconSlash),D.lc(2),D.Vc("hidden",s.isSelf||!s.otherMember||s.otherMember.isblocked)("priority",700)("content",D.Qc(23,73,"addon.messages.blockuser"))("iconAction",s.blockIcon),D.lc(2),D.Vc("hidden",s.isSelf||!s.otherMember||!s.otherMember.isblocked)("priority",700)("content",D.Qc(25,75,"addon.messages.unblockuser"))("iconAction",s.blockIcon),D.lc(2),D.Vc("hidden",s.isSelf||!s.muteEnabled||!s.conversation)("priority",600)("closeOnClick",!1)("content",D.Qc(27,77,s.conversation&&s.conversation.ismuted?"addon.messages.unmuteconversation":"addon.messages.muteconversation"))("iconAction",s.muteIcon),D.lc(2),D.Vc("hidden",!s.canDelete||!s.messages||!s.messages.length)("priority",400)("content",D.Qc(29,79,"addon.messages.showdeletemessages"))("toggle",s.showDelete),D.lc(2),D.Vc("hidden",!s.groupMessagingEnabled||!s.conversationId||s.isGroup||!s.messages||!s.messages.length)("priority",200)("content",D.Qc(31,81,"addon.messages.deleteconversation"))("closeOnClick",!1)("iconAction",s.deleteIcon),D.lc(2),D.Vc("hidden",s.isSelf||!s.otherMember||s.otherMember.iscontact||s.requestContactSent||s.requestContactReceived)("priority",100)("content",D.Qc(33,83,"addon.messages.addtoyourcontacts"))("iconAction",s.addRemoveIcon),D.lc(2),D.Vc("hidden",s.isSelf||!s.otherMember||!s.otherMember.iscontact)("priority",100)("content",D.Qc(35,85,"addon.messages.removefromyourcontacts"))("iconAction",s.addRemoveIcon)("iconSlash",!0),D.lc(3),D.Vc("hideUntil",s.loaded),D.lc(1),D.Vc("enabled",s.canLoadMore)("error",s.loadMoreError),D.lc(1),D.Vc("ngIf",s.isSelf&&!s.canLoadMore),D.lc(2),D.qd(s.title),D.lc(1),D.qc("addon-messages-discussion-group",s.isGroup),D.mc("aria-live","polite"),D.lc(1),D.Vc("ngForOf",s.messages),D.lc(1),D.Vc("ngIf",!s.messages||s.messages.length<=0),D.lc(1),D.Vc("ngIf",s.loaded&&s.newMessages>0),D.lc(1),D.Vc("ngIf",s.loaded&&(!s.conversationId||s.conversation)))},directives:[a.C,a.Ab,a.m,a.h,a.i,a.yb,k.t,x.a,q.a,F.a,j.a,O.a,a.v,A.a,v.a,a.P,k.s,T.a,S.a,a.D,w.a,U.a,a.t,a.O,B.a,a.x,Q.a,a.y,a.k,a.A,E.a,a.l,z.a],pipes:[L.d,G.a],styles:[".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}[_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%]{margin-top:6px;margin-left:auto;margin-right:auto}[_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--primary);background-color:initial}[_nghost-%COMP%]   .has-fab[_ngcontent-%COMP%]   .scroll-content[_ngcontent-%COMP%]{padding-bottom:0}[_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{position:absolute;color:var(--addon-messages-discussion-badge-text);background-color:var(--addon-messages-discussion-badge);display:block;right:0;top:0}[dir=rtl][_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{left:unset;right:unset;left:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .core-bar-button-image[_ngcontent-%COMP%]{margin-right:6px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .core-bar-button-image[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:6px;margin-inline-end:6px}}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:6px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:6px;margin-inline-start:6px}}.ios[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .ios   [_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{justify-content:center}"]}),AddonMessagesDiscussionPage})(),$=(()=>{class AddonMessagesComponentsModule{}return AddonMessagesComponentsModule.ɵmod=D.wc({type:AddonMessagesComponentsModule}),AddonMessagesComponentsModule.ɵinj=D.vc({factory:function AddonMessagesComponentsModule_Factory(e){return new(e||AddonMessagesComponentsModule)},imports:[[n.a]]}),AddonMessagesComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&D.kd($,{declarations:[N],imports:[n.a]}));const K=[{path:"",component:J}];let H=(()=>{class AddonMessagesDiscussionPageModule{}return AddonMessagesDiscussionPageModule.ɵmod=D.wc({type:AddonMessagesDiscussionPageModule}),AddonMessagesDiscussionPageModule.ɵinj=D.vc({factory:function AddonMessagesDiscussionPageModule_Factory(e){return new(e||AddonMessagesDiscussionPageModule)},imports:[[o.m.forChild(K),n.a,$],o.m]}),AddonMessagesDiscussionPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&D.kd(H,{declarations:[J],imports:[o.m,n.a,$],exports:[o.m]}))}}]);