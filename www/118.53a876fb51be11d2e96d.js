(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{IcH5:function(e,t,c){"use strict";c.r(t),c.d(t,"CoreSettingsSpaceUsagePageModule",(function(){return P}));var a=c("tyNb"),i=c("L3Fv"),s=c("mrSG"),n=c("9+EE"),o=c("fjkH"),r=c("1gmh"),l=c("fXoL"),g=c("TEn/"),d=c("ACV2"),p=c("nt/U"),S=c("PgjG"),u=c("ofXK"),h=c("hMzs"),f=c("ACYt"),m=c("3CSS"),U=c("sYmb"),_=c("1iFe");function CoreSettingsSpaceUsagePage_ion_item_17_ion_badge_8_Template(e,t){if(1&e&&(l.Ec(0,"ion-badge",15),l.pd(1),l.Pc(2,"coreBytesToSize"),l.Dc()),2&e){const e=l.Oc().$implicit;l.lc(1),l.qd(l.Qc(2,1,e.spaceUsage))}}const _c0=function(e){return{name:e}};function CoreSettingsSpaceUsagePage_ion_item_17_Template(e,t){if(1&e){const e=l.Fc();l.Ec(0,"ion-item"),l.Ec(1,"ion-label",9),l.Ec(2,"p",10),l.zc(3,"core-format-text",11),l.Dc(),l.Ec(4,"p",9),l.pd(5),l.Dc(),l.Ec(6,"p"),l.pd(7),l.Dc(),l.nd(8,CoreSettingsSpaceUsagePage_ion_item_17_ion_badge_8_Template,3,3,"ion-badge",12),l.Dc(),l.Ec(9,"ion-button",13),l.Mc("click",(function CoreSettingsSpaceUsagePage_ion_item_17_Template_ion_button_click_9_listener(){l.fd(e);const c=t.$implicit;return l.Oc().deleteSiteStorage(c)})),l.zc(10,"ion-icon",14),l.Pc(11,"translate"),l.Dc(),l.Dc()}if(2&e){const e=t.$implicit,c=l.Oc();l.qc("item-current",e.id==c.currentSiteId),l.lc(3),l.Vc("text",e.siteName)("siteId",e.id),l.lc(2),l.qd(e.fullName),l.lc(2),l.qd(e.siteUrlWithoutProtocol),l.lc(1),l.Vc("ngIf",void 0!==e.spaceUsage),l.lc(1),l.Vc("hidden",e.spaceUsage+e.cacheEntries<=0),l.lc(1),l.mc("aria-label",l.Rc(11,9,"addon.storagemanager.deletedatafrom",l.ad(12,_c0,e.siteName)))}}let b=(()=>{class CoreSettingsSpaceUsagePage{constructor(){this.loaded=!1,this.sites=[],this.currentSiteId="",this.totals={cacheEntries:0,spaceUsage:0},this.currentSiteId=n.b.getCurrentSiteId(),this.sitesObserver=o.b.on(o.b.SITE_UPDATED,(e=>Object(s.a)(this,void 0,void 0,(function*(){const t=yield n.b.getSite(e.siteId),c=this.sites.find((e=>e.id==t.id));if(c){const e=t.getInfo();c.siteName=t.getSiteName(),e&&(c.siteUrl=e.siteurl,c.fullName=e.fullname)}}))))}ngOnInit(){this.loadSiteData().finally((()=>{this.loaded=!0}))}loadSiteData(){return Object(s.a)(this,void 0,void 0,(function*(){let e=0,t=0;this.sites=yield n.b.getSortedSites();const c=r.a.instance;yield Promise.all(this.sites.map((a=>Object(s.a)(this,void 0,void 0,(function*(){const i=yield c.getSiteSpaceUsage(a.id);a.cacheEntries=i.cacheEntries,a.spaceUsage=i.spaceUsage,e+=a.spaceUsage||0,t+=a.cacheEntries||0}))))),this.totals.spaceUsage=e,this.totals.cacheEntries=t}))}refreshData(e){this.loadSiteData().finally((()=>{null==e?void 0:e.complete()}))}deleteSiteStorage(e){return Object(s.a)(this,void 0,void 0,(function*(){try{const t=yield r.a.deleteSiteStorage(e.siteName||"",e.id);this.totals.spaceUsage-=e.spaceUsage-t.spaceUsage,this.totals.spaceUsage-=e.cacheEntries-t.cacheEntries,e.spaceUsage=t.spaceUsage,e.cacheEntries=t.cacheEntries}catch(e){}}))}ngOnDestroy(){var e;null===(e=this.sitesObserver)||void 0===e?void 0:e.off()}}return CoreSettingsSpaceUsagePage.ɵfac=function CoreSettingsSpaceUsagePage_Factory(e){return new(e||CoreSettingsSpaceUsagePage)},CoreSettingsSpaceUsagePage.ɵcmp=l.sc({type:CoreSettingsSpaceUsagePage,selectors:[["page-core-app-settings-space-usage"]],decls:26,vars:18,consts:[["slot","start"],[3,"text"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"item-current",4,"ngFor","ngForOf"],["slot","end",1,"ion-margin-end"],[1,"ion-text-wrap"],[1,"item-heading"],["clean","true",3,"text","siteId"],["color","light",4,"ngIf"],["fill","clear","color","danger","slot","end",3,"hidden","click"],["name","fas-trash","slot","icon-only"],["color","light"]],template:function CoreSettingsSpaceUsagePage_Template(e,t){1&e&&(l.Ec(0,"ion-header"),l.Ec(1,"ion-toolbar"),l.Ec(2,"ion-buttons",0),l.zc(3,"ion-back-button",1),l.Pc(4,"translate"),l.Dc(),l.Ec(5,"ion-title"),l.Ec(6,"h1"),l.pd(7),l.Pc(8,"translate"),l.Dc(),l.Dc(),l.Ec(9,"ion-buttons",2),l.zc(10,"core-navbar-buttons"),l.Dc(),l.Dc(),l.Dc(),l.Ec(11,"ion-content",3),l.Ec(12,"ion-refresher",4),l.Mc("ionRefresh",(function CoreSettingsSpaceUsagePage_Template_ion_refresher_ionRefresh_12_listener(e){return t.refreshData(e.target)})),l.zc(13,"ion-refresher-content",5),l.Pc(14,"translate"),l.Dc(),l.Ec(15,"core-loading",6),l.Ec(16,"ion-list"),l.nd(17,CoreSettingsSpaceUsagePage_ion_item_17_Template,12,14,"ion-item",7),l.Ec(18,"ion-item-divider"),l.Ec(19,"ion-label"),l.Ec(20,"h2"),l.pd(21),l.Pc(22,"translate"),l.Dc(),l.Dc(),l.Ec(23,"p",8),l.pd(24),l.Pc(25,"coreBytesToSize"),l.Dc(),l.Dc(),l.Dc(),l.Dc(),l.Dc()),2&e&&(l.lc(3),l.Vc("text",l.Qc(4,8,"core.back")),l.lc(4),l.qd(l.Qc(8,10,"core.settings.spaceusage")),l.lc(5),l.Vc("disabled",!t.loaded),l.lc(1),l.Wc("pullingText",l.Qc(14,12,"core.pulltorefresh")),l.lc(2),l.Vc("hideUntil",t.loaded),l.lc(2),l.Vc("ngForOf",t.sites),l.lc(4),l.qd(l.Qc(22,14,"core.settings.total")),l.lc(3),l.rd(" ",l.Qc(25,16,t.totals.spaceUsage)," "))},directives:[g.C,g.Ab,g.m,g.h,g.i,g.yb,d.a,p.a,g.v,g.bb,g.cb,S.a,g.P,u.s,g.J,g.O,g.I,h.a,u.t,f.a,g.l,g.D,m.a,g.k],pipes:[U.d,_.a],encapsulation:2}),CoreSettingsSpaceUsagePage})();const E=[{path:"",component:b}];let P=(()=>{class CoreSettingsSpaceUsagePageModule{}return CoreSettingsSpaceUsagePageModule.ɵmod=l.wc({type:CoreSettingsSpaceUsagePageModule}),CoreSettingsSpaceUsagePageModule.ɵinj=l.vc({factory:function CoreSettingsSpaceUsagePageModule_Factory(e){return new(e||CoreSettingsSpaceUsagePageModule)},imports:[[a.m.forChild(E),i.a],a.m]}),CoreSettingsSpaceUsagePageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&l.kd(P,{declarations:[b],imports:[a.m,i.a],exports:[a.m]}))}}]);