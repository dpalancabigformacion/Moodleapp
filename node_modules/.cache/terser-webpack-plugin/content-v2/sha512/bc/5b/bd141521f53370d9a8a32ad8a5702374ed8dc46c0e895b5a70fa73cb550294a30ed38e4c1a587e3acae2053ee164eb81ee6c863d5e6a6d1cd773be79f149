{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{SyS0:function(t,e,i){\"use strict\";i.r(e),i.d(e,\"AddonModH5PActivityUsersAttemptsPageModule\",(function(){return b}));var o=i(\"tyNb\"),c=i(\"L3Fv\"),s=i(\"mrSG\"),n=i(\"4pns\"),a=i(\"pHTc\"),r=i(\"3LXp\"),d=i(\"bFG1\"),l=i(\"pOwY\"),p=i(\"fXoL\"),m=i(\"TEn/\"),_=i(\"ofXK\"),A=i(\"nt/U\"),h=i(\"PgjG\"),u=i(\"xpMl\"),f=i(\"hMzs\"),g=i(\"FeAf\"),v=i(\"r8G5\"),P=i(\"sYmb\"),y=i(\"uYHD\");function AddonModH5PActivityUsersAttemptsPage_core_format_text_7_Template(t,e){if(1&t&&p.zc(0,\"core-format-text\",9),2&t){const t=p.Oc();p.Vc(\"text\",t.h5pActivity.name)(\"contextInstanceId\",t.h5pActivity.coursemodule)(\"courseId\",t.courseId)}}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_9_Template(t,e){if(1&t&&(p.Ec(0,\"span\"),p.pd(1),p.Pc(2,\"coreFormatDate\"),p.Dc()),2&t){const t=p.Oc().$implicit;p.lc(1),p.rd(\" \",p.Rc(2,1,t.attempts[t.attempts.length-1].timemodified,\"strftimedatetimeshort\"),\" \")}}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_10_Template(t,e){1&t&&(p.Ec(0,\"span\"),p.pd(1,\"-\"),p.Dc())}const _c0=function(t){return{$a:t}};function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_12_Template(t,e){if(1&t&&(p.Ec(0,\"span\"),p.pd(1),p.Pc(2,\"translate\"),p.Dc()),2&t){const t=p.Oc().$implicit;p.lc(1),p.rd(\" \",p.Rc(2,1,\"core.percentagenumber\",p.ad(4,_c0,t.score)),\" \")}}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_13_Template(t,e){1&t&&(p.Ec(0,\"span\"),p.pd(1,\"-\"),p.Dc())}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template(t,e){if(1&t){const t=p.Fc();p.Ec(0,\"ion-item\",15),p.Mc(\"click\",(function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template_ion_item_click_0_listener(){p.fd(t);const i=e.$implicit;return p.Oc(2).openUser(i)})),p.Pc(1,\"translate\"),p.Ec(2,\"ion-label\"),p.Ec(3,\"ion-row\",11),p.Ec(4,\"ion-col\",12),p.Ec(5,\"p\"),p.zc(6,\"core-user-avatar\",16),p.Dc(),p.pd(7),p.Dc(),p.Ec(8,\"ion-col\",12),p.nd(9,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_9_Template,3,4,\"span\",6),p.nd(10,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_10_Template,2,0,\"span\",6),p.Dc(),p.Ec(11,\"ion-col\",13),p.nd(12,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_12_Template,3,6,\"span\",6),p.nd(13,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_13_Template,2,0,\"span\",6),p.Dc(),p.Ec(14,\"ion-col\",13),p.pd(15),p.Dc(),p.Dc(),p.Dc(),p.Dc()}if(2&t){const t=e.$implicit,i=p.Oc(2);p.mc(\"aria-label\",p.Rc(1,9,\"addon.mod_h5pactivity.review_user_attempts\",p.ad(12,_c0,t.attempts.length))),p.lc(6),p.Vc(\"user\",t.user)(\"courseId\",i.courseId),p.lc(1),p.rd(\" \",t.user.fullname,\" \"),p.lc(2),p.Vc(\"ngIf\",t.attempts.length),p.lc(1),p.Vc(\"ngIf\",!t.attempts.length),p.lc(2),p.Vc(\"ngIf\",void 0!==t.score),p.lc(1),p.Vc(\"ngIf\",void 0===t.score),p.lc(2),p.rd(\" \",t.attempts.length,\" \")}}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_Template(t,e){if(1&t&&(p.Ec(0,\"ion-list\"),p.Ec(1,\"ion-item\",10),p.Ec(2,\"ion-label\"),p.Ec(3,\"ion-row\",11),p.Ec(4,\"ion-col\",12),p.pd(5),p.Pc(6,\"translate\"),p.Dc(),p.Ec(7,\"ion-col\",12),p.pd(8),p.Pc(9,\"translate\"),p.Dc(),p.Ec(10,\"ion-col\",13),p.pd(11),p.Pc(12,\"translate\"),p.Dc(),p.Ec(13,\"ion-col\",13),p.pd(14),p.Pc(15,\"translate\"),p.Dc(),p.Dc(),p.Dc(),p.Dc(),p.nd(16,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template,16,14,\"ion-item\",14),p.Dc()),2&t){const t=p.Oc();p.lc(1),p.Vc(\"detail\",!1),p.lc(4),p.qd(p.Qc(6,6,\"core.user\")),p.lc(3),p.qd(p.Qc(9,8,\"core.date\")),p.lc(3),p.qd(p.Qc(12,10,\"addon.mod_h5pactivity.score\")),p.lc(3),p.qd(p.Qc(15,12,\"addon.mod_h5pactivity.attempts\")),p.lc(2),p.Vc(\"ngForOf\",t.users)}}function AddonModH5PActivityUsersAttemptsPage_core_empty_box_14_Template(t,e){1&t&&(p.zc(0,\"core-empty-box\",17),p.Pc(1,\"translate\")),2&t&&p.Vc(\"message\",p.Qc(1,1,\"addon.mod_h5pactivity.noparticipants\"))}let M=(()=>{class AddonModH5PActivityUsersAttemptsPage{constructor(){this.loaded=!1,this.users=[],this.fetchMoreUsersFailed=!1,this.canLoadMore=!1,this.page=0,this.fetchSuccess=!1}ngOnInit(){return Object(s.a)(this,void 0,void 0,(function*(){try{this.courseId=a.a.getRequiredRouteNumberParam(\"courseId\"),this.cmId=a.a.getRequiredRouteNumberParam(\"cmId\")}catch(t){return r.a.showErrorModal(t),a.a.back(),void 0}this.fetchData()}))}doRefresh(t){this.refreshData().finally((()=>{t.complete()}))}fetchData(t){return Object(s.a)(this,void 0,void 0,(function*(){try{this.h5pActivity=yield l.a.getH5PActivity(this.courseId,this.cmId),yield Promise.all([this.fetchUsers(t)]),this.fetchSuccess||(this.fetchSuccess=!0,d.a.ignoreErrors(l.a.logViewReport(this.h5pActivity.id,this.h5pActivity.name)))}catch(t){r.a.showErrorModalDefault(t,\"Error loading attempts.\")}finally{this.loaded=!0}}))}fetchUsers(t){return Object(s.a)(this,void 0,void 0,(function*(){if(!this.h5pActivity)return;t&&(this.page=0);const e=yield l.a.getUsersAttempts(this.h5pActivity.id,{cmId:this.cmId,page:this.page}),i=yield this.formatUsers(this.h5pActivity,e.users);this.users=0===this.page?i:this.users.concat(i),this.canLoadMore=e.canLoadMore,this.page++}))}formatUsers(t,e){return Object(s.a)(this,void 0,void 0,(function*(){return Promise.all(e.map((e=>Object(s.a)(this,void 0,void 0,(function*(){var i;if(e.user=yield n.a.getProfile(e.userid,this.courseId,!0),t.grademethod===l.b.GRADEMANUAL);else if(t.grademethod===l.b.GRADEAVERAGEATTEMPT){if(e.attempts.length){const t=e.attempts.reduce(((t,e)=>t+100*e.rawscore/e.maxscore),0);e.score=Math.round(t/e.attempts.length)}}else(null===(i=e.scored)||void 0===i?void 0:i.attempts[0])&&(e.score=Math.round(100*e.scored.attempts[0].rawscore/e.scored.attempts[0].maxscore));return e})))))}))}fetchMoreUsers(t){return Object(s.a)(this,void 0,void 0,(function*(){try{yield this.fetchUsers(!1)}catch(t){r.a.showErrorModalDefault(t,\"Error loading more users\"),this.fetchMoreUsersFailed=!0}t()}))}refreshData(){return Object(s.a)(this,void 0,void 0,(function*(){const t=[l.a.invalidateActivityData(this.courseId)];this.h5pActivity&&t.push(l.a.invalidateAllUsersAttempts(this.h5pActivity.id)),yield d.a.ignoreErrors(Promise.all(t)),yield this.fetchData(!0)}))}openUser(t){a.a.navigate(`../userattempts/${t.userid}`)}}return AddonModH5PActivityUsersAttemptsPage.ɵfac=function AddonModH5PActivityUsersAttemptsPage_Factory(t){return new(t||AddonModH5PActivityUsersAttemptsPage)},AddonModH5PActivityUsersAttemptsPage.ɵcmp=p.sc({type:AddonModH5PActivityUsersAttemptsPage,selectors:[[\"page-addon-mod-h5pactivity-users-attempts\"]],decls:16,vars:13,consts:[[\"slot\",\"start\"],[3,\"text\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\",4,\"ngIf\"],[\"slot\",\"fixed\",3,\"disabled\",\"ionRefresh\"],[3,\"pullingText\"],[3,\"hideUntil\"],[4,\"ngIf\"],[\"icon\",\"fas-chart-bar\",3,\"message\",4,\"ngIf\"],[3,\"enabled\",\"error\",\"action\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\"],[1,\"addon-mod_h5pactivity-table-header\",\"font-bold\",3,\"detail\"],[1,\"ion-align-items-center\"],[\"size\",\"4\",1,\"ion-text-center\"],[\"size\",\"2\",1,\"ion-text-center\"],[\"class\",\"ion-text-wrap addon-mod_h5pactivity-table-row\",\"detail\",\"true\",\"button\",\"\",3,\"click\",4,\"ngFor\",\"ngForOf\"],[\"detail\",\"true\",\"button\",\"\",1,\"ion-text-wrap\",\"addon-mod_h5pactivity-table-row\",3,\"click\"],[3,\"user\",\"courseId\"],[\"icon\",\"fas-chart-bar\",3,\"message\"]],template:function AddonModH5PActivityUsersAttemptsPage_Template(t,e){1&t&&(p.Ec(0,\"ion-header\"),p.Ec(1,\"ion-toolbar\"),p.Ec(2,\"ion-buttons\",0),p.zc(3,\"ion-back-button\",1),p.Pc(4,\"translate\"),p.Dc(),p.Ec(5,\"ion-title\"),p.Ec(6,\"h1\"),p.nd(7,AddonModH5PActivityUsersAttemptsPage_core_format_text_7_Template,1,3,\"core-format-text\",2),p.Dc(),p.Dc(),p.Dc(),p.Dc(),p.Ec(8,\"ion-content\"),p.Ec(9,\"ion-refresher\",3),p.Mc(\"ionRefresh\",(function AddonModH5PActivityUsersAttemptsPage_Template_ion_refresher_ionRefresh_9_listener(t){return e.doRefresh(t.target)})),p.zc(10,\"ion-refresher-content\",4),p.Pc(11,\"translate\"),p.Dc(),p.Ec(12,\"core-loading\",5),p.nd(13,AddonModH5PActivityUsersAttemptsPage_ion_list_13_Template,17,14,\"ion-list\",6),p.nd(14,AddonModH5PActivityUsersAttemptsPage_core_empty_box_14_Template,2,3,\"core-empty-box\",7),p.Ec(15,\"core-infinite-loading\",8),p.Mc(\"action\",(function AddonModH5PActivityUsersAttemptsPage_Template_core_infinite_loading_action_15_listener(t){return e.fetchMoreUsers(t)})),p.Dc(),p.Dc(),p.Dc()),2&t&&(p.lc(3),p.Vc(\"text\",p.Qc(4,9,\"core.back\")),p.lc(4),p.Vc(\"ngIf\",e.h5pActivity),p.lc(2),p.Vc(\"disabled\",!e.loaded),p.lc(1),p.Wc(\"pullingText\",p.Qc(11,11,\"core.pulltorefresh\")),p.lc(2),p.Vc(\"hideUntil\",e.loaded),p.lc(1),p.Vc(\"ngIf\",e.users.length),p.lc(1),p.Vc(\"ngIf\",!e.users.length&&!e.canLoadMore),p.lc(1),p.Vc(\"enabled\",e.loaded&&e.canLoadMore)(\"error\",e.fetchMoreUsersFailed))},directives:[m.C,m.Ab,m.m,m.h,m.i,m.yb,_.t,A.a,m.v,m.bb,m.cb,h.a,u.a,f.a,m.P,m.I,m.O,m.hb,m.u,_.s,g.a,v.a],pipes:[P.d,y.a],encapsulation:2}),AddonModH5PActivityUsersAttemptsPage})();const U=[{path:\"\",component:M}];let b=(()=>{class AddonModH5PActivityUsersAttemptsPageModule{}return AddonModH5PActivityUsersAttemptsPageModule.ɵmod=p.wc({type:AddonModH5PActivityUsersAttemptsPageModule}),AddonModH5PActivityUsersAttemptsPageModule.ɵinj=p.vc({factory:function AddonModH5PActivityUsersAttemptsPageModule_Factory(t){return new(t||AddonModH5PActivityUsersAttemptsPageModule)},imports:[[o.m.forChild(U),c.a],o.m]}),AddonModH5PActivityUsersAttemptsPageModule})();void((\"undefined\"==typeof ngJitMode||ngJitMode)&&p.kd(b,{declarations:[M],imports:[o.m,c.a],exports:[o.m]}))}}]);","name":"65.5b0bfb1010a23107487c.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[65],{\n\n/***/ \"SyS0\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"AddonModH5PActivityUsersAttemptsPageModule\", function() { return /* binding */ users_attempts_module_AddonModH5PActivityUsersAttemptsPageModule; });\n\n// EXTERNAL MODULE: ./node_modules/@angular/router/__ivy_ngcc__/fesm2015/router.js + 10 modules\nvar router = __webpack_require__(\"tyNb\");\n\n// EXTERNAL MODULE: ./src/core/shared.module.ts + 3 modules\nvar shared_module = __webpack_require__(\"L3Fv\");\n\n// EXTERNAL MODULE: ./node_modules/tslib/tslib.es6.js\nvar tslib_es6 = __webpack_require__(\"mrSG\");\n\n// EXTERNAL MODULE: ./src/core/features/user/services/user.ts\nvar services_user = __webpack_require__(\"4pns\");\n\n// EXTERNAL MODULE: ./src/core/services/navigator.ts\nvar services_navigator = __webpack_require__(\"pHTc\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/dom.ts + 2 modules\nvar dom = __webpack_require__(\"3LXp\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/utils.ts\nvar utils = __webpack_require__(\"bFG1\");\n\n// EXTERNAL MODULE: ./src/addons/mod/h5pactivity/services/h5pactivity.ts\nvar h5pactivity = __webpack_require__(\"pOwY\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/core/__ivy_ngcc__/fesm2015/core.js\nvar core = __webpack_require__(\"fXoL\");\n\n// EXTERNAL MODULE: ./node_modules/@ionic/angular/__ivy_ngcc__/fesm2015/ionic-angular.js + 5 modules\nvar ionic_angular = __webpack_require__(\"TEn/\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/common/__ivy_ngcc__/fesm2015/common.js\nvar common = __webpack_require__(\"ofXK\");\n\n// EXTERNAL MODULE: ./src/core/directives/content.ts\nvar content = __webpack_require__(\"nt/U\");\n\n// EXTERNAL MODULE: ./src/core/components/loading/loading.ts\nvar loading = __webpack_require__(\"PgjG\");\n\n// EXTERNAL MODULE: ./src/core/components/infinite-loading/infinite-loading.ts\nvar infinite_loading = __webpack_require__(\"xpMl\");\n\n// EXTERNAL MODULE: ./src/core/directives/format-text.ts\nvar format_text = __webpack_require__(\"hMzs\");\n\n// EXTERNAL MODULE: ./src/core/components/user-avatar/user-avatar.ts\nvar user_avatar = __webpack_require__(\"FeAf\");\n\n// EXTERNAL MODULE: ./src/core/components/empty-box/empty-box.ts\nvar empty_box = __webpack_require__(\"r8G5\");\n\n// EXTERNAL MODULE: ./node_modules/@ngx-translate/core/__ivy_ngcc__/fesm2015/ngx-translate-core.js + 8 modules\nvar ngx_translate_core = __webpack_require__(\"sYmb\");\n\n// EXTERNAL MODULE: ./src/core/pipes/format-date.ts\nvar format_date = __webpack_require__(\"uYHD\");\n\n// CONCATENATED MODULE: ./src/addons/mod/h5pactivity/pages/users-attempts/users-attempts.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonModH5PActivityUsersAttemptsPage_core_format_text_7_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-format-text\", 9);\n    }\n    if (rf & 2) {\n        const ctx_r0 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"Vc\" /* ɵɵproperty */](\"text\", ctx_r0.h5pActivity.name)(\"contextInstanceId\", ctx_r0.h5pActivity.coursemodule)(\"courseId\", ctx_r0.courseId);\n    }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_9_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"span\");\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"coreFormatDate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const user_r4 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](2, 1, user_r4.attempts[user_r4.attempts.length - 1].timemodified, \"strftimedatetimeshort\"), \" \");\n    }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_10_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"span\");\n        core[\"pd\" /* ɵɵtext */](1, \"-\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n}\nconst _c0 = function (a0) { return { $a: a0 }; };\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_12_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"span\");\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const user_r4 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](2, 1, \"core.percentagenumber\", core[\"ad\" /* ɵɵpureFunction1 */](4, _c0, user_r4.score)), \" \");\n    }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_13_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"span\");\n        core[\"pd\" /* ɵɵtext */](1, \"-\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r12 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-item\", 15);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template_ion_item_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r12); const user_r4 = ctx.$implicit; const ctx_r11 = core[\"Oc\" /* ɵɵnextContext */](2); return ctx_r11.openUser(user_r4); });\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n        core[\"Ec\" /* ɵɵelementStart */](2, \"ion-label\");\n        core[\"Ec\" /* ɵɵelementStart */](3, \"ion-row\", 11);\n        core[\"Ec\" /* ɵɵelementStart */](4, \"ion-col\", 12);\n        core[\"Ec\" /* ɵɵelementStart */](5, \"p\");\n        core[\"zc\" /* ɵɵelement */](6, \"core-user-avatar\", 16);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"pd\" /* ɵɵtext */](7);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](8, \"ion-col\", 12);\n        core[\"nd\" /* ɵɵtemplate */](9, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_9_Template, 3, 4, \"span\", 6);\n        core[\"nd\" /* ɵɵtemplate */](10, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_10_Template, 2, 0, \"span\", 6);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](11, \"ion-col\", 13);\n        core[\"nd\" /* ɵɵtemplate */](12, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_12_Template, 3, 6, \"span\", 6);\n        core[\"nd\" /* ɵɵtemplate */](13, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_13_Template, 2, 0, \"span\", 6);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](14, \"ion-col\", 13);\n        core[\"pd\" /* ɵɵtext */](15);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const user_r4 = ctx.$implicit;\n        const ctx_r3 = core[\"Oc\" /* ɵɵnextContext */](2);\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Rc\" /* ɵɵpipeBind2 */](1, 9, \"addon.mod_h5pactivity.review_user_attempts\", core[\"ad\" /* ɵɵpureFunction1 */](12, _c0, user_r4.attempts.length)));\n        core[\"lc\" /* ɵɵadvance */](6);\n        core[\"Vc\" /* ɵɵproperty */](\"user\", user_r4.user)(\"courseId\", ctx_r3.courseId);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", user_r4.user.fullname, \" \");\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", user_r4.attempts.length);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !user_r4.attempts.length);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", user_r4.score !== undefined);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", user_r4.score === undefined);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", user_r4.attempts.length, \" \");\n    }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-list\");\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-item\", 10);\n        core[\"Ec\" /* ɵɵelementStart */](2, \"ion-label\");\n        core[\"Ec\" /* ɵɵelementStart */](3, \"ion-row\", 11);\n        core[\"Ec\" /* ɵɵelementStart */](4, \"ion-col\", 12);\n        core[\"pd\" /* ɵɵtext */](5);\n        core[\"Pc\" /* ɵɵpipe */](6, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](7, \"ion-col\", 12);\n        core[\"pd\" /* ɵɵtext */](8);\n        core[\"Pc\" /* ɵɵpipe */](9, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](10, \"ion-col\", 13);\n        core[\"pd\" /* ɵɵtext */](11);\n        core[\"Pc\" /* ɵɵpipe */](12, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](13, \"ion-col\", 13);\n        core[\"pd\" /* ɵɵtext */](14);\n        core[\"Pc\" /* ɵɵpipe */](15, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](16, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template, 16, 14, \"ion-item\", 14);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r1 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"detail\", false);\n        core[\"lc\" /* ɵɵadvance */](4);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](6, 6, \"core.user\"));\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](9, 8, \"core.date\"));\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](12, 10, \"addon.mod_h5pactivity.score\"));\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](15, 12, \"addon.mod_h5pactivity.attempts\"));\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx_r1.users);\n    }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_core_empty_box_14_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-empty-box\", 17);\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n    }\n    if (rf & 2) {\n        core[\"Vc\" /* ɵɵproperty */](\"message\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"addon.mod_h5pactivity.noparticipants\"));\n    }\n}\n/**\n * Page that displays all users that can attempt an H5P activity.\n */\nlet users_attempts_AddonModH5PActivityUsersAttemptsPage = /*@__PURE__*/ (() => {\n    class AddonModH5PActivityUsersAttemptsPage {\n        constructor() {\n            this.loaded = false;\n            this.users = [];\n            this.fetchMoreUsersFailed = false;\n            this.canLoadMore = false;\n            this.page = 0;\n            this.fetchSuccess = false;\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnInit() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    this.courseId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('courseId');\n                    this.cmId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('cmId');\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModal(error);\n                    services_navigator[\"a\" /* CoreNavigator */].back();\n                    return;\n                }\n                this.fetchData();\n            });\n        }\n        /**\n         * Refresh the data.\n         *\n         * @param refresher Refresher.\n         */\n        doRefresh(refresher) {\n            this.refreshData().finally(() => {\n                refresher.complete();\n            });\n        }\n        /**\n         * Get quiz data and attempt data.\n         *\n         * @param refresh Whether user is refreshing data.\n         * @return Promise resolved when done.\n         */\n        fetchData(refresh) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    this.h5pActivity = yield h5pactivity[\"a\" /* AddonModH5PActivity */].getH5PActivity(this.courseId, this.cmId);\n                    yield Promise.all([\n                        this.fetchUsers(refresh),\n                    ]);\n                    if (!this.fetchSuccess) {\n                        this.fetchSuccess = true;\n                        utils[\"a\" /* CoreUtils */].ignoreErrors(h5pactivity[\"a\" /* AddonModH5PActivity */].logViewReport(this.h5pActivity.id, this.h5pActivity.name));\n                    }\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'Error loading attempts.');\n                }\n                finally {\n                    this.loaded = true;\n                }\n            });\n        }\n        /**\n         * Get users.\n         *\n         * @param refresh Whether user is refreshing data.\n         * @return Promise resolved when done.\n         */\n        fetchUsers(refresh) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.h5pActivity) {\n                    return;\n                }\n                if (refresh) {\n                    this.page = 0;\n                }\n                const result = yield h5pactivity[\"a\" /* AddonModH5PActivity */].getUsersAttempts(this.h5pActivity.id, {\n                    cmId: this.cmId,\n                    page: this.page,\n                });\n                const formattedUsers = yield this.formatUsers(this.h5pActivity, result.users);\n                if (this.page === 0) {\n                    this.users = formattedUsers;\n                }\n                else {\n                    this.users = this.users.concat(formattedUsers);\n                }\n                this.canLoadMore = result.canLoadMore;\n                this.page++;\n            });\n        }\n        /**\n         * Format users data.\n         *\n         * @param h5pActivity Activity data.\n         * @param users Users to format.\n         * @return Formatted users.\n         */\n        formatUsers(h5pActivity, users) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                return Promise.all(users.map((user) => Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                    var _a;\n                    user.user = yield services_user[\"a\" /* CoreUser */].getProfile(user.userid, this.courseId, true);\n                    // Calculate the score of the user.\n                    if (h5pActivity.grademethod === h5pactivity[\"b\" /* AddonModH5PActivityProvider */].GRADEMANUAL) {\n                        // No score.\n                    }\n                    else if (h5pActivity.grademethod === h5pactivity[\"b\" /* AddonModH5PActivityProvider */].GRADEAVERAGEATTEMPT) {\n                        if (user.attempts.length) {\n                            // Calculate the average.\n                            const sumScores = user.attempts.reduce((sumScores, attempt) => sumScores + attempt.rawscore * 100 / attempt.maxscore, 0);\n                            user.score = Math.round(sumScores / user.attempts.length);\n                        }\n                    }\n                    else if ((_a = user.scored) === null || _a === void 0 ? void 0 : _a.attempts[0]) {\n                        // Only a single attempt used to calculate the grade. Use it.\n                        user.score = Math.round(user.scored.attempts[0].rawscore * 100 / user.scored.attempts[0].maxscore);\n                    }\n                    return user;\n                })));\n            });\n        }\n        /**\n         * Load a new batch of users.\n         *\n         * @param complete Completion callback.\n         */\n        fetchMoreUsers(complete) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    yield this.fetchUsers(false);\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'Error loading more users');\n                    this.fetchMoreUsersFailed = true;\n                }\n                complete();\n            });\n        }\n        /**\n         * Refresh the data.\n         *\n         * @return Promise resolved when done.\n         */\n        refreshData() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const promises = [\n                    h5pactivity[\"a\" /* AddonModH5PActivity */].invalidateActivityData(this.courseId),\n                ];\n                if (this.h5pActivity) {\n                    promises.push(h5pactivity[\"a\" /* AddonModH5PActivity */].invalidateAllUsersAttempts(this.h5pActivity.id));\n                }\n                yield utils[\"a\" /* CoreUtils */].ignoreErrors(Promise.all(promises));\n                yield this.fetchData(true);\n            });\n        }\n        /**\n         * Open the page to view a user attempts.\n         *\n         * @param user User to open.\n         */\n        openUser(user) {\n            services_navigator[\"a\" /* CoreNavigator */].navigate(`../userattempts/${user.userid}`);\n        }\n    }\n    AddonModH5PActivityUsersAttemptsPage.ɵfac = function AddonModH5PActivityUsersAttemptsPage_Factory(t) { return new (t || AddonModH5PActivityUsersAttemptsPage)(); };\n    AddonModH5PActivityUsersAttemptsPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModH5PActivityUsersAttemptsPage, selectors: [[\"page-addon-mod-h5pactivity-users-attempts\"]], decls: 16, vars: 13, consts: [[\"slot\", \"start\"], [3, \"text\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\", 4, \"ngIf\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"hideUntil\"], [4, \"ngIf\"], [\"icon\", \"fas-chart-bar\", 3, \"message\", 4, \"ngIf\"], [3, \"enabled\", \"error\", \"action\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [1, \"addon-mod_h5pactivity-table-header\", \"font-bold\", 3, \"detail\"], [1, \"ion-align-items-center\"], [\"size\", \"4\", 1, \"ion-text-center\"], [\"size\", \"2\", 1, \"ion-text-center\"], [\"class\", \"ion-text-wrap addon-mod_h5pactivity-table-row\", \"detail\", \"true\", \"button\", \"\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"detail\", \"true\", \"button\", \"\", 1, \"ion-text-wrap\", \"addon-mod_h5pactivity-table-row\", 3, \"click\"], [3, \"user\", \"courseId\"], [\"icon\", \"fas-chart-bar\", 3, \"message\"]], template: function AddonModH5PActivityUsersAttemptsPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"nd\" /* ɵɵtemplate */](7, AddonModH5PActivityUsersAttemptsPage_core_format_text_7_Template, 1, 3, \"core-format-text\", 2);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](8, \"ion-content\");\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-refresher\", 3);\n                core[\"Mc\" /* ɵɵlistener */](\"ionRefresh\", function AddonModH5PActivityUsersAttemptsPage_Template_ion_refresher_ionRefresh_9_listener($event) { return ctx.doRefresh($event.target); });\n                core[\"zc\" /* ɵɵelement */](10, \"ion-refresher-content\", 4);\n                core[\"Pc\" /* ɵɵpipe */](11, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](12, \"core-loading\", 5);\n                core[\"nd\" /* ɵɵtemplate */](13, AddonModH5PActivityUsersAttemptsPage_ion_list_13_Template, 17, 14, \"ion-list\", 6);\n                core[\"nd\" /* ɵɵtemplate */](14, AddonModH5PActivityUsersAttemptsPage_core_empty_box_14_Template, 2, 3, \"core-empty-box\", 7);\n                core[\"Ec\" /* ɵɵelementStart */](15, \"core-infinite-loading\", 8);\n                core[\"Mc\" /* ɵɵlistener */](\"action\", function AddonModH5PActivityUsersAttemptsPage_Template_core_infinite_loading_action_15_listener($event) { return ctx.fetchMoreUsers($event); });\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 9, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.h5pActivity);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", !ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Wc\" /* ɵɵpropertyInterpolate */](\"pullingText\", core[\"Qc\" /* ɵɵpipeBind1 */](11, 11, \"core.pulltorefresh\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.users.length);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !ctx.users.length && !ctx.canLoadMore);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"enabled\", ctx.loaded && ctx.canLoadMore)(\"error\", ctx.fetchMoreUsersFailed);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], common[\"t\" /* NgIf */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], ionic_angular[\"bb\" /* IonRefresher */], ionic_angular[\"cb\" /* IonRefresherContent */], loading[\"a\" /* CoreLoadingComponent */], infinite_loading[\"a\" /* CoreInfiniteLoadingComponent */], format_text[\"a\" /* CoreFormatTextDirective */], ionic_angular[\"P\" /* IonList */], ionic_angular[\"I\" /* IonItem */], ionic_angular[\"O\" /* IonLabel */], ionic_angular[\"hb\" /* IonRow */], ionic_angular[\"u\" /* IonCol */], common[\"s\" /* NgForOf */], user_avatar[\"a\" /* CoreUserAvatarComponent */], empty_box[\"a\" /* CoreEmptyBoxComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */], format_date[\"a\" /* CoreFormatDatePipe */]], encapsulation: 2 });\n    return AddonModH5PActivityUsersAttemptsPage;\n})();\n\n// CONCATENATED MODULE: ./src/addons/mod/h5pactivity/pages/users-attempts/users-attempts.module.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\nconst routes = [\n    {\n        path: '',\n        component: users_attempts_AddonModH5PActivityUsersAttemptsPage,\n    },\n];\nlet users_attempts_module_AddonModH5PActivityUsersAttemptsPageModule = /*@__PURE__*/ (() => {\n    class AddonModH5PActivityUsersAttemptsPageModule {\n    }\n    AddonModH5PActivityUsersAttemptsPageModule.ɵmod = core[\"wc\" /* ɵɵdefineNgModule */]({ type: AddonModH5PActivityUsersAttemptsPageModule });\n    AddonModH5PActivityUsersAttemptsPageModule.ɵinj = core[\"vc\" /* ɵɵdefineInjector */]({ factory: function AddonModH5PActivityUsersAttemptsPageModule_Factory(t) { return new (t || AddonModH5PActivityUsersAttemptsPageModule)(); }, imports: [[\n                router[\"m\" /* RouterModule */].forChild(routes),\n                shared_module[\"a\" /* CoreSharedModule */],\n            ], router[\"m\" /* RouterModule */]] });\n    return AddonModH5PActivityUsersAttemptsPageModule;\n})();\n(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && core[\"kd\" /* ɵɵsetNgModuleScope */](users_attempts_module_AddonModH5PActivityUsersAttemptsPageModule, { declarations: [users_attempts_AddonModH5PActivityUsersAttemptsPage], imports: [router[\"m\" /* RouterModule */], shared_module[\"a\" /* CoreSharedModule */]], exports: [router[\"m\" /* RouterModule */]] }); })();\n\n\n/***/ })\n\n}]);","inputSourceMap":null}