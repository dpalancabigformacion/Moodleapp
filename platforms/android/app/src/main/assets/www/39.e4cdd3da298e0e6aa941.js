(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{Vuuv:function(e,n,t){"use strict";t.r(n),t.d(n,"AddonCalendarIndexPageModule",(function(){return R}));var a=t("tyNb"),o=t("L3Fv"),i=t("9Xwr"),c=t("mrSG"),d=t("GGba"),r=t("fjkH"),s=t("9+EE"),l=t("3LXp"),h=t("ZSwf"),u=t("SmTL"),f=t("Lc7R"),_=t("+lfu"),m=t("n6RP"),g=t("j3ag"),p=t("Yxfl"),v=t("cD/T"),E=t("kLT3"),C=t("pHTc"),b=t("ANhT"),I=t("BaYo"),y=t("YyYz"),x=t("fXoL"),D=t("TEn/"),P=t("ACYt"),A=t("3CSS"),O=t("fQ68"),T=t("ofXK"),w=t("8/N+"),N=t("C1x5"),S=t("nt/U"),M=t("yNDK"),k=t("sYmb");function AddonCalendarIndexPage_core_context_menu_item_14_Template(e,n){if(1&e){const e=x.Fc();x.Ec(0,"core-context-menu-item",15),x.Mc("action",(function AddonCalendarIndexPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){x.fd(e);return x.Oc().toggleDisplay()})),x.Pc(1,"translate"),x.Dc()}2&e&&x.Vc("priority",800)("content",x.Qc(1,2,"addon.calendar.upcomingevents"))}function AddonCalendarIndexPage_core_context_menu_item_15_Template(e,n){if(1&e){const e=x.Fc();x.Ec(0,"core-context-menu-item",16),x.Mc("action",(function AddonCalendarIndexPage_core_context_menu_item_15_Template_core_context_menu_item_action_0_listener(){x.fd(e);return x.Oc().toggleDisplay()})),x.Pc(1,"translate"),x.Dc()}2&e&&x.Vc("priority",800)("content",x.Qc(1,2,"addon.calendar.monthlyview"))}const _c0=function(e){return{$a:e}};function AddonCalendarIndexPage_ion_card_25_Template(e,n){1&e&&(x.Ec(0,"ion-card",17),x.Ec(1,"ion-item"),x.zc(2,"ion-icon",18),x.Ec(3,"ion-label"),x.pd(4),x.Pc(5,"translate"),x.Pc(6,"translate"),x.Dc(),x.Dc(),x.Dc()),2&e&&(x.lc(4),x.qd(x.Rc(5,1,"core.hasdatatosync",x.ad(6,_c0,x.Qc(6,4,"addon.calendar.calendar")))))}function AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template(e,n){if(1&e){const e=x.Fc();x.Ec(0,"addon-calendar-upcoming-events",19),x.Mc("onEventClicked",(function AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template_addon_calendar_upcoming_events_onEventClicked_0_listener(n){x.fd(e);return x.Oc().gotoEvent(n)})),x.Dc()}if(2&e){const e=x.Oc();x.Vc("hidden",e.showCalendar)("filter",e.filter)}}function AddonCalendarIndexPage_ion_fab_28_Template(e,n){if(1&e){const e=x.Fc();x.Ec(0,"ion-fab",20),x.Ec(1,"ion-fab-button",21),x.Mc("click",(function AddonCalendarIndexPage_ion_fab_28_Template_ion_fab_button_click_1_listener(){x.fd(e);return x.Oc().openEdit()})),x.Pc(2,"translate"),x.zc(3,"ion-icon",22),x.Ec(4,"span",23),x.pd(5),x.Pc(6,"translate"),x.Dc(),x.Dc(),x.Dc()}2&e&&(x.lc(1),x.mc("aria-label",x.Qc(2,2,"addon.calendar.newevent")),x.lc(4),x.qd(x.Qc(6,4,"addon.calendar.newevent")))}let V=(()=>{class AddonCalendarIndexPage{constructor(e){this.route=e,this.canCreate=!1,this.courses=[],this.notificationsEnabled=!1,this.loaded=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=I.a.ICON_LOADING,this.showCalendar=!0,this.loadUpcoming=!1,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=s.b.getCurrentSiteId(),this.newEventObserver=r.b.on(u.c.NEW_EVENT_EVENT,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.discardedObserver=r.b.on(u.c.NEW_EVENT_DISCARDED_EVENT,(()=>{this.loaded=!1,this.refreshData(!0,!1,!0)}),this.currentSiteId),this.editEventObserver=r.b.on(u.c.EDIT_EVENT_EVENT,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.syncObserver=r.b.on(_.b.AUTO_SYNCED,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.manualSyncObserver=r.b.on(_.b.MANUAL_SYNCED,(e=>{e&&"index"!=e.source&&(this.loaded=!1,this.refreshData(!1,!1,!0))}),this.currentSiteId),this.deleteEventObserver=r.b.on(u.c.DELETED_EVENT_EVENT,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.undeleteEventObserver=r.b.on(u.c.UNDELETED_EVENT_EVENT,(()=>Object(c.a)(this,void 0,void 0,(function*(){this.hasOffline=yield f.a.hasOfflineData()}))),this.currentSiteId),this.filterChangedObserver=r.b.on(u.c.FILTER_CHANGED_EVENT,(e=>Object(c.a)(this,void 0,void 0,(function*(){this.filter=e,this.canCreate=yield m.b.canEditEvents(this.filter.courseId)})))),this.onlineObserver=d.a.onChange().subscribe((()=>{g.A.run((()=>{this.isOnline=d.a.isOnline()}))}))}ngOnInit(){this.notificationsEnabled=b.a.isAvailable(),this.loadUpcoming=!!C.a.getRouteBooleanParam("upcoming"),this.showCalendar=!this.loadUpcoming,this.route.queryParams.subscribe((()=>Object(c.a)(this,void 0,void 0,(function*(){this.filter.courseId=C.a.getRouteNumberParam("courseId"),this.year=C.a.getRouteNumberParam("year"),this.month=C.a.getRouteNumberParam("month"),this.filter.filtered=!!this.filter.courseId,this.fetchData(!0,!1)}))));(new y.a).treatLink()}fetchData(e,n){return Object(c.a)(this,void 0,void 0,(function*(){if(this.syncIcon=I.a.ICON_LOADING,this.isOnline=d.a.isOnline(),e)try{const e=yield _.a.syncEvents();e.warnings&&e.warnings.length&&l.a.showErrorModal(e.warnings[0]),e.updated&&(e.source="index",r.b.trigger(_.b.MANUAL_SYNCED,e,this.currentSiteId))}catch(e){n&&l.a.showErrorModalDefault(e,"core.errorsync",!0)}try{const e=[];this.hasOffline=!1,e.push(h.a.getCoursesForPopover(this.filter.courseId).then((e=>{this.courses=e.courses}))),e.push(m.b.canEditEvents(this.filter.courseId).then((e=>{this.canCreate=e}))),e.push(f.a.hasOfflineData().then((e=>{this.hasOffline=e}))),yield Promise.all(e)}catch(e){l.a.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}this.loaded=!0,this.syncIcon=I.a.ICON_SYNC}))}doRefresh(e,n,t){return Object(c.a)(this,void 0,void 0,(function*(){this.loaded&&(yield this.refreshData(!0,t).finally((()=>{null==e?void 0:e.complete(),n&&n()})))}))}refreshData(e=!1,n=!1,t=!1){return Object(c.a)(this,void 0,void 0,(function*(){this.syncIcon=I.a.ICON_LOADING;const a=[];a.push(u.a.invalidateAllowedEventTypes()),this.showCalendar&&this.calendarComponent?a.push(this.calendarComponent.refreshData(t)):!this.showCalendar&&this.upcomingEventsComponent&&a.push(this.upcomingEventsComponent.refreshData()),yield Promise.all(a).finally((()=>this.fetchData(e,n)))}))}gotoEvent(e){C.a.navigateToSitePath(`/calendar/event/${e}`)}gotoDay(e){const n={day:e.day,month:e.month,year:e.year};Object.keys(this.filter).forEach((e=>{n[e]=this.filter[e]})),C.a.navigateToSitePath("/calendar/day",{params:n})}openFilter(){return Object(c.a)(this,void 0,void 0,(function*(){yield l.a.openSideModal({component:E.a,componentProps:{courses:this.courses,filter:this.filter}})}))}openEdit(e){const n={};e=e||0,this.filter.courseId&&(n.courseId=this.filter.courseId),C.a.navigateToSitePath(`/calendar/edit/${e}`,{params:n})}openSettings(){C.a.navigateToSitePath("/calendar/calendar-settings")}toggleDisplay(){this.showCalendar=!this.showCalendar,this.showCalendar||(this.loadUpcoming=!0)}ngOnDestroy(){var e,n,t,a,o,i,c,d,r;null===(e=this.newEventObserver)||void 0===e?void 0:e.off(),null===(n=this.discardedObserver)||void 0===n||n.off(),null===(t=this.editEventObserver)||void 0===t||t.off(),null===(a=this.deleteEventObserver)||void 0===a||a.off(),null===(o=this.undeleteEventObserver)||void 0===o||o.off(),null===(i=this.syncObserver)||void 0===i||i.off(),null===(c=this.manualSyncObserver)||void 0===c||c.off(),null===(d=this.filterChangedObserver)||void 0===d||d.off(),null===(r=this.onlineObserver)||void 0===r||r.unsubscribe()}}return AddonCalendarIndexPage.ɵfac=function AddonCalendarIndexPage_Factory(e){return new(e||AddonCalendarIndexPage)(x.yc(a.a))},AddonCalendarIndexPage.ɵcmp=x.sc({type:AddonCalendarIndexPage,selectors:[["page-addon-calendar-index"]],viewQuery:function AddonCalendarIndexPage_Query(e,n){var t;(1&e&&(x.ud(p.a,!0),x.ud(v.a,!0)),2&e)&&(x.dd(t=x.Nc())&&(n.calendarComponent=t.first),x.dd(t=x.Nc())&&(n.upcomingEventsComponent=t.first))},decls:29,vars:35,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-th-list",3,"priority","content","action",4,"ngIf"],["iconAction","fas-calendar-alt",3,"priority","content","action",4,"ngIf"],["iconAction","fas-cogs",3,"hidden","priority","content","action"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["class","core-warning-card",4,"ngIf"],[3,"hidden","initialYear","initialMonth","filter","displayNavButtons","onEventClicked","onDayClicked"],[3,"hidden","filter","onEventClicked",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-th-list",3,"priority","content","action"],["iconAction","fas-calendar-alt",3,"priority","content","action"],[1,"core-warning-card"],["name","fas-exclamation-triangle","slot","start","aria-hidden","true"],[3,"hidden","filter","onEventClicked"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonCalendarIndexPage_Template(e,n){1&e&&(x.Ec(0,"ion-header"),x.Ec(1,"ion-toolbar"),x.Ec(2,"ion-buttons",0),x.zc(3,"ion-back-button",1),x.Pc(4,"translate"),x.Dc(),x.Ec(5,"ion-title"),x.Ec(6,"h1"),x.pd(7),x.Pc(8,"translate"),x.Dc(),x.Dc(),x.Ec(9,"ion-buttons",2),x.Ec(10,"ion-button",3),x.Mc("click",(function AddonCalendarIndexPage_Template_ion_button_click_10_listener(){return n.openFilter()})),x.Pc(11,"translate"),x.zc(12,"ion-icon",4),x.Dc(),x.Ec(13,"core-context-menu"),x.nd(14,AddonCalendarIndexPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5),x.nd(15,AddonCalendarIndexPage_core_context_menu_item_15_Template,2,4,"core-context-menu-item",6),x.Ec(16,"core-context-menu-item",7),x.Mc("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_16_listener(){return n.openSettings()})),x.Pc(17,"translate"),x.Dc(),x.Ec(18,"core-context-menu-item",8),x.Mc("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_18_listener(e){return n.doRefresh(void 0,e,!0)})),x.Pc(19,"translate"),x.Dc(),x.Dc(),x.zc(20,"core-user-menu-button"),x.Dc(),x.Dc(),x.Dc(),x.Ec(21,"ion-content"),x.Ec(22,"ion-refresher",9),x.Mc("ionRefresh",(function AddonCalendarIndexPage_Template_ion_refresher_ionRefresh_22_listener(e){return n.doRefresh(e.target)})),x.zc(23,"ion-refresher-content",10),x.Pc(24,"translate"),x.Dc(),x.nd(25,AddonCalendarIndexPage_ion_card_25_Template,7,8,"ion-card",11),x.Ec(26,"addon-calendar-calendar",12),x.Mc("onEventClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onEventClicked_26_listener(e){return n.gotoEvent(e)}))("onDayClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onDayClicked_26_listener(e){return n.gotoDay(e)})),x.Dc(),x.nd(27,AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template,1,2,"addon-calendar-upcoming-events",13),x.nd(28,AddonCalendarIndexPage_ion_fab_28_Template,7,6,"ion-fab",14),x.Dc()),2&e&&(x.lc(3),x.Vc("text",x.Qc(4,23,"core.back")),x.lc(4),x.qd(x.Qc(8,25,n.showCalendar?"addon.calendar.calendarevents":"addon.calendar.upcomingevents")),x.lc(3),x.mc("aria-label",x.Qc(11,27,"core.filter")),x.lc(4),x.Vc("ngIf",n.showCalendar),x.lc(1),x.Vc("ngIf",!n.showCalendar),x.lc(1),x.Vc("hidden",!n.notificationsEnabled)("priority",600)("content",x.Qc(17,29,"core.settings.settings")),x.lc(2),x.Vc("hidden",!n.loaded||!n.hasOffline||!n.isOnline)("priority",400)("content",x.Qc(19,31,"core.settings.synchronizenow"))("iconAction",n.syncIcon)("closeOnClick",!1),x.lc(4),x.Vc("disabled",!n.loaded),x.lc(1),x.Wc("pullingText",x.Qc(24,33,"core.pulltorefresh")),x.lc(2),x.Vc("ngIf",n.hasOffline),x.lc(1),x.Vc("hidden",!n.showCalendar)("initialYear",n.year)("initialMonth",n.month)("filter",n.filter)("displayNavButtons",n.showCalendar),x.lc(1),x.Vc("ngIf",n.loadUpcoming),x.lc(1),x.Vc("ngIf",n.canCreate))},directives:[D.C,D.Ab,D.m,D.h,D.i,D.yb,P.a,D.l,D.D,A.a,O.a,T.t,w.a,N.a,S.a,D.v,D.bb,D.cb,p.a,D.n,D.I,D.O,v.a,D.x,M.a,D.y],pipes:[k.d],encapsulation:2}),AddonCalendarIndexPage})();var L=t("dQ3M");const Q=[{path:"",component:V}];let R=(()=>{class AddonCalendarIndexPageModule{}return AddonCalendarIndexPageModule.ɵmod=x.wc({type:AddonCalendarIndexPageModule}),AddonCalendarIndexPageModule.ɵinj=x.vc({factory:function AddonCalendarIndexPageModule_Factory(e){return new(e||AddonCalendarIndexPageModule)},imports:[[a.m.forChild(Q),o.a,i.a,L.a],a.m]}),AddonCalendarIndexPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&x.kd(R,{declarations:[V],imports:[a.m,o.a,i.a,L.a],exports:[a.m]}))}}]);