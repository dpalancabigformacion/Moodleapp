(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{QeBL:function(e,t,n){"use strict";n.r(t),n.d(t,"AddonNotesLazyModule",(function(){return S}));var o=n("L3Fv"),c=n("tyNb"),i=n("rGK3"),s=n("yQkb"),a=n("mrSG"),r=n("BaYo"),d=n("mYSf"),l=n("yqEV"),_=n("+c6a"),u=n("VS9b"),f=n("MUy3"),h=n("4pns"),p=n("TEn/"),g=n("pHTc"),m=n("9+EE"),N=n("3LXp"),y=n("vuGA"),I=n("bFG1"),b=n("fjkH"),D=n("fXoL"),L=n("ACV2"),P=n("ACYt"),A=n("3CSS"),O=n("fQ68"),E=n("8/N+"),v=n("nt/U"),T=n("PgjG"),w=n("ofXK"),C=n("rf3J"),x=n("FeAf"),V=n("r8G5"),M=n("hMzs"),k=n("yNDK"),z=n("sYmb"),Q=n("Cg42");function AddonNotesListPage_ion_item_24_Template(e,t){if(1&e&&(D.Ec(0,"ion-item",19),D.zc(1,"core-user-avatar",20),D.Ec(2,"ion-label"),D.Ec(3,"h2"),D.pd(4),D.Dc(),D.Dc(),D.Dc()),2&e){const e=D.Oc();D.lc(1),D.Vc("user",e.user)("courseId",e.courseId)("linkProfile",!1),D.lc(3),D.qd(e.user.fullname)}}const _c0=function(e){return{$a:e}};function AddonNotesListPage_ion_card_35_Template(e,t){1&e&&(D.Ec(0,"ion-card",21),D.Ec(1,"ion-item"),D.zc(2,"ion-icon",22),D.Ec(3,"ion-label"),D.pd(4),D.Pc(5,"translate"),D.Pc(6,"lowercase"),D.Pc(7,"translate"),D.Dc(),D.Dc(),D.Dc()),2&e&&(D.lc(4),D.rd(" ",D.Rc(5,1,"core.thereisdatatosync",D.ad(8,_c0,D.Qc(6,4,D.Qc(7,6,"addon.notes.notes"))))," "))}function AddonNotesListPage_core_empty_box_36_Template(e,t){1&e&&(D.zc(0,"core-empty-box",23),D.Pc(1,"translate")),2&e&&D.Vc("message",D.Qc(1,1,"addon.notes.nonotes"))}function AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template(e,t){if(1&e&&D.zc(0,"core-user-avatar",30),2&e){const e=D.Oc().$implicit,t=D.Oc(2);D.Vc("user",e)("courseId",t.courseId)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template(e,t){if(1&e&&(D.Ec(0,"p",31),D.pd(1),D.Dc()),2&e){const e=D.Oc().$implicit;D.lc(1),D.qd(e.userfullname)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template(e,t){if(1&e&&(D.Ec(0,"p",2),D.Ec(1,"span",19),D.pd(2),D.Pc(3,"coreDateDayOrTime"),D.Dc(),D.Dc()),2&e){const e=D.Oc().$implicit;D.lc(2),D.qd(D.Qc(3,1,e.lastmodified))}}function AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template(e,t){1&e&&(D.Ec(0,"p",2),D.zc(1,"ion-icon",32),D.Ec(2,"span",19),D.pd(3),D.Pc(4,"translate"),D.Dc(),D.Dc()),2&e&&(D.lc(3),D.rd(" ",D.Qc(4,1,"core.notsent")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template(e,t){1&e&&(D.Ec(0,"p",2),D.zc(1,"ion-icon",33),D.Ec(2,"span",19),D.pd(3),D.Pc(4,"translate"),D.Dc(),D.Dc()),2&e&&(D.lc(3),D.rd(" ",D.Qc(4,1,"core.deletedoffline")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template(e,t){if(1&e){const e=D.Fc();D.Ec(0,"ion-button",34),D.Mc("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template_ion_button_click_0_listener(t){D.fd(e);const n=D.Oc().$implicit;return D.Oc(2).undoDeleteNote(t,n)})),D.Pc(1,"translate"),D.zc(2,"ion-icon",35),D.Dc()}2&e&&D.mc("aria-label",D.Qc(1,1,"core.restore"))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template(e,t){if(1&e){const e=D.Fc();D.Ec(0,"ion-button",34),D.Mc("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template_ion_button_click_0_listener(t){D.fd(e);const n=D.Oc().$implicit;return D.Oc(2).deleteNote(t,n)})),D.Pc(1,"translate"),D.zc(2,"ion-icon",36),D.Dc()}2&e&&(D.Vc("@coreSlideInOut","fromRight"),D.mc("aria-label",D.Qc(1,2,"core.delete")))}function AddonNotesListPage_ng_container_37_ion_card_1_Template(e,t){if(1&e&&(D.Ec(0,"ion-card"),D.Ec(1,"ion-item",19),D.nd(2,AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template,1,2,"core-user-avatar",25),D.Ec(3,"ion-label"),D.nd(4,AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template,2,1,"p",26),D.nd(5,AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template,4,3,"p",27),D.Dc(),D.nd(6,AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template,5,3,"p",27),D.nd(7,AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template,5,3,"p",27),D.nd(8,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template,3,3,"ion-button",28),D.nd(9,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template,3,4,"ion-button",28),D.Dc(),D.Ec(10,"ion-item",19),D.Ec(11,"ion-label"),D.zc(12,"core-format-text",29),D.Dc(),D.Dc(),D.Dc()),2&e){const e=t.$implicit,n=D.Oc(2);D.lc(2),D.Vc("ngIf",!n.userId),D.lc(2),D.Vc("ngIf",!n.userId),D.lc(1),D.Vc("ngIf",!e.deleted&&!e.offline),D.lc(1),D.Vc("ngIf",e.offline),D.lc(1),D.Vc("ngIf",e.deleted),D.lc(1),D.Vc("ngIf",e.deleted),D.lc(1),D.Vc("ngIf",n.showDelete&&!e.deleted&&("personal"!=n.type||e.usermodified==n.currentUserId)),D.lc(3),D.Vc("text",e.content)("filter",!1)}}function AddonNotesListPage_ng_container_37_Template(e,t){if(1&e&&(D.Cc(0),D.nd(1,AddonNotesListPage_ng_container_37_ion_card_1_Template,13,9,"ion-card",24),D.Bc()),2&e){const e=D.Oc();D.lc(1),D.Vc("ngForOf",e.notes)}}function AddonNotesListPage_ion_fab_38_Template(e,t){if(1&e){const e=D.Fc();D.Ec(0,"ion-fab",37),D.Ec(1,"ion-fab-button",38),D.Mc("click",(function AddonNotesListPage_ion_fab_38_Template_ion_fab_button_click_1_listener(t){D.fd(e);return D.Oc().addNote(t)})),D.Pc(2,"translate"),D.zc(3,"ion-icon",39),D.Ec(4,"span",40),D.pd(5),D.Pc(6,"translate"),D.Dc(),D.Dc(),D.Dc()}2&e&&(D.lc(1),D.mc("aria-label",D.Qc(2,2,"addon.notes.addnewnote")),D.lc(4),D.qd(D.Qc(6,4,"addon.notes.addnewnote")))}let F=(()=>{class AddonNotesListPage{constructor(){this.type="course",this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING,this.notes=[],this.hasOffline=!1,this.notesLoaded=!1,this.showDelete=!1,this.canDeleteNotes=!1,this.logAfterFetch=!0;try{this.courseId=g.a.getRequiredRouteNumberParam("courseId"),this.userId=g.a.getRouteNumberParam("userId")}catch(e){return N.a.showErrorModal(e),g.a.back(),void 0}this.syncObserver=b.b.on(u.b.AUTO_SYNCED,(e=>{var t;e.courseId==this.courseId&&(this.showSyncWarnings(e.warnings),this.notesLoaded=!1,this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING,null===(t=this.content)||void 0===t||t.scrollToTop(),this.fetchNotes(!1))}),m.b.getCurrentSiteId()),this.currentUserId=m.b.getCurrentSiteUserId()}ngOnInit(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.fetchNotes(!0)}))}fetchNotes(e=!1,t=!1){return Object(a.a)(this,void 0,void 0,(function*(){e&&(yield this.syncNotes(t));try{const e=(yield l.a.getNotes(this.courseId,this.userId))[this.type+"notes"]||[];e.forEach((e=>{e.content=y.a.decodeHTML(e.content)})),yield l.a.setOfflineDeletedNotes(e,this.courseId),this.hasOffline=e.some((e=>e.offline||e.deleted)),this.userId?(this.notes=e,this.user=yield h.a.getProfile(this.userId,this.courseId,!0)):this.notes=yield l.a.getNotesUserData(e),this.logAfterFetch&&(this.logAfterFetch=!1,I.a.ignoreErrors(l.a.logView(this.courseId,this.userId)))}catch(e){N.a.showErrorModal(e)}finally{let e=this.notes&&this.notes.length>0;e&&"personal"==this.type&&(e=!!this.notes.find((e=>e.usermodified==this.currentUserId))),this.canDeleteNotes=e,this.notesLoaded=!0,this.refreshIcon=r.a.ICON_REFRESH,this.syncIcon=r.a.ICON_SYNC}}))}refreshNotes(e,t){this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING,l.a.invalidateNotes(this.courseId,this.userId).finally((()=>{this.fetchNotes(!0,e).finally((()=>{t&&(null==t?void 0:t.complete())}))}))}typeChanged(e){return Object(a.a)(this,void 0,void 0,(function*(){this.type=e,this.notesLoaded=!1,this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING,this.logAfterFetch=!0,yield this.fetchNotes(!0)}))}addNote(e){return Object(a.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();const t=yield N.a.openModal({component:d.a,componentProps:{userId:this.userId,courseId:this.courseId,type:this.type}});void 0!==t&&(t.sent&&t.type?(t.type!=this.type&&(this.type=t.type,this.notesLoaded=!1),this.refreshNotes(!1)):t.type&&t.type!=this.type&&this.typeChanged(t.type))}))}deleteNote(e,t){return Object(a.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();try{yield N.a.showDeleteConfirm("addon.notes.deleteconfirm");try{yield l.a.deleteNote(t,this.courseId),this.showDelete=!1,this.refreshNotes(!1),N.a.showToast("addon.notes.eventnotedeleted",!0,N.c.LONG)}catch(e){N.a.showErrorModalDefault(e,"Delete note failed.")}}catch(e){}}))}undoDeleteNote(e,t){return Object(a.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation(),yield _.a.undoDeleteNote(t.id),this.refreshNotes(!0)}))}toggleDelete(){this.showDelete=!this.showDelete}syncNotes(e){return Object(a.a)(this,void 0,void 0,(function*(){try{const e=yield u.a.syncNotes(this.courseId);this.showSyncWarnings(e.warnings)}catch(t){e&&N.a.showErrorModalDefault(t,"core.errorsync",!0)}}))}showSyncWarnings(e){const t=y.a.buildMessage(e);t&&N.a.showErrorModal(t)}ngOnDestroy(){this.syncObserver&&this.syncObserver.off()}}return AddonNotesListPage.ɵfac=function AddonNotesListPage_Factory(e){return new(e||AddonNotesListPage)},AddonNotesListPage.ɵcmp=D.sc({type:AddonNotesListPage,selectors:[["page-addon-notes-list-page"]],viewQuery:function AddonNotesListPage_Query(e,t){var n;(1&e&&D.ud(p.v,!0),2&e)&&(D.dd(n=D.Nc())&&(t.content=n.first))},decls:39,vars:44,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","end","fill","clear",3,"hidden","click"],["name","fas-pen","slot","icon-only","aria-hidden","true"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[3,"selection","onChange"],["value","site",1,"ion-text-wrap"],["value","course",1,"ion-text-wrap"],["value","personal",1,"ion-text-wrap"],["class","core-warning-card",4,"ngIf"],["icon","fas-receipt",3,"message",4,"ngIf"],[4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId","linkProfile"],[1,"core-warning-card"],["name","fas-exclamation-triangle","slot","start","aria-hidden","true"],["icon","fas-receipt",3,"message"],[4,"ngFor","ngForOf"],["slot","start",3,"user","courseId",4,"ngIf"],["class","item-heading",4,"ngIf"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"click",4,"ngIf"],[3,"text","filter"],["slot","start",3,"user","courseId"],[1,"item-heading"],["name","fas-clock","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click"],["name","fas-undo-alt","slot","icon-only","aria-hidden","true"],["name","fas-trash","slot","icon-only","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonNotesListPage_Template(e,t){1&e&&(D.Ec(0,"ion-header"),D.Ec(1,"ion-toolbar"),D.Ec(2,"ion-buttons",0),D.zc(3,"ion-back-button",1),D.Pc(4,"translate"),D.Dc(),D.Ec(5,"ion-title"),D.Ec(6,"h1"),D.pd(7),D.Pc(8,"translate"),D.Dc(),D.Dc(),D.zc(9,"ion-buttons",2),D.Dc(),D.Dc(),D.Ec(10,"core-navbar-buttons",2),D.Ec(11,"ion-button",3),D.Mc("click",(function AddonNotesListPage_Template_ion_button_click_11_listener(){return t.toggleDelete()})),D.Pc(12,"translate"),D.zc(13,"ion-icon",4),D.Dc(),D.Ec(14,"core-context-menu"),D.Ec(15,"core-context-menu-item",5),D.Mc("action",(function AddonNotesListPage_Template_core_context_menu_item_action_15_listener(){return t.refreshNotes(!1)})),D.Pc(16,"translate"),D.Dc(),D.Ec(17,"core-context-menu-item",5),D.Mc("action",(function AddonNotesListPage_Template_core_context_menu_item_action_17_listener(){return t.refreshNotes(!0)})),D.Pc(18,"translate"),D.Dc(),D.Dc(),D.Dc(),D.Ec(19,"ion-content",6),D.Ec(20,"ion-refresher",7),D.Mc("ionRefresh",(function AddonNotesListPage_Template_ion_refresher_ionRefresh_20_listener(e){return t.refreshNotes(!1,e.target)})),D.zc(21,"ion-refresher-content",8),D.Pc(22,"translate"),D.Dc(),D.Ec(23,"core-loading",9),D.nd(24,AddonNotesListPage_ion_item_24_Template,5,4,"ion-item",10),D.Ec(25,"core-combobox",11),D.Mc("onChange",(function AddonNotesListPage_Template_core_combobox_onChange_25_listener(e){return t.typeChanged(e)})),D.Ec(26,"ion-select-option",12),D.pd(27),D.Pc(28,"translate"),D.Dc(),D.Ec(29,"ion-select-option",13),D.pd(30),D.Pc(31,"translate"),D.Dc(),D.Ec(32,"ion-select-option",14),D.pd(33),D.Pc(34,"translate"),D.Dc(),D.Dc(),D.nd(35,AddonNotesListPage_ion_card_35_Template,8,10,"ion-card",15),D.nd(36,AddonNotesListPage_core_empty_box_36_Template,2,3,"core-empty-box",16),D.nd(37,AddonNotesListPage_ng_container_37_Template,2,1,"ng-container",17),D.Dc(),D.nd(38,AddonNotesListPage_ion_fab_38_Template,7,6,"ion-fab",18),D.Dc()),2&e&&(D.lc(3),D.Vc("text",D.Qc(4,26,"core.back")),D.lc(4),D.qd(D.Qc(8,28,"addon.notes.notes")),D.lc(4),D.Vc("hidden",!t.canDeleteNotes),D.mc("aria-label",D.Qc(12,30,"core.toggledelete")),D.lc(4),D.Vc("hidden",!(t.notesLoaded&&!t.hasOffline))("priority",100)("content",D.Qc(16,32,"core.refresh"))("iconAction",t.refreshIcon)("closeOnClick",!0),D.lc(2),D.Vc("hidden",!(t.notesLoaded&&t.hasOffline))("priority",100)("content",D.Qc(18,34,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),D.lc(3),D.Vc("disabled",!t.notesLoaded),D.lc(1),D.Wc("pullingText",D.Qc(22,36,"core.pulltorefresh")),D.lc(2),D.Vc("hideUntil",t.notesLoaded),D.lc(1),D.Vc("ngIf",t.user),D.lc(1),D.Vc("selection",t.type),D.lc(2),D.rd(" ",D.Qc(28,38,"addon.notes.sitenotes")," "),D.lc(3),D.rd(" ",D.Qc(31,40,"addon.notes.coursenotes")," "),D.lc(3),D.rd(" ",D.Qc(34,42,"addon.notes.personalnotes")," "),D.lc(2),D.Vc("ngIf",t.hasOffline),D.lc(1),D.Vc("ngIf",t.notes&&0==t.notes.length),D.lc(1),D.Vc("ngIf",t.notes&&t.notes.length>0),D.lc(1),D.Vc("ngIf",t.userId&&t.notesLoaded))},directives:[p.C,p.Ab,p.m,p.h,p.i,p.yb,L.a,P.a,p.l,p.D,A.a,O.a,E.a,v.a,p.v,p.bb,p.cb,T.a,w.t,C.a,p.mb,p.I,x.a,p.O,p.n,V.a,w.s,M.a,p.x,k.a,p.y],pipes:[z.d,w.p,Q.a],encapsulation:2,data:{animation:[f.a.SLIDE_IN_OUT]}}),AddonNotesListPage})();const G=[{path:"",component:F}];let S=(()=>{class AddonNotesLazyModule{}return AddonNotesLazyModule.ɵmod=D.wc({type:AddonNotesLazyModule}),AddonNotesLazyModule.ɵinj=D.vc({factory:function AddonNotesLazyModule_Factory(e){return new(e||AddonNotesLazyModule)},imports:[[c.m.forChild(G),o.a,i.a,s.a],c.m]}),AddonNotesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&D.kd(S,{declarations:[F],imports:[c.m,o.a,i.a,s.a],exports:[c.m]}))}}]);