(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{"1mzu":function(e,o,t){"use strict";t.r(o),t.d(o,"CoreCoursesCategoriesPageModule",(function(){return v}));var r=t("tyNb"),s=t("L3Fv"),n=t("oV7r"),c=t("mrSG"),a=t("9+EE"),i=t("3LXp"),l=t("bFG1"),d=t("Xzvb"),g=t("j3ag"),u=t("pHTc"),_=t("fjkH"),C=t("fXoL"),h=t("TEn/"),m=t("hMzs"),p=t("fQ68"),f=t("ofXK"),b=t("8/N+"),E=t("nt/U"),y=t("PgjG"),w=t("3CSS"),D=t("edOc"),P=t("Y7jA"),I=t("r8G5"),O=t("sYmb");function CoreCoursesCategoriesPage_core_context_menu_item_10_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,"core-context-menu-item",5),C.Mc("action",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(){C.fd(e);return C.Oc().toggleDownload()}))("toggleChange",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_toggleChange_0_listener(o){C.fd(e);return C.Oc().downloadEnabled=o})),C.Pc(1,"translate"),C.Dc()}if(2&e){const e=C.Oc();C.Vc("priority",1e3)("content",C.Qc(1,3,"core.settings.showdownloadoptions"))("toggle",e.downloadEnabled)}}function CoreCoursesCategoriesPage_ion_item_19_p_6_Template(e,o){if(1&e&&(C.Ec(0,"p"),C.zc(1,"core-format-text",16),C.Dc()),2&e){const e=C.Oc(2);C.lc(1),C.Vc("text",e.currentCategory.description)("contextInstanceId",e.currentCategory.id)}}function CoreCoursesCategoriesPage_ion_item_19_Template(e,o){if(1&e&&(C.Ec(0,"ion-item",13),C.zc(1,"ion-icon",14),C.Pc(2,"translate"),C.Ec(3,"ion-label"),C.Ec(4,"p",15),C.zc(5,"core-format-text",2),C.Dc(),C.nd(6,CoreCoursesCategoriesPage_ion_item_19_p_6_Template,2,2,"p",11),C.Dc(),C.Dc()),2&e){const e=C.Oc();C.lc(1),C.mc("aria-label",C.Qc(2,4,"core.category")),C.lc(4),C.Vc("text",e.currentCategory.name)("contextInstanceId",e.currentCategory.id),C.lc(1),C.Vc("ngIf",e.currentCategory.description)}}const _c0=function(e){return{$a:e}};function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_ion_badge_7_Template(e,o){if(1&e&&(C.Ec(0,"ion-badge",21),C.Ec(1,"span",22),C.pd(2),C.Dc(),C.Ec(3,"span",23),C.pd(4),C.Pc(5,"translate"),C.Dc(),C.Dc()),2&e){const e=C.Oc().$implicit;C.lc(2),C.qd(e.coursecount),C.lc(2),C.qd(C.Rc(5,2,"core.courses.therearecourses",C.ad(5,_c0,e.coursecount)))}}function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,"ion-card"),C.Ec(1,"ion-item",19),C.Mc("click",(function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template_ion_item_click_1_listener(){C.fd(e);const t=o.$implicit;return C.Oc(2).openCategory(t.id)})),C.zc(2,"ion-icon",14),C.Pc(3,"translate"),C.Ec(4,"ion-label"),C.Ec(5,"h2"),C.zc(6,"core-format-text",2),C.Dc(),C.Dc(),C.nd(7,CoreCoursesCategoriesPage_ng_container_20_ion_card_6_ion_badge_7_Template,6,7,"ion-badge",20),C.Dc(),C.Dc()}if(2&e){const e=o.$implicit,t=C.Oc(2);C.lc(1),C.mc("aria-label",e.name),C.lc(1),C.mc("aria-label",C.Qc(3,5,"core.category")),C.lc(4),C.Vc("text",e.name)("contextInstanceId",e.id),C.lc(1),C.Vc("ngIf",!t.showOnlyEnrolled&&e.coursecount>0)}}function CoreCoursesCategoriesPage_ng_container_20_Template(e,o){if(1&e&&(C.Cc(0),C.Ec(1,"ion-item-divider"),C.Ec(2,"ion-label"),C.Ec(3,"h2",17),C.pd(4),C.Pc(5,"translate"),C.Dc(),C.Dc(),C.Dc(),C.nd(6,CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template,8,7,"ion-card",18),C.Bc()),2&e){const e=C.Oc();C.lc(4),C.qd(C.Qc(5,2,"core.courses.categories")),C.lc(2),C.Vc("ngForOf",e.categories)}}function CoreCoursesCategoriesPage_ng_container_21_h2_3_Template(e,o){1&e&&(C.Ec(0,"h2",17),C.pd(1),C.Pc(2,"translate"),C.Dc()),2&e&&(C.lc(1),C.qd(C.Qc(2,1,"core.courses.courses")))}function CoreCoursesCategoriesPage_ng_container_21_h2_4_Template(e,o){1&e&&(C.Ec(0,"h2",17),C.pd(1),C.Pc(2,"translate"),C.Dc()),2&e&&(C.lc(1),C.qd(C.Qc(2,1,"core.courses.mycourses")))}function CoreCoursesCategoriesPage_ng_container_21_core_courses_course_list_item_5_Template(e,o){if(1&e&&C.zc(0,"core-courses-course-list-item",26),2&e){const e=o.$implicit,t=C.Oc(2);C.Vc("course",e)("showDownload",t.downloadEnabled)}}function CoreCoursesCategoriesPage_ng_container_21_Template(e,o){if(1&e&&(C.Cc(0),C.Ec(1,"ion-item-divider"),C.Ec(2,"ion-label"),C.nd(3,CoreCoursesCategoriesPage_ng_container_21_h2_3_Template,3,3,"h2",24),C.nd(4,CoreCoursesCategoriesPage_ng_container_21_h2_4_Template,3,3,"h2",24),C.Dc(),C.Dc(),C.nd(5,CoreCoursesCategoriesPage_ng_container_21_core_courses_course_list_item_5_Template,1,2,"core-courses-course-list-item",25),C.Bc()),2&e){const e=C.Oc();C.lc(3),C.Vc("ngIf",!e.showOnlyEnrolled),C.lc(1),C.Vc("ngIf",e.showOnlyEnrolled),C.lc(1),C.Vc("ngForOf",e.courses)}}function CoreCoursesCategoriesPage_core_empty_box_22_Template(e,o){1&e&&(C.zc(0,"core-empty-box",27),C.Pc(1,"translate")),2&e&&C.Vc("message",C.Qc(1,1,"core.courses.nocoursesyet"))}let x=(()=>{class CoreCoursesCategoriesPage{constructor(){this.categories=[],this.courses=[],this.categoriesLoaded=!1,this.showOnlyEnrolled=!1,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.categoryCourses=[],this.categoryId=0,this.isDestroyed=!1,this.title=g.J.instant("core.courses.categories"),this.currentSiteId=a.b.getRequiredCurrentSite().getId(),this.myCoursesObserver=_.b.on(d.b.EVENT_MY_COURSES_UPDATED,(e=>{e.action==d.b.ACTION_ENROL&&this.fetchCategories()}),this.currentSiteId),this.siteUpdatedObserver=_.b.on(_.b.SITE_UPDATED,(()=>{this.downloadCourseEnabled=!d.a.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!d.a.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&this.downloadEnabled}),this.currentSiteId),this.downloadEnabledObserver=_.b.on(d.b.EVENT_DASHBOARD_DOWNLOAD_ENABLED_CHANGED,(e=>{this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&e.enabled}))}ngOnInit(){this.categoryId=u.a.getRouteNumberParam("id")||0,this.showOnlyEnrolled=u.a.getRouteBooleanParam("enrolled")||this.showOnlyEnrolled,this.downloadCourseEnabled=!d.a.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!d.a.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&d.a.getCourseDownloadOptionsEnabled(),this.fetchCategories().finally((()=>{this.categoriesLoaded=!0}))}fetchCategories(){return Object(c.a)(this,void 0,void 0,(function*(){try{const e=yield d.a.getCategories(this.categoryId,!0);this.currentCategory=void 0;const o=e.findIndex((e=>e.id==this.categoryId));if(o>=0&&(this.currentCategory=e[o],delete e[o]),e.sort(((e,o)=>e.depth==o.depth?e.sortorder>o.sortorder?1:o.sortorder>e.sortorder?-1:0:e.depth>o.depth?1:-1)),this.categories=l.a.formatTree(e,"parent","id",this.categoryId),this.currentCategory){this.title=this.currentCategory.name;try{this.categoryCourses=yield d.a.getCoursesByField("category",this.categoryId),yield this.filterEnrolled()}catch(e){!this.isDestroyed&&i.a.showErrorModalDefault(e,"core.courses.errorloadcourses",!0)}}}catch(e){!this.isDestroyed&&i.a.showErrorModalDefault(e,"core.courses.errorloadcategories",!0)}}))}refreshCategories(e){const o=[];o.push(d.a.invalidateUserCourses()),o.push(d.a.invalidateCategories(this.categoryId,!0)),o.push(d.a.invalidateCoursesByField("category",this.categoryId)),o.push(a.b.getRequiredCurrentSite().invalidateConfig()),Promise.all(o).finally((()=>{this.fetchCategories().finally((()=>{null==e?void 0:e.complete()}))}))}openCategory(e){u.a.navigateToSitePath("courses/categories/"+e,{params:{enrolled:this.showOnlyEnrolled}})}filterEnrolled(){return Object(c.a)(this,void 0,void 0,(function*(){this.showOnlyEnrolled?(yield Promise.all(this.categoryCourses.map((e=>Object(c.a)(this,void 0,void 0,(function*(){if(!(void 0!==e.progress))try{const o=yield d.a.getUserCourse(e.id);e.progress=o.progress,e.completionusertracked=o.completionusertracked}catch(e){}}))))),this.courses=this.categoryCourses.filter((e=>"progress"in e))):this.courses=this.categoryCourses}))}toggleDownload(){d.a.setCourseDownloadOptionsEnabled(this.downloadEnabled)}ngOnDestroy(){this.myCoursesObserver.off(),this.siteUpdatedObserver.off(),this.downloadEnabledObserver.off(),this.isDestroyed=!0}}return CoreCoursesCategoriesPage.ɵfac=function CoreCoursesCategoriesPage_Factory(e){return new(e||CoreCoursesCategoriesPage)},CoreCoursesCategoriesPage.ɵcmp=C.sc({type:CoreCoursesCategoriesPage,selectors:[["page-core-courses-categories"]],decls:23,vars:20,consts:[["slot","start"],[3,"text"],["contextLevel","coursecat",3,"text","contextInstanceId"],["slot","end"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange",4,"ngIf"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"list-item-limited-width"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],["icon","fas-graduation-cap",3,"message",4,"ngIf"],[1,"ion-text-wrap"],["name","fas-folder","slot","start"],[1,"item-heading"],["collapsible-item","","contextLevel","coursecat",3,"text","contextInstanceId"],[1,"big"],[4,"ngFor","ngForOf"],["button","","detail","true",1,"ion-text-wrap",3,"click"],["slot","end","color","light",4,"ngIf"],["slot","end","color","light"],["aria-hidden","true"],[1,"sr-only"],["class","big",4,"ngIf"],[3,"course","showDownload",4,"ngFor","ngForOf"],[3,"course","showDownload"],["icon","fas-graduation-cap",3,"message"]],template:function CoreCoursesCategoriesPage_Template(e,o){1&e&&(C.Ec(0,"ion-header"),C.Ec(1,"ion-toolbar"),C.Ec(2,"ion-buttons",0),C.zc(3,"ion-back-button",1),C.Pc(4,"translate"),C.Dc(),C.Ec(5,"ion-title"),C.Ec(6,"h1"),C.zc(7,"core-format-text",2),C.Dc(),C.Dc(),C.Ec(8,"ion-buttons",3),C.Ec(9,"core-context-menu"),C.nd(10,CoreCoursesCategoriesPage_core_context_menu_item_10_Template,2,5,"core-context-menu-item",4),C.Ec(11,"core-context-menu-item",5),C.Mc("action",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_action_11_listener(){return o.filterEnrolled()}))("toggleChange",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_toggleChange_11_listener(e){return o.showOnlyEnrolled=e})),C.Pc(12,"translate"),C.Dc(),C.Dc(),C.Dc(),C.Dc(),C.Dc(),C.Ec(13,"ion-content"),C.Ec(14,"ion-refresher",6),C.Mc("ionRefresh",(function CoreCoursesCategoriesPage_Template_ion_refresher_ionRefresh_14_listener(e){return o.refreshCategories(e.target)})),C.zc(15,"ion-refresher-content",7),C.Pc(16,"translate"),C.Dc(),C.Ec(17,"core-loading",8),C.Ec(18,"ion-list",9),C.nd(19,CoreCoursesCategoriesPage_ion_item_19_Template,7,6,"ion-item",10),C.nd(20,CoreCoursesCategoriesPage_ng_container_20_Template,7,4,"ng-container",11),C.nd(21,CoreCoursesCategoriesPage_ng_container_21_Template,6,3,"ng-container",11),C.Dc(),C.nd(22,CoreCoursesCategoriesPage_core_empty_box_22_Template,2,3,"core-empty-box",12),C.Dc(),C.Dc()),2&e&&(C.lc(3),C.Vc("text",C.Qc(4,14,"core.back")),C.lc(4),C.Vc("text",o.title)("contextInstanceId",o.currentCategory&&o.currentCategory.id),C.lc(3),C.Vc("ngIf",o.downloadCourseEnabled||o.downloadCoursesEnabled),C.lc(1),C.Vc("priority",900)("content",C.Qc(12,16,"core.courses.showonlyenrolled"))("toggle",o.showOnlyEnrolled),C.lc(3),C.Vc("disabled",!o.categoriesLoaded),C.lc(1),C.Wc("pullingText",C.Qc(16,18,"core.pulltorefresh")),C.lc(2),C.Vc("hideUntil",o.categoriesLoaded),C.lc(2),C.Vc("ngIf",o.currentCategory),C.lc(1),C.Vc("ngIf",o.categories.length>0),C.lc(1),C.Vc("ngIf",o.courses.length>0),C.lc(1),C.Vc("ngIf",!o.categories.length&&!o.courses.length))},directives:[h.C,h.Ab,h.m,h.h,h.i,h.yb,m.a,p.a,f.t,b.a,E.a,h.v,h.bb,h.cb,y.a,h.P,h.I,h.D,w.a,h.O,D.a,h.J,f.s,h.n,h.k,P.a,I.a],pipes:[O.d],encapsulation:2}),CoreCoursesCategoriesPage})();const T=[{path:"",component:x}];let v=(()=>{class CoreCoursesCategoriesPageModule{}return CoreCoursesCategoriesPageModule.ɵmod=C.wc({type:CoreCoursesCategoriesPageModule}),CoreCoursesCategoriesPageModule.ɵinj=C.vc({factory:function CoreCoursesCategoriesPageModule_Factory(e){return new(e||CoreCoursesCategoriesPageModule)},imports:[[r.m.forChild(T),s.a,n.a],r.m]}),CoreCoursesCategoriesPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&C.kd(v,{declarations:[x],imports:[r.m,s.a,n.a],exports:[r.m]}))}}]);