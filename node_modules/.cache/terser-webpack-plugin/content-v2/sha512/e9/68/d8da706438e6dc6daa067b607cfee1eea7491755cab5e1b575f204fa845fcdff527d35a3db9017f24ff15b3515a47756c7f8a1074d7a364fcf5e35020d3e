{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{KBMx:function(e,o,t){\"use strict\";t.r(o),t.d(o,\"AddonStorageManagerLazyModule\",(function(){return R}));var n=t(\"tyNb\"),a=t(\"L3Fv\"),i=t(\"mrSG\"),r=t(\"BaYo\"),c=t(\"ULAo\"),d=t(\"GBcW\"),s=t(\"zbKZ\"),l=t(\"Xzvb\"),g=t(\"1gmh\"),_=t(\"SV+s\"),u=t(\"pHTc\"),h=t(\"9+EE\"),m=t(\"3LXp\"),S=t(\"j3ag\"),f=t(\"Wsfw\"),p=t(\"fjkH\"),C=t(\"fXoL\"),b=t(\"TEn/\"),D=t(\"nt/U\"),M=t(\"PgjG\"),P=t(\"ofXK\"),w=t(\"ACYt\"),v=t(\"3CSS\"),O=t(\"sYmb\"),I=t(\"1iFe\");function AddonStorageManagerCoursesStoragePage_div_11_Template(e,o){1&e&&(C.Ec(0,\"div\",6),C.Ec(1,\"h2\"),C.pd(2),C.Pc(3,\"translate\"),C.Dc(),C.Dc()),2&e&&(C.lc(2),C.qd(C.Qc(3,1,\"addon.storagemanager.alldata\")))}function AddonStorageManagerCoursesStoragePage_ion_card_12_ion_badge_6_Template(e,o){if(1&e&&(C.Ec(0,\"ion-badge\",9),C.pd(1),C.Pc(2,\"coreBytesToSize\"),C.Dc()),2&e){const e=C.Oc(2);C.lc(1),C.qd(C.Qc(2,1,e.spaceUsage.spaceUsage))}}function AddonStorageManagerCoursesStoragePage_ion_card_12_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,\"ion-card\"),C.Ec(1,\"ion-item\",13),C.Ec(2,\"ion-label\"),C.Ec(3,\"p\",14),C.pd(4),C.Pc(5,\"translate\"),C.Dc(),C.nd(6,AddonStorageManagerCoursesStoragePage_ion_card_12_ion_badge_6_Template,3,3,\"ion-badge\",15),C.Dc(),C.Ec(7,\"ion-button\",16),C.Mc(\"click\",(function AddonStorageManagerCoursesStoragePage_ion_card_12_Template_ion_button_click_7_listener(o){C.fd(e);return C.Oc().deleteSiteStorage(o)})),C.Pc(8,\"translate\"),C.zc(9,\"ion-icon\",17),C.Dc(),C.Dc(),C.Dc()}if(2&e){const e=C.Oc();C.lc(4),C.qd(C.Qc(5,4,\"addon.storagemanager.totalspaceusage\")),C.lc(2),C.Vc(\"ngIf\",e.spaceUsage.spaceUsage),C.lc(1),C.Vc(\"hidden\",e.spaceUsage.spaceUsage+e.spaceUsage.cacheEntries<=0),C.mc(\"aria-label\",C.Qc(8,6,\"addon.storagemanager.deleteallsitedata\"))}}function AddonStorageManagerCoursesStoragePage_ion_item_29_p_4_Template(e,o){1&e&&(C.Ec(0,\"p\",22),C.pd(1),C.Pc(2,\"translate\"),C.Dc()),2&e&&(C.lc(1),C.rd(\" \",C.Qc(2,1,\"core.downloading\"),\" \"))}const _c0=function(e){return{name:e}};function AddonStorageManagerCoursesStoragePage_ion_item_29_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,\"ion-item\",18),C.Mc(\"click\",(function AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_item_click_0_listener(){C.fd(e);const t=o.$implicit;return C.Oc().openCourse(t.id,t.title)})),C.Ec(1,\"ion-label\",19),C.Ec(2,\"p\",8),C.pd(3),C.Dc(),C.nd(4,AddonStorageManagerCoursesStoragePage_ion_item_29_p_4_Template,3,3,\"p\",20),C.Ec(5,\"ion-badge\",9),C.pd(6),C.Pc(7,\"coreBytesToSize\"),C.Dc(),C.Dc(),C.Ec(8,\"ion-button\",10),C.Mc(\"click\",(function AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_button_click_8_listener(t){C.fd(e);const n=o.$implicit;return C.Oc().deleteCourse(t,n)})),C.zc(9,\"ion-icon\",21),C.Pc(10,\"translate\"),C.Dc(),C.Dc()}if(2&e){const e=o.$implicit;C.lc(3),C.qd(e.title),C.lc(1),C.Vc(\"ngIf\",e.isDownloading),C.lc(2),C.rd(\" \",C.Qc(7,5,e.totalSize),\" \"),C.lc(2),C.Vc(\"disabled\",e.isDownloading),C.lc(1),C.mc(\"aria-label\",C.Rc(10,7,\"addon.storagemanager.deletedatafrom\",C.ad(10,_c0,e.title)))}}let E=(()=>{class AddonStorageManagerCoursesStoragePage{constructor(){this.userCourses=[],this.downloadedCourses=[],this.completelyDownloadedCourses=[],this.totalSize=0,this.loaded=!1,this.spaceUsage={cacheEntries:0,spaceUsage:0},this.siteId=h.b.getCurrentSiteId()}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){this.userCourses=yield l.a.getUserCourses(),this.courseStatusObserver=p.b.on(p.b.COURSE_STATUS_CHANGED,(({courseId:e,status:o})=>this.onCourseUpdated(e,o)));const e=yield c.a.getDownloadedCourseIds(),o=yield Promise.all(this.userCourses.filter((o=>-1!==e.indexOf(o.id))).map((e=>this.getDownloadedCourse(e))));if(yield _.a.isAvailable(this.siteId)){const e=h.b.getCurrentSiteHomeId(),t=yield this.calculateDownloadedCourseSize(e);if(t>0){const n=yield c.a.getCourseStatus(e);o.push({id:e,title:S.J.instant(\"core.sitehome.sitehome\"),totalSize:t,isDownloading:n===r.a.DOWNLOADING})}}this.spaceUsage=yield g.a.getSiteSpaceUsage(this.siteId),this.setDownloadedCourses(o),this.loaded=!0}))}ngOnDestroy(){var e;null===(e=this.courseStatusObserver)||void 0===e?void 0:e.off()}deleteCompletelyDownloadedCourses(e){return Object(i.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();try{yield m.a.showDeleteConfirm(\"addon.storagemanager.confirmdeletecourses\")}catch(e){if(!m.a.isCanceledError(e))throw e;return}const o=yield m.a.showModalLoading(\"core.deleting\",!0),t=this.completelyDownloadedCourses.map((e=>e.id));try{yield Promise.all(t.map((e=>d.a.deleteCourseFiles(e)))),this.setDownloadedCourses(this.downloadedCourses.filter((e=>!t.includes(e.id))))}catch(e){m.a.showErrorModalDefault(e,S.J.instant(\"core.errordeletefile\"))}finally{o.dismiss()}}))}deleteCourse(e,o){return Object(i.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();try{yield m.a.showDeleteConfirm(\"addon.storagemanager.confirmdeletedatafrom\",{name:o.title})}catch(e){if(!m.a.isCanceledError(e))throw e;return}const t=yield m.a.showModalLoading(\"core.deleting\",!0);try{yield d.a.deleteCourseFiles(o.id),this.setDownloadedCourses(f.a.withoutItem(this.downloadedCourses,o))}catch(e){m.a.showErrorModalDefault(e,S.J.instant(\"core.errordeletefile\"))}finally{t.dismiss()}}))}onCourseUpdated(e,o){return Object(i.a)(this,void 0,void 0,(function*(){if(e==c.e.ALL_COURSES_CLEARED)return this.setDownloadedCourses([]),void 0;const t=this.downloadedCourses.find((o=>o.id===e));t&&(t.isDownloading=o===r.a.DOWNLOADING,t.totalSize=yield this.calculateDownloadedCourseSize(t.id),this.setDownloadedCourses(this.downloadedCourses))}))}setDownloadedCourses(e){this.downloadedCourses=e.sort(((e,o)=>o.totalSize-e.totalSize)),this.completelyDownloadedCourses=e.filter((e=>!e.isDownloading)),this.totalSize=this.downloadedCourses.reduce(((e,o)=>e+o.totalSize),0)}getDownloadedCourse(e){return Object(i.a)(this,void 0,void 0,(function*(){const o=yield this.calculateDownloadedCourseSize(e.id),t=yield c.a.getCourseStatus(e.id);return{id:e.id,title:e.displayname||e.fullname,totalSize:o,isDownloading:t===r.a.DOWNLOADING}}))}calculateDownloadedCourseSize(e){return Object(i.a)(this,void 0,void 0,(function*(){const o=yield c.a.getSections(e),t=f.a.flatten(o.map((e=>e.modules))).map((o=>Object(i.a)(this,void 0,void 0,(function*(){const t=yield s.a.getModuleStoredSize(o,e);return isNaN(t)?0:t}))));return(yield Promise.all(t)).reduce(((e,o)=>e+o),0)}))}openCourse(e,o){u.a.navigateToSitePath(\"/storage/\"+e,{params:{title:o}})}deleteSiteStorage(e){return Object(i.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();try{const e=h.b.getRequiredCurrentSite().getSiteName();this.spaceUsage=yield g.a.deleteSiteStorage(e,this.siteId)}catch(e){}}))}}return AddonStorageManagerCoursesStoragePage.ɵfac=function AddonStorageManagerCoursesStoragePage_Factory(e){return new(e||AddonStorageManagerCoursesStoragePage)},AddonStorageManagerCoursesStoragePage.ɵcmp=C.sc({type:AddonStorageManagerCoursesStoragePage,selectors:[[\"page-addon-storagemanager-courses-storage\"]],decls:30,vars:23,consts:[[\"slot\",\"start\"],[3,\"text\"],[1,\"limited-width\"],[3,\"hideUntil\"],[\"class\",\"ion-padding-horizontal ion-text-wrap\",4,\"ngIf\"],[4,\"ngIf\"],[1,\"ion-padding-horizontal\",\"ion-text-wrap\"],[\"lines\",\"full\",1,\"size\",\"courses\",\"ion-text-wrap\"],[1,\"item-heading\"],[\"color\",\"light\"],[\"slot\",\"end\",\"color\",\"danger\",\"fill\",\"clear\",3,\"disabled\",\"click\"],[\"name\",\"fas-trash\",\"slot\",\"icon-only\",3,\"ariaLabel\"],[\"class\",\"course\",\"button\",\"\",3,\"click\",4,\"ngFor\",\"ngForOf\"],[1,\"ion-text-wrap\",\"total\"],[1,\"item-heading\",\"ion-text-wrap\"],[\"color\",\"light\",4,\"ngIf\"],[\"fill\",\"clear\",\"color\",\"danger\",\"slot\",\"end\",3,\"hidden\",\"click\"],[\"name\",\"fas-trash\",\"slot\",\"icon-only\",\"aria-hidden\",\"true\"],[\"button\",\"\",1,\"course\",3,\"click\"],[1,\"ion-text-wrap\"],[\"class\",\"item-heading item-heading-secondary\",4,\"ngIf\"],[\"name\",\"fas-trash\",\"slot\",\"icon-only\"],[1,\"item-heading\",\"item-heading-secondary\"]],template:function AddonStorageManagerCoursesStoragePage_Template(e,o){1&e&&(C.Ec(0,\"ion-header\"),C.Ec(1,\"ion-toolbar\"),C.Ec(2,\"ion-buttons\",0),C.zc(3,\"ion-back-button\",1),C.Pc(4,\"translate\"),C.Dc(),C.Ec(5,\"ion-title\"),C.Ec(6,\"h1\"),C.pd(7),C.Pc(8,\"translate\"),C.Dc(),C.Dc(),C.Dc(),C.Dc(),C.Ec(9,\"ion-content\",2),C.Ec(10,\"core-loading\",3),C.nd(11,AddonStorageManagerCoursesStoragePage_div_11_Template,4,3,\"div\",4),C.nd(12,AddonStorageManagerCoursesStoragePage_ion_card_12_Template,10,8,\"ion-card\",5),C.Ec(13,\"div\",6),C.Ec(14,\"h2\"),C.pd(15),C.Pc(16,\"translate\"),C.Dc(),C.Dc(),C.Ec(17,\"ion-card\"),C.Ec(18,\"ion-item\",7),C.Ec(19,\"ion-label\"),C.Ec(20,\"p\",8),C.pd(21),C.Pc(22,\"translate\"),C.Dc(),C.Ec(23,\"ion-badge\",9),C.pd(24),C.Pc(25,\"coreBytesToSize\"),C.Dc(),C.Dc(),C.Ec(26,\"ion-button\",10),C.Mc(\"click\",(function AddonStorageManagerCoursesStoragePage_Template_ion_button_click_26_listener(e){return o.deleteCompletelyDownloadedCourses(e)})),C.zc(27,\"ion-icon\",11),C.Pc(28,\"translate\"),C.Dc(),C.Dc(),C.nd(29,AddonStorageManagerCoursesStoragePage_ion_item_29_Template,11,12,\"ion-item\",12),C.Dc(),C.Dc(),C.Dc()),2&e&&(C.lc(3),C.Vc(\"text\",C.Qc(4,11,\"core.back\")),C.lc(4),C.qd(C.Qc(8,13,\"addon.storagemanager.managedownloads\")),C.lc(3),C.Vc(\"hideUntil\",o.loaded),C.lc(1),C.Vc(\"ngIf\",o.spaceUsage),C.lc(1),C.Vc(\"ngIf\",o.spaceUsage),C.lc(3),C.qd(C.Qc(16,15,\"addon.storagemanager.downloadedcourses\")),C.lc(6),C.qd(C.Qc(22,17,\"addon.storagemanager.totalspaceusage\")),C.lc(3),C.qd(C.Qc(25,19,o.totalSize)),C.lc(2),C.Vc(\"disabled\",0===o.completelyDownloadedCourses.length),C.lc(1),C.Wc(\"ariaLabel\",C.Qc(28,21,\"addon.storagemanager.deletecourses\")),C.lc(2),C.Vc(\"ngForOf\",o.downloadedCourses))},directives:[b.C,b.Ab,b.m,b.h,b.i,b.yb,D.a,b.v,M.a,P.t,b.n,b.I,b.O,b.k,w.a,b.l,b.D,v.a,P.s],pipes:[O.d,I.a],styles:[\"ion-item.courses[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%], ion-item.total[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{font-weight:700}\"]}),AddonStorageManagerCoursesStoragePage})();var y=t(\"bFG1\"),A=t(\"6s78\"),z=t(\"hMzs\"),T=t(\"TKc2\"),k=t(\"uHIS\"),x=t(\"eAud\");function AddonStorageManagerCourseStoragePage_ion_item_11_Template(e,o){1&e&&(C.Ec(0,\"ion-item\",14),C.Ec(1,\"ion-label\"),C.Ec(2,\"p\"),C.pd(3),C.Pc(4,\"translate\"),C.Dc(),C.Dc(),C.Dc()),2&e&&(C.lc(3),C.qd(C.Qc(4,1,\"addon.storagemanager.courseinfo\")))}function AddonStorageManagerCourseStoragePage_ng_container_22_Template(e,o){if(1&e&&(C.Cc(0),C.pd(1),C.Pc(2,\"coreBytesToSize\"),C.Bc()),2&e){const e=C.Oc();C.lc(1),C.qd(C.Qc(2,1,e.totalSize))}}function AddonStorageManagerCourseStoragePage_ng_container_23_Template(e,o){1&e&&(C.Cc(0),C.pd(1),C.Pc(2,\"translate\"),C.Bc()),2&e&&(C.lc(1),C.qd(C.Qc(2,1,\"core.calculating\")))}function AddonStorageManagerCourseStoragePage_ion_button_24_ion_icon_1_Template(e,o){if(1&e&&C.zc(0,\"ion-icon\",18),2&e){const e=C.Oc(2);C.Vc(\"name\",e.prefetchCourseData.icon)}}function AddonStorageManagerCourseStoragePage_ion_button_24_ion_spinner_2_Template(e,o){1&e&&C.zc(0,\"ion-spinner\",0)}function AddonStorageManagerCourseStoragePage_ion_button_24_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,\"ion-button\",15),C.Mc(\"click\",(function AddonStorageManagerCourseStoragePage_ion_button_24_Template_ion_button_click_0_listener(){C.fd(e);return C.Oc().prefetchCourse()})),C.nd(1,AddonStorageManagerCourseStoragePage_ion_button_24_ion_icon_1_Template,1,1,\"ion-icon\",16),C.nd(2,AddonStorageManagerCourseStoragePage_ion_button_24_ion_spinner_2_Template,1,0,\"ion-spinner\",17),C.pd(3),C.Pc(4,\"translate\"),C.Dc()}if(2&e){const e=C.Oc();C.Vc(\"disabled\",e.prefetchCourseData.loading),C.lc(1),C.Vc(\"ngIf\",!e.prefetchCourseData.loading),C.lc(1),C.Vc(\"ngIf\",e.prefetchCourseData.loading),C.lc(1),C.rd(\" \",C.Qc(4,4,e.prefetchCourseData.statusTranslatable),\" \")}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_8_ion_icon_1_Template(e,o){1&e&&(C.zc(0,\"ion-icon\",30),C.Pc(1,\"translate\")),2&e&&C.mc(\"aria-label\",C.Qc(1,1,\"core.downloaded\"))}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_8_Template(e,o){if(1&e&&(C.Ec(0,\"ion-badge\",28),C.nd(1,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_8_ion_icon_1_Template,2,3,\"ion-icon\",29),C.pd(2),C.Pc(3,\"coreBytesToSize\"),C.Dc()),2&e){const e=C.Oc(2).$implicit,o=C.Oc();C.Vc(\"color\",e.downloadStatus==o.statusDownloaded?\"success\":\"light\"),C.lc(1),C.Vc(\"ngIf\",e.downloadStatus==o.statusDownloaded),C.lc(1),C.rd(\"\",C.Qc(3,3,e.totalSize),\" \")}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_9_Template(e,o){1&e&&(C.Ec(0,\"ion-badge\",31),C.pd(1),C.Pc(2,\"translate\"),C.Dc()),2&e&&(C.lc(1),C.rd(\" \",C.Qc(2,1,\"core.calculating\"),\" \"))}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_p_10_Template(e,o){if(1&e&&(C.Ec(0,\"p\"),C.zc(1,\"core-progress-bar\",32),C.Dc()),2&e){const e=C.Oc(2).$implicit;C.lc(1),C.Vc(\"progress\",0==e.total?-1:e.count/e.total)}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_core_download_refresh_1_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,\"core-download-refresh\",39),C.Mc(\"action\",(function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_core_download_refresh_1_Template_core_download_refresh_action_0_listener(){C.fd(e);const o=C.Oc(4).$implicit;return C.Oc().prefecthSection(o)})),C.Dc()}if(2&e){const e=C.Oc(4).$implicit;C.Vc(\"status\",e.downloadStatus)(\"enabled\",!0)(\"loading\",e.isDownloading||e.isCalculating)(\"canTrustDownload\",!0)}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_ion_badge_2_Template(e,o){if(1&e&&(C.Ec(0,\"ion-badge\",40),C.Pc(1,\"translate\"),C.pd(2),C.Dc()),2&e){const e=C.Oc(4).$implicit;C.mc(\"aria-valuemax\",e.total)(\"aria-valuenow\",e.count)(\"aria-valuetext\",C.Rc(1,5,\"core.course.downloadsectionprogressdescription\",e)),C.lc(2),C.sd(\" \",e.count,\" / \",e.total,\" \")}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_Template(e,o){if(1&e&&(C.Ec(0,\"div\",36),C.nd(1,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_core_download_refresh_1_Template,1,4,\"core-download-refresh\",37),C.nd(2,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_ion_badge_2_Template,3,8,\"ion-badge\",38),C.Dc()),2&e){const e=C.Oc(3).$implicit,o=C.Oc();C.lc(1),C.Vc(\"ngIf\",!e.isDownloading&&e.downloadStatus!=o.statusDownloaded),C.lc(1),C.Vc(\"ngIf\",e.isDownloading&&e.count<e.total)}}const course_storage_c0=function(e){return{name:e}};function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_ion_button_2_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,\"ion-button\",41),C.Mc(\"click\",(function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_ion_button_2_Template_ion_button_click_0_listener(){C.fd(e);const o=C.Oc(3).$implicit;return C.Oc().deleteForSection(o)})),C.zc(1,\"ion-icon\",42),C.Pc(2,\"translate\"),C.Dc()}if(2&e){const e=C.Oc(3).$implicit;C.lc(1),C.mc(\"aria-label\",C.Rc(2,1,\"addon.storagemanager.deletedatafrom\",C.ad(4,course_storage_c0,e.name)))}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_Template(e,o){if(1&e&&(C.Ec(0,\"div\",33),C.nd(1,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_Template,3,2,\"div\",34),C.nd(2,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_ion_button_2_Template,3,6,\"ion-button\",35),C.Dc()),2&e){const e=C.Oc(2).$implicit,o=C.Oc();C.lc(1),C.Vc(\"ngIf\",o.downloadEnabled),C.lc(1),C.Vc(\"ngIf\",!e.calculatingSize&&e.totalSize>0)}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_mod_icon_1_Template(e,o){if(1&e&&C.zc(0,\"core-mod-icon\",49),2&e){const e=C.Oc(2).$implicit;C.Vc(\"modicon\",e.handlerData.icon)(\"modname\",e.modname)(\"componentId\",e.instance)}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_5_ion_icon_1_Template(e,o){1&e&&(C.zc(0,\"ion-icon\",30),C.Pc(1,\"translate\")),2&e&&C.mc(\"aria-label\",C.Qc(1,1,\"core.downloaded\"))}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_5_Template(e,o){if(1&e&&(C.Ec(0,\"ion-badge\",28),C.nd(1,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_5_ion_icon_1_Template,2,3,\"ion-icon\",29),C.pd(2),C.Pc(3,\"coreBytesToSize\"),C.Dc()),2&e){const e=C.Oc(2).$implicit,o=C.Oc(4);C.Vc(\"color\",e.downloadStatus==o.statusDownloaded?\"success\":\"light\"),C.lc(1),C.Vc(\"ngIf\",e.downloadStatus==o.statusDownloaded),C.lc(1),C.rd(\"\",C.Qc(3,3,e.totalSize),\" \")}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_6_Template(e,o){1&e&&(C.Ec(0,\"ion-badge\",31),C.pd(1),C.Pc(2,\"translate\"),C.Dc()),2&e&&(C.lc(1),C.rd(\" \",C.Qc(2,1,\"core.calculating\"),\" \"))}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_download_refresh_8_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,\"core-download-refresh\",50),C.Mc(\"action\",(function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_download_refresh_8_Template_core_download_refresh_action_0_listener(){C.fd(e);const o=C.Oc(2).$implicit,t=C.Oc(3).$implicit;return C.Oc().prefetchModule(o,t)})),C.Dc()}if(2&e){const e=C.Oc(2).$implicit;C.Vc(\"status\",e.downloadStatus)(\"enabled\",!0)(\"canTrustDownload\",!0)(\"loading\",e.spinner||e.handlerData.spinner)}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_button_9_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,\"ion-button\",51),C.Mc(\"click\",(function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_button_9_Template_ion_button_click_0_listener(){C.fd(e);const o=C.Oc(2).$implicit,t=C.Oc(3).$implicit;return C.Oc().deleteForModule(o,t)})),C.zc(1,\"ion-icon\",42),C.Pc(2,\"translate\"),C.Dc()}if(2&e){const e=C.Oc(2).$implicit;C.lc(1),C.mc(\"aria-label\",C.Rc(2,1,\"addon.storagemanager.deletedatafrom\",C.ad(4,course_storage_c0,e.name)))}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_Template(e,o){if(1&e&&(C.Ec(0,\"ion-item\",44),C.nd(1,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_mod_icon_1_Template,1,3,\"core-mod-icon\",45),C.Ec(2,\"ion-label\",14),C.Ec(3,\"h3\"),C.zc(4,\"core-format-text\",46),C.Dc(),C.nd(5,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_5_Template,4,5,\"ion-badge\",24),C.nd(6,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_6_Template,3,3,\"ion-badge\",25),C.Dc(),C.Ec(7,\"div\",33),C.nd(8,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_download_refresh_8_Template,1,4,\"core-download-refresh\",47),C.nd(9,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_button_9_Template,3,6,\"ion-button\",48),C.Dc(),C.Dc()),2&e){const e=C.Oc().$implicit,o=C.Oc(4);C.lc(1),C.Vc(\"ngIf\",e.handlerData.icon),C.lc(2),C.oc(\"\",e.handlerData.class,\" addon-storagemanager-module-size\"),C.lc(1),C.Vc(\"text\",e.handlerData.title)(\"courseId\",e.course)(\"contextInstanceId\",e.id)(\"adaptImg\",!1),C.lc(1),C.Vc(\"ngIf\",!e.calculatingSize&&e.totalSize>0),C.lc(1),C.Vc(\"ngIf\",e.calculatingSize),C.lc(2),C.Vc(\"ngIf\",o.downloadEnabled&&(null==e.handlerData?null:e.handlerData.showDownloadButton)&&e.downloadStatus!=o.statusDownloaded),C.lc(1),C.Vc(\"ngIf\",!e.calculatingSize&&e.totalSize>0)}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_Template(e,o){if(1&e&&(C.Cc(0),C.nd(1,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_Template,10,12,\"ion-item\",43),C.Bc()),2&e){const e=o.$implicit,t=C.Oc(4);C.lc(1),C.Vc(\"ngIf\",t.downloadEnabled||!e.calculatingSize&&e.totalSize>0)}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_Template(e,o){if(1&e&&(C.Cc(0),C.nd(1,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_Template,2,1,\"ng-container\",13),C.Bc()),2&e){const e=C.Oc(2).$implicit;C.lc(1),C.Vc(\"ngForOf\",e.modules)}}function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_Template(e,o){if(1&e){const e=C.Fc();C.Ec(0,\"ion-card\",20),C.Ec(1,\"ion-card-header\"),C.Ec(2,\"ion-item\",21),C.Mc(\"click\",(function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_Template_ion_item_click_2_listener(o){C.fd(e);const t=C.Oc().$implicit;return C.Oc().toggleExpand(o,t)})),C.Pc(3,\"translate\"),C.zc(4,\"ion-icon\",22),C.Ec(5,\"ion-label\"),C.Ec(6,\"p\",7),C.zc(7,\"core-format-text\",23),C.Dc(),C.nd(8,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_8_Template,4,5,\"ion-badge\",24),C.nd(9,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_9_Template,3,3,\"ion-badge\",25),C.nd(10,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_p_10_Template,2,1,\"p\",9),C.Dc(),C.nd(11,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_Template,3,2,\"div\",26),C.Dc(),C.Dc(),C.Ec(12,\"ion-card-content\",27),C.nd(13,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_Template,2,1,\"ng-container\",9),C.Dc(),C.Dc()}if(2&e){const e=C.Oc().$implicit,o=C.Oc();C.lc(2),C.qc(\"core-course-storage-section-expanded\",e.expanded),C.Vc(\"lines\",e.expanded?\"full\":\"none\"),C.mc(\"aria-label\",C.Qc(3,17,e.expanded?\"core.collapse\":\"core.expand\"))(\"aria-expanded\",e.expanded)(\"aria-controls\",\"core-course-storage-section-\"+e.id),C.lc(2),C.qc(\"expandable-status-icon-expanded\",e.expanded),C.lc(3),C.Vc(\"text\",e.name)(\"contextInstanceId\",e.course)(\"adaptImg\",!1),C.lc(1),C.Vc(\"ngIf\",!e.calculatingSize&&e.totalSize>0),C.lc(1),C.Vc(\"ngIf\",e.calculatingSize),C.lc(1),C.Vc(\"ngIf\",o.downloadEnabled&&e.isDownloading),C.lc(1),C.Vc(\"ngIf\",!e.calculatingSize&&e.totalSize>0||o.downloadEnabled),C.lc(1),C.Xc(\"id\",\"core-course-storage-section-\",e.id,\"\"),C.lc(1),C.Vc(\"ngIf\",e.expanded)}}function AddonStorageManagerCourseStoragePage_ng_container_30_Template(e,o){if(1&e&&(C.Cc(0),C.nd(1,AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_Template,14,19,\"ion-card\",19),C.Bc()),2&e){const e=o.$implicit;C.lc(1),C.Vc(\"ngIf\",e.modules.length>0)}}let V=(()=>{class AddonStorageManagerCourseStoragePage{constructor(e,o){this.elementRef=e,this.changeDetectorRef=o,this.title=\"\",this.loaded=!1,this.sections=[],this.totalSize=0,this.calculatingSize=!0,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.prefetchCourseData={icon:r.a.ICON_LOADING,statusTranslatable:\"core.course.downloadcourse\",status:\"\",loading:!0},this.statusDownloaded=r.a.DOWNLOADED,this.isDestroyed=!1,this.isGuest=!1,this.siteUpdatedObserver=p.b.on(p.b.SITE_UPDATED,(()=>{this.downloadCourseEnabled=!l.a.isDownloadCourseDisabledInSite(),this.downloadEnabled=!h.b.getRequiredCurrentSite().isOfflineDisabled(),this.initCoursePrefetch(),this.initModulePrefetch(),this.changeDetectorRef.markForCheck()}),h.b.getCurrentSiteId())}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){try{this.courseId=u.a.getRequiredRouteParam(\"courseId\")}catch(e){return m.a.showErrorModal(e),u.a.back(),void 0}this.title=u.a.getRouteParam(\"title\")||\"\",this.title||this.courseId!=h.b.getCurrentSiteHomeId()||(this.title=S.J.instant(\"core.sitehome.sitehome\")),this.isGuest=!!u.a.getRouteBooleanParam(\"isGuest\"),this.initialSectionId=u.a.getRouteNumberParam(\"sectionId\"),this.downloadCourseEnabled=!l.a.isDownloadCourseDisabledInSite(),this.downloadEnabled=!h.b.getRequiredCurrentSite().isOfflineDisabled();const e=(yield c.a.getSections(this.courseId,!1,!0)).filter((e=>!d.a.isSectionStealth(e)));this.sections=(yield d.a.addHandlerDataForModules(e,this.courseId)).sections.map((e=>Object.assign(Object.assign({},e),{totalSize:0,calculatingSize:!0,expanded:e.id===this.initialSectionId,modules:e.modules.map((e=>Object.assign(Object.assign({},e),{calculatingSize:!0})))}))),this.loaded=!0,A.a.scrollToElement(this.elementRef.nativeElement,\".core-course-storage-section-expanded\",{addYAxis:-10}),yield Promise.all([this.initSizes(),this.initCoursePrefetch(),this.initModulePrefetch()]),this.changeDetectorRef.markForCheck()}))}initCoursePrefetch(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.downloadCourseEnabled||this.courseStatusObserver)return;if(this.courseStatusObserver=p.b.on(p.b.COURSE_STATUS_CHANGED,(e=>{e.courseId!=this.courseId&&e.courseId!=c.e.ALL_COURSES_CLEARED||this.updateCourseStatus(e.status)}),h.b.getCurrentSiteId()),yield this.determineCoursePrefetchIcon(),this.prefetchCourseData.icon!=r.a.ICON_LOADING)return;const e=d.a.getCourseDownloadPromise(this.courseId);if(e)e.catch((e=>{this.isDestroyed||m.a.showErrorModalDefault(e,\"core.course.errordownloadingcourse\",!0)}));else{const e=yield c.a.setCoursePreviousStatus(this.courseId);this.updateCourseStatus(e)}}))}initModulePrefetch(){return Object(i.a)(this,void 0,void 0,(function*(){this.downloadEnabled&&!this.sectionStatusObserver&&(this.sectionStatusObserver=p.b.on(p.b.SECTION_STATUS_CHANGED,(e=>Object(i.a)(this,void 0,void 0,(function*(){if(!this.downloadEnabled||!this.sections.length||!e.sectionId||e.courseId!=this.courseId)return;const o=d.a.getSectionDownloadId({id:e.sectionId});if(s.a.isBeingDownloaded(o))return;const t=this.sections.find((o=>o.id==e.sectionId));t&&(yield d.a.calculateSectionStatus(t,this.courseId,!1),t.isDownloading&&!s.a.isBeingDownloaded(o)&&this.prefecthSection(t))}))),h.b.getCurrentSiteId()),d.a.calculateSectionsStatus(this.sections,this.courseId,!1,!1),this.sections.forEach((e=>{e.modules.forEach((e=>{var o;(null===(o=e.handlerData)||void 0===o?void 0:o.showDownloadButton)&&(e.spinner=!0,e.prefetchHandler=s.a.getPrefetchHandlerFor(e.modname),this.calculateModuleStatus(e))}))})),this.moduleStatusObserver=p.b.on(p.b.PACKAGE_STATUS_CHANGED,(e=>{let o;if(this.sections.some((t=>(o=t.modules.find((o=>{var t;return o.id==e.componentId&&o.prefetchHandler&&e.component==(null===(t=o.prefetchHandler)||void 0===t?void 0:t.component)})),!!o))),!o)return;const t=s.a.determineModuleStatus(o,e.status);this.updateModuleStatus(o,t)}),h.b.getCurrentSiteId()))}))}initSizes(){return Object(i.a)(this,void 0,void 0,(function*(){yield Promise.all(this.sections.map((e=>Object(i.a)(this,void 0,void 0,(function*(){yield Promise.all(e.modules.map((o=>Object(i.a)(this,void 0,void 0,(function*(){const t=yield s.a.getModuleStoredSize(o,this.courseId);isNaN(t)||(o.totalSize=Number(t),e.totalSize+=t,this.totalSize+=t),o.calculatingSize=!1}))))),e.calculatingSize=!1}))))),this.calculatingSize=!1,0==this.totalSize&&this.markCourseAsNotDownloaded()}))}updateModulesSizes(e,o){return Object(i.a)(this,void 0,void 0,(function*(){this.calculatingSize=!0,yield Promise.all(e.map((e=>Object(i.a)(this,void 0,void 0,(function*(){var t;if(!e.calculatingSize){e.calculatingSize=!0,this.changeDetectorRef.markForCheck(),o||(o=this.sections.find((o=>o.modules.some((o=>o.id===e.id)))))&&(o.calculatingSize=!0);try{const n=yield s.a.getModuleStoredSize(e,this.courseId),a=(isNaN(n)?0:n)-(null!==(t=e.totalSize)&&void 0!==t?t:0);e.totalSize=Number(n),this.totalSize+=a,o&&(o.totalSize+=a)}catch(e){}finally{e.calculatingSize=!1,this.changeDetectorRef.markForCheck()}}}))))),this.calculatingSize=!1,o&&(o.calculatingSize=!1),this.changeDetectorRef.markForCheck()}))}deleteForCourse(){return Object(i.a)(this,void 0,void 0,(function*(){try{yield m.a.showDeleteConfirm(\"addon.storagemanager.confirmdeletedatafrom\",{name:this.title})}catch(e){if(!m.a.isCanceledError(e))throw e;return}const e=[];this.sections.forEach((o=>{o.modules.forEach((o=>{o.totalSize&&o.totalSize>0&&e.push(o)}))})),this.deleteModules(e)}))}deleteForSection(e){return Object(i.a)(this,void 0,void 0,(function*(){try{yield m.a.showDeleteConfirm(\"addon.storagemanager.confirmdeletedatafrom\",{name:e.name})}catch(e){if(!m.a.isCanceledError(e))throw e;return}const o=[];e.modules.forEach((e=>{e.totalSize&&e.totalSize>0&&o.push(e)})),this.deleteModules(o,e)}))}deleteForModule(e,o){return Object(i.a)(this,void 0,void 0,(function*(){if(0!==e.totalSize){try{yield m.a.showDeleteConfirm(\"addon.storagemanager.confirmdeletedatafrom\",{name:e.name})}catch(e){if(!m.a.isCanceledError(e))throw e;return}this.deleteModules([e],o)}}))}deleteModules(e,o){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield m.a.showModalLoading(\"core.deleting\",!0),n=[];e.forEach((e=>{const t=d.a.removeModuleStoredData(e,this.courseId).then((()=>{const t=e.totalSize||0;o&&(o.totalSize-=t),this.totalSize-=t,e.totalSize=0}));n.push(t)}));try{yield Promise.all(n)}catch(e){m.a.showErrorModalDefault(e,S.J.instant(\"core.errordeletefile\"))}finally{t.dismiss(),yield this.updateModulesSizes(e,o),d.a.calculateSectionsStatus(this.sections,this.courseId,!1,!1),this.changeDetectorRef.markForCheck()}}))}markCourseAsNotDownloaded(){c.a.setCourseStatus(this.courseId,r.a.NOT_DOWNLOADED)}calculateSectionsStatus(e){this.sections&&y.a.ignoreErrors(d.a.calculateSectionsStatus(this.sections,this.courseId,e))}prefecthSection(e){return Object(i.a)(this,void 0,void 0,(function*(){e.isCalculating=!0,this.changeDetectorRef.markForCheck();try{yield d.a.confirmDownloadSizeSection(this.courseId,e,this.sections);try{yield d.a.prefetchSection(e,this.courseId,this.sections)}catch(e){this.isDestroyed||m.a.showErrorModalDefault(e,\"core.course.errordownloadingsection\",!0)}finally{yield this.updateModulesSizes(e.modules,e),this.changeDetectorRef.markForCheck()}}catch(e){if(!this.isDestroyed&&e)return m.a.showErrorModal(e),this.changeDetectorRef.markForCheck(),void 0}finally{e.isCalculating=!1,this.changeDetectorRef.markForCheck()}}))}prefetchModule(e,o=!1){return Object(i.a)(this,void 0,void 0,(function*(){if(e.prefetchHandler){e.spinner=!0;try{this.changeDetectorRef.markForCheck();const t=yield e.prefetchHandler.getDownloadSize(e,e.course,!0);yield d.a.prefetchModule(e.prefetchHandler,e,t,e.course,o),d.a.calculateSectionsStatus(this.sections,this.courseId,!1,!1)}catch(e){this.isDestroyed||m.a.showErrorModalDefault(e,\"core.errordownloading\",!0)}finally{e.spinner=!1,yield this.updateModulesSizes([e]),this.changeDetectorRef.markForCheck()}}}))}updateModuleStatus(e,o){var t,n;o&&(e.spinner=!1,e.downloadStatus=o,null===(n=null===(t=e.handlerData)||void 0===t?void 0:t.updateStatus)||void 0===n||n.call(t,o),this.changeDetectorRef.markForCheck())}calculateModuleStatus(e){return Object(i.a)(this,void 0,void 0,(function*(){if(!e)return;const o=yield s.a.getModuleStatus(e,this.courseId);this.updateModuleStatus(e,o)}))}determineCoursePrefetchIcon(){return Object(i.a)(this,void 0,void 0,(function*(){this.prefetchCourseData=yield d.a.getCourseStatusIconAndTitle(this.courseId)}))}updateCourseStatus(e){const o=d.a.getCoursePrefetchStatusInfo(e);this.prefetchCourseData.status=o.status,this.prefetchCourseData.icon=o.icon,this.prefetchCourseData.statusTranslatable=o.statusTranslatable,this.prefetchCourseData.loading=o.loading}prefetchCourse(){return Object(i.a)(this,void 0,void 0,(function*(){let e=(yield l.a.getUserCourses(!0)).find((e=>e.id==this.courseId));if(e||(e=yield l.a.getCourse(this.courseId)),e)try{this.changeDetectorRef.markForCheck(),yield d.a.confirmAndPrefetchCourse(this.prefetchCourseData,e,{sections:this.sections,isGuest:this.isGuest}),this.changeDetectorRef.markForCheck()}catch(e){if(this.isDestroyed)return;m.a.showErrorModalDefault(e,\"core.course.errordownloadingcourse\",!0)}}))}toggleExpand(e,o){o.expanded=!o.expanded,e.stopPropagation(),e.preventDefault()}ngOnDestroy(){var e,o,t,n;null===(e=this.courseStatusObserver)||void 0===e?void 0:e.off(),null===(o=this.sectionStatusObserver)||void 0===o||o.off(),null===(t=this.moduleStatusObserver)||void 0===t||t.off(),null===(n=this.siteUpdatedObserver)||void 0===n||n.off(),this.sections.forEach((e=>{e.modules.forEach((e=>{var o,t;null===(t=null===(o=e.handlerData)||void 0===o?void 0:o.onDestroy)||void 0===t?void 0:t.call(o)}))})),this.isDestroyed=!0}}return AddonStorageManagerCourseStoragePage.ɵfac=function AddonStorageManagerCourseStoragePage_Factory(e){return new(e||AddonStorageManagerCourseStoragePage)(C.yc(C.r),C.yc(C.j))},AddonStorageManagerCourseStoragePage.ɵcmp=C.sc({type:AddonStorageManagerCourseStoragePage,selectors:[[\"page-addon-storagemanager-course-storage\"]],decls:31,vars:26,consts:[[\"slot\",\"start\"],[3,\"text\"],[1,\"limited-width\"],[3,\"hideUntil\"],[\"class\",\"ion-text-wrap\",4,\"ngIf\"],[1,\"wholecourse\"],[1,\"size\",\"ion-text-wrap\",\"ion-no-padding\"],[1,\"item-heading\",\"ion-text-wrap\"],[\"color\",\"light\",\"slot\",\"end\"],[4,\"ngIf\"],[\"expand\",\"block\",\"fill\",\"outline\",\"class\",\"ion-no-margin\",3,\"disabled\",\"click\",4,\"ngIf\"],[\"expand\",\"block\",\"color\",\"danger\",1,\"ion-no-margin\",\"ion-margin-top\",3,\"disabled\",\"click\"],[\"name\",\"fas-trash\",\"slot\",\"start\"],[4,\"ngFor\",\"ngForOf\"],[1,\"ion-text-wrap\"],[\"expand\",\"block\",\"fill\",\"outline\",1,\"ion-no-margin\",3,\"disabled\",\"click\"],[\"slot\",\"start\",3,\"name\",4,\"ngIf\"],[\"slot\",\"start\",4,\"ngIf\"],[\"slot\",\"start\",3,\"name\"],[\"class\",\"section\",4,\"ngIf\"],[1,\"section\"],[\"button\",\"\",\"detail\",\"false\",3,\"lines\",\"click\"],[\"name\",\"fas-chevron-right\",\"flip-rtl\",\"\",\"slot\",\"start\",1,\"expandable-status-icon\"],[\"contextLevel\",\"course\",3,\"text\",\"contextInstanceId\",\"adaptImg\"],[3,\"color\",4,\"ngIf\"],[\"color\",\"light\",4,\"ngIf\"],[\"class\",\"storage-buttons\",\"slot\",\"end\",4,\"ngIf\"],[3,\"id\"],[3,\"color\"],[\"name\",\"fam-cloud-done\",4,\"ngIf\"],[\"name\",\"fam-cloud-done\"],[\"color\",\"light\"],[3,\"progress\"],[\"slot\",\"end\",1,\"storage-buttons\"],[\"slot\",\"end\",\"class\",\"core-button-spinner\",4,\"ngIf\"],[\"color\",\"danger\",\"fill\",\"clear\",3,\"click\",4,\"ngIf\"],[\"slot\",\"end\",1,\"core-button-spinner\"],[3,\"status\",\"enabled\",\"loading\",\"canTrustDownload\",\"action\",4,\"ngIf\"],[\"class\",\"core-course-download-section-progress\",\"role\",\"progressbar\",4,\"ngIf\"],[3,\"status\",\"enabled\",\"loading\",\"canTrustDownload\",\"action\"],[\"role\",\"progressbar\",1,\"core-course-download-section-progress\"],[\"color\",\"danger\",\"fill\",\"clear\",3,\"click\"],[\"name\",\"fas-trash\",\"slot\",\"icon-only\"],[\"class\",\"core-course-storage-activity\",4,\"ngIf\"],[1,\"core-course-storage-activity\"],[\"slot\",\"start\",3,\"modicon\",\"modname\",\"componentId\",4,\"ngIf\"],[\"contextLevel\",\"module\",3,\"text\",\"courseId\",\"contextInstanceId\",\"adaptImg\"],[3,\"status\",\"enabled\",\"canTrustDownload\",\"loading\",\"action\",4,\"ngIf\"],[\"fill\",\"clear\",\"color\",\"danger\",3,\"click\",4,\"ngIf\"],[\"slot\",\"start\",3,\"modicon\",\"modname\",\"componentId\"],[3,\"status\",\"enabled\",\"canTrustDownload\",\"loading\",\"action\"],[\"fill\",\"clear\",\"color\",\"danger\",3,\"click\"]],template:function AddonStorageManagerCourseStoragePage_Template(e,o){1&e&&(C.Ec(0,\"ion-header\"),C.Ec(1,\"ion-toolbar\"),C.Ec(2,\"ion-buttons\",0),C.zc(3,\"ion-back-button\",1),C.Pc(4,\"translate\"),C.Dc(),C.Ec(5,\"ion-title\"),C.Ec(6,\"h1\"),C.pd(7),C.Pc(8,\"translate\"),C.Dc(),C.Dc(),C.Dc(),C.Dc(),C.Ec(9,\"ion-content\",2),C.Ec(10,\"core-loading\",3),C.nd(11,AddonStorageManagerCourseStoragePage_ion_item_11_Template,5,3,\"ion-item\",4),C.Ec(12,\"ion-card\",5),C.Ec(13,\"ion-card-header\"),C.Ec(14,\"ion-card-title\"),C.pd(15),C.Dc(),C.Ec(16,\"ion-item\",6),C.Ec(17,\"ion-label\"),C.Ec(18,\"p\",7),C.pd(19),C.Pc(20,\"translate\"),C.Dc(),C.Dc(),C.Ec(21,\"ion-badge\",8),C.nd(22,AddonStorageManagerCourseStoragePage_ng_container_22_Template,3,3,\"ng-container\",9),C.nd(23,AddonStorageManagerCourseStoragePage_ng_container_23_Template,3,3,\"ng-container\",9),C.Dc(),C.Dc(),C.nd(24,AddonStorageManagerCourseStoragePage_ion_button_24_Template,5,6,\"ion-button\",10),C.Ec(25,\"ion-button\",11),C.Mc(\"click\",(function AddonStorageManagerCourseStoragePage_Template_ion_button_click_25_listener(){return o.deleteForCourse()})),C.zc(26,\"ion-icon\",12),C.Pc(27,\"translate\"),C.pd(28),C.Pc(29,\"translate\"),C.Dc(),C.Dc(),C.Dc(),C.nd(30,AddonStorageManagerCourseStoragePage_ng_container_30_Template,2,1,\"ng-container\",13),C.Dc(),C.Dc()),2&e&&(C.lc(3),C.Vc(\"text\",C.Qc(4,13,\"core.back\")),C.lc(4),C.qd(C.Qc(8,15,\"addon.storagemanager.coursedownloads\")),C.lc(3),C.Vc(\"hideUntil\",o.loaded),C.lc(1),C.Vc(\"ngIf\",o.downloadCourseEnabled),C.lc(4),C.qd(o.title),C.lc(4),C.qd(C.Qc(20,17,\"addon.storagemanager.totaldownloads\")),C.lc(3),C.Vc(\"ngIf\",!o.calculatingSize),C.lc(1),C.Vc(\"ngIf\",o.calculatingSize),C.lc(1),C.Vc(\"ngIf\",o.downloadCourseEnabled),C.lc(1),C.Vc(\"disabled\",o.calculatingSize||o.totalSize<=0),C.lc(1),C.mc(\"aria-label\",C.Rc(27,19,\"addon.storagemanager.deletedatafrom\",C.ad(24,course_storage_c0,o.title))),C.lc(2),C.rd(\" \",C.Qc(29,22,\"addon.storagemanager.deleteall\"),\" \"),C.lc(2),C.Vc(\"ngForOf\",o.sections))},directives:[b.C,b.Ab,b.m,b.h,b.i,b.yb,D.a,b.v,M.a,P.t,b.n,b.p,b.r,b.I,b.O,b.k,w.a,b.l,b.D,v.a,P.s,b.qb,z.a,b.o,T.a,k.a,x.a],pipes:[O.d,I.a],styles:['[_nghost-%COMP%]{--course-storage-max-activity-height:120px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-item.size[_ngcontent-%COMP%]{--inner-padding-end:0px}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{position:relative;max-height:var(--course-storage-max-activity-height);overflow:hidden}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]     *{pointer-events:none!important}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:before{content:\"\";height:var(--course-storage-max-activity-height);position:absolute;left:0;right:0;top:0;background:linear-gradient(180deg,rgba(var(--background-gradient-rgb),0) calc(100% - 30px),rgba(var(--background-gradient-rgb),1) calc(100% - 20px));z-index:6;pointer-events:none}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{font-weight:700;font-size:1.2rem}ion-badge[_ngcontent-%COMP%]{margin-top:8px}ion-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:8px;margin-inline-end:8px}}ion-item[_ngcontent-%COMP%]   core-mod-icon[_ngcontent-%COMP%]{--size:18px;padding:9px;--margin-vertical:8px;--margin-end:8px}.storage-buttons[_ngcontent-%COMP%]{display:flex;align-items:center}'],changeDetection:0}),AddonStorageManagerCourseStoragePage})();const F=[{path:\"storage\",component:E},{path:\"storage/:courseId\",component:V}];let R=(()=>{class AddonStorageManagerLazyModule{}return AddonStorageManagerLazyModule.ɵmod=C.wc({type:AddonStorageManagerLazyModule}),AddonStorageManagerLazyModule.ɵinj=C.vc({factory:function AddonStorageManagerLazyModule_Factory(e){return new(e||AddonStorageManagerLazyModule)},imports:[[n.m.forChild(F),a.a],n.m]}),AddonStorageManagerLazyModule})();void((\"undefined\"==typeof ngJitMode||ngJitMode)&&C.kd(R,{declarations:[E,V],imports:[n.m,a.a],exports:[n.m]}))}}]);","name":"88.a3cdbc830ae1667364ab.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[88],{\n\n/***/ \"KBMx\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"AddonStorageManagerLazyModule\", function() { return /* binding */ storagemanager_lazy_module_AddonStorageManagerLazyModule; });\n\n// EXTERNAL MODULE: ./node_modules/@angular/router/__ivy_ngcc__/fesm2015/router.js + 10 modules\nvar router = __webpack_require__(\"tyNb\");\n\n// EXTERNAL MODULE: ./src/core/shared.module.ts + 3 modules\nvar shared_module = __webpack_require__(\"L3Fv\");\n\n// EXTERNAL MODULE: ./node_modules/tslib/tslib.es6.js\nvar tslib_es6 = __webpack_require__(\"mrSG\");\n\n// EXTERNAL MODULE: ./src/core/constants.ts\nvar constants = __webpack_require__(\"BaYo\");\n\n// EXTERNAL MODULE: ./src/core/features/course/services/course.ts\nvar services_course = __webpack_require__(\"ULAo\");\n\n// EXTERNAL MODULE: ./src/core/features/course/services/course-helper.ts\nvar course_helper = __webpack_require__(\"GBcW\");\n\n// EXTERNAL MODULE: ./src/core/features/course/services/module-prefetch-delegate.ts\nvar module_prefetch_delegate = __webpack_require__(\"zbKZ\");\n\n// EXTERNAL MODULE: ./src/core/features/courses/services/courses.ts\nvar services_courses = __webpack_require__(\"Xzvb\");\n\n// EXTERNAL MODULE: ./src/core/features/settings/services/settings-helper.ts\nvar settings_helper = __webpack_require__(\"1gmh\");\n\n// EXTERNAL MODULE: ./src/core/features/sitehome/services/sitehome.ts\nvar sitehome = __webpack_require__(\"SV+s\");\n\n// EXTERNAL MODULE: ./src/core/services/navigator.ts\nvar services_navigator = __webpack_require__(\"pHTc\");\n\n// EXTERNAL MODULE: ./src/core/services/sites.ts\nvar sites = __webpack_require__(\"9+EE\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/dom.ts + 2 modules\nvar dom = __webpack_require__(\"3LXp\");\n\n// EXTERNAL MODULE: ./src/core/singletons/index.ts\nvar singletons = __webpack_require__(\"j3ag\");\n\n// EXTERNAL MODULE: ./src/core/singletons/array.ts\nvar array = __webpack_require__(\"Wsfw\");\n\n// EXTERNAL MODULE: ./src/core/singletons/events.ts\nvar events = __webpack_require__(\"fjkH\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/core/__ivy_ngcc__/fesm2015/core.js\nvar core = __webpack_require__(\"fXoL\");\n\n// EXTERNAL MODULE: ./node_modules/@ionic/angular/__ivy_ngcc__/fesm2015/ionic-angular.js + 5 modules\nvar ionic_angular = __webpack_require__(\"TEn/\");\n\n// EXTERNAL MODULE: ./src/core/directives/content.ts\nvar content = __webpack_require__(\"nt/U\");\n\n// EXTERNAL MODULE: ./src/core/components/loading/loading.ts\nvar loading = __webpack_require__(\"PgjG\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/common/__ivy_ngcc__/fesm2015/common.js\nvar common = __webpack_require__(\"ofXK\");\n\n// EXTERNAL MODULE: ./src/core/directives/update-non-reactive-attributes.ts\nvar update_non_reactive_attributes = __webpack_require__(\"ACYt\");\n\n// EXTERNAL MODULE: ./src/core/directives/fa-icon.ts\nvar fa_icon = __webpack_require__(\"3CSS\");\n\n// EXTERNAL MODULE: ./node_modules/@ngx-translate/core/__ivy_ngcc__/fesm2015/ngx-translate-core.js + 8 modules\nvar ngx_translate_core = __webpack_require__(\"sYmb\");\n\n// EXTERNAL MODULE: ./src/core/pipes/bytes-to-size.ts\nvar bytes_to_size = __webpack_require__(\"1iFe\");\n\n// CONCATENATED MODULE: ./src/addons/storagemanager/pages/courses-storage/courses-storage.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonStorageManagerCoursesStoragePage_div_11_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\", 6);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"h2\");\n        core[\"pd\" /* ɵɵtext */](2);\n        core[\"Pc\" /* ɵɵpipe */](3, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](3, 1, \"addon.storagemanager.alldata\"));\n    }\n}\nfunction AddonStorageManagerCoursesStoragePage_ion_card_12_ion_badge_6_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 9);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"coreBytesToSize\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r3 = core[\"Oc\" /* ɵɵnextContext */](2);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, ctx_r3.spaceUsage.spaceUsage));\n    }\n}\nfunction AddonStorageManagerCoursesStoragePage_ion_card_12_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r5 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-card\");\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-item\", 13);\n        core[\"Ec\" /* ɵɵelementStart */](2, \"ion-label\");\n        core[\"Ec\" /* ɵɵelementStart */](3, \"p\", 14);\n        core[\"pd\" /* ɵɵtext */](4);\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](6, AddonStorageManagerCoursesStoragePage_ion_card_12_ion_badge_6_Template, 3, 3, \"ion-badge\", 15);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](7, \"ion-button\", 16);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonStorageManagerCoursesStoragePage_ion_card_12_Template_ion_button_click_7_listener($event) { core[\"fd\" /* ɵɵrestoreView */](_r5); const ctx_r4 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r4.deleteSiteStorage($event); });\n        core[\"Pc\" /* ɵɵpipe */](8, \"translate\");\n        core[\"zc\" /* ɵɵelement */](9, \"ion-icon\", 17);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r1 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](4);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](5, 4, \"addon.storagemanager.totalspaceusage\"));\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx_r1.spaceUsage.spaceUsage);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"hidden\", ctx_r1.spaceUsage.spaceUsage + ctx_r1.spaceUsage.cacheEntries <= 0);\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](8, 6, \"addon.storagemanager.deleteallsitedata\"));\n    }\n}\nfunction AddonStorageManagerCoursesStoragePage_ion_item_29_p_4_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"p\", 22);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.downloading\"), \" \");\n    }\n}\nconst _c0 = function (a0) { return { name: a0 }; };\nfunction AddonStorageManagerCoursesStoragePage_ion_item_29_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r9 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-item\", 18);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_item_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r9); const course_r6 = ctx.$implicit; const ctx_r8 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r8.openCourse(course_r6.id, course_r6.title); });\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-label\", 19);\n        core[\"Ec\" /* ɵɵelementStart */](2, \"p\", 8);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](4, AddonStorageManagerCoursesStoragePage_ion_item_29_p_4_Template, 3, 3, \"p\", 20);\n        core[\"Ec\" /* ɵɵelementStart */](5, \"ion-badge\", 9);\n        core[\"pd\" /* ɵɵtext */](6);\n        core[\"Pc\" /* ɵɵpipe */](7, \"coreBytesToSize\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](8, \"ion-button\", 10);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_button_click_8_listener($event) { core[\"fd\" /* ɵɵrestoreView */](_r9); const course_r6 = ctx.$implicit; const ctx_r10 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r10.deleteCourse($event, course_r6); });\n        core[\"zc\" /* ɵɵelement */](9, \"ion-icon\", 21);\n        core[\"Pc\" /* ɵɵpipe */](10, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const course_r6 = ctx.$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"qd\" /* ɵɵtextInterpolate */](course_r6.title);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", course_r6.isDownloading);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](7, 5, course_r6.totalSize), \" \");\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"disabled\", course_r6.isDownloading);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Rc\" /* ɵɵpipeBind2 */](10, 7, \"addon.storagemanager.deletedatafrom\", core[\"ad\" /* ɵɵpureFunction1 */](10, _c0, course_r6.title)));\n    }\n}\n/**\n * Page that displays downloaded courses and allows the user to delete them.\n */\nlet courses_storage_AddonStorageManagerCoursesStoragePage = /*@__PURE__*/ (() => {\n    class AddonStorageManagerCoursesStoragePage {\n        constructor() {\n            this.userCourses = [];\n            this.downloadedCourses = [];\n            this.completelyDownloadedCourses = [];\n            this.totalSize = 0;\n            this.loaded = false;\n            this.spaceUsage = {\n                cacheEntries: 0,\n                spaceUsage: 0,\n            };\n            this.siteId = sites[\"b\" /* CoreSites */].getCurrentSiteId();\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnInit() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                this.userCourses = yield services_courses[\"a\" /* CoreCourses */].getUserCourses();\n                this.courseStatusObserver = events[\"b\" /* CoreEvents */].on(events[\"b\" /* CoreEvents */].COURSE_STATUS_CHANGED, ({ courseId, status }) => this.onCourseUpdated(courseId, status));\n                const downloadedCourseIds = yield services_course[\"a\" /* CoreCourse */].getDownloadedCourseIds();\n                const downloadedCourses = yield Promise.all(this.userCourses\n                    .filter((course) => downloadedCourseIds.indexOf(course.id) !== -1)\n                    .map((course) => this.getDownloadedCourse(course)));\n                const siteHomeEnabled = yield sitehome[\"a\" /* CoreSiteHome */].isAvailable(this.siteId);\n                if (siteHomeEnabled) {\n                    const siteHomeId = sites[\"b\" /* CoreSites */].getCurrentSiteHomeId();\n                    const size = yield this.calculateDownloadedCourseSize(siteHomeId);\n                    if (size > 0) {\n                        const status = yield services_course[\"a\" /* CoreCourse */].getCourseStatus(siteHomeId);\n                        downloadedCourses.push({\n                            id: siteHomeId,\n                            title: singletons[\"J\" /* Translate */].instant('core.sitehome.sitehome'),\n                            totalSize: size,\n                            isDownloading: status === constants[\"a\" /* CoreConstants */].DOWNLOADING,\n                        });\n                    }\n                }\n                this.spaceUsage = yield settings_helper[\"a\" /* CoreSettingsHelper */].getSiteSpaceUsage(this.siteId);\n                this.setDownloadedCourses(downloadedCourses);\n                this.loaded = true;\n            });\n        }\n        /**\n         * Component destroyed.\n         */\n        ngOnDestroy() {\n            var _a;\n            (_a = this.courseStatusObserver) === null || _a === void 0 ? void 0 : _a.off();\n        }\n        /**\n         * Delete all courses that have been downloaded.\n         *\n         * @param event: Event Object.\n         */\n        deleteCompletelyDownloadedCourses(event) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                event.preventDefault();\n                event.stopPropagation();\n                try {\n                    yield dom[\"a\" /* CoreDomUtils */].showDeleteConfirm('addon.storagemanager.confirmdeletecourses');\n                }\n                catch (error) {\n                    if (!dom[\"a\" /* CoreDomUtils */].isCanceledError(error)) {\n                        throw error;\n                    }\n                    return;\n                }\n                const modal = yield dom[\"a\" /* CoreDomUtils */].showModalLoading('core.deleting', true);\n                const deletedCourseIds = this.completelyDownloadedCourses.map((course) => course.id);\n                try {\n                    yield Promise.all(deletedCourseIds.map((courseId) => course_helper[\"a\" /* CoreCourseHelper */].deleteCourseFiles(courseId)));\n                    this.setDownloadedCourses(this.downloadedCourses.filter((course) => !deletedCourseIds.includes(course.id)));\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, singletons[\"J\" /* Translate */].instant('core.errordeletefile'));\n                }\n                finally {\n                    modal.dismiss();\n                }\n            });\n        }\n        /**\n         * Delete course.\n         *\n         * @param event: Event Object.\n         * @param course Course to delete.\n         */\n        deleteCourse(event, course) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                event.preventDefault();\n                event.stopPropagation();\n                try {\n                    yield dom[\"a\" /* CoreDomUtils */].showDeleteConfirm('addon.storagemanager.confirmdeletedatafrom', { name: course.title });\n                }\n                catch (error) {\n                    if (!dom[\"a\" /* CoreDomUtils */].isCanceledError(error)) {\n                        throw error;\n                    }\n                    return;\n                }\n                const modal = yield dom[\"a\" /* CoreDomUtils */].showModalLoading('core.deleting', true);\n                try {\n                    yield course_helper[\"a\" /* CoreCourseHelper */].deleteCourseFiles(course.id);\n                    this.setDownloadedCourses(array[\"a\" /* CoreArray */].withoutItem(this.downloadedCourses, course));\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, singletons[\"J\" /* Translate */].instant('core.errordeletefile'));\n                }\n                finally {\n                    modal.dismiss();\n                }\n            });\n        }\n        /**\n         * Handle course updated event.\n         *\n         * @param courseId Updated course id.\n         */\n        onCourseUpdated(courseId, status) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (courseId == services_course[\"e\" /* CoreCourseProvider */].ALL_COURSES_CLEARED) {\n                    this.setDownloadedCourses([]);\n                    return;\n                }\n                const course = this.downloadedCourses.find((course) => course.id === courseId);\n                if (!course) {\n                    return;\n                }\n                course.isDownloading = status === constants[\"a\" /* CoreConstants */].DOWNLOADING;\n                course.totalSize = yield this.calculateDownloadedCourseSize(course.id);\n                this.setDownloadedCourses(this.downloadedCourses);\n            });\n        }\n        /**\n         * Set downloaded courses data.\n         *\n         * @param courses Courses info.\n         */\n        setDownloadedCourses(courses) {\n            this.downloadedCourses = courses.sort((a, b) => b.totalSize - a.totalSize);\n            this.completelyDownloadedCourses = courses.filter((course) => !course.isDownloading);\n            this.totalSize = this.downloadedCourses.reduce((totalSize, course) => totalSize + course.totalSize, 0);\n        }\n        /**\n         * Get downloaded course data.\n         *\n         * @param course Course.\n         * @return Course info.\n         */\n        getDownloadedCourse(course) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const totalSize = yield this.calculateDownloadedCourseSize(course.id);\n                const status = yield services_course[\"a\" /* CoreCourse */].getCourseStatus(course.id);\n                return {\n                    id: course.id,\n                    title: course.displayname || course.fullname,\n                    totalSize,\n                    isDownloading: status === constants[\"a\" /* CoreConstants */].DOWNLOADING,\n                };\n            });\n        }\n        /**\n         * Calculate the size of a downloaded course.\n         *\n         * @param courseId Downloaded course id.\n         * @return Promise to be resolved with the course size.\n         */\n        calculateDownloadedCourseSize(courseId) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const sections = yield services_course[\"a\" /* CoreCourse */].getSections(courseId);\n                const modules = array[\"a\" /* CoreArray */].flatten(sections.map((section) => section.modules));\n                const promisedModuleSizes = modules.map((module) => Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                    const size = yield module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].getModuleStoredSize(module, courseId);\n                    return isNaN(size) ? 0 : size;\n                }));\n                const moduleSizes = yield Promise.all(promisedModuleSizes);\n                return moduleSizes.reduce((totalSize, moduleSize) => totalSize + moduleSize, 0);\n            });\n        }\n        /**\n         * Open course storage.\n         *\n         * @param courseId Course Id.\n         */\n        openCourse(courseId, title) {\n            services_navigator[\"a\" /* CoreNavigator */].navigateToSitePath('/storage/' + courseId, { params: { title } });\n        }\n        /**\n         * Deletes files of a site and the tables that can be cleared.\n         *\n         * @param event: Event Object.\n         */\n        deleteSiteStorage(event) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                event.preventDefault();\n                event.stopPropagation();\n                try {\n                    const siteName = sites[\"b\" /* CoreSites */].getRequiredCurrentSite().getSiteName();\n                    this.spaceUsage = yield settings_helper[\"a\" /* CoreSettingsHelper */].deleteSiteStorage(siteName, this.siteId);\n                }\n                catch (_a) {\n                    // Ignore cancelled confirmation modal.\n                }\n            });\n        }\n    }\n    AddonStorageManagerCoursesStoragePage.ɵfac = function AddonStorageManagerCoursesStoragePage_Factory(t) { return new (t || AddonStorageManagerCoursesStoragePage)(); };\n    AddonStorageManagerCoursesStoragePage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonStorageManagerCoursesStoragePage, selectors: [[\"page-addon-storagemanager-courses-storage\"]], decls: 30, vars: 23, consts: [[\"slot\", \"start\"], [3, \"text\"], [1, \"limited-width\"], [3, \"hideUntil\"], [\"class\", \"ion-padding-horizontal ion-text-wrap\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"ion-padding-horizontal\", \"ion-text-wrap\"], [\"lines\", \"full\", 1, \"size\", \"courses\", \"ion-text-wrap\"], [1, \"item-heading\"], [\"color\", \"light\"], [\"slot\", \"end\", \"color\", \"danger\", \"fill\", \"clear\", 3, \"disabled\", \"click\"], [\"name\", \"fas-trash\", \"slot\", \"icon-only\", 3, \"ariaLabel\"], [\"class\", \"course\", \"button\", \"\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"ion-text-wrap\", \"total\"], [1, \"item-heading\", \"ion-text-wrap\"], [\"color\", \"light\", 4, \"ngIf\"], [\"fill\", \"clear\", \"color\", \"danger\", \"slot\", \"end\", 3, \"hidden\", \"click\"], [\"name\", \"fas-trash\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [\"button\", \"\", 1, \"course\", 3, \"click\"], [1, \"ion-text-wrap\"], [\"class\", \"item-heading item-heading-secondary\", 4, \"ngIf\"], [\"name\", \"fas-trash\", \"slot\", \"icon-only\"], [1, \"item-heading\", \"item-heading-secondary\"]], template: function AddonStorageManagerCoursesStoragePage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"pd\" /* ɵɵtext */](7);\n                core[\"Pc\" /* ɵɵpipe */](8, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-content\", 2);\n                core[\"Ec\" /* ɵɵelementStart */](10, \"core-loading\", 3);\n                core[\"nd\" /* ɵɵtemplate */](11, AddonStorageManagerCoursesStoragePage_div_11_Template, 4, 3, \"div\", 4);\n                core[\"nd\" /* ɵɵtemplate */](12, AddonStorageManagerCoursesStoragePage_ion_card_12_Template, 10, 8, \"ion-card\", 5);\n                core[\"Ec\" /* ɵɵelementStart */](13, \"div\", 6);\n                core[\"Ec\" /* ɵɵelementStart */](14, \"h2\");\n                core[\"pd\" /* ɵɵtext */](15);\n                core[\"Pc\" /* ɵɵpipe */](16, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](17, \"ion-card\");\n                core[\"Ec\" /* ɵɵelementStart */](18, \"ion-item\", 7);\n                core[\"Ec\" /* ɵɵelementStart */](19, \"ion-label\");\n                core[\"Ec\" /* ɵɵelementStart */](20, \"p\", 8);\n                core[\"pd\" /* ɵɵtext */](21);\n                core[\"Pc\" /* ɵɵpipe */](22, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](23, \"ion-badge\", 9);\n                core[\"pd\" /* ɵɵtext */](24);\n                core[\"Pc\" /* ɵɵpipe */](25, \"coreBytesToSize\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](26, \"ion-button\", 10);\n                core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonStorageManagerCoursesStoragePage_Template_ion_button_click_26_listener($event) { return ctx.deleteCompletelyDownloadedCourses($event); });\n                core[\"zc\" /* ɵɵelement */](27, \"ion-icon\", 11);\n                core[\"Pc\" /* ɵɵpipe */](28, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"nd\" /* ɵɵtemplate */](29, AddonStorageManagerCoursesStoragePage_ion_item_29_Template, 11, 12, \"ion-item\", 12);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 11, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](8, 13, \"addon.storagemanager.managedownloads\"));\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.spaceUsage);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.spaceUsage);\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](16, 15, \"addon.storagemanager.downloadedcourses\"));\n                core[\"lc\" /* ɵɵadvance */](6);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](22, 17, \"addon.storagemanager.totalspaceusage\"));\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](25, 19, ctx.totalSize));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", ctx.completelyDownloadedCourses.length === 0);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Wc\" /* ɵɵpropertyInterpolate */](\"ariaLabel\", core[\"Qc\" /* ɵɵpipeBind1 */](28, 21, \"addon.storagemanager.deletecourses\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx.downloadedCourses);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], loading[\"a\" /* CoreLoadingComponent */], common[\"t\" /* NgIf */], ionic_angular[\"n\" /* IonCard */], ionic_angular[\"I\" /* IonItem */], ionic_angular[\"O\" /* IonLabel */], ionic_angular[\"k\" /* IonBadge */], update_non_reactive_attributes[\"a\" /* CoreUpdateNonReactiveAttributesDirective */], ionic_angular[\"l\" /* IonButton */], ionic_angular[\"D\" /* IonIcon */], fa_icon[\"a\" /* CoreFaIconDirective */], common[\"s\" /* NgForOf */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */], bytes_to_size[\"a\" /* CoreBytesToSizePipe */]], styles: [\"ion-item.courses[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%], ion-item.total[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{font-weight:700}\"] });\n    return AddonStorageManagerCoursesStoragePage;\n})();\n\n// EXTERNAL MODULE: ./src/core/services/utils/utils.ts\nvar utils = __webpack_require__(\"bFG1\");\n\n// EXTERNAL MODULE: ./src/core/singletons/dom.ts + 1 modules\nvar singletons_dom = __webpack_require__(\"6s78\");\n\n// EXTERNAL MODULE: ./src/core/directives/format-text.ts\nvar format_text = __webpack_require__(\"hMzs\");\n\n// EXTERNAL MODULE: ./src/core/components/progress-bar/progress-bar.ts\nvar progress_bar = __webpack_require__(\"TKc2\");\n\n// EXTERNAL MODULE: ./src/core/components/download-refresh/download-refresh.ts\nvar download_refresh = __webpack_require__(\"uHIS\");\n\n// EXTERNAL MODULE: ./src/core/components/mod-icon/mod-icon.ts\nvar mod_icon = __webpack_require__(\"eAud\");\n\n// CONCATENATED MODULE: ./src/addons/storagemanager/pages/course-storage/course-storage.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonStorageManagerCourseStoragePage_ion_item_11_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-item\", 14);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-label\");\n        core[\"Ec\" /* ɵɵelementStart */](2, \"p\");\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](4, 1, \"addon.storagemanager.courseinfo\"));\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_22_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"coreBytesToSize\");\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r1 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, ctx_r1.totalSize));\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_23_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.calculating\"));\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ion_button_24_ion_icon_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"ion-icon\", 18);\n    }\n    if (rf & 2) {\n        const ctx_r5 = core[\"Oc\" /* ɵɵnextContext */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"name\", ctx_r5.prefetchCourseData.icon);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ion_button_24_ion_spinner_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"ion-spinner\", 0);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ion_button_24_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r8 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 15);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonStorageManagerCourseStoragePage_ion_button_24_Template_ion_button_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r8); const ctx_r7 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r7.prefetchCourse(); });\n        core[\"nd\" /* ɵɵtemplate */](1, AddonStorageManagerCourseStoragePage_ion_button_24_ion_icon_1_Template, 1, 1, \"ion-icon\", 16);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonStorageManagerCourseStoragePage_ion_button_24_ion_spinner_2_Template, 1, 0, \"ion-spinner\", 17);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r3 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"Vc\" /* ɵɵproperty */](\"disabled\", ctx_r3.prefetchCourseData.loading);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !ctx_r3.prefetchCourseData.loading);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx_r3.prefetchCourseData.loading);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](4, 4, ctx_r3.prefetchCourseData.statusTranslatable), \" \");\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_8_ion_icon_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"ion-icon\", 30);\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n    }\n    if (rf & 2) {\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"core.downloaded\"));\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_8_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 28);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_8_ion_icon_1_Template, 2, 3, \"ion-icon\", 29);\n        core[\"pd\" /* ɵɵtext */](2);\n        core[\"Pc\" /* ɵɵpipe */](3, \"coreBytesToSize\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        const ctx_r11 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"Vc\" /* ɵɵproperty */](\"color\", section_r9.downloadStatus == ctx_r11.statusDownloaded ? \"success\" : \"light\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", section_r9.downloadStatus == ctx_r11.statusDownloaded);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\"\", core[\"Qc\" /* ɵɵpipeBind1 */](3, 3, section_r9.totalSize), \" \");\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_9_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 31);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.calculating\"), \" \");\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_p_10_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"p\");\n        core[\"zc\" /* ɵɵelement */](1, \"core-progress-bar\", 32);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"progress\", section_r9.total == 0 ? 0 - 1 : section_r9.count / section_r9.total);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_core_download_refresh_1_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r25 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"core-download-refresh\", 39);\n        core[\"Mc\" /* ɵɵlistener */](\"action\", function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_core_download_refresh_1_Template_core_download_refresh_action_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r25); const section_r9 = core[\"Oc\" /* ɵɵnextContext */](4).$implicit; const ctx_r23 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r23.prefecthSection(section_r9); });\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = core[\"Oc\" /* ɵɵnextContext */](4).$implicit;\n        core[\"Vc\" /* ɵɵproperty */](\"status\", section_r9.downloadStatus)(\"enabled\", true)(\"loading\", section_r9.isDownloading || section_r9.isCalculating)(\"canTrustDownload\", true);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_ion_badge_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 40);\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n        core[\"pd\" /* ɵɵtext */](2);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = core[\"Oc\" /* ɵɵnextContext */](4).$implicit;\n        core[\"mc\" /* ɵɵattribute */](\"aria-valuemax\", section_r9.total)(\"aria-valuenow\", section_r9.count)(\"aria-valuetext\", core[\"Rc\" /* ɵɵpipeBind2 */](1, 5, \"core.course.downloadsectionprogressdescription\", section_r9));\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", section_r9.count, \" / \", section_r9.total, \" \");\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\", 36);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_core_download_refresh_1_Template, 1, 4, \"core-download-refresh\", 37);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_ion_badge_2_Template, 3, 8, \"ion-badge\", 38);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = core[\"Oc\" /* ɵɵnextContext */](3).$implicit;\n        const ctx_r19 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !section_r9.isDownloading && section_r9.downloadStatus != ctx_r19.statusDownloaded);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", section_r9.isDownloading && section_r9.count < section_r9.total);\n    }\n}\nconst course_storage_c0 = function (a0) { return { name: a0 }; };\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_ion_button_2_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r31 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 41);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_ion_button_2_Template_ion_button_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r31); const section_r9 = core[\"Oc\" /* ɵɵnextContext */](3).$implicit; const ctx_r29 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r29.deleteForSection(section_r9); });\n        core[\"zc\" /* ɵɵelement */](1, \"ion-icon\", 42);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = core[\"Oc\" /* ɵɵnextContext */](3).$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Rc\" /* ɵɵpipeBind2 */](2, 1, \"addon.storagemanager.deletedatafrom\", core[\"ad\" /* ɵɵpureFunction1 */](4, course_storage_c0, section_r9.name)));\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\", 33);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_div_1_Template, 3, 2, \"div\", 34);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_ion_button_2_Template, 3, 6, \"ion-button\", 35);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        const ctx_r14 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx_r14.downloadEnabled);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !section_r9.calculatingSize && section_r9.totalSize > 0);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_mod_icon_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-mod-icon\", 49);\n    }\n    if (rf & 2) {\n        const module_r35 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"Vc\" /* ɵɵproperty */](\"modicon\", module_r35.handlerData.icon)(\"modname\", module_r35.modname)(\"componentId\", module_r35.instance);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_5_ion_icon_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"ion-icon\", 30);\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n    }\n    if (rf & 2) {\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"core.downloaded\"));\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_5_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 28);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_5_ion_icon_1_Template, 2, 3, \"ion-icon\", 29);\n        core[\"pd\" /* ɵɵtext */](2);\n        core[\"Pc\" /* ɵɵpipe */](3, \"coreBytesToSize\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const module_r35 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        const ctx_r38 = core[\"Oc\" /* ɵɵnextContext */](4);\n        core[\"Vc\" /* ɵɵproperty */](\"color\", module_r35.downloadStatus == ctx_r38.statusDownloaded ? \"success\" : \"light\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", module_r35.downloadStatus == ctx_r38.statusDownloaded);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\"\", core[\"Qc\" /* ɵɵpipeBind1 */](3, 3, module_r35.totalSize), \" \");\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_6_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 31);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.calculating\"), \" \");\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_download_refresh_8_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r47 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"core-download-refresh\", 50);\n        core[\"Mc\" /* ɵɵlistener */](\"action\", function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_download_refresh_8_Template_core_download_refresh_action_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r47); const module_r35 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit; const section_r9 = core[\"Oc\" /* ɵɵnextContext */](3).$implicit; const ctx_r45 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r45.prefetchModule(module_r35, section_r9); });\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const module_r35 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"Vc\" /* ɵɵproperty */](\"status\", module_r35.downloadStatus)(\"enabled\", true)(\"canTrustDownload\", true)(\"loading\", module_r35.spinner || module_r35.handlerData.spinner);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_button_9_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r52 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 51);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_button_9_Template_ion_button_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r52); const module_r35 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit; const section_r9 = core[\"Oc\" /* ɵɵnextContext */](3).$implicit; const ctx_r50 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r50.deleteForModule(module_r35, section_r9); });\n        core[\"zc\" /* ɵɵelement */](1, \"ion-icon\", 42);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const module_r35 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Rc\" /* ɵɵpipeBind2 */](2, 1, \"addon.storagemanager.deletedatafrom\", core[\"ad\" /* ɵɵpureFunction1 */](4, course_storage_c0, module_r35.name)));\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-item\", 44);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_mod_icon_1_Template, 1, 3, \"core-mod-icon\", 45);\n        core[\"Ec\" /* ɵɵelementStart */](2, \"ion-label\", 14);\n        core[\"Ec\" /* ɵɵelementStart */](3, \"h3\");\n        core[\"zc\" /* ɵɵelement */](4, \"core-format-text\", 46);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](5, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_5_Template, 4, 5, \"ion-badge\", 24);\n        core[\"nd\" /* ɵɵtemplate */](6, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_badge_6_Template, 3, 3, \"ion-badge\", 25);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](7, \"div\", 33);\n        core[\"nd\" /* ɵɵtemplate */](8, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_core_download_refresh_8_Template, 1, 4, \"core-download-refresh\", 47);\n        core[\"nd\" /* ɵɵtemplate */](9, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_ion_button_9_Template, 3, 6, \"ion-button\", 48);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const module_r35 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r36 = core[\"Oc\" /* ɵɵnextContext */](4);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", module_r35.handlerData.icon);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"oc\" /* ɵɵclassMapInterpolate1 */](\"\", module_r35.handlerData.class, \" addon-storagemanager-module-size\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"text\", module_r35.handlerData.title)(\"courseId\", module_r35.course)(\"contextInstanceId\", module_r35.id)(\"adaptImg\", false);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !module_r35.calculatingSize && module_r35.totalSize > 0);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", module_r35.calculatingSize);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx_r36.downloadEnabled && (module_r35.handlerData == null ? null : module_r35.handlerData.showDownloadButton) && module_r35.downloadStatus != ctx_r36.statusDownloaded);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !module_r35.calculatingSize && module_r35.totalSize > 0);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_ion_item_1_Template, 10, 12, \"ion-item\", 43);\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const module_r35 = ctx.$implicit;\n        const ctx_r34 = core[\"Oc\" /* ɵɵnextContext */](4);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx_r34.downloadEnabled || !module_r35.calculatingSize && module_r35.totalSize > 0);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_ng_container_1_Template, 2, 1, \"ng-container\", 13);\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", section_r9.modules);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r58 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-card\", 20);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-card-header\");\n        core[\"Ec\" /* ɵɵelementStart */](2, \"ion-item\", 21);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_Template_ion_item_click_2_listener($event) { core[\"fd\" /* ɵɵrestoreView */](_r58); const section_r9 = core[\"Oc\" /* ɵɵnextContext */]().$implicit; const ctx_r57 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r57.toggleExpand($event, section_r9); });\n        core[\"Pc\" /* ɵɵpipe */](3, \"translate\");\n        core[\"zc\" /* ɵɵelement */](4, \"ion-icon\", 22);\n        core[\"Ec\" /* ɵɵelementStart */](5, \"ion-label\");\n        core[\"Ec\" /* ɵɵelementStart */](6, \"p\", 7);\n        core[\"zc\" /* ɵɵelement */](7, \"core-format-text\", 23);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](8, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_8_Template, 4, 5, \"ion-badge\", 24);\n        core[\"nd\" /* ɵɵtemplate */](9, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ion_badge_9_Template, 3, 3, \"ion-badge\", 25);\n        core[\"nd\" /* ɵɵtemplate */](10, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_p_10_Template, 2, 1, \"p\", 9);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](11, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_div_11_Template, 3, 2, \"div\", 26);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](12, \"ion-card-content\", 27);\n        core[\"nd\" /* ɵɵtemplate */](13, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_ng_container_13_Template, 2, 1, \"ng-container\", 9);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r10 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"qc\" /* ɵɵclassProp */](\"core-course-storage-section-expanded\", section_r9.expanded);\n        core[\"Vc\" /* ɵɵproperty */](\"lines\", section_r9.expanded ? \"full\" : \"none\");\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](3, 17, section_r9.expanded ? \"core.collapse\" : \"core.expand\"))(\"aria-expanded\", section_r9.expanded)(\"aria-controls\", \"core-course-storage-section-\" + section_r9.id);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"qc\" /* ɵɵclassProp */](\"expandable-status-icon-expanded\", section_r9.expanded);\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"Vc\" /* ɵɵproperty */](\"text\", section_r9.name)(\"contextInstanceId\", section_r9.course)(\"adaptImg\", false);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !section_r9.calculatingSize && section_r9.totalSize > 0);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", section_r9.calculatingSize);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx_r10.downloadEnabled && section_r9.isDownloading);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !section_r9.calculatingSize && section_r9.totalSize > 0 || ctx_r10.downloadEnabled);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Xc\" /* ɵɵpropertyInterpolate1 */](\"id\", \"core-course-storage-section-\", section_r9.id, \"\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", section_r9.expanded);\n    }\n}\nfunction AddonStorageManagerCourseStoragePage_ng_container_30_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonStorageManagerCourseStoragePage_ng_container_30_ion_card_1_Template, 14, 19, \"ion-card\", 19);\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const section_r9 = ctx.$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", section_r9.modules.length > 0);\n    }\n}\n/**\n * Page that displays the amount of file storage used by each activity on the course, and allows\n * the user to prefecth and delete this data.\n */\nlet course_storage_AddonStorageManagerCourseStoragePage = /*@__PURE__*/ (() => {\n    class AddonStorageManagerCourseStoragePage {\n        constructor(elementRef, changeDetectorRef) {\n            this.elementRef = elementRef;\n            this.changeDetectorRef = changeDetectorRef;\n            this.title = '';\n            this.loaded = false;\n            this.sections = [];\n            this.totalSize = 0;\n            this.calculatingSize = true;\n            this.downloadEnabled = false;\n            this.downloadCourseEnabled = false;\n            this.prefetchCourseData = {\n                icon: constants[\"a\" /* CoreConstants */].ICON_LOADING,\n                statusTranslatable: 'core.course.downloadcourse',\n                status: '',\n                loading: true,\n            };\n            this.statusDownloaded = constants[\"a\" /* CoreConstants */].DOWNLOADED;\n            this.isDestroyed = false;\n            this.isGuest = false;\n            // Refresh the enabled flags if site is updated.\n            this.siteUpdatedObserver = events[\"b\" /* CoreEvents */].on(events[\"b\" /* CoreEvents */].SITE_UPDATED, () => {\n                this.downloadCourseEnabled = !services_courses[\"a\" /* CoreCourses */].isDownloadCourseDisabledInSite();\n                this.downloadEnabled = !sites[\"b\" /* CoreSites */].getRequiredCurrentSite().isOfflineDisabled();\n                this.initCoursePrefetch();\n                this.initModulePrefetch();\n                this.changeDetectorRef.markForCheck();\n            }, sites[\"b\" /* CoreSites */].getCurrentSiteId());\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnInit() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    this.courseId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteParam('courseId');\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModal(error);\n                    services_navigator[\"a\" /* CoreNavigator */].back();\n                    return;\n                }\n                this.title = services_navigator[\"a\" /* CoreNavigator */].getRouteParam('title') || '';\n                if (!this.title && this.courseId == sites[\"b\" /* CoreSites */].getCurrentSiteHomeId()) {\n                    this.title = singletons[\"J\" /* Translate */].instant('core.sitehome.sitehome');\n                }\n                this.isGuest = !!services_navigator[\"a\" /* CoreNavigator */].getRouteBooleanParam('isGuest');\n                this.initialSectionId = services_navigator[\"a\" /* CoreNavigator */].getRouteNumberParam('sectionId');\n                this.downloadCourseEnabled = !services_courses[\"a\" /* CoreCourses */].isDownloadCourseDisabledInSite();\n                this.downloadEnabled = !sites[\"b\" /* CoreSites */].getRequiredCurrentSite().isOfflineDisabled();\n                const sections = (yield services_course[\"a\" /* CoreCourse */].getSections(this.courseId, false, true))\n                    .filter((section) => !course_helper[\"a\" /* CoreCourseHelper */].isSectionStealth(section));\n                this.sections = (yield course_helper[\"a\" /* CoreCourseHelper */].addHandlerDataForModules(sections, this.courseId)).sections\n                    .map(section => (Object.assign(Object.assign({}, section), { totalSize: 0, calculatingSize: true, expanded: section.id === this.initialSectionId, modules: section.modules.map(module => (Object.assign(Object.assign({}, module), { calculatingSize: true }))) })));\n                this.loaded = true;\n                singletons_dom[\"a\" /* CoreDom */].scrollToElement(this.elementRef.nativeElement, '.core-course-storage-section-expanded', { addYAxis: -10 });\n                yield Promise.all([\n                    this.initSizes(),\n                    this.initCoursePrefetch(),\n                    this.initModulePrefetch(),\n                ]);\n                this.changeDetectorRef.markForCheck();\n            });\n        }\n        /**\n         * Init course prefetch information.\n         *\n         * @return Promise resolved when done.\n         */\n        initCoursePrefetch() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.downloadCourseEnabled || this.courseStatusObserver) {\n                    return;\n                }\n                // Listen for changes in course status.\n                this.courseStatusObserver = events[\"b\" /* CoreEvents */].on(events[\"b\" /* CoreEvents */].COURSE_STATUS_CHANGED, (data) => {\n                    if (data.courseId == this.courseId || data.courseId == services_course[\"e\" /* CoreCourseProvider */].ALL_COURSES_CLEARED) {\n                        this.updateCourseStatus(data.status);\n                    }\n                }, sites[\"b\" /* CoreSites */].getCurrentSiteId());\n                // Determine the course prefetch status.\n                yield this.determineCoursePrefetchIcon();\n                if (this.prefetchCourseData.icon != constants[\"a\" /* CoreConstants */].ICON_LOADING) {\n                    return;\n                }\n                // Course is being downloaded. Get the download promise.\n                const promise = course_helper[\"a\" /* CoreCourseHelper */].getCourseDownloadPromise(this.courseId);\n                if (promise) {\n                    // There is a download promise. Show an error if it fails.\n                    promise.catch((error) => {\n                        if (!this.isDestroyed) {\n                            dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.course.errordownloadingcourse', true);\n                        }\n                    });\n                }\n                else {\n                    // No download, this probably means that the app was closed while downloading. Set previous status.\n                    const status = yield services_course[\"a\" /* CoreCourse */].setCoursePreviousStatus(this.courseId);\n                    this.updateCourseStatus(status);\n                }\n            });\n        }\n        /**\n         * Init module prefetch information.\n         *\n         * @return Promise resolved when done.\n         */\n        initModulePrefetch() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.downloadEnabled || this.sectionStatusObserver) {\n                    return;\n                }\n                // Listen for section status changes.\n                this.sectionStatusObserver = events[\"b\" /* CoreEvents */].on(events[\"b\" /* CoreEvents */].SECTION_STATUS_CHANGED, (data) => Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                    if (!this.downloadEnabled || !this.sections.length || !data.sectionId || data.courseId != this.courseId) {\n                        return;\n                    }\n                    // Check if the affected section is being downloaded.\n                    // If so, we don't update section status because it'll already be updated when the download finishes.\n                    const downloadId = course_helper[\"a\" /* CoreCourseHelper */].getSectionDownloadId({ id: data.sectionId });\n                    if (module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].isBeingDownloaded(downloadId)) {\n                        return;\n                    }\n                    // Get the affected section.\n                    const section = this.sections.find(section => section.id == data.sectionId);\n                    if (!section) {\n                        return;\n                    }\n                    // Recalculate the status.\n                    yield course_helper[\"a\" /* CoreCourseHelper */].calculateSectionStatus(section, this.courseId, false);\n                    if (section.isDownloading && !module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].isBeingDownloaded(downloadId)) {\n                        // All the modules are now downloading, set a download all promise.\n                        this.prefecthSection(section);\n                    }\n                }), sites[\"b\" /* CoreSites */].getCurrentSiteId());\n                // The download status of a section might have been changed from within a module page.\n                course_helper[\"a\" /* CoreCourseHelper */].calculateSectionsStatus(this.sections, this.courseId, false, false);\n                this.sections.forEach((section) => {\n                    section.modules.forEach((module) => {\n                        var _a;\n                        if ((_a = module.handlerData) === null || _a === void 0 ? void 0 : _a.showDownloadButton) {\n                            module.spinner = true;\n                            // Listen for changes on this module status, even if download isn't enabled.\n                            module.prefetchHandler = module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].getPrefetchHandlerFor(module.modname);\n                            this.calculateModuleStatus(module);\n                        }\n                    });\n                });\n                this.moduleStatusObserver = events[\"b\" /* CoreEvents */].on(events[\"b\" /* CoreEvents */].PACKAGE_STATUS_CHANGED, (data) => {\n                    let module;\n                    this.sections.some((section) => {\n                        module = section.modules.find((module) => { var _a; return module.id == data.componentId && module.prefetchHandler && data.component == ((_a = module.prefetchHandler) === null || _a === void 0 ? void 0 : _a.component); });\n                        return !!module;\n                    });\n                    if (!module) {\n                        return;\n                    }\n                    // Call determineModuleStatus to get the right status to display.\n                    const status = module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].determineModuleStatus(module, data.status);\n                    // Update the status.\n                    this.updateModuleStatus(module, status);\n                }, sites[\"b\" /* CoreSites */].getCurrentSiteId());\n            });\n        }\n        /**\n         * Init section, course and modules sizes.\n         */\n        initSizes() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                yield Promise.all(this.sections.map((section) => Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                    yield Promise.all(section.modules.map((module) => Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                        // Note: This function only gets the size for modules which are downloadable.\n                        // For other modules it always returns 0, even if they have downloaded some files.\n                        // However there is no 100% reliable way to actually track the files in this case.\n                        // You can maybe guess it based on the component and componentid.\n                        // But these aren't necessarily consistent, for example mod_frog vs mmaModFrog.\n                        // There is nothing enforcing correct values.\n                        // Most modules which have large files are downloadable, so I think this is sufficient.\n                        const size = yield module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].getModuleStoredSize(module, this.courseId);\n                        // There are some cases where the return from this is not a valid number.\n                        if (!isNaN(size)) {\n                            module.totalSize = Number(size);\n                            section.totalSize += size;\n                            this.totalSize += size;\n                        }\n                        module.calculatingSize = false;\n                    })));\n                    section.calculatingSize = false;\n                })));\n                this.calculatingSize = false;\n                // Mark course as not downloaded if course size is 0.\n                if (this.totalSize == 0) {\n                    this.markCourseAsNotDownloaded();\n                }\n            });\n        }\n        /**\n         * Update the sizes of some modules.\n         *\n         * @param modules Modules.\n         * @param section Section the modules belong to.\n         * @return Promise resolved when done.\n         */\n        updateModulesSizes(modules, section) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                this.calculatingSize = true;\n                yield Promise.all(modules.map((module) => Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                    var _a;\n                    if (module.calculatingSize) {\n                        return;\n                    }\n                    module.calculatingSize = true;\n                    this.changeDetectorRef.markForCheck();\n                    if (!section) {\n                        section = this.sections.find((section) => section.modules.some((mod) => mod.id === module.id));\n                        if (section) {\n                            section.calculatingSize = true;\n                        }\n                    }\n                    try {\n                        const size = yield module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].getModuleStoredSize(module, this.courseId);\n                        const diff = (isNaN(size) ? 0 : size) - ((_a = module.totalSize) !== null && _a !== void 0 ? _a : 0);\n                        module.totalSize = Number(size);\n                        this.totalSize += diff;\n                        if (section) {\n                            section.totalSize += diff;\n                        }\n                    }\n                    catch (_b) {\n                        // Ignore errors, it shouldn't happen.\n                    }\n                    finally {\n                        module.calculatingSize = false;\n                        this.changeDetectorRef.markForCheck();\n                    }\n                })));\n                this.calculatingSize = false;\n                if (section) {\n                    section.calculatingSize = false;\n                }\n                this.changeDetectorRef.markForCheck();\n            });\n        }\n        /**\n         * The user has requested a delete for the whole course data.\n         *\n         * (This works by deleting data for each module on the course that has data.)\n         */\n        deleteForCourse() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    yield dom[\"a\" /* CoreDomUtils */].showDeleteConfirm('addon.storagemanager.confirmdeletedatafrom', { name: this.title });\n                }\n                catch (error) {\n                    if (!dom[\"a\" /* CoreDomUtils */].isCanceledError(error)) {\n                        throw error;\n                    }\n                    return;\n                }\n                const modules = [];\n                this.sections.forEach((section) => {\n                    section.modules.forEach((module) => {\n                        if (module.totalSize && module.totalSize > 0) {\n                            modules.push(module);\n                        }\n                    });\n                });\n                this.deleteModules(modules);\n            });\n        }\n        /**\n         * The user has requested a delete for a section's data.\n         *\n         * (This works by deleting data for each module in the section that has data.)\n         *\n         * @param section Section object with information about section and modules\n         */\n        deleteForSection(section) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    yield dom[\"a\" /* CoreDomUtils */].showDeleteConfirm('addon.storagemanager.confirmdeletedatafrom', { name: section.name });\n                }\n                catch (error) {\n                    if (!dom[\"a\" /* CoreDomUtils */].isCanceledError(error)) {\n                        throw error;\n                    }\n                    return;\n                }\n                const modules = [];\n                section.modules.forEach((module) => {\n                    if (module.totalSize && module.totalSize > 0) {\n                        modules.push(module);\n                    }\n                });\n                this.deleteModules(modules, section);\n            });\n        }\n        /**\n         * The user has requested a delete for a module's data\n         *\n         * @param module Module details\n         * @param section Section the module belongs to.\n         */\n        deleteForModule(module, section) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (module.totalSize === 0) {\n                    return;\n                }\n                try {\n                    yield dom[\"a\" /* CoreDomUtils */].showDeleteConfirm('addon.storagemanager.confirmdeletedatafrom', { name: module.name });\n                }\n                catch (error) {\n                    if (!dom[\"a\" /* CoreDomUtils */].isCanceledError(error)) {\n                        throw error;\n                    }\n                    return;\n                }\n                this.deleteModules([module], section);\n            });\n        }\n        /**\n         * Deletes the specified modules, showing the loading overlay while it happens.\n         *\n         * @param modules Modules to delete\n         * @param section Section the modules belong to.\n         * @return Promise<void> Once deleting has finished\n         */\n        deleteModules(modules, section) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const modal = yield dom[\"a\" /* CoreDomUtils */].showModalLoading('core.deleting', true);\n                const promises = [];\n                modules.forEach((module) => {\n                    // Remove the files.\n                    const promise = course_helper[\"a\" /* CoreCourseHelper */].removeModuleStoredData(module, this.courseId).then(() => {\n                        const moduleSize = module.totalSize || 0;\n                        // When the files and cache are removed, update the size.\n                        if (section) {\n                            section.totalSize -= moduleSize;\n                        }\n                        this.totalSize -= moduleSize;\n                        module.totalSize = 0;\n                        return;\n                    });\n                    promises.push(promise);\n                });\n                try {\n                    yield Promise.all(promises);\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, singletons[\"J\" /* Translate */].instant('core.errordeletefile'));\n                }\n                finally {\n                    modal.dismiss();\n                    yield this.updateModulesSizes(modules, section);\n                    course_helper[\"a\" /* CoreCourseHelper */].calculateSectionsStatus(this.sections, this.courseId, false, false);\n                    this.changeDetectorRef.markForCheck();\n                }\n            });\n        }\n        /**\n         * Mark course as not downloaded.\n         */\n        markCourseAsNotDownloaded() {\n            // @TODO In order to correctly check the status of the course we should check all module statuses.\n            // We are currently marking as not downloaded if size is 0 but we should take into account that\n            // resources without files can be downloaded and cached.\n            services_course[\"a\" /* CoreCourse */].setCourseStatus(this.courseId, constants[\"a\" /* CoreConstants */].NOT_DOWNLOADED);\n        }\n        /**\n         * Calculate the status of sections.\n         *\n         * @param refresh If refresh or not.\n         */\n        calculateSectionsStatus(refresh) {\n            if (!this.sections) {\n                return;\n            }\n            utils[\"a\" /* CoreUtils */].ignoreErrors(course_helper[\"a\" /* CoreCourseHelper */].calculateSectionsStatus(this.sections, this.courseId, refresh));\n        }\n        /**\n         * Confirm and prefetch a section. If the section is \"all sections\", prefetch all the sections.\n         *\n         * @param section Section to download.\n         */\n        prefecthSection(section) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                section.isCalculating = true;\n                this.changeDetectorRef.markForCheck();\n                try {\n                    yield course_helper[\"a\" /* CoreCourseHelper */].confirmDownloadSizeSection(this.courseId, section, this.sections);\n                    try {\n                        yield course_helper[\"a\" /* CoreCourseHelper */].prefetchSection(section, this.courseId, this.sections);\n                    }\n                    catch (error) {\n                        if (!this.isDestroyed) {\n                            dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.course.errordownloadingsection', true);\n                        }\n                    }\n                    finally {\n                        yield this.updateModulesSizes(section.modules, section);\n                        this.changeDetectorRef.markForCheck();\n                    }\n                }\n                catch (error) {\n                    // User cancelled or there was an error calculating the size.\n                    if (!this.isDestroyed && error) {\n                        dom[\"a\" /* CoreDomUtils */].showErrorModal(error);\n                        this.changeDetectorRef.markForCheck();\n                        return;\n                    }\n                }\n                finally {\n                    section.isCalculating = false;\n                    this.changeDetectorRef.markForCheck();\n                }\n            });\n        }\n        /**\n         * Download the module.\n         *\n         * @param module Module to prefetch.\n         * @param refresh Whether it's refreshing.\n         * @return Promise resolved when done.\n         */\n        prefetchModule(module, refresh = false) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!module.prefetchHandler) {\n                    return;\n                }\n                // Show spinner since this operation might take a while.\n                module.spinner = true;\n                try {\n                    // Get download size to ask for confirm if it's high.\n                    this.changeDetectorRef.markForCheck();\n                    const size = yield module.prefetchHandler.getDownloadSize(module, module.course, true);\n                    yield course_helper[\"a\" /* CoreCourseHelper */].prefetchModule(module.prefetchHandler, module, size, module.course, refresh);\n                    course_helper[\"a\" /* CoreCourseHelper */].calculateSectionsStatus(this.sections, this.courseId, false, false);\n                }\n                catch (error) {\n                    if (!this.isDestroyed) {\n                        dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.errordownloading', true);\n                    }\n                }\n                finally {\n                    module.spinner = false;\n                    yield this.updateModulesSizes([module]);\n                    this.changeDetectorRef.markForCheck();\n                }\n            });\n        }\n        /**\n         * Show download buttons according to module status.\n         *\n         * @param module Module to update.\n         * @param status Module status.\n         */\n        updateModuleStatus(module, status) {\n            var _a, _b;\n            if (!status) {\n                return;\n            }\n            module.spinner = false;\n            module.downloadStatus = status;\n            (_b = (_a = module.handlerData) === null || _a === void 0 ? void 0 : _a.updateStatus) === null || _b === void 0 ? void 0 : _b.call(_a, status);\n            this.changeDetectorRef.markForCheck();\n        }\n        /**\n         * Calculate and show module status.\n         *\n         * @param module Module to update.\n         * @return Promise resolved when done.\n         */\n        calculateModuleStatus(module) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!module) {\n                    return;\n                }\n                const status = yield module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].getModuleStatus(module, this.courseId);\n                this.updateModuleStatus(module, status);\n            });\n        }\n        /**\n         * Determines the prefetch icon of the course.\n         *\n         * @return Promise resolved when done.\n         */\n        determineCoursePrefetchIcon() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                this.prefetchCourseData = yield course_helper[\"a\" /* CoreCourseHelper */].getCourseStatusIconAndTitle(this.courseId);\n            });\n        }\n        /**\n         * Update the course status icon and title.\n         *\n         * @param status Status to show.\n         */\n        updateCourseStatus(status) {\n            const statusData = course_helper[\"a\" /* CoreCourseHelper */].getCoursePrefetchStatusInfo(status);\n            this.prefetchCourseData.status = statusData.status;\n            this.prefetchCourseData.icon = statusData.icon;\n            this.prefetchCourseData.statusTranslatable = statusData.statusTranslatable;\n            this.prefetchCourseData.loading = statusData.loading;\n        }\n        /**\n         * Prefetch the whole course.\n         */\n        prefetchCourse() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const courses = yield services_courses[\"a\" /* CoreCourses */].getUserCourses(true);\n                let course = courses.find((course) => course.id == this.courseId);\n                if (!course) {\n                    course = yield services_courses[\"a\" /* CoreCourses */].getCourse(this.courseId);\n                }\n                if (!course) {\n                    return;\n                }\n                try {\n                    this.changeDetectorRef.markForCheck();\n                    yield course_helper[\"a\" /* CoreCourseHelper */].confirmAndPrefetchCourse(this.prefetchCourseData, course, {\n                        sections: this.sections,\n                        isGuest: this.isGuest,\n                    });\n                    this.changeDetectorRef.markForCheck();\n                }\n                catch (error) {\n                    if (this.isDestroyed) {\n                        return;\n                    }\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.course.errordownloadingcourse', true);\n                }\n            });\n        }\n        /**\n         * Toggle expand status.\n         *\n         * @param event Event object.\n         * @param section Section to expand / collapse.\n         */\n        toggleExpand(event, section) {\n            section.expanded = !section.expanded;\n            event.stopPropagation();\n            event.preventDefault();\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnDestroy() {\n            var _a, _b, _c, _d;\n            (_a = this.courseStatusObserver) === null || _a === void 0 ? void 0 : _a.off();\n            (_b = this.sectionStatusObserver) === null || _b === void 0 ? void 0 : _b.off();\n            (_c = this.moduleStatusObserver) === null || _c === void 0 ? void 0 : _c.off();\n            (_d = this.siteUpdatedObserver) === null || _d === void 0 ? void 0 : _d.off();\n            this.sections.forEach((section) => {\n                section.modules.forEach((module) => {\n                    var _a, _b;\n                    (_b = (_a = module.handlerData) === null || _a === void 0 ? void 0 : _a.onDestroy) === null || _b === void 0 ? void 0 : _b.call(_a);\n                });\n            });\n            this.isDestroyed = true;\n        }\n    }\n    AddonStorageManagerCourseStoragePage.ɵfac = function AddonStorageManagerCourseStoragePage_Factory(t) { return new (t || AddonStorageManagerCourseStoragePage)(core[\"yc\" /* ɵɵdirectiveInject */](core[\"r\" /* ElementRef */]), core[\"yc\" /* ɵɵdirectiveInject */](core[\"j\" /* ChangeDetectorRef */])); };\n    AddonStorageManagerCourseStoragePage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonStorageManagerCourseStoragePage, selectors: [[\"page-addon-storagemanager-course-storage\"]], decls: 31, vars: 26, consts: [[\"slot\", \"start\"], [3, \"text\"], [1, \"limited-width\"], [3, \"hideUntil\"], [\"class\", \"ion-text-wrap\", 4, \"ngIf\"], [1, \"wholecourse\"], [1, \"size\", \"ion-text-wrap\", \"ion-no-padding\"], [1, \"item-heading\", \"ion-text-wrap\"], [\"color\", \"light\", \"slot\", \"end\"], [4, \"ngIf\"], [\"expand\", \"block\", \"fill\", \"outline\", \"class\", \"ion-no-margin\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [\"expand\", \"block\", \"color\", \"danger\", 1, \"ion-no-margin\", \"ion-margin-top\", 3, \"disabled\", \"click\"], [\"name\", \"fas-trash\", \"slot\", \"start\"], [4, \"ngFor\", \"ngForOf\"], [1, \"ion-text-wrap\"], [\"expand\", \"block\", \"fill\", \"outline\", 1, \"ion-no-margin\", 3, \"disabled\", \"click\"], [\"slot\", \"start\", 3, \"name\", 4, \"ngIf\"], [\"slot\", \"start\", 4, \"ngIf\"], [\"slot\", \"start\", 3, \"name\"], [\"class\", \"section\", 4, \"ngIf\"], [1, \"section\"], [\"button\", \"\", \"detail\", \"false\", 3, \"lines\", \"click\"], [\"name\", \"fas-chevron-right\", \"flip-rtl\", \"\", \"slot\", \"start\", 1, \"expandable-status-icon\"], [\"contextLevel\", \"course\", 3, \"text\", \"contextInstanceId\", \"adaptImg\"], [3, \"color\", 4, \"ngIf\"], [\"color\", \"light\", 4, \"ngIf\"], [\"class\", \"storage-buttons\", \"slot\", \"end\", 4, \"ngIf\"], [3, \"id\"], [3, \"color\"], [\"name\", \"fam-cloud-done\", 4, \"ngIf\"], [\"name\", \"fam-cloud-done\"], [\"color\", \"light\"], [3, \"progress\"], [\"slot\", \"end\", 1, \"storage-buttons\"], [\"slot\", \"end\", \"class\", \"core-button-spinner\", 4, \"ngIf\"], [\"color\", \"danger\", \"fill\", \"clear\", 3, \"click\", 4, \"ngIf\"], [\"slot\", \"end\", 1, \"core-button-spinner\"], [3, \"status\", \"enabled\", \"loading\", \"canTrustDownload\", \"action\", 4, \"ngIf\"], [\"class\", \"core-course-download-section-progress\", \"role\", \"progressbar\", 4, \"ngIf\"], [3, \"status\", \"enabled\", \"loading\", \"canTrustDownload\", \"action\"], [\"role\", \"progressbar\", 1, \"core-course-download-section-progress\"], [\"color\", \"danger\", \"fill\", \"clear\", 3, \"click\"], [\"name\", \"fas-trash\", \"slot\", \"icon-only\"], [\"class\", \"core-course-storage-activity\", 4, \"ngIf\"], [1, \"core-course-storage-activity\"], [\"slot\", \"start\", 3, \"modicon\", \"modname\", \"componentId\", 4, \"ngIf\"], [\"contextLevel\", \"module\", 3, \"text\", \"courseId\", \"contextInstanceId\", \"adaptImg\"], [3, \"status\", \"enabled\", \"canTrustDownload\", \"loading\", \"action\", 4, \"ngIf\"], [\"fill\", \"clear\", \"color\", \"danger\", 3, \"click\", 4, \"ngIf\"], [\"slot\", \"start\", 3, \"modicon\", \"modname\", \"componentId\"], [3, \"status\", \"enabled\", \"canTrustDownload\", \"loading\", \"action\"], [\"fill\", \"clear\", \"color\", \"danger\", 3, \"click\"]], template: function AddonStorageManagerCourseStoragePage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"pd\" /* ɵɵtext */](7);\n                core[\"Pc\" /* ɵɵpipe */](8, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-content\", 2);\n                core[\"Ec\" /* ɵɵelementStart */](10, \"core-loading\", 3);\n                core[\"nd\" /* ɵɵtemplate */](11, AddonStorageManagerCourseStoragePage_ion_item_11_Template, 5, 3, \"ion-item\", 4);\n                core[\"Ec\" /* ɵɵelementStart */](12, \"ion-card\", 5);\n                core[\"Ec\" /* ɵɵelementStart */](13, \"ion-card-header\");\n                core[\"Ec\" /* ɵɵelementStart */](14, \"ion-card-title\");\n                core[\"pd\" /* ɵɵtext */](15);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](16, \"ion-item\", 6);\n                core[\"Ec\" /* ɵɵelementStart */](17, \"ion-label\");\n                core[\"Ec\" /* ɵɵelementStart */](18, \"p\", 7);\n                core[\"pd\" /* ɵɵtext */](19);\n                core[\"Pc\" /* ɵɵpipe */](20, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](21, \"ion-badge\", 8);\n                core[\"nd\" /* ɵɵtemplate */](22, AddonStorageManagerCourseStoragePage_ng_container_22_Template, 3, 3, \"ng-container\", 9);\n                core[\"nd\" /* ɵɵtemplate */](23, AddonStorageManagerCourseStoragePage_ng_container_23_Template, 3, 3, \"ng-container\", 9);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"nd\" /* ɵɵtemplate */](24, AddonStorageManagerCourseStoragePage_ion_button_24_Template, 5, 6, \"ion-button\", 10);\n                core[\"Ec\" /* ɵɵelementStart */](25, \"ion-button\", 11);\n                core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonStorageManagerCourseStoragePage_Template_ion_button_click_25_listener() { return ctx.deleteForCourse(); });\n                core[\"zc\" /* ɵɵelement */](26, \"ion-icon\", 12);\n                core[\"Pc\" /* ɵɵpipe */](27, \"translate\");\n                core[\"pd\" /* ɵɵtext */](28);\n                core[\"Pc\" /* ɵɵpipe */](29, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"nd\" /* ɵɵtemplate */](30, AddonStorageManagerCourseStoragePage_ng_container_30_Template, 2, 1, \"ng-container\", 13);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 13, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](8, 15, \"addon.storagemanager.coursedownloads\"));\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.downloadCourseEnabled);\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"qd\" /* ɵɵtextInterpolate */](ctx.title);\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](20, 17, \"addon.storagemanager.totaldownloads\"));\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !ctx.calculatingSize);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.calculatingSize);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.downloadCourseEnabled);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", ctx.calculatingSize || ctx.totalSize <= 0);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Rc\" /* ɵɵpipeBind2 */](27, 19, \"addon.storagemanager.deletedatafrom\", core[\"ad\" /* ɵɵpureFunction1 */](24, course_storage_c0, ctx.title)));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](29, 22, \"addon.storagemanager.deleteall\"), \" \");\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx.sections);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], loading[\"a\" /* CoreLoadingComponent */], common[\"t\" /* NgIf */], ionic_angular[\"n\" /* IonCard */], ionic_angular[\"p\" /* IonCardHeader */], ionic_angular[\"r\" /* IonCardTitle */], ionic_angular[\"I\" /* IonItem */], ionic_angular[\"O\" /* IonLabel */], ionic_angular[\"k\" /* IonBadge */], update_non_reactive_attributes[\"a\" /* CoreUpdateNonReactiveAttributesDirective */], ionic_angular[\"l\" /* IonButton */], ionic_angular[\"D\" /* IonIcon */], fa_icon[\"a\" /* CoreFaIconDirective */], common[\"s\" /* NgForOf */], ionic_angular[\"qb\" /* IonSpinner */], format_text[\"a\" /* CoreFormatTextDirective */], ionic_angular[\"o\" /* IonCardContent */], progress_bar[\"a\" /* CoreProgressBarComponent */], download_refresh[\"a\" /* CoreDownloadRefreshComponent */], mod_icon[\"a\" /* CoreModIconComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */], bytes_to_size[\"a\" /* CoreBytesToSizePipe */]], styles: [\"[_nghost-%COMP%]{--course-storage-max-activity-height:120px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-item.size[_ngcontent-%COMP%]{--inner-padding-end:0px}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{position:relative;max-height:var(--course-storage-max-activity-height);overflow:hidden}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]     *{pointer-events:none!important}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:before{content:\\\"\\\";height:var(--course-storage-max-activity-height);position:absolute;left:0;right:0;top:0;background:linear-gradient(180deg,rgba(var(--background-gradient-rgb),0) calc(100% - 30px),rgba(var(--background-gradient-rgb),1) calc(100% - 20px));z-index:6;pointer-events:none}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{font-weight:700;font-size:1.2rem}ion-badge[_ngcontent-%COMP%]{margin-top:8px}ion-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:8px;margin-inline-end:8px}}ion-item[_ngcontent-%COMP%]   core-mod-icon[_ngcontent-%COMP%]{--size:18px;padding:9px;--margin-vertical:8px;--margin-end:8px}.storage-buttons[_ngcontent-%COMP%]{display:flex;align-items:center}\"], changeDetection: 0 });\n    return AddonStorageManagerCourseStoragePage;\n})();\n\n// CONCATENATED MODULE: ./src/addons/storagemanager/storagemanager-lazy.module.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\nconst routes = [\n    {\n        path: 'storage',\n        component: courses_storage_AddonStorageManagerCoursesStoragePage,\n    },\n    {\n        path: 'storage/:courseId',\n        component: course_storage_AddonStorageManagerCourseStoragePage,\n    },\n];\nlet storagemanager_lazy_module_AddonStorageManagerLazyModule = /*@__PURE__*/ (() => {\n    class AddonStorageManagerLazyModule {\n    }\n    AddonStorageManagerLazyModule.ɵmod = core[\"wc\" /* ɵɵdefineNgModule */]({ type: AddonStorageManagerLazyModule });\n    AddonStorageManagerLazyModule.ɵinj = core[\"vc\" /* ɵɵdefineInjector */]({ factory: function AddonStorageManagerLazyModule_Factory(t) { return new (t || AddonStorageManagerLazyModule)(); }, imports: [[\n                router[\"m\" /* RouterModule */].forChild(routes),\n                shared_module[\"a\" /* CoreSharedModule */],\n            ], router[\"m\" /* RouterModule */]] });\n    return AddonStorageManagerLazyModule;\n})();\n(function () {\n    (typeof ngJitMode === \"undefined\" || ngJitMode) && core[\"kd\" /* ɵɵsetNgModuleScope */](storagemanager_lazy_module_AddonStorageManagerLazyModule, { declarations: [courses_storage_AddonStorageManagerCoursesStoragePage,\n            course_storage_AddonStorageManagerCourseStoragePage], imports: [router[\"m\" /* RouterModule */], shared_module[\"a\" /* CoreSharedModule */]], exports: [router[\"m\" /* RouterModule */]] });\n})();\n\n\n/***/ })\n\n}]);","inputSourceMap":null}