{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{HWyG:function(e,t,o){\"use strict\";o.r(t),o.d(t,\"AddonModImscpViewPageModule\",(function(){return F}));var i=o(\"tyNb\"),n=o(\"L3Fv\"),c=o(\"mrSG\"),a=o(\"BaYo\"),d=o(\"93ts\"),r=o(\"ULAo\"),s=o(\"zbKZ\"),l=o(\"GGba\"),m=o(\"pHTc\"),u=o(\"3LXp\"),h=o(\"vuGA\"),f=o(\"bFG1\"),p=o(\"j3ag\"),I=o(\"oIyK\"),g=o(\"Z23Z\"),w=o(\"fXoL\"),_=o(\"TEn/\"),M=o(\"hMzs\"),v=o(\"ofXK\"),b=o(\"nt/U\"),V=o(\"PgjG\"),y=o(\"ACYt\"),P=o(\"3CSS\"),A=o(\"qNqN\"),O=o(\"/BoF\"),E=o(\"3jOR\"),T=o(\"sYmb\");function AddonModImscpViewPage_ion_button_9_Template(e,t){if(1&e){const e=w.Fc();w.Ec(0,\"ion-button\",9),w.Mc(\"click\",(function AddonModImscpViewPage_ion_button_9_Template_ion_button_click_0_listener(){w.fd(e);return w.Oc().showToc()})),w.Pc(1,\"translate\"),w.zc(2,\"ion-icon\",10),w.Dc()}2&e&&w.mc(\"aria-label\",w.Qc(1,1,\"addon.mod_imscp.toc\"))}function AddonModImscpViewPage_ion_card_12_Template(e,t){if(1&e&&(w.Ec(0,\"ion-card\",11),w.Ec(1,\"ion-item\"),w.zc(2,\"ion-icon\",12),w.Ec(3,\"ion-label\"),w.zc(4,\"span\",13),w.Dc(),w.Dc(),w.Dc()),2&e){const e=w.Oc();w.lc(4),w.Vc(\"innerHTML\",e.warning,w.gd)}}function AddonModImscpViewPage_core_iframe_13_Template(e,t){if(1&e&&w.zc(0,\"core-iframe\",14),2&e){const e=w.Oc();w.Vc(\"src\",e.src)(\"showFullscreenOnToolbar\",!0)(\"autoFullscreenOnRotate\",!0)}}function AddonModImscpViewPage_core_navigation_bar_14_Template(e,t){if(1&e){const e=w.Fc();w.Ec(0,\"core-navigation-bar\",15),w.Mc(\"action\",(function AddonModImscpViewPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener(t){w.fd(e);return w.Oc().loadItem(t)})),w.Dc()}if(2&e){const e=w.Oc();w.Vc(\"items\",e.navigationItems)}}let D=(()=>{class AddonModImscpViewPage{constructor(){this.title=\"\",this.src=\"\",this.warning=\"\",this.navigationItems=[],this.loaded=!1,this.items=[]}ngOnInit(){try{this.cmId=m.a.getRequiredRouteNumberParam(\"cmId\"),this.courseId=m.a.getRequiredRouteNumberParam(\"courseId\"),this.initialItemHref=m.a.getRouteParam(\"initialHref\")}catch(e){return u.a.showErrorModal(e),m.a.back(),void 0}this.fetchContent()}fetchContent(e=!1){return Object(c.a)(this,void 0,void 0,(function*(){try{const{module:t,imscp:o}=yield this.loadImscpData();this.title=o.name;const i=yield this.downloadResourceIfNeeded(t,e),n=yield r.a.getModuleContents(t,this.courseId);if(this.items=g.a.createItemList(n),this.items.length&&(this.initialItemHref&&this.items.some((e=>e.href===this.initialItemHref))&&(this.currentHref=this.initialItemHref),void 0===this.currentHref)){const e=yield g.a.getLastItemViewed(o.id);this.currentHref=void 0!==e?e:this.items[0].href}if(void 0===this.currentHref)throw new d.a(\"Empty TOC\");try{yield this.loadItemHref(this.currentHref)}catch(e){return u.a.showErrorModalDefault(e,\"addon.mod_imscp.deploymenterror\",!0),void 0}if(null==i?void 0:i.failed){const e=h.a.getErrorMessageFromError(i.error)||i.error;this.warning=p.J.instant(\"core.errordownloadingsomefiles\")+(e?\" \"+e:\"\")}else this.warning=\"\"}catch(e){u.a.showErrorModalDefault(e,\"core.course.errorgetmodule\",!0)}finally{this.loaded=!0}}))}loadImscpData(){return Object(c.a)(this,void 0,void 0,(function*(){return this.module=yield r.a.getModule(this.cmId,this.courseId),this.imscp=yield g.a.getImscp(this.courseId,this.cmId),{module:this.module,imscp:this.imscp}}))}downloadResourceIfNeeded(e,t=!1){var o;return Object(c.a)(this,void 0,void 0,(function*(){const i={failed:!1};let n=!1;if((yield s.a.getModuleStatus(e,this.courseId,void 0,t))!==a.a.DOWNLOADED)try{yield s.a.downloadModule(e,this.courseId),n=!0}catch(e){i.failed=!0,i.error=e}if(!(null===(o=e.contents)||void 0===o?void 0:o.length)||t&&!n){const o=t&&l.a.isOnline();try{yield r.a.loadModuleContents(e,void 0,void 0,!1,o)}catch(t){if(o&&!e.contents)yield r.a.loadModuleContents(e);else if(!e.contents)throw t}}return i}))}doRefresh(e){return Object(c.a)(this,void 0,void 0,(function*(){yield f.a.ignoreErrors(Promise.all([g.a.invalidateContent(this.cmId,this.courseId),s.a.invalidateCourseUpdates(this.courseId)])),yield f.a.ignoreErrors(this.fetchContent(!0)),null==e||e.complete()}))}loadItemHref(e){return Object(c.a)(this,void 0,void 0,(function*(){if(!this.module)return;const t=yield g.a.getIframeSrc(this.module,e);this.currentHref=e,this.navigationItems=this.items.map((e=>({item:e,current:e.href==this.currentHref,enabled:!!e.href}))),this.src&&t==this.src?(this.src=\"\",setTimeout((()=>{this.src=t}))):this.src=t,this.imscp&&g.a.storeLastItemViewed(this.imscp.id,e,this.courseId)}))}loadItem(e){this.loadItemHref(e.href)}showToc(){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield u.a.openSideModal({component:I.a,componentProps:{items:this.items,selected:this.currentHref}});e&&this.loadItemHref(e)}))}}return AddonModImscpViewPage.ɵfac=function AddonModImscpViewPage_Factory(e){return new(e||AddonModImscpViewPage)},AddonModImscpViewPage.ɵcmp=w.sc({type:AddonModImscpViewPage,selectors:[[\"page-addon-mod-imscp-view\"]],decls:15,vars:11,consts:[[\"slot\",\"start\"],[3,\"text\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\"],[\"slot\",\"end\"],[\"aria-haspopup\",\"true\",3,\"click\",4,\"ngIf\"],[3,\"hideUntil\"],[\"class\",\"core-warning-card\",4,\"ngIf\"],[3,\"src\",\"showFullscreenOnToolbar\",\"autoFullscreenOnRotate\",4,\"ngIf\"],[\"collapsible-footer\",\"\",\"appearOnBottom\",\"\",3,\"items\",\"action\",4,\"ngIf\"],[\"aria-haspopup\",\"true\",3,\"click\"],[\"name\",\"fas-bookmark\",\"slot\",\"icon-only\",\"aria-hidden\",\"true\"],[1,\"core-warning-card\"],[\"name\",\"fas-exclamation-triangle\",\"slot\",\"start\",\"aria-hidden\",\"true\"],[3,\"innerHTML\"],[3,\"src\",\"showFullscreenOnToolbar\",\"autoFullscreenOnRotate\"],[\"collapsible-footer\",\"\",\"appearOnBottom\",\"\",3,\"items\",\"action\"]],template:function AddonModImscpViewPage_Template(e,t){1&e&&(w.Ec(0,\"ion-header\"),w.Ec(1,\"ion-toolbar\"),w.Ec(2,\"ion-buttons\",0),w.zc(3,\"ion-back-button\",1),w.Pc(4,\"translate\"),w.Dc(),w.Ec(5,\"ion-title\"),w.Ec(6,\"h1\"),w.zc(7,\"core-format-text\",2),w.Dc(),w.Dc(),w.Ec(8,\"ion-buttons\",3),w.nd(9,AddonModImscpViewPage_ion_button_9_Template,3,3,\"ion-button\",4),w.Dc(),w.Dc(),w.Dc(),w.Ec(10,\"ion-content\"),w.Ec(11,\"core-loading\",5),w.nd(12,AddonModImscpViewPage_ion_card_12_Template,5,1,\"ion-card\",6),w.nd(13,AddonModImscpViewPage_core_iframe_13_Template,1,3,\"core-iframe\",7),w.Dc(),w.nd(14,AddonModImscpViewPage_core_navigation_bar_14_Template,1,1,\"core-navigation-bar\",8),w.Dc()),2&e&&(w.lc(3),w.Vc(\"text\",w.Qc(4,9,\"core.back\")),w.lc(4),w.Vc(\"text\",t.title)(\"contextInstanceId\",t.cmId)(\"courseId\",t.courseId),w.lc(2),w.Vc(\"ngIf\",t.loaded),w.lc(2),w.Vc(\"hideUntil\",t.loaded),w.lc(1),w.Vc(\"ngIf\",t.warning),w.lc(1),w.Vc(\"ngIf\",t.loaded),w.lc(1),w.Vc(\"ngIf\",t.loaded&&t.navigationItems.length>1))},directives:[_.C,_.Ab,_.m,_.h,_.i,_.yb,M.a,v.t,b.a,_.v,V.a,y.a,_.l,_.D,P.a,_.n,_.I,_.O,A.a,O.a,E.a],pipes:[T.d],encapsulation:2}),AddonModImscpViewPage})();const H=[{path:\"\",component:D}];let F=(()=>{class AddonModImscpViewPageModule{}return AddonModImscpViewPageModule.ɵmod=w.wc({type:AddonModImscpViewPageModule}),AddonModImscpViewPageModule.ɵinj=w.vc({factory:function AddonModImscpViewPageModule_Factory(e){return new(e||AddonModImscpViewPageModule)},imports:[[i.m.forChild(H),n.a],i.m]}),AddonModImscpViewPageModule})();void((\"undefined\"==typeof ngJitMode||ngJitMode)&&w.kd(F,{declarations:[D],imports:[i.m,n.a],exports:[i.m]}))}}]);","name":"67.e14b223e0fc7e55dc647.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[67],{\n\n/***/ \"HWyG\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"AddonModImscpViewPageModule\", function() { return /* binding */ view_module_AddonModImscpViewPageModule; });\n\n// EXTERNAL MODULE: ./node_modules/@angular/router/__ivy_ngcc__/fesm2015/router.js + 10 modules\nvar router = __webpack_require__(\"tyNb\");\n\n// EXTERNAL MODULE: ./src/core/shared.module.ts + 3 modules\nvar shared_module = __webpack_require__(\"L3Fv\");\n\n// EXTERNAL MODULE: ./node_modules/tslib/tslib.es6.js\nvar tslib_es6 = __webpack_require__(\"mrSG\");\n\n// EXTERNAL MODULE: ./src/core/constants.ts\nvar constants = __webpack_require__(\"BaYo\");\n\n// EXTERNAL MODULE: ./src/core/classes/errors/error.ts\nvar errors_error = __webpack_require__(\"93ts\");\n\n// EXTERNAL MODULE: ./src/core/features/course/services/course.ts\nvar course = __webpack_require__(\"ULAo\");\n\n// EXTERNAL MODULE: ./src/core/features/course/services/module-prefetch-delegate.ts\nvar module_prefetch_delegate = __webpack_require__(\"zbKZ\");\n\n// EXTERNAL MODULE: ./src/core/services/network.ts + 2 modules\nvar network = __webpack_require__(\"GGba\");\n\n// EXTERNAL MODULE: ./src/core/services/navigator.ts\nvar services_navigator = __webpack_require__(\"pHTc\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/dom.ts + 2 modules\nvar dom = __webpack_require__(\"3LXp\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/text.ts + 1 modules\nvar utils_text = __webpack_require__(\"vuGA\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/utils.ts\nvar utils = __webpack_require__(\"bFG1\");\n\n// EXTERNAL MODULE: ./src/core/singletons/index.ts\nvar singletons = __webpack_require__(\"j3ag\");\n\n// EXTERNAL MODULE: ./src/addons/mod/imscp/components/toc/toc.ts\nvar toc = __webpack_require__(\"oIyK\");\n\n// EXTERNAL MODULE: ./src/addons/mod/imscp/services/imscp.ts\nvar services_imscp = __webpack_require__(\"Z23Z\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/core/__ivy_ngcc__/fesm2015/core.js\nvar core = __webpack_require__(\"fXoL\");\n\n// EXTERNAL MODULE: ./node_modules/@ionic/angular/__ivy_ngcc__/fesm2015/ionic-angular.js + 5 modules\nvar ionic_angular = __webpack_require__(\"TEn/\");\n\n// EXTERNAL MODULE: ./src/core/directives/format-text.ts\nvar format_text = __webpack_require__(\"hMzs\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/common/__ivy_ngcc__/fesm2015/common.js\nvar common = __webpack_require__(\"ofXK\");\n\n// EXTERNAL MODULE: ./src/core/directives/content.ts\nvar content = __webpack_require__(\"nt/U\");\n\n// EXTERNAL MODULE: ./src/core/components/loading/loading.ts\nvar loading = __webpack_require__(\"PgjG\");\n\n// EXTERNAL MODULE: ./src/core/directives/update-non-reactive-attributes.ts\nvar update_non_reactive_attributes = __webpack_require__(\"ACYt\");\n\n// EXTERNAL MODULE: ./src/core/directives/fa-icon.ts\nvar fa_icon = __webpack_require__(\"3CSS\");\n\n// EXTERNAL MODULE: ./src/core/components/iframe/iframe.ts\nvar iframe = __webpack_require__(\"qNqN\");\n\n// EXTERNAL MODULE: ./src/core/components/navigation-bar/navigation-bar.ts\nvar navigation_bar = __webpack_require__(\"/BoF\");\n\n// EXTERNAL MODULE: ./src/core/directives/collapsible-footer.ts\nvar collapsible_footer = __webpack_require__(\"3jOR\");\n\n// EXTERNAL MODULE: ./node_modules/@ngx-translate/core/__ivy_ngcc__/fesm2015/ngx-translate-core.js + 8 modules\nvar ngx_translate_core = __webpack_require__(\"sYmb\");\n\n// CONCATENATED MODULE: ./src/addons/mod/imscp/pages/view/view.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonModImscpViewPage_ion_button_9_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r5 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 9);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModImscpViewPage_ion_button_9_Template_ion_button_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r5); const ctx_r4 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r4.showToc(); });\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 10);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"addon.mod_imscp.toc\"));\n    }\n}\nfunction AddonModImscpViewPage_ion_card_12_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-card\", 11);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-item\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 12);\n        core[\"Ec\" /* ɵɵelementStart */](3, \"ion-label\");\n        core[\"zc\" /* ɵɵelement */](4, \"span\", 13);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r1 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](4);\n        core[\"Vc\" /* ɵɵproperty */](\"innerHTML\", ctx_r1.warning, core[\"gd\" /* ɵɵsanitizeHtml */]);\n    }\n}\nfunction AddonModImscpViewPage_core_iframe_13_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-iframe\", 14);\n    }\n    if (rf & 2) {\n        const ctx_r2 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"Vc\" /* ɵɵproperty */](\"src\", ctx_r2.src)(\"showFullscreenOnToolbar\", true)(\"autoFullscreenOnRotate\", true);\n    }\n}\nfunction AddonModImscpViewPage_core_navigation_bar_14_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r7 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"core-navigation-bar\", 15);\n        core[\"Mc\" /* ɵɵlistener */](\"action\", function AddonModImscpViewPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener($event) { core[\"fd\" /* ɵɵrestoreView */](_r7); const ctx_r6 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r6.loadItem($event); });\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r3 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"Vc\" /* ɵɵproperty */](\"items\", ctx_r3.navigationItems);\n    }\n}\n/**\n * Page that displays a IMSCP content.\n */\nlet view_AddonModImscpViewPage = /*@__PURE__*/ (() => {\n    class AddonModImscpViewPage {\n        constructor() {\n            this.title = '';\n            this.src = '';\n            this.warning = '';\n            this.navigationItems = [];\n            this.loaded = false;\n            this.items = [];\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnInit() {\n            try {\n                this.cmId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('cmId');\n                this.courseId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('courseId');\n                this.initialItemHref = services_navigator[\"a\" /* CoreNavigator */].getRouteParam('initialHref');\n            }\n            catch (error) {\n                dom[\"a\" /* CoreDomUtils */].showErrorModal(error);\n                services_navigator[\"a\" /* CoreNavigator */].back();\n                return;\n            }\n            this.fetchContent();\n        }\n        /**\n         * Download IMSCP contents and load the current item.\n         *\n         * @param refresh Whether we're refreshing data.\n         * @return Promise resolved when done.\n         */\n        fetchContent(refresh = false) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    const { module, imscp } = yield this.loadImscpData();\n                    this.title = imscp.name;\n                    const downloadResult = yield this.downloadResourceIfNeeded(module, refresh);\n                    // Get contents. No need to refresh, it has been done in downloadResourceIfNeeded.\n                    const contents = yield course[\"a\" /* CoreCourse */].getModuleContents(module, this.courseId);\n                    this.items = services_imscp[\"a\" /* AddonModImscp */].createItemList(contents);\n                    if (this.items.length) {\n                        if (this.initialItemHref) {\n                            // Check it's valid.\n                            if (this.items.some(item => item.href === this.initialItemHref)) {\n                                this.currentHref = this.initialItemHref;\n                            }\n                        }\n                        if (this.currentHref === undefined) {\n                            // Get last viewed.\n                            const lastViewedHref = yield services_imscp[\"a\" /* AddonModImscp */].getLastItemViewed(imscp.id);\n                            if (lastViewedHref !== undefined) {\n                                this.currentHref = lastViewedHref;\n                            }\n                            else {\n                                // Use first one.\n                                this.currentHref = this.items[0].href;\n                            }\n                        }\n                    }\n                    if (this.currentHref === undefined) {\n                        throw new errors_error[\"a\" /* CoreError */]('Empty TOC');\n                    }\n                    try {\n                        yield this.loadItemHref(this.currentHref);\n                    }\n                    catch (error) {\n                        dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'addon.mod_imscp.deploymenterror', true);\n                        return;\n                    }\n                    if (downloadResult === null || downloadResult === void 0 ? void 0 : downloadResult.failed) {\n                        const error = utils_text[\"a\" /* CoreTextUtils */].getErrorMessageFromError(downloadResult.error) || downloadResult.error;\n                        this.warning = singletons[\"J\" /* Translate */].instant('core.errordownloadingsomefiles') + (error ? ' ' + error : '');\n                    }\n                    else {\n                        this.warning = '';\n                    }\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.course.errorgetmodule', true);\n                }\n                finally {\n                    this.loaded = true;\n                }\n            });\n        }\n        /**\n         * Load IMSCP data from WS.\n         *\n         * @return Promise resolved when done.\n         */\n        loadImscpData() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                this.module = yield course[\"a\" /* CoreCourse */].getModule(this.cmId, this.courseId);\n                this.imscp = yield services_imscp[\"a\" /* AddonModImscp */].getImscp(this.courseId, this.cmId);\n                return {\n                    module: this.module,\n                    imscp: this.imscp,\n                };\n            });\n        }\n        /**\n         * Download a resource if needed.\n         * If the download call fails the promise won't be rejected, but the error will be included in the returned object.\n         * If module.contents cannot be loaded then the Promise will be rejected.\n         *\n         * @param refresh Whether we're refreshing data.\n         * @return Promise resolved when done.\n         */\n        downloadResourceIfNeeded(module, refresh = false) {\n            var _a;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const result = {\n                    failed: false,\n                };\n                let contentsAlreadyLoaded = false;\n                // Get module status to determine if it needs to be downloaded.\n                const status = yield module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].getModuleStatus(module, this.courseId, undefined, refresh);\n                if (status !== constants[\"a\" /* CoreConstants */].DOWNLOADED) {\n                    // Download content. This function also loads module contents if needed.\n                    try {\n                        yield module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].downloadModule(module, this.courseId);\n                        // If we reach here it means the download process already loaded the contents, no need to do it again.\n                        contentsAlreadyLoaded = true;\n                    }\n                    catch (error) {\n                        // Mark download as failed but go on since the main files could have been downloaded.\n                        result.failed = true;\n                        result.error = error;\n                    }\n                }\n                if (!((_a = module.contents) === null || _a === void 0 ? void 0 : _a.length) || (refresh && !contentsAlreadyLoaded)) {\n                    // Try to load the contents.\n                    const ignoreCache = refresh && network[\"a\" /* CoreNetwork */].isOnline();\n                    try {\n                        yield course[\"a\" /* CoreCourse */].loadModuleContents(module, undefined, undefined, false, ignoreCache);\n                    }\n                    catch (error) {\n                        // Error loading contents. If we ignored cache, try to get the cached value.\n                        if (ignoreCache && !module.contents) {\n                            yield course[\"a\" /* CoreCourse */].loadModuleContents(module);\n                        }\n                        else if (!module.contents) {\n                            // Not able to load contents, throw the error.\n                            throw error;\n                        }\n                    }\n                }\n                return result;\n            });\n        }\n        /**\n         * Refresh the data.\n         *\n         * @param refresher Refresher.\n         * @return Promise resolved when done.\n         */\n        doRefresh(refresher) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                yield utils[\"a\" /* CoreUtils */].ignoreErrors(Promise.all([\n                    services_imscp[\"a\" /* AddonModImscp */].invalidateContent(this.cmId, this.courseId),\n                    module_prefetch_delegate[\"a\" /* CoreCourseModulePrefetchDelegate */].invalidateCourseUpdates(this.courseId),\n                ]));\n                yield utils[\"a\" /* CoreUtils */].ignoreErrors(this.fetchContent(true));\n                refresher === null || refresher === void 0 ? void 0 : refresher.complete();\n            });\n        }\n        /**\n         * Loads an item.\n         *\n         * @param itemHref Item Href.\n         * @return Promise resolved when done.\n         */\n        loadItemHref(itemHref) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.module) {\n                    return;\n                }\n                const src = yield services_imscp[\"a\" /* AddonModImscp */].getIframeSrc(this.module, itemHref);\n                this.currentHref = itemHref;\n                this.navigationItems = this.items.map((item) => ({\n                    item: item,\n                    current: item.href == this.currentHref,\n                    enabled: !!item.href,\n                }));\n                if (this.src && src == this.src) {\n                    // Re-loading same page. Set it to empty and then re-set the src in the next digest so it detects it has changed.\n                    this.src = '';\n                    setTimeout(() => {\n                        this.src = src;\n                    });\n                }\n                else {\n                    this.src = src;\n                }\n                if (this.imscp) {\n                    services_imscp[\"a\" /* AddonModImscp */].storeLastItemViewed(this.imscp.id, itemHref, this.courseId);\n                }\n            });\n        }\n        /**\n         * Loads an item.\n         *\n         * @param item Item.\n         */\n        loadItem(item) {\n            this.loadItemHref(item.href);\n        }\n        /**\n         * Show the TOC.\n         */\n        showToc() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                // Create the toc modal.\n                const itemHref = yield dom[\"a\" /* CoreDomUtils */].openSideModal({\n                    component: toc[\"a\" /* AddonModImscpTocComponent */],\n                    componentProps: {\n                        items: this.items,\n                        selected: this.currentHref,\n                    },\n                });\n                if (itemHref) {\n                    this.loadItemHref(itemHref);\n                }\n            });\n        }\n    }\n    AddonModImscpViewPage.ɵfac = function AddonModImscpViewPage_Factory(t) { return new (t || AddonModImscpViewPage)(); };\n    AddonModImscpViewPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModImscpViewPage, selectors: [[\"page-addon-mod-imscp-view\"]], decls: 15, vars: 11, consts: [[\"slot\", \"start\"], [3, \"text\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [\"slot\", \"end\"], [\"aria-haspopup\", \"true\", 3, \"click\", 4, \"ngIf\"], [3, \"hideUntil\"], [\"class\", \"core-warning-card\", 4, \"ngIf\"], [3, \"src\", \"showFullscreenOnToolbar\", \"autoFullscreenOnRotate\", 4, \"ngIf\"], [\"collapsible-footer\", \"\", \"appearOnBottom\", \"\", 3, \"items\", \"action\", 4, \"ngIf\"], [\"aria-haspopup\", \"true\", 3, \"click\"], [\"name\", \"fas-bookmark\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [1, \"core-warning-card\"], [\"name\", \"fas-exclamation-triangle\", \"slot\", \"start\", \"aria-hidden\", \"true\"], [3, \"innerHTML\"], [3, \"src\", \"showFullscreenOnToolbar\", \"autoFullscreenOnRotate\"], [\"collapsible-footer\", \"\", \"appearOnBottom\", \"\", 3, \"items\", \"action\"]], template: function AddonModImscpViewPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"zc\" /* ɵɵelement */](7, \"core-format-text\", 2);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](8, \"ion-buttons\", 3);\n                core[\"nd\" /* ɵɵtemplate */](9, AddonModImscpViewPage_ion_button_9_Template, 3, 3, \"ion-button\", 4);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](10, \"ion-content\");\n                core[\"Ec\" /* ɵɵelementStart */](11, \"core-loading\", 5);\n                core[\"nd\" /* ɵɵtemplate */](12, AddonModImscpViewPage_ion_card_12_Template, 5, 1, \"ion-card\", 6);\n                core[\"nd\" /* ɵɵtemplate */](13, AddonModImscpViewPage_core_iframe_13_Template, 1, 3, \"core-iframe\", 7);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"nd\" /* ɵɵtemplate */](14, AddonModImscpViewPage_core_navigation_bar_14_Template, 1, 1, \"core-navigation-bar\", 8);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 9, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", ctx.title)(\"contextInstanceId\", ctx.cmId)(\"courseId\", ctx.courseId);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.warning);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.loaded && ctx.navigationItems.length > 1);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], format_text[\"a\" /* CoreFormatTextDirective */], common[\"t\" /* NgIf */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], loading[\"a\" /* CoreLoadingComponent */], update_non_reactive_attributes[\"a\" /* CoreUpdateNonReactiveAttributesDirective */], ionic_angular[\"l\" /* IonButton */], ionic_angular[\"D\" /* IonIcon */], fa_icon[\"a\" /* CoreFaIconDirective */], ionic_angular[\"n\" /* IonCard */], ionic_angular[\"I\" /* IonItem */], ionic_angular[\"O\" /* IonLabel */], iframe[\"a\" /* CoreIframeComponent */], navigation_bar[\"a\" /* CoreNavigationBarComponent */], collapsible_footer[\"a\" /* CoreCollapsibleFooterDirective */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */]], encapsulation: 2 });\n    return AddonModImscpViewPage;\n})();\n\n// CONCATENATED MODULE: ./src/addons/mod/imscp/pages/view/view.module.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\nconst routes = [\n    {\n        path: '',\n        component: view_AddonModImscpViewPage,\n    },\n];\nlet view_module_AddonModImscpViewPageModule = /*@__PURE__*/ (() => {\n    class AddonModImscpViewPageModule {\n    }\n    AddonModImscpViewPageModule.ɵmod = core[\"wc\" /* ɵɵdefineNgModule */]({ type: AddonModImscpViewPageModule });\n    AddonModImscpViewPageModule.ɵinj = core[\"vc\" /* ɵɵdefineInjector */]({ factory: function AddonModImscpViewPageModule_Factory(t) { return new (t || AddonModImscpViewPageModule)(); }, imports: [[\n                router[\"m\" /* RouterModule */].forChild(routes),\n                shared_module[\"a\" /* CoreSharedModule */],\n            ], router[\"m\" /* RouterModule */]] });\n    return AddonModImscpViewPageModule;\n})();\n(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && core[\"kd\" /* ɵɵsetNgModuleScope */](view_module_AddonModImscpViewPageModule, { declarations: [view_AddonModImscpViewPage], imports: [router[\"m\" /* RouterModule */], shared_module[\"a\" /* CoreSharedModule */]], exports: [router[\"m\" /* RouterModule */]] }); })();\n\n\n/***/ })\n\n}]);","inputSourceMap":null}