(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{bxKJ:function(n,e,t){"use strict";t.r(e),t.d(e,"AddonMessagesContacts35PageModule",(function(){return E}));var s=t("tyNb"),o=t("vY5A"),a=t("muSn"),i=t("Y+03"),c=t("L3Fv"),g=t("PM4H"),r=t("mrSG"),d=t("9+EE"),l=t("KMk0"),_=t("3LXp"),m=t("nvXB"),h=t("fjkH"),M=t("j3ag"),C=t("pHTc"),P=t("fXoL"),u=t("TEn/"),O=t("nt/U"),f=t("46ml"),p=t("9zps"),b=t("PgjG"),v=t("ofXK"),x=t("r8G5"),y=t("FeAf"),A=t("sYmb");function AddonMessagesContacts35Page_core_empty_box_18_Template(n,e){1&n&&(P.zc(0,"core-empty-box",9),P.Pc(1,"translate")),2&n&&P.Vc("message",P.Qc(1,1,"addon.messages.contactlistempty"))}function AddonMessagesContacts35Page_core_empty_box_19_Template(n,e){1&n&&(P.zc(0,"core-empty-box",9),P.Pc(1,"translate")),2&n&&P.Vc("message",P.Qc(1,1,"addon.messages.nousersfound"))}function AddonMessagesContacts35Page_ion_list_20_ng_container_1_ng_container_9_ion_item_1_Template(n,e){if(1&n){const n=P.Fc();P.Ec(0,"ion-item",16),P.Mc("click",(function AddonMessagesContacts35Page_ion_list_20_ng_container_1_ng_container_9_ion_item_1_Template_ion_item_click_0_listener(){P.fd(n);const e=P.Oc().$implicit;return P.Oc(3).gotoDiscussion(e.id)})),P.zc(1,"core-user-avatar",17),P.Ec(2,"ion-label"),P.Ec(3,"p",12),P.pd(4),P.Dc(),P.Dc(),P.Dc()}if(2&n){const n=P.Oc().$implicit,e=P.Oc(3);P.mc("aria-label",n.fullname)("aria-current",n.id==e.discussionUserId?"page":"false"),P.lc(1),P.Vc("user",n)("checkOnline",n.showonlinestatus),P.lc(3),P.qd(n.fullname)}}function AddonMessagesContacts35Page_ion_list_20_ng_container_1_ng_container_9_Template(n,e){if(1&n&&(P.Cc(0),P.nd(1,AddonMessagesContacts35Page_ion_list_20_ng_container_1_ng_container_9_ion_item_1_Template,5,5,"ion-item",15),P.Bc()),2&n){const n=e.$implicit;P.lc(1),P.Vc("ngIf",n.profileimageurl||n.profileimageurlsmall)}}function AddonMessagesContacts35Page_ion_list_20_ng_container_1_Template(n,e){if(1&n&&(P.Cc(0),P.Ec(1,"ion-item-divider"),P.Ec(2,"ion-label"),P.Ec(3,"p",12),P.pd(4),P.Pc(5,"translate"),P.Dc(),P.Dc(),P.Ec(6,"ion-note",13),P.Ec(7,"ion-badge"),P.pd(8),P.Dc(),P.Dc(),P.Dc(),P.nd(9,AddonMessagesContacts35Page_ion_list_20_ng_container_1_ng_container_9_Template,2,1,"ng-container",14),P.Bc()),2&n){const n=P.Oc().$implicit,e=P.Oc();P.lc(4),P.qd(P.Qc(5,3,"addon.messages.type_"+n)),P.lc(4),P.qd(e.contacts[n].length),P.lc(1),P.Vc("ngForOf",e.contacts[n])}}function AddonMessagesContacts35Page_ion_list_20_Template(n,e){if(1&n&&(P.Ec(0,"ion-list",10),P.nd(1,AddonMessagesContacts35Page_ion_list_20_ng_container_1_Template,10,5,"ng-container",11),P.Dc()),2&n){const n=e.$implicit,t=P.Oc();P.lc(1),P.Vc("ngIf",t.contacts[n]&&(t.contacts[n].length>0||n===t.searchType))}}let w=(()=>{class AddonMessagesContacts35Page{constructor(n){this.route=n,this.noSearchTypes=["online","offline","blocked","strangers"],this.loaded=!1,this.contactTypes=["online","offline","blocked","strangers"],this.searchType="search",this.loadingMessage="",this.hasContacts=!1,this.contacts={online:[],offline:[],strangers:[],search:[]},this.searchString="",this.siteId=d.b.getCurrentSiteId(),this.searchingMessages=M.J.instant("core.searching"),this.loadingMessages=M.J.instant("core.loading"),this.loadingMessage=this.loadingMessages,this.memberInfoObserver=h.b.on(l.b.MEMBER_INFO_CHANGED_EVENT,(n=>{n.contactRequestConfirmed&&this.refreshData()}),d.b.getCurrentSiteId())}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){const n=C.a.getRouteNumberParam("discussionUserId")||C.a.getRouteNumberParam("userId")||void 0;if(!this.loaded||this.discussionUserId!=n){this.discussionUserId=n,this.discussionUserId&&this.gotoDiscussion(this.discussionUserId);try{if(yield this.fetchData(),!this.discussionUserId&&this.hasContacts&&i.a.isTablet){let n;for(const e in this.contacts)if(this.contacts[e].length>0){n=this.contacts[e][0];break}n&&this.gotoDiscussion(n.id)}}finally{this.loaded=!0}}}))}refreshData(n){return Object(r.a)(this,void 0,void 0,(function*(){try{this.searchString?yield this.performSearch(this.searchString):(yield l.a.invalidateAllContactsCache(),yield this.fetchData())}finally{null==n?void 0:n.complete()}}))}fetchData(){return Object(r.a)(this,void 0,void 0,(function*(){this.loadingMessage=this.loadingMessages;try{const n=yield l.a.getAllContacts();for(const e in n)this.contacts[e]=n[e].length>0?this.sortUsers(n[e]):[];this.clearSearch()}catch(n){_.a.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)}}))}sortUsers(n){return n.sort(((n,e)=>{const t=n.fullname.toLowerCase(),s=e.fullname.toLowerCase();return t.localeCompare(s)}))}clearSearch(){this.searchString="",this.contactTypes=this.noSearchTypes,this.hasContacts=!1;for(const n in this.contacts)if(this.contacts[n].length>0)return this.hasContacts=!0,void 0}search(n){return m.a.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.searchingMessages,this.performSearch(n).finally((()=>{this.loaded=!0}))}performSearch(n){return Object(r.a)(this,void 0,void 0,(function*(){try{const e=yield l.a.searchContacts(n);this.hasContacts=e.length>0,this.searchString=n,this.contactTypes=["search"],this.contacts.search=this.sortUsers(e)}catch(n){_.a.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)}}))}gotoDiscussion(n){this.discussionUserId=n;const e={userId:n},t=C.a.isCurrentPathInTablet("**/messages/contacts-35/discussion");C.a.navigate((t?"../":"")+"discussion",{params:e})}ngOnDestroy(){var n;null===(n=this.memberInfoObserver)||void 0===n?void 0:n.off()}}return AddonMessagesContacts35Page.ɵfac=function AddonMessagesContacts35Page_Factory(n){return new(n||AddonMessagesContacts35Page)(P.yc(s.a))},AddonMessagesContacts35Page.ɵcmp=P.sc({type:AddonMessagesContacts35Page,selectors:[["addon-messages-contacts"]],decls:21,vars:19,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesContacts",3,"placeholder","disabled","onSubmit","onClear"],[3,"hideUntil","message"],["icon","fas-address-book",3,"message",4,"ngIf"],["class","ion-no-margin",4,"ngFor","ngForOf"],["icon","fas-address-book",3,"message"],[1,"ion-no-margin"],[4,"ngIf"],[1,"item-heading"],["slot","end",1,"ion-padding-end"],[4,"ngFor","ngForOf"],["class","ion-text-wrap addon-messages-conversation-item","detail","true","button","",3,"click",4,"ngIf"],["detail","true","button","",1,"ion-text-wrap","addon-messages-conversation-item",3,"click"],["slot","start",3,"user","checkOnline"]],template:function AddonMessagesContacts35Page_Template(n,e){1&n&&(P.Ec(0,"ion-header"),P.Ec(1,"ion-toolbar"),P.Ec(2,"ion-buttons",0),P.zc(3,"ion-back-button",1),P.Pc(4,"translate"),P.Dc(),P.Ec(5,"ion-title"),P.Ec(6,"h1"),P.pd(7),P.Pc(8,"translate"),P.Dc(),P.Dc(),P.zc(9,"ion-buttons",2),P.Dc(),P.Dc(),P.Ec(10,"ion-content"),P.Ec(11,"core-split-view"),P.Ec(12,"ion-refresher",3),P.Mc("ionRefresh",(function AddonMessagesContacts35Page_Template_ion_refresher_ionRefresh_12_listener(n){return e.refreshData(n.target)})),P.zc(13,"ion-refresher-content",4),P.Pc(14,"translate"),P.Dc(),P.Ec(15,"core-search-box",5),P.Mc("onSubmit",(function AddonMessagesContacts35Page_Template_core_search_box_onSubmit_15_listener(n){return e.search(n)}))("onClear",(function AddonMessagesContacts35Page_Template_core_search_box_onClear_15_listener(){return e.clearSearch()})),P.Pc(16,"translate"),P.Dc(),P.Ec(17,"core-loading",6),P.nd(18,AddonMessagesContacts35Page_core_empty_box_18_Template,2,3,"core-empty-box",7),P.nd(19,AddonMessagesContacts35Page_core_empty_box_19_Template,2,3,"core-empty-box",7),P.nd(20,AddonMessagesContacts35Page_ion_list_20_Template,2,1,"ion-list",8),P.Dc(),P.Dc(),P.Dc()),2&n&&(P.lc(3),P.Vc("text",P.Qc(4,11,"core.back")),P.lc(4),P.qd(P.Qc(8,13,"addon.messages.contacts")),P.lc(5),P.Vc("disabled",!e.loaded),P.lc(1),P.Wc("pullingText",P.Qc(14,15,"core.pulltorefresh")),P.lc(2),P.Vc("placeholder",P.Qc(16,17,"addon.messages.contactname"))("disabled",!e.loaded),P.lc(2),P.Vc("hideUntil",e.loaded)("message",e.loadingMessage),P.lc(1),P.Vc("ngIf",!e.hasContacts&&""==e.searchString),P.lc(1),P.Vc("ngIf",!e.hasContacts&&""!=e.searchString),P.lc(1),P.Vc("ngForOf",e.contactTypes))},directives:[u.C,u.Ab,u.m,u.h,u.i,u.yb,O.a,u.v,f.a,u.bb,u.cb,p.a,b.a,v.t,v.s,x.a,u.P,u.J,u.O,u.W,u.k,u.I,y.a],pipes:[A.d],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContacts35Page})();const D=[{path:"",component:w},a.AddonMessagesDiscussionRoute],T=[{path:"",component:w,children:[a.AddonMessagesDiscussionRoute]}],k=[...Object(o.c)(D,(()=>i.a.isMobile)),...Object(o.c)(T,(()=>i.a.isTablet))];let E=(()=>{class AddonMessagesContacts35PageModule{}return AddonMessagesContacts35PageModule.ɵmod=P.wc({type:AddonMessagesContacts35PageModule}),AddonMessagesContacts35PageModule.ɵinj=P.vc({factory:function AddonMessagesContacts35PageModule_Factory(n){return new(n||AddonMessagesContacts35PageModule)},imports:[[s.m.forChild(k),c.a,g.a],s.m]}),AddonMessagesContacts35PageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&P.kd(E,{declarations:[w],imports:[s.m,c.a,g.a],exports:[s.m]}))}}]);