(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{SyS0:function(t,e,i){"use strict";i.r(e),i.d(e,"AddonModH5PActivityUsersAttemptsPageModule",(function(){return b}));var o=i("tyNb"),c=i("L3Fv"),s=i("mrSG"),n=i("4pns"),a=i("pHTc"),r=i("3LXp"),d=i("bFG1"),l=i("pOwY"),p=i("fXoL"),m=i("TEn/"),_=i("ofXK"),A=i("nt/U"),h=i("PgjG"),u=i("xpMl"),f=i("hMzs"),g=i("FeAf"),v=i("r8G5"),P=i("sYmb"),y=i("uYHD");function AddonModH5PActivityUsersAttemptsPage_core_format_text_7_Template(t,e){if(1&t&&p.zc(0,"core-format-text",9),2&t){const t=p.Oc();p.Vc("text",t.h5pActivity.name)("contextInstanceId",t.h5pActivity.coursemodule)("courseId",t.courseId)}}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_9_Template(t,e){if(1&t&&(p.Ec(0,"span"),p.pd(1),p.Pc(2,"coreFormatDate"),p.Dc()),2&t){const t=p.Oc().$implicit;p.lc(1),p.rd(" ",p.Rc(2,1,t.attempts[t.attempts.length-1].timemodified,"strftimedatetimeshort")," ")}}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_10_Template(t,e){1&t&&(p.Ec(0,"span"),p.pd(1,"-"),p.Dc())}const _c0=function(t){return{$a:t}};function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_12_Template(t,e){if(1&t&&(p.Ec(0,"span"),p.pd(1),p.Pc(2,"translate"),p.Dc()),2&t){const t=p.Oc().$implicit;p.lc(1),p.rd(" ",p.Rc(2,1,"core.percentagenumber",p.ad(4,_c0,t.score))," ")}}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_13_Template(t,e){1&t&&(p.Ec(0,"span"),p.pd(1,"-"),p.Dc())}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template(t,e){if(1&t){const t=p.Fc();p.Ec(0,"ion-item",15),p.Mc("click",(function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template_ion_item_click_0_listener(){p.fd(t);const i=e.$implicit;return p.Oc(2).openUser(i)})),p.Pc(1,"translate"),p.Ec(2,"ion-label"),p.Ec(3,"ion-row",11),p.Ec(4,"ion-col",12),p.Ec(5,"p"),p.zc(6,"core-user-avatar",16),p.Dc(),p.pd(7),p.Dc(),p.Ec(8,"ion-col",12),p.nd(9,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_9_Template,3,4,"span",6),p.nd(10,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_10_Template,2,0,"span",6),p.Dc(),p.Ec(11,"ion-col",13),p.nd(12,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_12_Template,3,6,"span",6),p.nd(13,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_13_Template,2,0,"span",6),p.Dc(),p.Ec(14,"ion-col",13),p.pd(15),p.Dc(),p.Dc(),p.Dc(),p.Dc()}if(2&t){const t=e.$implicit,i=p.Oc(2);p.mc("aria-label",p.Rc(1,9,"addon.mod_h5pactivity.review_user_attempts",p.ad(12,_c0,t.attempts.length))),p.lc(6),p.Vc("user",t.user)("courseId",i.courseId),p.lc(1),p.rd(" ",t.user.fullname," "),p.lc(2),p.Vc("ngIf",t.attempts.length),p.lc(1),p.Vc("ngIf",!t.attempts.length),p.lc(2),p.Vc("ngIf",void 0!==t.score),p.lc(1),p.Vc("ngIf",void 0===t.score),p.lc(2),p.rd(" ",t.attempts.length," ")}}function AddonModH5PActivityUsersAttemptsPage_ion_list_13_Template(t,e){if(1&t&&(p.Ec(0,"ion-list"),p.Ec(1,"ion-item",10),p.Ec(2,"ion-label"),p.Ec(3,"ion-row",11),p.Ec(4,"ion-col",12),p.pd(5),p.Pc(6,"translate"),p.Dc(),p.Ec(7,"ion-col",12),p.pd(8),p.Pc(9,"translate"),p.Dc(),p.Ec(10,"ion-col",13),p.pd(11),p.Pc(12,"translate"),p.Dc(),p.Ec(13,"ion-col",13),p.pd(14),p.Pc(15,"translate"),p.Dc(),p.Dc(),p.Dc(),p.Dc(),p.nd(16,AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template,16,14,"ion-item",14),p.Dc()),2&t){const t=p.Oc();p.lc(1),p.Vc("detail",!1),p.lc(4),p.qd(p.Qc(6,6,"core.user")),p.lc(3),p.qd(p.Qc(9,8,"core.date")),p.lc(3),p.qd(p.Qc(12,10,"addon.mod_h5pactivity.score")),p.lc(3),p.qd(p.Qc(15,12,"addon.mod_h5pactivity.attempts")),p.lc(2),p.Vc("ngForOf",t.users)}}function AddonModH5PActivityUsersAttemptsPage_core_empty_box_14_Template(t,e){1&t&&(p.zc(0,"core-empty-box",17),p.Pc(1,"translate")),2&t&&p.Vc("message",p.Qc(1,1,"addon.mod_h5pactivity.noparticipants"))}let M=(()=>{class AddonModH5PActivityUsersAttemptsPage{constructor(){this.loaded=!1,this.users=[],this.fetchMoreUsersFailed=!1,this.canLoadMore=!1,this.page=0,this.fetchSuccess=!1}ngOnInit(){return Object(s.a)(this,void 0,void 0,(function*(){try{this.courseId=a.a.getRequiredRouteNumberParam("courseId"),this.cmId=a.a.getRequiredRouteNumberParam("cmId")}catch(t){return r.a.showErrorModal(t),a.a.back(),void 0}this.fetchData()}))}doRefresh(t){this.refreshData().finally((()=>{t.complete()}))}fetchData(t){return Object(s.a)(this,void 0,void 0,(function*(){try{this.h5pActivity=yield l.a.getH5PActivity(this.courseId,this.cmId),yield Promise.all([this.fetchUsers(t)]),this.fetchSuccess||(this.fetchSuccess=!0,d.a.ignoreErrors(l.a.logViewReport(this.h5pActivity.id,this.h5pActivity.name)))}catch(t){r.a.showErrorModalDefault(t,"Error loading attempts.")}finally{this.loaded=!0}}))}fetchUsers(t){return Object(s.a)(this,void 0,void 0,(function*(){if(!this.h5pActivity)return;t&&(this.page=0);const e=yield l.a.getUsersAttempts(this.h5pActivity.id,{cmId:this.cmId,page:this.page}),i=yield this.formatUsers(this.h5pActivity,e.users);this.users=0===this.page?i:this.users.concat(i),this.canLoadMore=e.canLoadMore,this.page++}))}formatUsers(t,e){return Object(s.a)(this,void 0,void 0,(function*(){return Promise.all(e.map((e=>Object(s.a)(this,void 0,void 0,(function*(){var i;if(e.user=yield n.a.getProfile(e.userid,this.courseId,!0),t.grademethod===l.b.GRADEMANUAL);else if(t.grademethod===l.b.GRADEAVERAGEATTEMPT){if(e.attempts.length){const t=e.attempts.reduce(((t,e)=>t+100*e.rawscore/e.maxscore),0);e.score=Math.round(t/e.attempts.length)}}else(null===(i=e.scored)||void 0===i?void 0:i.attempts[0])&&(e.score=Math.round(100*e.scored.attempts[0].rawscore/e.scored.attempts[0].maxscore));return e})))))}))}fetchMoreUsers(t){return Object(s.a)(this,void 0,void 0,(function*(){try{yield this.fetchUsers(!1)}catch(t){r.a.showErrorModalDefault(t,"Error loading more users"),this.fetchMoreUsersFailed=!0}t()}))}refreshData(){return Object(s.a)(this,void 0,void 0,(function*(){const t=[l.a.invalidateActivityData(this.courseId)];this.h5pActivity&&t.push(l.a.invalidateAllUsersAttempts(this.h5pActivity.id)),yield d.a.ignoreErrors(Promise.all(t)),yield this.fetchData(!0)}))}openUser(t){a.a.navigate(`../userattempts/${t.userid}`)}}return AddonModH5PActivityUsersAttemptsPage.ɵfac=function AddonModH5PActivityUsersAttemptsPage_Factory(t){return new(t||AddonModH5PActivityUsersAttemptsPage)},AddonModH5PActivityUsersAttemptsPage.ɵcmp=p.sc({type:AddonModH5PActivityUsersAttemptsPage,selectors:[["page-addon-mod-h5pactivity-users-attempts"]],decls:16,vars:13,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["icon","fas-chart-bar",3,"message",4,"ngIf"],[3,"enabled","error","action"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[1,"addon-mod_h5pactivity-table-header","font-bold",3,"detail"],[1,"ion-align-items-center"],["size","4",1,"ion-text-center"],["size","2",1,"ion-text-center"],["class","ion-text-wrap addon-mod_h5pactivity-table-row","detail","true","button","",3,"click",4,"ngFor","ngForOf"],["detail","true","button","",1,"ion-text-wrap","addon-mod_h5pactivity-table-row",3,"click"],[3,"user","courseId"],["icon","fas-chart-bar",3,"message"]],template:function AddonModH5PActivityUsersAttemptsPage_Template(t,e){1&t&&(p.Ec(0,"ion-header"),p.Ec(1,"ion-toolbar"),p.Ec(2,"ion-buttons",0),p.zc(3,"ion-back-button",1),p.Pc(4,"translate"),p.Dc(),p.Ec(5,"ion-title"),p.Ec(6,"h1"),p.nd(7,AddonModH5PActivityUsersAttemptsPage_core_format_text_7_Template,1,3,"core-format-text",2),p.Dc(),p.Dc(),p.Dc(),p.Dc(),p.Ec(8,"ion-content"),p.Ec(9,"ion-refresher",3),p.Mc("ionRefresh",(function AddonModH5PActivityUsersAttemptsPage_Template_ion_refresher_ionRefresh_9_listener(t){return e.doRefresh(t.target)})),p.zc(10,"ion-refresher-content",4),p.Pc(11,"translate"),p.Dc(),p.Ec(12,"core-loading",5),p.nd(13,AddonModH5PActivityUsersAttemptsPage_ion_list_13_Template,17,14,"ion-list",6),p.nd(14,AddonModH5PActivityUsersAttemptsPage_core_empty_box_14_Template,2,3,"core-empty-box",7),p.Ec(15,"core-infinite-loading",8),p.Mc("action",(function AddonModH5PActivityUsersAttemptsPage_Template_core_infinite_loading_action_15_listener(t){return e.fetchMoreUsers(t)})),p.Dc(),p.Dc(),p.Dc()),2&t&&(p.lc(3),p.Vc("text",p.Qc(4,9,"core.back")),p.lc(4),p.Vc("ngIf",e.h5pActivity),p.lc(2),p.Vc("disabled",!e.loaded),p.lc(1),p.Wc("pullingText",p.Qc(11,11,"core.pulltorefresh")),p.lc(2),p.Vc("hideUntil",e.loaded),p.lc(1),p.Vc("ngIf",e.users.length),p.lc(1),p.Vc("ngIf",!e.users.length&&!e.canLoadMore),p.lc(1),p.Vc("enabled",e.loaded&&e.canLoadMore)("error",e.fetchMoreUsersFailed))},directives:[m.C,m.Ab,m.m,m.h,m.i,m.yb,_.t,A.a,m.v,m.bb,m.cb,h.a,u.a,f.a,m.P,m.I,m.O,m.hb,m.u,_.s,g.a,v.a],pipes:[P.d,y.a],encapsulation:2}),AddonModH5PActivityUsersAttemptsPage})();const U=[{path:"",component:M}];let b=(()=>{class AddonModH5PActivityUsersAttemptsPageModule{}return AddonModH5PActivityUsersAttemptsPageModule.ɵmod=p.wc({type:AddonModH5PActivityUsersAttemptsPageModule}),AddonModH5PActivityUsersAttemptsPageModule.ɵinj=p.vc({factory:function AddonModH5PActivityUsersAttemptsPageModule_Factory(t){return new(t||AddonModH5PActivityUsersAttemptsPageModule)},imports:[[o.m.forChild(U),c.a],o.m]}),AddonModH5PActivityUsersAttemptsPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&p.kd(b,{declarations:[M],imports:[o.m,c.a],exports:[o.m]}))}}]);