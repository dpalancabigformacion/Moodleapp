(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{eoiU:function(t,i,s){"use strict";s.d(i,"a",(function(){return CoreSwipeNavigationItemsManager}));var o=s("mrSG"),n=s("pHTc"),e=s("CtbY");class CoreSwipeNavigationItemsManager extends e.a{start(){return Object(o.a)(this,void 0,void 0,(function*(){this.updateSelectedItem()}))}navigateToNextItem(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(1,"forward")}))}navigateToPreviousItem(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(-1,"back")}))}hasNextItem(){return Object(o.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(1))}))}hasPreviousItem(){return Object(o.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(-1))}))}getCurrentPageRoute(){return n.a.getCurrentRoute()}getSelectedItemPathFromRoute(t){const i=[];for(;t&&(i.push(...t.url),t.firstChild);)t=t.firstChild;return i.map((t=>t.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(t,i){return Object(o.a)(this,void 0,void 0,(function*(){const s=yield this.getItemBy(t);s&&(yield this.navigateToItem(s,{animationDirection:i,replace:!0}))}))}getItemBy(t){var i;return Object(o.a)(this,void 0,void 0,(function*(){const s=this.getSource().getItems(),o=null!==(i=this.selectedItem&&(null==s?void 0:s.indexOf(this.selectedItem)))&&void 0!==i?i:-1;if(-1===o||null===s)return null;const n=t>0?1:-1;let e=o,c=0;for(;c!==t&&(e+=n,!(e<0||e>=s.length));)this.skipItemInSwipe(s[e])||(c+=n);return c===t?s[e]:this.getSource().isCompleted()?null:(yield this.getSource().load(),this.getItemBy(t))}))}skipItemInSwipe(t){return!1}}},v7Sk:function(t,i,s){"use strict";s.r(i),s.d(i,"AddonForumDiscussionPageModule",(function(){return oi}));var o=s("tyNb"),n=s("AzLI"),e=s("MLi9"),c=s("L3Fv"),a=s("mrSG"),r=s("BaYo"),d=s("baaQ"),u=s("hSQQ"),l=s("FLKP"),m=s("y+FG"),h=s("R+GZ"),_=s("4pns"),f=s("TEn/"),g=s("GGba"),p=s("pHTc"),I=s("Y+03"),P=s("9+EE"),b=s("3LXp"),D=s("bFG1"),v=s("j3ag"),y=s("Wsfw"),A=s("6s78"),M=s("fjkH"),O=s("LVzu"),S=s("nFEd"),F=s("ZCW2"),E=s("VF9H"),T=s("h709"),C=s("pET4"),w=s("fXoL"),x=s("46ml");function AddonModForumDiscussionPage_h1_6_Template(t,i){if(1&t&&(w.Ec(0,"h1"),w.zc(1,"core-format-text",23),w.Dc()),2&t){const t=w.Oc();w.lc(1),w.Vc("text",t.startingPost.subject)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModForumDiscussionPage_core_context_menu_item_10_Template(t,i){if(1&t){const t=w.Fc();w.Ec(0,"core-context-menu-item",24),w.Mc("action",(function AddonModForumDiscussionPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(i){w.fd(t);return w.Oc().doRefresh(null,i)})),w.Pc(1,"translate"),w.Dc()}if(2&t){const t=w.Oc();w.Vc("priority",650)("content",w.Qc(1,4,"addon.mod_forum.refreshposts"))("iconAction",t.refreshIcon)("closeOnClick",!1)}}function AddonModForumDiscussionPage_core_context_menu_item_11_Template(t,i){if(1&t){const t=w.Fc();w.Ec(0,"core-context-menu-item",24),w.Mc("action",(function AddonModForumDiscussionPage_core_context_menu_item_11_Template_core_context_menu_item_action_0_listener(i){w.fd(t);return w.Oc().doRefresh(null,i,!0)})),w.Pc(1,"translate"),w.Dc()}if(2&t){const t=w.Oc();w.Vc("priority",550)("content",w.Qc(1,4,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1)}}const _c0=function(t){return{$a:t}};function AddonModForumDiscussionPage_ion_card_37_Template(t,i){if(1&t&&(w.Ec(0,"ion-card",25),w.Ec(1,"ion-item"),w.zc(2,"ion-icon",26),w.Ec(3,"ion-label"),w.pd(4),w.Pc(5,"translate"),w.Dc(),w.Dc(),w.Dc()),2&t){const t=w.Oc();w.lc(4),w.qd(w.Rc(5,1,"core.hasdatatosync",w.ad(4,_c0,t.discussionStr)))}}function AddonModForumDiscussionPage_ion_card_38_Template(t,i){if(1&t&&(w.Ec(0,"ion-card",27),w.Ec(1,"ion-item"),w.zc(2,"ion-icon",28),w.Ec(3,"ion-label"),w.pd(4),w.Dc(),w.Dc(),w.Dc()),2&t){const t=w.Oc();w.lc(4),w.qd(t.availabilityMessage)}}function AddonModForumDiscussionPage_ion_card_39_Template(t,i){1&t&&(w.Ec(0,"ion-card",27),w.Ec(1,"ion-item"),w.zc(2,"ion-icon",29),w.Ec(3,"ion-label"),w.pd(4),w.Pc(5,"translate"),w.Dc(),w.Dc(),w.Dc()),2&t&&(w.lc(4),w.qd(w.Qc(5,1,"addon.mod_forum.discussionlocked")))}function AddonModForumDiscussionPage_ion_card_40_Template(t,i){1&t&&(w.Ec(0,"ion-card",27),w.Ec(1,"ion-item"),w.zc(2,"ion-icon",28),w.Ec(3,"ion-label"),w.pd(4),w.Pc(5,"translate"),w.Dc(),w.Dc(),w.Dc()),2&t&&(w.lc(4),w.qd(w.Qc(5,1,"addon.mod_forum.qandanotify")))}function AddonModForumDiscussionPage_div_41_Template(t,i){if(1&t){const t=w.Fc();w.Ec(0,"div",30),w.Ec(1,"addon-mod-forum-post",31),w.Mc("onPostChange",(function AddonModForumDiscussionPage_div_41_Template_addon_mod_forum_post_onPostChange_1_listener(){w.fd(t);return w.Oc().postListChanged()})),w.Dc(),w.Dc()}if(2&t){const t=w.Oc();w.lc(1),w.Vc("post",t.startingPost)("discussion",t.discussion)("courseId",t.courseId)("highlight",!0)("discussionId",t.discussionId)("component",t.component)("componentId",t.cmId)("formData",t.formData)("originalData",t.originalData)("forum",t.forum)("accessInfo",t.accessInfo)("trackPosts",t.trackPosts)("ratingInfo",t.ratingInfo)("leavingPage",t.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template(t,i){1&t&&w.zc(0,"core-spacer")}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template(t,i){if(1&t){const t=w.Fc();w.Cc(0),w.nd(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template,1,0,"core-spacer",2),w.Ec(2,"addon-mod-forum-post",33),w.Mc("onPostChange",(function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template_addon_mod_forum_post_onPostChange_2_listener(){w.fd(t);return w.Oc(2).postListChanged()})),w.Dc(),w.Bc()}if(2&t){const t=i.$implicit,s=i.first,o=w.Oc(2);w.lc(1),w.Vc("ngIf",!s),w.lc(1),w.Vc("post",t)("courseId",o.courseId)("discussionId",o.discussionId)("component",o.component)("componentId",o.cmId)("formData",o.formData)("originalData",o.originalData)("parentSubject",o.postSubjects[t.parentid])("forum",o.forum)("accessInfo",o.accessInfo)("trackPosts",o.trackPosts)("ratingInfo",o.ratingInfo)("leavingPage",o.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_Template(t,i){if(1&t&&(w.Ec(0,"ion-card"),w.nd(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template,3,14,"ng-container",32),w.Dc()),2&t){const t=w.Oc();w.lc(1),w.Vc("ngForOf",t.posts)}}function AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template(t,i){1&t&&w.Ac(0)}const _c1=function(t){return{post:t}};function AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template(t,i){if(1&t&&(w.Cc(0),w.nd(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),w.Bc()),2&t){const t=i.$implicit;w.Oc(2);const s=w.ed(45);w.lc(1),w.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",w.ad(2,_c1,t))}}function AddonModForumDiscussionPage_ng_container_43_Template(t,i){if(1&t&&(w.Cc(0),w.nd(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template,2,4,"ng-container",32),w.Bc()),2&t){const t=w.Oc();w.lc(1),w.Vc("ngForOf",t.posts)}}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template(t,i){1&t&&w.Ac(0)}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template(t,i){if(1&t&&(w.Cc(0),w.nd(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),w.Bc()),2&t){const t=i.$implicit;w.Oc(3);const s=w.ed(45);w.lc(1),w.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",w.ad(2,_c1,t))}}function AddonModForumDiscussionPage_ng_template_44_div_2_Template(t,i){if(1&t&&(w.Ec(0,"div",36),w.nd(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template,2,4,"ng-container",32),w.Dc()),2&t){const t=w.Oc().post;w.lc(1),w.Vc("ngForOf",t.children)}}function AddonModForumDiscussionPage_ng_template_44_Template(t,i){if(1&t){const t=w.Fc();w.Ec(0,"ion-card"),w.Ec(1,"addon-mod-forum-post",33),w.Mc("onPostChange",(function AddonModForumDiscussionPage_ng_template_44_Template_addon_mod_forum_post_onPostChange_1_listener(){w.fd(t);return w.Oc().postListChanged()})),w.Dc(),w.Dc(),w.nd(2,AddonModForumDiscussionPage_ng_template_44_div_2_Template,2,1,"div",35)}if(2&t){const t=i.post,s=w.Oc();w.lc(1),w.Vc("post",t)("courseId",s.courseId)("discussionId",s.discussionId)("component",s.component)("componentId",s.cmId)("formData",s.formData)("originalData",s.originalData)("parentSubject",s.postSubjects[t.parentid])("forum",s.forum)("accessInfo",s.accessInfo)("trackPosts",s.trackPosts)("ratingInfo",s.ratingInfo)("leavingPage",s.leavingPage),w.lc(1),w.Vc("ngIf",t.children&&t.children.length&&t.children[0].subject)}}let k=(()=>{class AddonModForumDiscussionPage{constructor(t,i,s){this.splitView=t,this.elementRef=i,this.route=s,this.forum={},this.accessInfo={},this.posts=[],this.discussionLoaded=!1,this.sort="nested",this.formData={replyingTo:0,isEditing:!1,subject:"",message:null,files:[],isprivatereply:!1},this.originalData={subject:null,message:null,files:[],isprivatereply:!1},this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING,this.discussionStr="",this.component=F.b.COMPONENT,this.canPin=!1,this.availabilityMessage=null,this.showQAMessage=!1,this.leavingPage=!1,this.hasOfflineRatings=!1}get isMobile(){return I.a.isMobile}ngOnInit(){var t,i,s;return Object(a.a)(this,void 0,void 0,(function*(){try{const s=this.route.snapshot.data;this.courseId=p.a.getRouteNumberParam("courseId"),this.cmId=p.a.getRouteNumberParam("cmId"),this.forumId=p.a.getRouteNumberParam("forumId"),this.discussion=p.a.getRouteParam("discussion"),this.discussionId=this.discussion?this.discussion.discussion:p.a.getRequiredRouteNumberParam("discussionId"),this.trackPosts=p.a.getRouteBooleanParam("trackPosts")||!1,this.postId=p.a.getRouteNumberParam("postId"),this.parent=p.a.getRouteNumberParam("parent"),this.courseId&&this.cmId&&(null===(t=s.swipeEnabled)||void 0===t||t)&&(this.discussions=new discussion_page_AddonModForumDiscussionDiscussionsSwipeManager(d.a.getOrCreateSource(O.a,[this.courseId,this.cmId,null!==(i=s.discussionsPathPrefix)&&void 0!==i?i:""])),yield this.discussions.start())}catch(t){return b.a.showErrorModal(t),this.goBack(),void 0}this.isOnline=g.a.isOnline(),this.externalUrl=null===(s=P.b.getCurrentSite())||void 0===s?void 0:s.createSiteUrl("/mod/forum/discuss.php",{d:this.discussionId.toString()}),this.onlineObserver=g.a.onChange().subscribe((()=>{v.A.run((()=>{this.isOnline=g.a.isOnline()}))})),this.discussionStr=v.J.instant("addon.mod_forum.discussion")}))}ngAfterViewInit(){return Object(a.a)(this,void 0,void 0,(function*(){this.sort=this.parent?"nested":yield this.getUserSort(),yield this.fetchPosts(!0,!1,!0);const t=this.postId||this.parent;t&&A.a.scrollToElement(this.elementRef.nativeElement,"#addon-mod_forum-post-"+t)}))}ionViewDidEnter(){return Object(a.a)(this,void 0,void 0,(function*(){if(this.syncObserver)return;this.discussion||(yield this.loadDiscussion(this.discussionId,this.forumId,this.cmId));const t=this.discussion;this.syncObserver=M.b.on(C.b.AUTO_SYNCED,(t=>{t.forumId==this.forumId&&this.discussionId==t.discussionId&&t.userId==P.b.getCurrentSiteUserId()&&(this.discussionLoaded=!1,this.refreshPosts())}),P.b.getCurrentSiteId()),this.syncManualObserver=M.b.on(C.b.MANUAL_SYNCED,(t=>{"discussion"!=t.source&&t.forumId==this.forumId&&t.userId==P.b.getCurrentSiteUserId()&&(this.discussionLoaded=!1,this.refreshPosts())}),P.b.getCurrentSiteId()),this.forumId&&t&&t.numunread>0&&F.a.invalidateDiscussionsList(this.forumId),this.ratingOfflineObserver=M.b.on(l.b.RATING_SAVED_EVENT,(t=>{"mod_forum"==t.component&&"post"==t.ratingArea&&"module"==t.contextLevel&&t.instanceId==this.cmId&&t.itemSetId==this.discussionId&&(this.hasOfflineRatings=!0)})),this.ratingSyncObserver=M.b.on(h.b.SYNCED_EVENT,(t=>Object(a.a)(this,void 0,void 0,(function*(){"mod_forum"==t.component&&"post"==t.ratingArea&&"module"==t.contextLevel&&t.instanceId==this.cmId&&t.itemSetId==this.discussionId&&(this.hasOfflineRatings=!1)})))),this.changeDiscObserver=M.b.on(F.b.CHANGE_DISCUSSION_EVENT,(i=>{t&&this.forumId&&(this.forumId===i.forumId||i.cmId===this.cmId)&&F.a.invalidateDiscussionsList(this.forumId).finally((()=>{var s;void 0!==i.locked&&(t.locked=i.locked),void 0!==i.pinned&&(t.pinned=i.pinned),void 0!==i.starred&&(t.starred=i.starred),void 0!==i.deleted&&i.deleted&&((null===(s=i.post)||void 0===s?void 0:s.parentid)?(this.discussionLoaded=!1,this.refreshPosts()):this.goBack())}))}))}))}canLeave(){return Object(a.a)(this,void 0,void 0,(function*(){return E.a.hasPostDataChanged(this.formData,this.originalData)&&(yield b.a.showConfirm(v.J.instant("core.confirmcanceledit"))),u.a.clearTmpFiles(this.formData.files),this.leavingPage=!0,!0}))}goBack(){var t;this.leavingPage||((null===(t=this.splitView)||void 0===t?void 0:t.outletActivated)?p.a.navigate("../"):p.a.back())}ionViewWillLeave(){this.syncObserver&&this.syncObserver.off(),this.syncManualObserver&&this.syncManualObserver.off(),this.ratingOfflineObserver&&this.ratingOfflineObserver.off(),this.ratingSyncObserver&&this.ratingSyncObserver.off(),this.changeDiscObserver&&this.changeDiscObserver.off(),delete this.syncObserver}ngOnDestroy(){this.onlineObserver&&this.onlineObserver.unsubscribe(),this.discussions&&this.discussions.destroy()}getUserSort(){return Object(a.a)(this,void 0,void 0,(function*(){try{return yield P.b.getRequiredCurrentSite().getLocalSiteConfig("AddonModForumDiscussionSort")}catch(t){try{const t=yield _.a.getUserPreference("forum_displaymode");switch(Number(t)){case 1:return"flat-oldest";case-1:return"flat-newest";case 3:return"nested"}}catch(t){}}return"flat-oldest"}))}fetchForum(){if(this.courseId&&this.cmId)return F.a.getForum(this.courseId,this.cmId);if(this.courseId&&this.forumId)return F.a.getForumById(this.courseId,this.forumId);throw new Error("Cannot get the forum")}fetchPosts(t,i,s){return Object(a.a)(this,void 0,void 0,(function*(){let o=[];const n=[];let e=!1;try{t&&(yield D.a.ignoreErrors(this.syncDiscussion(!!i)));const c=yield F.a.getDiscussionPosts(this.discussionId,{cmId:this.cmId}),d=yield T.a.getDiscussionReplies(this.discussionId);this.ratingInfo=c.ratinginfo,o=c.posts,this.courseId=c.courseid||this.courseId,this.forumId=c.forumid||this.forumId,this.postHasOffline=!!d.length;const u=[],l={};o.forEach((t=>{l[t.id]=t,e=e||!!t.unread})),d.forEach((t=>{this.forumId||(this.forumId=t.forumid),this.courseId||(this.courseId=t.courseid),u.push(E.a.instance.convertOfflineReplyToOnline(t).then((t=>Object(a.a)(this,void 0,void 0,(function*(){n.push(t),t.parentid&&(l[t.parentid].capabilities.reply=!1)})))))})),yield Promise.all(u),o=D.a.objectToArray(l);let h=n.concat(o);if(this.startingPost=F.a.extractStartingPost(h),"nested"==this.sort){F.a.sortDiscussionPosts(h,"ASC");h=D.a.formatTree(h,"parentid","id",this.startingPost?this.startingPost.id:this.discussion?this.discussion.id:0)}else{F.a.sortDiscussionPosts(h,"flat-newest"==this.sort?"DESC":"ASC")}try{const t=yield this.fetchForum();void 0!==t.istracked&&(this.trackPosts=t.istracked),this.forumId=t.id,this.cmId=t.cmid,this.courseId=t.course,this.forum=t,this.availabilityMessage=E.a.getAvailabilityMessage(t);const i=[];i.push(F.a.instance.getAccessInformation(this.forumId,{cmId:this.cmId}).then((i=>Object(a.a)(this,void 0,void 0,(function*(){this.accessInfo=i,E.a.isCutoffDateReached(t)&&!i.cancanoverridecutoff&&h.forEach((t=>{t.capabilities.reply=!1}));const s=P.b.getCurrentSiteUserId();this.showQAMessage="qanda"===t.type&&!i.canviewqandawithoutposting&&!h.some((t=>t.author.id===s))}))))),this.discussion||i.push(this.loadDiscussion(this.discussionId,this.forumId,this.cmId)),yield Promise.all(i)}catch(t){}if(!this.discussion&&!this.startingPost)throw new Error("Invalid forum discussion.");if(this.startingPost&&this.startingPost.author&&"single"==this.forum.type&&(delete this.startingPost.author.fullname,delete this.startingPost.author.groups),this.posts=h,this.postSubjects=this.getAllPosts().reduce(((t,i)=>(t[i.id]=i.subject,t)),this.startingPost?{[this.startingPost.id]:this.startingPost.subject}:{}),F.a.isSetPinStateAvailableForSite()&&this.forumId)try{const t=yield F.a.canAddDiscussionToAll(this.forumId,{cmId:this.cmId});this.canPin=!!t.canpindiscussions}catch(t){this.canPin=!1}else this.canPin=!1;this.hasOfflineRatings=yield m.a.hasRatings("mod_forum","post","module",this.cmId,this.discussionId)}catch(t){b.a.showErrorModal(t)}finally{this.discussionLoaded=!0,this.refreshIcon=r.a.ICON_REFRESH,this.syncIcon=r.a.ICON_SYNC,(s||e&&this.trackPosts)&&F.a.logDiscussionView(this.discussionId,this.forumId||-1,this.forum.name).catch((()=>{})).finally((()=>{this.courseId&&this.cmId&&M.b.trigger(F.b.MARK_READ_EVENT,{courseId:this.courseId,moduleId:this.cmId},P.b.getCurrentSiteId())}))}}))}loadDiscussion(t,i,s){return Object(a.a)(this,void 0,void 0,(function*(){!this.discussion&&i&&s&&(this.discussion=yield E.a.getDiscussionById(i,s,t),this.discussionId=this.discussion.discussion)}))}syncDiscussion(t){return Object(a.a)(this,void 0,void 0,(function*(){const i=[];i.push(C.a.instance.syncDiscussionReplies(this.discussionId).then((t=>{t.warnings&&t.warnings.length&&b.a.showErrorModal(t.warnings[0]),t&&t.updated&&this.forumId&&M.b.trigger(C.b.MANUAL_SYNCED,{forumId:this.forumId,userId:P.b.getCurrentSiteUserId(),source:"discussion"},P.b.getCurrentSiteId())}))),i.push(C.a.instance.syncRatings(this.cmId,this.discussionId).then((t=>{t.warnings&&t.warnings.length&&b.a.showErrorModal(t.warnings[0])})));try{yield Promise.all(i)}catch(i){throw t&&b.a.showErrorModalDefault(i,"core.errorsync",!0),new Error("Failed syncing discussion")}}))}doRefresh(t,i,s=!1){return Object(a.a)(this,void 0,void 0,(function*(){this.discussionLoaded&&(yield this.refreshPosts(!0,s).finally((()=>{null==t?void 0:t.complete(),i&&i()})))}))}refreshPosts(t,i){return Object(a.a)(this,void 0,void 0,(function*(){this.content.scrollToTop(),this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING;const s=[];this.courseId&&s.push(F.a.invalidateForumData(this.courseId)),s.push(F.a.invalidateDiscussionPosts(this.discussionId,this.forumId)),this.forumId&&s.push(F.a.invalidateAccessInformation(this.forumId)),this.forumId&&s.push(F.a.invalidateCanAddDiscussion(this.forumId)),yield D.a.ignoreErrors(D.a.allPromises(s)),yield this.fetchPosts(t,i)}))}changeSort(t){return this.discussionLoaded=!1,this.sort=t,P.b.getRequiredCurrentSite().setLocalSiteConfig("AddonModForumDiscussionSort",this.sort),this.content.scrollToTop(),this.fetchPosts()}setLockState(t){return Object(a.a)(this,void 0,void 0,(function*(){if(!this.discussion||!this.forumId||!this.cmId)return;const i=yield b.a.showModalLoading("core.sending",!0);try{const s=yield F.a.setLockState(this.forumId,this.discussionId,t);this.discussion.locked=s.locked;M.b.trigger(F.b.CHANGE_DISCUSSION_EVENT,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId,locked:this.discussion.locked},P.b.getCurrentSiteId()),b.a.showToast("addon.mod_forum.lockupdated",!0)}catch(t){b.a.showErrorModal(t)}finally{i.dismiss()}}))}setPinState(t){return Object(a.a)(this,void 0,void 0,(function*(){if(!this.discussion||!this.forumId||!this.cmId)return;const i=yield b.a.showModalLoading("core.sending",!0);try{yield F.a.setPinState(this.discussionId,t),this.discussion.pinned=t;M.b.trigger(F.b.CHANGE_DISCUSSION_EVENT,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId,pinned:this.discussion.pinned},P.b.getCurrentSiteId()),b.a.showToast("addon.mod_forum.pinupdated",!0)}catch(t){b.a.showErrorModal(t)}finally{i.dismiss()}}))}toggleFavouriteState(t){return Object(a.a)(this,void 0,void 0,(function*(){if(!this.discussion||!this.forumId||!this.cmId)return;const i=yield b.a.showModalLoading("core.sending",!0);try{yield F.a.toggleFavouriteState(this.discussionId,t),this.discussion.starred=t;M.b.trigger(F.b.CHANGE_DISCUSSION_EVENT,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId,starred:this.discussion.starred},P.b.getCurrentSiteId()),b.a.showToast("addon.mod_forum.favouriteupdated",!0)}catch(t){b.a.showErrorModal(t)}finally{i.dismiss()}}))}postListChanged(){if(!this.forumId||!this.cmId)return;M.b.trigger(F.b.REPLY_DISCUSSION_EVENT,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId},P.b.getCurrentSiteId()),this.discussionLoaded=!1,this.refreshPosts().finally((()=>{this.discussionLoaded=!0}))}getAllPosts(){const t=this.posts.map((t=>this.flattenPostHierarchy(t)));return y.a.flatten(t)}flattenPostHierarchy(t){const i=[t],s=t.children||[];for(const t of s)i.push(...this.flattenPostHierarchy(t));return i}}return AddonModForumDiscussionPage.ɵfac=function AddonModForumDiscussionPage_Factory(t){return new(t||AddonModForumDiscussionPage)(w.yc(x.a,8),w.yc(w.r),w.yc(o.a))},AddonModForumDiscussionPage.ɵcmp=w.sc({type:AddonModForumDiscussionPage,selectors:[["page-addon-mod-forum-discussion"]],viewQuery:function AddonModForumDiscussionPage_Query(t,i){var s;(1&t&&w.ud(f.v,!0),2&t)&&(w.dd(s=w.Nc())&&(i.content=s.first))},decls:46,vars:73,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[3,"priority","content","iconAction","closeOnClick","action",4,"ngIf"],["iconAction","fas-arrow-down",3,"hidden","priority","content","action"],["iconAction","fas-arrow-up",3,"hidden","priority","content","action"],["iconAction","fas-exchange-alt",3,"hidden","priority","content","action"],["iconAction","fas-lock",3,"hidden","priority","content","action"],["iconAction","fas-unlock",3,"hidden","priority","content","action"],["iconAction","fas-map-pin",3,"hidden","priority","content","action"],["iconAction","fas-map-pin",3,"hidden","priority","content","iconSlash","action"],["iconAction","fas-star",3,"hidden","priority","content","action"],["iconAction","fas-star",3,"hidden","priority","content","iconSlash","action"],["iconAction","fas-external-link-alt",3,"hidden","priority","content","href","showBrowserWarning"],[1,"limited-width",3,"core-swipe-navigation"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],["class","core-info-card",4,"ngIf"],["class","ion-margin-bottom",4,"ngIf"],["nestedPosts",""],["contextLevel","module",3,"text","contextInstanceId","courseId"],[3,"priority","content","iconAction","closeOnClick","action"],[1,"core-warning-card"],["name","fas-exclamation-triangle","slot","start","aria-hidden","true"],[1,"core-info-card"],["name","fas-info-circle","slot","start","aria-hidden","true"],["name","fas-lock","slot","start","aria-hidden","true"],[1,"ion-margin-bottom"],[3,"post","discussion","courseId","highlight","discussionId","component","componentId","formData","originalData","forum","accessInfo","trackPosts","ratingInfo","leavingPage","onPostChange"],[4,"ngFor","ngForOf"],[3,"post","courseId","discussionId","component","componentId","formData","originalData","parentSubject","forum","accessInfo","trackPosts","ratingInfo","leavingPage","onPostChange"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","ion-padding-start",4,"ngIf"],[1,"ion-padding-start"]],template:function AddonModForumDiscussionPage_Template(t,i){1&t&&(w.Ec(0,"ion-header"),w.Ec(1,"ion-toolbar"),w.Ec(2,"ion-buttons",0),w.zc(3,"ion-back-button",1),w.Pc(4,"translate"),w.Dc(),w.Ec(5,"ion-title"),w.nd(6,AddonModForumDiscussionPage_h1_6_Template,2,3,"h1",2),w.Dc(),w.zc(7,"ion-buttons",3),w.Dc(),w.Dc(),w.Ec(8,"core-navbar-buttons",3),w.Ec(9,"core-context-menu"),w.nd(10,AddonModForumDiscussionPage_core_context_menu_item_10_Template,2,6,"core-context-menu-item",4),w.nd(11,AddonModForumDiscussionPage_core_context_menu_item_11_Template,2,6,"core-context-menu-item",4),w.Ec(12,"core-context-menu-item",5),w.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_12_listener(){return i.changeSort("flat-oldest")})),w.Pc(13,"translate"),w.Dc(),w.Ec(14,"core-context-menu-item",6),w.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_14_listener(){return i.changeSort("flat-newest")})),w.Pc(15,"translate"),w.Dc(),w.Ec(16,"core-context-menu-item",7),w.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_16_listener(){return i.changeSort("nested")})),w.Pc(17,"translate"),w.Dc(),w.Ec(18,"core-context-menu-item",8),w.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_18_listener(){return i.setLockState(!0)})),w.Pc(19,"translate"),w.Dc(),w.Ec(20,"core-context-menu-item",9),w.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_20_listener(){return i.setLockState(!1)})),w.Pc(21,"translate"),w.Dc(),w.Ec(22,"core-context-menu-item",10),w.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_22_listener(){return i.setPinState(!0)})),w.Pc(23,"translate"),w.Dc(),w.Ec(24,"core-context-menu-item",11),w.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_24_listener(){return i.setPinState(!1)})),w.Pc(25,"translate"),w.Dc(),w.Ec(26,"core-context-menu-item",12),w.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_26_listener(){return i.toggleFavouriteState(!0)})),w.Pc(27,"translate"),w.Dc(),w.Ec(28,"core-context-menu-item",13),w.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_28_listener(){return i.toggleFavouriteState(!1)})),w.Pc(29,"translate"),w.Dc(),w.zc(30,"core-context-menu-item",14),w.Pc(31,"translate"),w.Dc(),w.Dc(),w.Ec(32,"ion-content",15),w.Ec(33,"ion-refresher",16),w.Mc("ionRefresh",(function AddonModForumDiscussionPage_Template_ion_refresher_ionRefresh_33_listener(t){return i.doRefresh(t.target)})),w.zc(34,"ion-refresher-content",17),w.Pc(35,"translate"),w.Dc(),w.Ec(36,"core-loading",18),w.nd(37,AddonModForumDiscussionPage_ion_card_37_Template,6,6,"ion-card",19),w.nd(38,AddonModForumDiscussionPage_ion_card_38_Template,5,1,"ion-card",20),w.nd(39,AddonModForumDiscussionPage_ion_card_39_Template,6,3,"ion-card",20),w.nd(40,AddonModForumDiscussionPage_ion_card_40_Template,6,3,"ion-card",20),w.nd(41,AddonModForumDiscussionPage_div_41_Template,2,14,"div",21),w.nd(42,AddonModForumDiscussionPage_ion_card_42_Template,2,1,"ion-card",2),w.nd(43,AddonModForumDiscussionPage_ng_container_43_Template,2,1,"ng-container",2),w.nd(44,AddonModForumDiscussionPage_ng_template_44_Template,3,14,"ng-template",null,22,w.od),w.Dc(),w.Dc()),2&t&&(w.lc(3),w.Vc("text",w.Qc(4,49,"core.back")),w.lc(3),w.Vc("ngIf",i.startingPost),w.lc(4),w.Vc("ngIf",i.discussionLoaded&&!i.postHasOffline&&i.isOnline),w.lc(1),w.Vc("ngIf",i.discussionLoaded&&i.isMobile&&i.postHasOffline&&i.isOnline),w.lc(1),w.Vc("hidden","flat-oldest"==i.sort)("priority",500)("content",w.Qc(13,51,"addon.mod_forum.modeflatoldestfirst")),w.lc(2),w.Vc("hidden","flat-newest"==i.sort)("priority",450)("content",w.Qc(15,53,"addon.mod_forum.modeflatnewestfirst")),w.lc(2),w.Vc("hidden","nested"==i.sort)("priority",400)("content",w.Qc(17,55,"addon.mod_forum.modenested")),w.lc(2),w.Vc("hidden",!i.discussion||!i.discussion.canlock||i.discussion.locked)("priority",300)("content",w.Qc(19,57,"addon.mod_forum.lockdiscussion")),w.lc(2),w.Vc("hidden",!i.discussion||!i.discussion.canlock||!i.discussion.locked)("priority",300)("content",w.Qc(21,59,"addon.mod_forum.unlockdiscussion")),w.lc(2),w.Vc("hidden",!i.discussion||!i.canPin||i.discussion.pinned)("priority",250)("content",w.Qc(23,61,"addon.mod_forum.pindiscussion")),w.lc(2),w.Vc("hidden",!i.discussion||!i.canPin||!i.discussion.pinned)("priority",250)("content",w.Qc(25,63,"addon.mod_forum.unpindiscussion"))("iconSlash",!0),w.lc(2),w.Vc("hidden",!i.discussion||!i.discussion.canfavourite||i.discussion.starred)("priority",200)("content",w.Qc(27,65,"addon.mod_forum.addtofavourites")),w.lc(2),w.Vc("hidden",!i.discussion||!i.discussion.canfavourite||!i.discussion.starred)("priority",200)("content",w.Qc(29,67,"addon.mod_forum.removefromfavourites"))("iconSlash",!0),w.lc(2),w.Vc("hidden",!i.externalUrl)("priority",100)("content",w.Qc(31,69,"core.openinbrowser"))("href",i.externalUrl)("showBrowserWarning",!1),w.lc(2),w.Vc("core-swipe-navigation",i.discussions),w.lc(1),w.Vc("disabled",!i.discussionLoaded),w.lc(1),w.Wc("pullingText",w.Qc(35,71,"core.pulltorefresh")),w.lc(2),w.Vc("hideUntil",i.discussionLoaded),w.lc(1),w.Vc("ngIf",i.postHasOffline||i.hasOfflineRatings),w.lc(1),w.Vc("ngIf",i.availabilityMessage),w.lc(1),w.Vc("ngIf",i.discussion&&i.discussion.locked),w.lc(1),w.Vc("ngIf",i.showQAMessage),w.lc(1),w.Vc("ngIf",i.startingPost),w.lc(1),w.Vc("ngIf","nested"!=i.sort&&i.posts.length),w.lc(1),w.Vc("ngIf","nested"==i.sort&&i.posts.length))},styles:["[_nghost-%COMP%]   .addon-forum-reply-button[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin:0}"]}),AddonModForumDiscussionPage})();class discussion_page_AddonModForumDiscussionDiscussionsSwipeManager extends S.a{getSelectedItemPathFromRoute(t){return this.getSource().DISCUSSIONS_PATH_PREFIX+t.params.discussionId}}var N=s("ofXK"),V=s("M9y5"),L=s("aEIl"),R=s("3zv0"),j=s("Lmwl"),Q=s("4qNr"),U=s("fQ68"),B=s("8/N+"),H=s("0QZc"),G=s("uHIS"),z=s("w+Pn"),q=s("r8G5"),J=s("5450"),Y=s("W5pS"),W=s("WPIK"),K=s("p+Qc"),X=s("qNqN"),Z=s("xpMl"),$=s("FTxb"),tt=s("PgjG"),it=s("/K1O"),st=s("FasJ"),ot=s("9pYf"),nt=s("eAud"),et=s("ACV2"),ct=s("/BoF"),at=s("TKc2"),rt=s("whRm"),dt=s("O4u7"),ut=s("lqoc"),lt=s("3lz8"),mt=s("QQhE"),ht=s("MpCO"),_t=s("JYLr"),ft=s("vWwc"),gt=s("NhJP"),pt=s("rztj"),It=s("FeAf"),Pt=s("rf3J"),bt=s("nEkO"),Dt=s("TF0o"),vt=s("p5uK"),yt=s("6uVz"),At=s("d0nH"),Mt=s("NcPy"),Ot=s("yNDK"),St=s("3CSS"),Ft=s("hMzs"),Et=s("iSJP"),Tt=s("iJls"),Ct=s("ArDJ"),wt=s("nu3w"),xt=s("saTE"),kt=s("8PoL"),Nt=s("4a38"),Vt=s("4JiN"),Lt=s("OZH1"),Rt=s("edOc"),jt=s("3jOR"),Qt=s("nt/U"),Ut=s("ACYt"),Bt=s("6A9T"),Ht=s("3Pt+"),Gt=s("sYmb"),zt=s("GsO6"),qt=s("L5yw"),Jt=s("1iFe"),Yt=s("dne1"),Wt=s("Cg42"),Kt=s("llyR"),Xt=s("uYHD"),Zt=s("SspJ"),$t=s("U2xU"),ti=s("lAaw"),ii=s("1ArG");const si=[{path:"",component:k,canDeactivate:[e.a]}];let oi=(()=>{class AddonForumDiscussionPageModule{}return AddonForumDiscussionPageModule.ɵmod=w.wc({type:AddonForumDiscussionPageModule}),AddonForumDiscussionPageModule.ɵinj=w.vc({factory:function AddonForumDiscussionPageModule_Factory(t){return new(t||AddonForumDiscussionPageModule)},imports:[[o.m.forChild(si),c.a,n.a]]}),AddonForumDiscussionPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&w.kd(oi,{declarations:[k],imports:[o.m,c.a,n.a]})),w.jd(k,[o.n,o.j,o.l,o.k,o.p,N.q,N.r,N.s,N.t,N.A,N.w,N.x,N.y,N.z,N.u,N.v,V.a,L.a,R.a,j.a,Q.a,U.a,B.a,H.a,G.a,z.a,q.a,J.a,Y.a,W.a,K.a,X.a,Z.a,$.a,tt.a,it.a,st.a,ot.a,nt.a,et.a,ct.a,at.a,rt.a,dt.a,ut.a,lt.a,x.a,mt.a,ht.a,_t.a,ft.a,gt.a,pt.a,It.a,Pt.a,bt.a,Dt.a,vt.a,yt.a,At.a,Mt.a,Ot.a,St.a,Ft.a,Et.a,Tt.a,Ct.a,wt.a,xt.a,kt.a,Nt.a,Vt.b,Lt.a,Rt.a,jt.a,Qt.a,Ut.a,Bt.a,Ht.H,Ht.w,Ht.G,Ht.c,Ht.x,Ht.A,Ht.a,Ht.D,Ht.E,Ht.z,Ht.r,Ht.s,Ht.C,Ht.o,Ht.n,Ht.y,Ht.b,Ht.d,Ht.u,Ht.v,Ht.t,f.f,f.g,f.h,f.j,f.k,f.l,f.m,f.n,f.o,f.p,f.q,f.r,f.s,f.t,f.u,f.v,f.w,f.x,f.y,f.z,f.A,f.B,f.C,f.D,f.E,f.F,f.G,f.H,f.I,f.J,f.K,f.L,f.M,f.N,f.O,f.P,f.Q,f.R,f.S,f.T,f.U,f.V,f.W,f.X,f.Y,f.Z,f.ab,f.bb,f.cb,f.db,f.eb,f.fb,f.hb,f.ib,f.jb,f.kb,f.lb,f.mb,f.nb,f.ob,f.pb,f.qb,f.rb,f.sb,f.tb,f.vb,f.wb,f.xb,f.zb,f.Ab,f.yb,f.ub,f.d,f.Jb,f.Mb,f.Ob,f.Pb,f.gb,f.i,f.Hb,f.Nb,f.Rb,f.Sb,f.Tb,f.Bb,Ht.h,Ht.k,Ht.i,Ht.l,Ht.e,Gt.a,zt.a,qt.a,k],[N.b,N.G,N.p,N.k,N.E,N.g,N.C,N.F,N.d,N.f,N.i,N.j,N.l,Jt.a,Yt.a,Wt.a,Kt.a,Xt.a,Zt.a,$t.a,ti.a,ii.a,Gt.d])}}]);