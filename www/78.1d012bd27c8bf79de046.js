(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{"Y/uQ":function(t,e,r){"use strict";r.r(e),r.d(e,"AddonModScormLazyModule",(function(){return Y}));var o=r("tyNb"),i=r("L3Fv"),s=r("snYc"),a=r("ghUQ"),c=r("kGPB"),n=r("fXoL"),d=r("TEn/"),l=r("4JiN"),m=r("hMzs"),h=r("nt/U"),u=r("sYmb");let f=(()=>{class AddonModScormIndexPage extends a.a{}return AddonModScormIndexPage.ɵfac=function AddonModScormIndexPage_Factory(t){return p(t||AddonModScormIndexPage)},AddonModScormIndexPage.ɵcmp=n.sc({type:AddonModScormIndexPage,selectors:[["page-addon-mod-scorm-index"]],viewQuery:function AddonModScormIndexPage_Query(t,e){var r;(1&t&&n.ud(c.a,!0),2&t)&&(n.dd(r=n.Nc())&&(e.activityComponent=r.first))},features:[n.ic],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","dataRetrieved"]],template:function AddonModScormIndexPage_Template(t,e){1&t&&(n.Ec(0,"ion-header",0),n.Ec(1,"ion-toolbar"),n.Ec(2,"ion-buttons",1),n.zc(3,"ion-back-button",2),n.Pc(4,"translate"),n.Dc(),n.Ec(5,"ion-title"),n.Ec(6,"h1"),n.zc(7,"core-format-text",3),n.Dc(),n.Dc(),n.zc(8,"ion-buttons",4),n.Dc(),n.Dc(),n.Ec(9,"ion-content",5),n.Ec(10,"ion-refresher",6),n.Mc("ionRefresh",(function AddonModScormIndexPage_Template_ion_refresher_ionRefresh_10_listener(t){return null==e.activityComponent?null:e.activityComponent.doRefresh(t.target)})),n.zc(11,"ion-refresher-content",7),n.Pc(12,"translate"),n.Dc(),n.Ec(13,"addon-mod-scorm-index",8),n.Mc("dataRetrieved",(function AddonModScormIndexPage_Template_addon_mod_scorm_index_dataRetrieved_13_listener(t){return e.updateData(t)})),n.Dc(),n.Dc()),2&t&&(n.lc(3),n.Vc("text",n.Qc(4,8,"core.back")),n.lc(4),n.Vc("text",e.title)("contextInstanceId",null==e.module?null:e.module.id)("courseId",e.courseId),n.lc(3),n.Vc("disabled",null==e.activityComponent?null:e.activityComponent.showLoading),n.lc(1),n.Wc("pullingText",n.Qc(12,10,"core.pulltorefresh")),n.lc(2),n.Vc("module",e.module)("courseId",e.courseId))},directives:[d.C,l.b,d.Ab,d.m,d.h,d.i,d.yb,m.a,h.a,d.v,d.bb,d.cb,c.a],pipes:[u.d],encapsulation:2}),AddonModScormIndexPage})();const p=n.Gc(f);var _=r("mrSG"),v=r("pHTc"),g=r("9+EE"),I=r("uT8i"),w=r("3LXp"),b=r("Q98t"),E=r("bFG1"),M=r("fjkH"),S=r("bKlM");const y="^[\\u0000-\\uFFFF]{0,255}$",T="^[\\u0000-\\uFFFF]{0,4096}$",A="^([0-2]{1}[0-9]{1}):([0-5]{1}[0-9]{1}):([0-5]{1}[0-9]{1})(.[0-9]{1,2})?$",D="^([0-9]{2,4}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$",P="^-?([0-9]+)$",O="^-?([0-9]{0,3})(.[0-9]*)?$",x="^[\\u0021-\\u007E]{0,255}$",C=y,N="[._](\\d+).",U="raw,min,max",$="0#100",k={0:"No error",101:"General exception",201:"Invalid argument error",202:"Element cannot have children",203:"Element not an array - cannot have count",301:"Not initialized",401:"Not implemented error",402:"Invalid set value, element is a keyword",403:"Element is read only",404:"Element is write only",405:"Incorrect data type"};class data_model_12_AddonModScormDataModel12{constructor(t,e,r,o,i,s=S.b.MODENORMAL,a=!1,c=!0){this.siteId=t,this.scorm=e,this.scoId=r,this.attempt=o,this.userData=i,this.mode=s,this.offline=a,this.canSaveTracks=c,this.currentUserData={},this.def={},this.defExtra={},this.dataModel={},this.initialized=!1,this.errorCode="0",this.init(i)}addTime(t,e){const r=t.split(":"),o=e.split(":"),i=r[2].split("."),s=o[2].split(".");let a=0,c=0;i.length>1&&(c=parseInt(i[1],10));let n=0;s.length>1&&(n=parseInt(s[1],10));let d=c+n;a=Math.floor(d/100),d-=100*a,Math.floor(d)<10&&(d="0"+d.toString());let l=parseInt(i[0],10)+parseInt(s[0],10)+a;a=Math.floor(l/60),l-=60*a,Math.floor(l)<10&&(l="0"+l.toString());let m=parseInt(r[1],10)+parseInt(o[1],10)+a;a=Math.floor(m/60),m-=60*a,m<10&&(m="0"+m.toString());let h=parseInt(r[0],10)+parseInt(o[0],10)+a;return h<10&&(h="0"+h.toString()),"0"!=d?h+":"+m+":"+l+"."+d:h+":"+m+":"+l}collectData(){if(!this.currentUserData[this.scoId])return[];const t=[];for(const e in this.currentUserData[this.scoId].userdata){if("cmi"!=e.substring(0,3)||"cmi.core.session_time"==e)continue;const r=new RegExp(N,"g"),o=e.replace(r,".n.");if(void 0===this.dataModel[this.scoId][e]&&void 0!==this.dataModel[this.scoId][o]&&(this.dataModel[this.scoId][e]=E.a.clone(this.dataModel[this.scoId][o])),void 0===this.dataModel[this.scoId][e]||"r"==this.dataModel[this.scoId][e].mod)continue;const i={element:e.replace(r,"_$1."),value:this.getEl(e)};void 0!==this.dataModel[this.scoId][e].defaultvalue?this.dataModel[this.scoId][e].defaultvalue!==i.value&&(t.push(i),this.dataModel[this.scoId][e].defaultvalue=i.value):(t.push(i),this.dataModel[this.scoId][e].defaultvalue=i.value)}return t}getEl(t){return this.currentUserData[this.scoId]&&void 0!==this.currentUserData[this.scoId].userdata[t]?this.currentUserData[this.scoId].userdata[t]:""}init(t){var e,r,o,i,s,a,c;for(const e in t){const r=t[e];this.def[e]=r.defaultdata,this.defExtra[e]=r.userdata}for(const t in this.def){this.dataModel[t]={"cmi._children":{defaultvalue:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions",mod:"r",writeerror:"402"},"cmi._version":{defaultvalue:"3.4",mod:"r",writeerror:"402"},"cmi.core._children":{defaultvalue:"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time",mod:"r",writeerror:"402"},"cmi.core.student_id":{defaultvalue:this.def[t]["cmi.core.student_id"],mod:"r",writeerror:"403"},"cmi.core.student_name":{defaultvalue:this.def[t]["cmi.core.student_name"],mod:"r",writeerror:"403"},"cmi.core.lesson_location":{defaultvalue:this.def[t]["cmi.core.lesson_location"],format:y,mod:"rw",writeerror:"405"},"cmi.core.credit":{defaultvalue:this.def[t]["cmi.core.credit"],mod:"r",writeerror:"403"},"cmi.core.lesson_status":{defaultvalue:this.def[t]["cmi.core.lesson_status"],format:"^passed$|^completed$|^failed$|^incomplete$|^browsed$",mod:"rw",writeerror:"405"},"cmi.core.entry":{defaultvalue:this.def[t]["cmi.core.entry"],mod:"r",writeerror:"403"},"cmi.core.score._children":{defaultvalue:U,mod:"r",writeerror:"402"},"cmi.core.score.raw":{defaultvalue:this.def[t]["cmi.core.score.raw"],format:O,range:$,mod:"rw",writeerror:"405"},"cmi.core.score.max":{defaultvalue:this.def[t]["cmi.core.score.max"],format:O,range:$,mod:"rw",writeerror:"405"},"cmi.core.score.min":{defaultvalue:this.def[t]["cmi.core.score.min"],format:O,range:$,mod:"rw",writeerror:"405"},"cmi.core.total_time":{defaultvalue:this.def[t]["cmi.core.total_time"],mod:"r",writeerror:"403"},"cmi.core.lesson_mode":{defaultvalue:this.def[t]["cmi.core.lesson_mode"],mod:"r",writeerror:"403"},"cmi.core.exit":{defaultvalue:this.def[t]["cmi.core.exit"],format:"^time-out$|^suspend$|^logout$|^$",mod:"w",readerror:"404",writeerror:"405"},"cmi.core.session_time":{format:D,mod:"w",defaultvalue:"00:00:00",readerror:"404",writeerror:"405"},"cmi.suspend_data":{defaultvalue:this.def[t]["cmi.suspend_data"],format:T,mod:"rw",writeerror:"405"},"cmi.launch_data":{defaultvalue:this.def[t]["cmi.launch_data"],mod:"r",writeerror:"403"},"cmi.comments":{defaultvalue:this.def[t]["cmi.comments"],format:T,mod:"rw",writeerror:"405"},"cmi.evaluation.comments._count":{defaultvalue:"0",mod:"r",writeerror:"402"},"cmi.evaluation.comments._children":{defaultvalue:"content,location,time",mod:"r",writeerror:"402"},"cmi.evaluation.comments.n.content":{defaultvalue:"",pattern:N,format:y,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.location":{defaultvalue:"",pattern:N,format:y,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.time":{defaultvalue:"",pattern:N,format:A,mod:"rw",writeerror:"405"},"cmi.comments_from_lms":{mod:"r",writeerror:"403"},"cmi.objectives._children":{defaultvalue:"id,score,status",mod:"r",writeerror:"402"},"cmi.objectives._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.objectives.n.id":{pattern:N,format:x,mod:"rw",writeerror:"405"},"cmi.objectives.n.score._children":{pattern:N,mod:"r",writeerror:"402"},"cmi.objectives.n.score.raw":{defaultvalue:"",pattern:N,format:O,range:$,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.min":{defaultvalue:"",pattern:N,format:O,range:$,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.max":{defaultvalue:"",pattern:N,format:O,range:$,mod:"rw",writeerror:"405"},"cmi.objectives.n.status":{pattern:N,format:"^passed$|^completed$|^failed$|^incomplete$|^browsed$|^not attempted$",mod:"rw",writeerror:"405"},"cmi.student_data._children":{defaultvalue:"mastery_score,max_time_allowed,time_limit_action",mod:"r",writeerror:"402"},"cmi.student_data.mastery_score":{defaultvalue:this.def[t]["cmi.student_data.mastery_score"],mod:"r",writeerror:"403"},"cmi.student_data.max_time_allowed":{defaultvalue:this.def[t]["cmi.student_data.max_time_allowed"],mod:"r",writeerror:"403"},"cmi.student_data.time_limit_action":{defaultvalue:this.def[t]["cmi.student_data.time_limit_action"],mod:"r",writeerror:"403"},"cmi.student_preference._children":{defaultvalue:"audio,language,speed,text",mod:"r",writeerror:"402"},"cmi.student_preference.audio":{defaultvalue:this.def[t]["cmi.student_preference.audio"],format:P,range:"-1#100",mod:"rw",writeerror:"405"},"cmi.student_preference.language":{defaultvalue:this.def[t]["cmi.student_preference.language"],format:y,mod:"rw",writeerror:"405"},"cmi.student_preference.speed":{defaultvalue:this.def[t]["cmi.student_preference.speed"],format:P,range:"-100#100",mod:"rw",writeerror:"405"},"cmi.student_preference.text":{defaultvalue:this.def[t]["cmi.student_preference.text"],format:P,range:"-1#1",mod:"rw",writeerror:"405"},"cmi.interactions._children":{defaultvalue:"id,objectives,time,type,correct_responses,weighting,student_response,result,latency",mod:"r",writeerror:"402"},"cmi.interactions._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.id":{pattern:N,format:x,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.objectives._count":{pattern:N,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.objectives.n.id":{pattern:N,format:x,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.time":{pattern:N,format:A,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.type":{pattern:N,format:"^true-false$|^choice$|^fill-in$|^matching$|^performance$|^sequencing$|^likert$|^numeric$",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.correct_responses._count":{pattern:N,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.correct_responses.n.pattern":{pattern:N,format:C,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.weighting":{pattern:N,format:O,range:"-100#100",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.student_response":{pattern:N,format:C,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.result":{pattern:N,format:"^correct$|^wrong$|^unanticipated$|^neutral$|^([0-9]{0,3})?(.[0-9]*)?$",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.latency":{pattern:N,format:D,mod:"w",readerror:"404",writeerror:"405"},"nav.event":{defaultvalue:"",format:"^previous$|^continue$",mod:"w",readerror:"404",writeerror:"405"}},this.currentUserData[t]={scoid:Number(t),userdata:{},defaultdata:{}};for(const e in this.dataModel[t])if(null===e.match(/\.n\./)){const r=this.dataModel[t][e].defaultvalue;void 0!==r&&(this.currentUserData[t].userdata[e]=r)}for(const e in this.def[t])if(null===e.match(/\.n\./)){const r=this.dataModel[t][e].defaultvalue;this.currentUserData[t].userdata[e]=void 0!==r?r:void 0!==this.defExtra[t][e]?this.defExtra[t][e]:""}const n=new RegExp(N,"g");for(const d in this.defExtra[t]){let l="",m="0";if(d.match(n)){const h=d.replace(n,".$1.");if(this.currentUserData[t].userdata[h]=this.defExtra[t][d],0===h.indexOf("cmi.evaluation.comments"))l="cmi.evaluation.comments._count",m=(null===(e=h.match(/.(\d+)./))||void 0===e?void 0:e[1])||"0";else if(0===h.indexOf("cmi.objectives"))l="cmi.objectives._count",m=(null===(r=h.match(/.(\d+)./))||void 0===r?void 0:r[1])||"0";else if(0===h.indexOf("cmi.interactions"))if(h.indexOf(".objectives.")>0){const t=null===(o=h.match(/cmi.interactions.(\d+)./))||void 0===o?void 0:o[1];m=(null===(i=h.match(/objectives.(\d+)./))||void 0===i?void 0:i[1])||"0",l="cmi.interactions."+t+".objectives._count"}else if(h.indexOf(".correct_responses.")>0){const t=null===(s=h.match(/cmi.interactions.(\d+)./))||void 0===s?void 0:s[1];m=(null===(a=h.match(/correct_responses.(\d+)./))||void 0===a?void 0:a[1])||"0",l="cmi.interactions."+t+".correct_responses._count"}else l="cmi.interactions._count",m=(null===(c=h.match(/.(\d+)./))||void 0===c?void 0:c[1])||"0";if(l){const e=this.currentUserData[t].userdata[l];void 0===e&&(this.currentUserData[t].userdata[l]=0),Number(m)==Number(e)&&(this.currentUserData[t].userdata[l]=Number(e)+1),Number(m)>Number(e)&&(this.currentUserData[t].userdata[l]=Number(m)-1)}}}""===this.currentUserData[t].userdata["cmi.core.lesson_status"]&&(this.currentUserData[t].userdata["cmi.core.lesson_status"]="not attempted"),this.currentUserData[t].userdata["cmi.core.credit"]=this.mode==S.b.MODENORMAL?"credit":"no-credit",this.currentUserData[t].userdata["cmi.core.lesson_mode"]=this.mode}}LMSCommit(t){if(this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.errorCode="0",""==t){if(this.initialized){const t=this.storeData(!1);return this.triggerEvent(S.b.UPDATE_TOC_EVENT),this.errorCode=t?"0":"101",t?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"}LMSFinish(t){if(this.errorCode="0",""==t){if(this.initialized){this.initialized=!1;const t=this.storeData(!0);return""!=this.getEl("nav.event")?"continue"==this.getEl("nav.event")?this.triggerEvent(S.b.LAUNCH_NEXT_SCO_EVENT):this.triggerEvent(S.b.LAUNCH_PREV_SCO_EVENT):this.scorm.auto&&this.triggerEvent(S.b.LAUNCH_NEXT_SCO_EVENT),this.errorCode=t?"0":"101",this.triggerEvent(S.b.UPDATE_TOC_EVENT),t?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"}LMSGetDiagnostic(t){return""==t&&(t=this.errorCode),t}LMSGetErrorString(t){return""!=t?k[t]:""}LMSGetLastError(){return this.errorCode}LMSGetValue(t){if(this.errorCode="0",this.initialized)if(""!=t){const e=new RegExp(N,"g"),r=String(t).replace(e,".n.");if(void 0!==this.dataModel[this.scoId][r]){if("w"!=this.dataModel[this.scoId][r].mod)return this.errorCode="0",this.getEl(t);this.errorCode=this.dataModel[this.scoId][r].readerror||"0"}else{const t="._children",e="._count";if(r.substring(r.length-t.length)==t){const e=r.substring(0,r.length-t.length);this.errorCode=void 0!==this.dataModel[this.scoId][e]?"202":"201"}else if(r.substring(r.length-e.length)==e){const t=r.substring(0,r.length-e.length);this.errorCode=void 0!==this.dataModel[this.scoId][t]?"203":"201"}else this.errorCode="201"}}else this.errorCode="201";else this.errorCode="301";return""}LMSInitialize(t){if(this.errorCode="0",""==t){if(!this.initialized)return this.initialized=!0,this.errorCode="0","true";this.errorCode="101"}else this.errorCode="201";return"false"}LMSSetValue(t,e){var r,o,i;if(this.errorCode="0",this.initialized)if(""!=t){let s=new RegExp(N,"g");const a=String(t).replace(s,".n.");if(void 0!==this.dataModel[this.scoId][a])if("r"!=this.dataModel[this.scoId][a].mod){s=new RegExp(null!==(r=this.dataModel[this.scoId][a].format)&&void 0!==r?r:"");if(null!=(e+="").match(s)){if(t!=a){if(0===t.indexOf("cmi.objectives")){const e="cmi.objectives."+(null===(o=t.match(/cmi.objectives.(\d+)./))||void 0===o?void 0:o[1])+".score";void 0===this.currentUserData[this.scoId].userdata[e+"._children"]&&(this.setEl(this.currentUserData[this.scoId].userdata[e+"._children"],U),this.setEl(this.currentUserData[this.scoId].userdata[e+".raw"],""),this.setEl(this.currentUserData[this.scoId].userdata[e+".min"],""),this.setEl(this.currentUserData[this.scoId].userdata[e+".max"],""))}else if(0===t.indexOf("cmi.interactions")){const e=null===(i=t.match(/cmi.interactions.(\d+)./))||void 0===i?void 0:i[1];let r="cmi.interactions."+e+".objectives._count";void 0===this.currentUserData[this.scoId].userdata[r]&&this.setEl(r,0),r="cmi.interactions."+e+".correct_responses._count",void 0===this.currentUserData[this.scoId].userdata[r]&&this.setEl(r,0)}const e=t.split(".");let r="cmi";for(let t=1;t<e.length-1;t++){const o=e[t];if(e[t+1].match(/^\d+$/)){const i=r+"."+o+"._count";if(void 0===this.currentUserData[this.scoId].userdata[i]&&this.setEl(i,0),e[t+1]==this.getEl(i)){const t=this.getEl(i);this.setEl(i,Number(t)+1)}e[t+1]>this.getEl(i)&&(this.errorCode="201"),r=r.concat("."+o+"."+e[t+1]),t++}else r=r.concat("."+o)}t=r.concat("."+e[e.length-1])}if("0"==this.errorCode){this.scorm.autocommit&&!this.timeout&&(this.timeout=window.setTimeout(this.LMSCommit.bind(this),6e4,[""]));const r=this.dataModel[this.scoId][a].range;if(void 0===r)return"cmi.comments"==t?this.setEl("cmi.comments",this.getEl("cmi.comments")+e):this.setEl(t,e),this.errorCode="0","true";{const o=r.split("#");if((e=Number(e))>=Number(o[0])&&e<=Number(o[1]))return this.setEl(t,Number(e)),this.errorCode="0","true";this.errorCode=this.dataModel[this.scoId][a].writeerror}}}else this.errorCode=this.dataModel[this.scoId][a].writeerror}else this.errorCode=this.dataModel[this.scoId][a].writeerror;else this.errorCode="201"}else this.errorCode="201";else this.errorCode="301";return"false"}loadSco(t){this.scoId=t}setEl(t,e){this.currentUserData[this.scoId]=this.currentUserData[this.scoId]||{scoid:this.scoId,userdata:{},defaultdata:{}},this.currentUserData[this.scoId].userdata[t]=e}setOffline(t){this.offline=t}storeData(t){if(!this.canSaveTracks)return!0;let e;t?("not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","completed"),this.getEl("cmi.core.lesson_mode")==S.b.MODENORMAL&&"credit"==this.getEl("cmi.core.credit")&&""!==this.getEl("cmi.student_data.mastery_score")&&""!==this.getEl("cmi.core.score.raw")&&(parseFloat(this.getEl("cmi.core.score.raw"))>=parseFloat(this.getEl("cmi.student_data.mastery_score"))?this.setEl("cmi.core.lesson_status","passed"):this.setEl("cmi.core.lesson_status","failed")),this.getEl("cmi.core.lesson_mode")==S.b.MODEBROWSE&&""==this.dataModel[this.scoId]["cmi.core.lesson_status"].defaultvalue&&"not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","browsed"),e=this.collectData(),e.push(this.totalTime())):e=this.collectData();const r=S.a.saveTracksSync(this.scoId,this.attempt,e,this.scorm,this.offline,this.currentUserData);return this.offline||r?r:(this.offline=!0,this.triggerEvent(S.b.GO_OFFLINE_EVENT),S.a.saveTracksSync(this.scoId,this.attempt,e,this.scorm,this.offline,this.currentUserData))}totalTime(){return{element:"cmi.core.total_time",value:this.addTime(this.getEl("cmi.core.total_time"),this.getEl("cmi.core.session_time"))}}triggerEvent(t){M.b.trigger(t,{scormId:this.scorm.id,scoId:this.scoId,attempt:this.attempt},this.siteId)}}var j=r("8ykv"),z=r("pisK"),L=r("G82x"),F=r("tVmb"),R=r("ofXK"),V=r("PgjG"),G=r("3zv0"),H=r("ACYt"),Q=r("3CSS"),q=r("qNqN"),W=r("/BoF"),B=r("3jOR");function AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template(t,e){if(1&t){const t=n.Fc();n.Ec(0,"ion-button",11),n.Mc("click",(function AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template_ion_button_click_0_listener(){n.fd(t);return n.Oc(2).openToc()})),n.Pc(1,"translate"),n.zc(2,"ion-icon",12),n.Dc()}2&t&&n.mc("aria-label",n.Qc(1,1,"addon.mod_scorm.toc"))}function AddonModScormPlayerPage_core_button_with_spinner_9_Template(t,e){if(1&t&&(n.Ec(0,"core-button-with-spinner",9),n.nd(1,AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template,3,3,"ion-button",10),n.Dc()),2&t){const t=n.Oc();n.Vc("loading",t.loadingToc),n.lc(1),n.Vc("ngIf",t.toc.length)}}function AddonModScormPlayerPage_core_iframe_12_Template(t,e){if(1&t&&n.zc(0,"core-iframe",13),2&t){const t=n.Oc();n.Vc("src",t.src)("iframeWidth",t.scormWidth)("iframeHeight",t.scormHeight)("showFullscreenOnToolbar",!0)("autoFullscreenOnRotate",!0)}}function AddonModScormPlayerPage_p_13_Template(t,e){if(1&t&&(n.Ec(0,"p"),n.pd(1),n.Pc(2,"translate"),n.Dc()),2&t){const t=n.Oc();n.lc(1),n.qd(n.Qc(2,1,t.errorMessage))}}function AddonModScormPlayerPage_core_navigation_bar_14_Template(t,e){if(1&t){const t=n.Fc();n.Ec(0,"core-navigation-bar",14),n.Mc("action",(function AddonModScormPlayerPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener(e){n.fd(t);return n.Oc().loadSco(e)})),n.Dc()}if(2&t){const t=n.Oc();n.Vc("items",t.navigationItems)}}let X=(()=>{class AddonModScormPlayerPage{constructor(t){this.mainMenuPage=t,this.showToc=!1,this.loadingToc=!0,this.toc=[],this.loaded=!1,this.incomplete=!1,this.navigationItems=[],this.newAttempt=!1,this.attempt=0,this.offline=!1}ngOnInit(){return Object(_.a)(this,void 0,void 0,(function*(){try{this.cmId=v.a.getRequiredRouteNumberParam("cmId"),this.courseId=v.a.getRequiredRouteNumberParam("courseId"),this.mode=v.a.getRouteParam("mode")||S.b.MODENORMAL,this.moduleUrl=v.a.getRouteParam("moduleUrl")||"",this.newAttempt=!!v.a.getRouteBooleanParam("newAttempt"),this.organizationId=v.a.getRouteParam("organizationId"),this.initialScoId=v.a.getRouteNumberParam("scoId"),this.siteId=g.b.getRequiredCurrentSite().getId()}catch(t){return w.a.showErrorModal(t),v.a.back(),void 0}try{if(yield this.fetchData(),!this.currentSco)return v.a.back(),void 0;if(this.newAttempt)try{yield this.setStartTime(this.currentSco.id)}catch(t){w.a.showErrorModalDefault(t,"addon.mod_scorm.errorgetscorm",!0)}this.loadSco(this.currentSco)}finally{this.loaded=!0}}))}get canSaveTracks(){return!this.accessInfo||!!this.accessInfo.cansavetrack}initialize(){return Object(_.a)(this,void 0,void 0,(function*(){this.scorm=yield S.a.getScorm(this.courseId,this.cmId,{moduleUrl:this.moduleUrl,readingStrategy:1}),I.a.blockOperation(S.b.COMPONENT,this.scorm.id,"player"),this.title=this.scorm.name,this.showToc=S.a.displayTocInPlayer(this.scorm),this.scorm.popup&&this.scorm.width&&this.scorm.width>100&&(this.scormWidth=this.scorm.width,this.scorm.height&&this.scorm.height>100&&(this.scormHeight=this.scorm.height)),this.tocObserver=M.b.on(S.b.UPDATE_TOC_EVENT,(t=>{t.scormId===this.scorm.id&&(this.offline?setTimeout(this.refreshToc.bind(this),100):this.refreshToc())}),this.siteId),this.launchNextObserver=M.b.on(S.b.LAUNCH_NEXT_SCO_EVENT,(t=>{if(t.scormId===this.scorm.id&&this.currentSco){const t=z.a.getNextScoFromToc(this.toc,this.currentSco.id);t&&this.loadSco(t)}}),this.siteId),this.launchPrevObserver=M.b.on(S.b.LAUNCH_PREV_SCO_EVENT,(t=>{if(t.scormId===this.scorm.id&&this.currentSco){const t=z.a.getPreviousScoFromToc(this.toc,this.currentSco.id);t&&this.loadSco(t)}}),this.siteId),this.goOfflineObserver=M.b.on(S.b.GO_OFFLINE_EVENT,(t=>{t.scormId!==this.scorm.id||this.offline||(this.offline=!0,setTimeout((()=>Object(_.a)(this,void 0,void 0,(function*(){try{z.a.convertAttemptToOffline(this.scorm,this.attempt)}catch(t){w.a.showErrorModalDefault(t,"core.error",!0)}this.refreshToc()}))),200))}),this.siteId)}))}calculateNavigationItems(t){this.navigationItems=this.toc.filter((t=>t.isvisible)).map((e=>({item:e,title:e.title,current:e.id==t,enabled:!(!e.prereq||!e.launch)})))}determineAttemptAndMode(t,e){return Object(_.a)(this,void 0,void 0,(function*(){const r=yield z.a.determineAttemptToContinue(this.scorm,t);let o=!1;this.attempt=r.num,this.offline=r.offline,this.attempt!=t.lastAttempt.num&&(this.attemptToContinue=this.attempt),this.attempt>0&&(o=yield S.a.isAttemptIncomplete(this.scorm.id,this.attempt,{offline:this.offline,cmId:this.cmId}));const i=S.a.determineAttemptAndMode(this.scorm,this.mode,this.attempt,this.newAttempt,o,e.cansavetrack);if(i.attempt>this.attempt)if(this.offline)yield z.a.createOfflineAttempt(this.scorm,i.attempt,t.online.length);else try{yield S.a.getScormUserData(this.scorm.id,i.attempt,{cmId:this.cmId,readingStrategy:2})}catch(e){this.offline=!0,yield z.a.createOfflineAttempt(this.scorm,i.attempt,t.online.length)}this.mode=i.mode,this.newAttempt=i.newAttempt,this.attempt=i.attempt}))}fetchData(){return Object(_.a)(this,void 0,void 0,(function*(){this.scorm||(yield this.initialize()),yield L.a.waitForSync(this.scorm.id);try{const[t,e]=yield Promise.all([S.a.getAttemptCount(this.scorm.id,{cmId:this.cmId}),S.a.getAccessInformation(this.scorm.id,{cmId:this.cmId})]);this.accessInfo=e,yield this.determineAttemptAndMode(t,e);const[r]=yield Promise.all([S.a.getScormUserData(this.scorm.id,this.attempt,{cmId:this.cmId,offline:this.offline}),this.fetchToc()]);this.userData=r}catch(t){w.a.showErrorModalDefault(t,"addon.mod_scorm.errorgetscorm",!0)}}))}fetchToc(){return Object(_.a)(this,void 0,void 0,(function*(){this.loadingToc=!0;try{if(this.incomplete=yield S.a.isAttemptIncomplete(this.scorm.id,this.attempt,{offline:this.offline,cmId:this.cmId}),this.toc=yield z.a.getToc(this.scorm.id,this.attempt,this.incomplete,{organization:this.organizationId,offline:this.offline,cmId:this.cmId}),this.currentSco)return;if(this.newAttempt&&(this.initialScoId=this.scorm.launch),this.initialScoId&&this.initialScoId>0&&(this.currentSco=z.a.getScoFromToc(this.toc,this.initialScoId)),this.currentSco)return;const t=yield z.a.getFirstSco(this.scorm.id,this.attempt,{toc:this.toc,organization:this.organizationId,mode:this.mode,offline:this.offline,cmId:this.cmId});t?this.currentSco=t:this.errorMessage="addon.mod_scorm.errornovalidsco"}finally{this.loadingToc=!1}}))}loadSco(t){var e;return Object(_.a)(this,void 0,void 0,(function*(){this.dataModel?this.dataModel.loadSco(t.id):(this.dataModel=new data_model_12_AddonModScormDataModel12(this.siteId,this.scorm,t.id,this.attempt,null!==(e=this.userData)&&void 0!==e?e:{},this.mode,this.offline,this.canSaveTracks),window.API=this.dataModel),this.currentSco=t,this.title=t.title||this.scorm.name,this.calculateNavigationItems(t.id),this.loadScoSrc(t),"asset"==t.scormtype&&this.markCompleted(t),E.a.ignoreErrors(S.a.logLaunchSco(this.scorm.id,t.id,this.scorm.name))}))}loadScoSrc(t){return Object(_.a)(this,void 0,void 0,(function*(){const e=yield S.a.getScoSrc(this.scorm,t);e==this.src&&(this.src="",yield E.a.nextTick()),this.src=e}))}markCompleted(t){var e;return Object(_.a)(this,void 0,void 0,(function*(){if(!this.canSaveTracks)return;const r=[{element:"cmi.core.lesson_status",value:"completed"}];try{S.a.saveTracks(t.id,this.attempt,r,this.scorm,this.offline)}catch(o){if(this.offline)return;const i=yield S.a.getScormUserData(this.scorm.id,this.attempt,{cmId:this.cmId});if(i[t.id]&&"completed"==i[t.id].userdata["cmi.core.lesson_status"])return;try{yield z.a.convertAttemptToOffline(this.scorm,this.attempt),this.offline=!0,null===(e=this.dataModel)||void 0===e||e.setOffline(!0),yield S.a.saveTracks(t.id,this.attempt,r,this.scorm,!0)}catch(t){w.a.showErrorModalDefault(t,"core.error",!0)}}finally{this.refreshToc()}}))}openToc(){return Object(_.a)(this,void 0,void 0,(function*(){const t=yield w.a.openSideModal({component:j.a,componentProps:{toc:this.toc,attemptToContinue:this.attemptToContinue,selected:this.currentSco&&this.currentSco.id,moduleId:this.cmId,courseId:this.courseId,accessInfo:this.accessInfo,mode:this.mode}});t&&this.loadSco(t)}))}refreshToc(){return Object(_.a)(this,void 0,void 0,(function*(){try{yield E.a.ignoreErrors(S.a.invalidateAllScormData(this.scorm.id)),yield this.fetchToc()}catch(t){w.a.showErrorModalDefault(t,"addon.mod_scorm.errorgetscorm",!0)}}))}setStartTime(t){return Object(_.a)(this,void 0,void 0,(function*(){if(!this.canSaveTracks)return;const e=[{element:"x.start.time",value:String(b.a.timestamp())}];yield S.a.saveTracks(t,this.attempt,e,this.scorm,this.offline),this.offline||(yield E.a.ignoreErrors(S.a.getAttemptCount(this.scorm.id,{cmId:this.cmId,readingStrategy:2})))}))}ngOnDestroy(){var t,e,r;this.src="",M.b.trigger(M.b.ACTIVITY_DATA_SENT,{module:"scorm"}),null===(t=this.tocObserver)||void 0===t||t.off(),null===(e=this.launchNextObserver)||void 0===e||e.off(),null===(r=this.launchPrevObserver)||void 0===r||r.off(),setTimeout((()=>{var t;null===(t=this.goOfflineObserver)||void 0===t?void 0:t.off()}),500),I.a.unblockOperation(S.b.COMPONENT,this.scorm.id,"player")}}return AddonModScormPlayerPage.ɵfac=function AddonModScormPlayerPage_Factory(t){return new(t||AddonModScormPlayerPage)(n.yc(F.a))},AddonModScormPlayerPage.ɵcmp=n.sc({type:AddonModScormPlayerPage,selectors:[["page-addon-mod-scorm-player"]],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[3,"loading",4,"ngIf"],[3,"hideUntil"],[3,"src","iframeWidth","iframeHeight","showFullscreenOnToolbar","autoFullscreenOnRotate",4,"ngIf"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",3,"items","action",4,"ngIf"],[3,"loading"],["fill","clear","aria-haspopup","true",3,"click",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[3,"src","iframeWidth","iframeHeight","showFullscreenOnToolbar","autoFullscreenOnRotate"],["collapsible-footer","","appearOnBottom","","slot","fixed",3,"items","action"]],template:function AddonModScormPlayerPage_Template(t,e){1&t&&(n.Ec(0,"ion-header"),n.Ec(1,"ion-toolbar"),n.Ec(2,"ion-buttons",0),n.zc(3,"ion-back-button",1),n.Pc(4,"translate"),n.Dc(),n.Ec(5,"ion-title"),n.Ec(6,"h1"),n.zc(7,"core-format-text",2),n.Dc(),n.Dc(),n.Ec(8,"ion-buttons",3),n.nd(9,AddonModScormPlayerPage_core_button_with_spinner_9_Template,2,2,"core-button-with-spinner",4),n.Dc(),n.Dc(),n.Dc(),n.Ec(10,"ion-content"),n.Ec(11,"core-loading",5),n.nd(12,AddonModScormPlayerPage_core_iframe_12_Template,1,5,"core-iframe",6),n.nd(13,AddonModScormPlayerPage_p_13_Template,3,3,"p",7),n.Dc(),n.nd(14,AddonModScormPlayerPage_core_navigation_bar_14_Template,1,1,"core-navigation-bar",8),n.Dc()),2&t&&(n.lc(3),n.Vc("text",n.Qc(4,9,"core.back")),n.lc(4),n.Vc("text",e.title)("contextInstanceId",e.cmId)("courseId",e.courseId),n.lc(2),n.Vc("ngIf",e.showToc),n.lc(2),n.Vc("hideUntil",e.loaded),n.lc(1),n.Vc("ngIf",e.loaded&&e.src),n.lc(1),n.Vc("ngIf",!e.src&&e.errorMessage),n.lc(1),n.Vc("ngIf",e.loaded&&e.navigationItems.length>1))},directives:[d.C,d.Ab,d.m,d.h,d.i,d.yb,m.a,R.t,h.a,d.v,V.a,G.a,H.a,d.l,d.D,Q.a,q.a,W.a,B.a],pipes:[u.d],encapsulation:2}),AddonModScormPlayerPage})();const J=[{path:":courseId/:cmId",component:f},{path:":courseId/:cmId/player",component:X}];let Y=(()=>{class AddonModScormLazyModule{}return AddonModScormLazyModule.ɵmod=n.wc({type:AddonModScormLazyModule}),AddonModScormLazyModule.ɵinj=n.vc({factory:function AddonModScormLazyModule_Factory(t){return new(t||AddonModScormLazyModule)},imports:[[o.m.forChild(J),i.a,s.a]]}),AddonModScormLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&n.kd(Y,{declarations:[f,X],imports:[o.m,i.a,s.a]}))}}]);