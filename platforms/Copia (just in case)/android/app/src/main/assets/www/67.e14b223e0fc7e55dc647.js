(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{HWyG:function(e,t,o){"use strict";o.r(t),o.d(t,"AddonModImscpViewPageModule",(function(){return F}));var i=o("tyNb"),n=o("L3Fv"),c=o("mrSG"),a=o("BaYo"),d=o("93ts"),r=o("ULAo"),s=o("zbKZ"),l=o("GGba"),m=o("pHTc"),u=o("3LXp"),h=o("vuGA"),f=o("bFG1"),p=o("j3ag"),I=o("oIyK"),g=o("Z23Z"),w=o("fXoL"),_=o("TEn/"),M=o("hMzs"),v=o("ofXK"),b=o("nt/U"),V=o("PgjG"),y=o("ACYt"),P=o("3CSS"),A=o("qNqN"),O=o("/BoF"),E=o("3jOR"),T=o("sYmb");function AddonModImscpViewPage_ion_button_9_Template(e,t){if(1&e){const e=w.Fc();w.Ec(0,"ion-button",9),w.Mc("click",(function AddonModImscpViewPage_ion_button_9_Template_ion_button_click_0_listener(){w.fd(e);return w.Oc().showToc()})),w.Pc(1,"translate"),w.zc(2,"ion-icon",10),w.Dc()}2&e&&w.mc("aria-label",w.Qc(1,1,"addon.mod_imscp.toc"))}function AddonModImscpViewPage_ion_card_12_Template(e,t){if(1&e&&(w.Ec(0,"ion-card",11),w.Ec(1,"ion-item"),w.zc(2,"ion-icon",12),w.Ec(3,"ion-label"),w.zc(4,"span",13),w.Dc(),w.Dc(),w.Dc()),2&e){const e=w.Oc();w.lc(4),w.Vc("innerHTML",e.warning,w.gd)}}function AddonModImscpViewPage_core_iframe_13_Template(e,t){if(1&e&&w.zc(0,"core-iframe",14),2&e){const e=w.Oc();w.Vc("src",e.src)("showFullscreenOnToolbar",!0)("autoFullscreenOnRotate",!0)}}function AddonModImscpViewPage_core_navigation_bar_14_Template(e,t){if(1&e){const e=w.Fc();w.Ec(0,"core-navigation-bar",15),w.Mc("action",(function AddonModImscpViewPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener(t){w.fd(e);return w.Oc().loadItem(t)})),w.Dc()}if(2&e){const e=w.Oc();w.Vc("items",e.navigationItems)}}let D=(()=>{class AddonModImscpViewPage{constructor(){this.title="",this.src="",this.warning="",this.navigationItems=[],this.loaded=!1,this.items=[]}ngOnInit(){try{this.cmId=m.a.getRequiredRouteNumberParam("cmId"),this.courseId=m.a.getRequiredRouteNumberParam("courseId"),this.initialItemHref=m.a.getRouteParam("initialHref")}catch(e){return u.a.showErrorModal(e),m.a.back(),void 0}this.fetchContent()}fetchContent(e=!1){return Object(c.a)(this,void 0,void 0,(function*(){try{const{module:t,imscp:o}=yield this.loadImscpData();this.title=o.name;const i=yield this.downloadResourceIfNeeded(t,e),n=yield r.a.getModuleContents(t,this.courseId);if(this.items=g.a.createItemList(n),this.items.length&&(this.initialItemHref&&this.items.some((e=>e.href===this.initialItemHref))&&(this.currentHref=this.initialItemHref),void 0===this.currentHref)){const e=yield g.a.getLastItemViewed(o.id);this.currentHref=void 0!==e?e:this.items[0].href}if(void 0===this.currentHref)throw new d.a("Empty TOC");try{yield this.loadItemHref(this.currentHref)}catch(e){return u.a.showErrorModalDefault(e,"addon.mod_imscp.deploymenterror",!0),void 0}if(null==i?void 0:i.failed){const e=h.a.getErrorMessageFromError(i.error)||i.error;this.warning=p.J.instant("core.errordownloadingsomefiles")+(e?" "+e:"")}else this.warning=""}catch(e){u.a.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}finally{this.loaded=!0}}))}loadImscpData(){return Object(c.a)(this,void 0,void 0,(function*(){return this.module=yield r.a.getModule(this.cmId,this.courseId),this.imscp=yield g.a.getImscp(this.courseId,this.cmId),{module:this.module,imscp:this.imscp}}))}downloadResourceIfNeeded(e,t=!1){var o;return Object(c.a)(this,void 0,void 0,(function*(){const i={failed:!1};let n=!1;if((yield s.a.getModuleStatus(e,this.courseId,void 0,t))!==a.a.DOWNLOADED)try{yield s.a.downloadModule(e,this.courseId),n=!0}catch(e){i.failed=!0,i.error=e}if(!(null===(o=e.contents)||void 0===o?void 0:o.length)||t&&!n){const o=t&&l.a.isOnline();try{yield r.a.loadModuleContents(e,void 0,void 0,!1,o)}catch(t){if(o&&!e.contents)yield r.a.loadModuleContents(e);else if(!e.contents)throw t}}return i}))}doRefresh(e){return Object(c.a)(this,void 0,void 0,(function*(){yield f.a.ignoreErrors(Promise.all([g.a.invalidateContent(this.cmId,this.courseId),s.a.invalidateCourseUpdates(this.courseId)])),yield f.a.ignoreErrors(this.fetchContent(!0)),null==e||e.complete()}))}loadItemHref(e){return Object(c.a)(this,void 0,void 0,(function*(){if(!this.module)return;const t=yield g.a.getIframeSrc(this.module,e);this.currentHref=e,this.navigationItems=this.items.map((e=>({item:e,current:e.href==this.currentHref,enabled:!!e.href}))),this.src&&t==this.src?(this.src="",setTimeout((()=>{this.src=t}))):this.src=t,this.imscp&&g.a.storeLastItemViewed(this.imscp.id,e,this.courseId)}))}loadItem(e){this.loadItemHref(e.href)}showToc(){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield u.a.openSideModal({component:I.a,componentProps:{items:this.items,selected:this.currentHref}});e&&this.loadItemHref(e)}))}}return AddonModImscpViewPage.ɵfac=function AddonModImscpViewPage_Factory(e){return new(e||AddonModImscpViewPage)},AddonModImscpViewPage.ɵcmp=w.sc({type:AddonModImscpViewPage,selectors:[["page-addon-mod-imscp-view"]],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["aria-haspopup","true",3,"click",4,"ngIf"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],[3,"src","showFullscreenOnToolbar","autoFullscreenOnRotate",4,"ngIf"],["collapsible-footer","","appearOnBottom","",3,"items","action",4,"ngIf"],["aria-haspopup","true",3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"core-warning-card"],["name","fas-exclamation-triangle","slot","start","aria-hidden","true"],[3,"innerHTML"],[3,"src","showFullscreenOnToolbar","autoFullscreenOnRotate"],["collapsible-footer","","appearOnBottom","",3,"items","action"]],template:function AddonModImscpViewPage_Template(e,t){1&e&&(w.Ec(0,"ion-header"),w.Ec(1,"ion-toolbar"),w.Ec(2,"ion-buttons",0),w.zc(3,"ion-back-button",1),w.Pc(4,"translate"),w.Dc(),w.Ec(5,"ion-title"),w.Ec(6,"h1"),w.zc(7,"core-format-text",2),w.Dc(),w.Dc(),w.Ec(8,"ion-buttons",3),w.nd(9,AddonModImscpViewPage_ion_button_9_Template,3,3,"ion-button",4),w.Dc(),w.Dc(),w.Dc(),w.Ec(10,"ion-content"),w.Ec(11,"core-loading",5),w.nd(12,AddonModImscpViewPage_ion_card_12_Template,5,1,"ion-card",6),w.nd(13,AddonModImscpViewPage_core_iframe_13_Template,1,3,"core-iframe",7),w.Dc(),w.nd(14,AddonModImscpViewPage_core_navigation_bar_14_Template,1,1,"core-navigation-bar",8),w.Dc()),2&e&&(w.lc(3),w.Vc("text",w.Qc(4,9,"core.back")),w.lc(4),w.Vc("text",t.title)("contextInstanceId",t.cmId)("courseId",t.courseId),w.lc(2),w.Vc("ngIf",t.loaded),w.lc(2),w.Vc("hideUntil",t.loaded),w.lc(1),w.Vc("ngIf",t.warning),w.lc(1),w.Vc("ngIf",t.loaded),w.lc(1),w.Vc("ngIf",t.loaded&&t.navigationItems.length>1))},directives:[_.C,_.Ab,_.m,_.h,_.i,_.yb,M.a,v.t,b.a,_.v,V.a,y.a,_.l,_.D,P.a,_.n,_.I,_.O,A.a,O.a,E.a],pipes:[T.d],encapsulation:2}),AddonModImscpViewPage})();const H=[{path:"",component:D}];let F=(()=>{class AddonModImscpViewPageModule{}return AddonModImscpViewPageModule.ɵmod=w.wc({type:AddonModImscpViewPageModule}),AddonModImscpViewPageModule.ɵinj=w.vc({factory:function AddonModImscpViewPageModule_Factory(e){return new(e||AddonModImscpViewPageModule)},imports:[[i.m.forChild(H),n.a],i.m]}),AddonModImscpViewPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&w.kd(F,{declarations:[D],imports:[i.m,n.a],exports:[i.m]}))}}]);