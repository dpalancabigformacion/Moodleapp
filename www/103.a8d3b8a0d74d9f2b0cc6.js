(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{dxjp:function(e,o,n){"use strict";n.r(o),n.d(o,"CoreLoginEmailSignupPageModule",(function(){return N}));var i=n("tyNb"),t=n("L3Fv"),c=n("5aQ+"),r=n("mrSG"),a=n("3Pt+"),l=n("9+EE"),s=n("3LXp"),g=n("vuGA"),_=n("bFG1"),p=n("JFK0"),d=n("BaYo"),m=n("j3ag"),u=n("Smo8"),f=n("mv9v"),h=n("pHTc"),E=n("4reR"),C=n("whRm"),P=n("9cfD"),b=n("6s78"),M=n("fXoL"),O=n("TEn/"),y=n("ofXK"),v=n("nt/U"),D=n("ACYt"),S=n("3CSS"),F=n("PgjG"),w=n("iSJP"),L=n("FasJ"),V=n("FTxb"),T=n("lqoc"),q=n("hMzs"),k=n("f1LK"),x=n("sYmb");const Q=["ageForm"],I=["signupFormEl"];function CoreLoginEmailSignupPage_ion_button_10_Template(e,o){if(1&e){const e=M.Fc();M.Ec(0,"ion-button",7),M.Mc("click",(function CoreLoginEmailSignupPage_ion_button_10_Template_ion_button_click_0_listener(){M.fd(e);return M.Oc().showAuthInstructions()})),M.Pc(1,"translate"),M.zc(2,"ion-icon",8),M.Dc()}2&e&&M.mc("aria-label",M.Qc(1,1,"core.login.instructions"))}function CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template(e,o){if(1&e&&(M.Ec(0,"ion-list"),M.Ec(1,"ion-item",10),M.Ec(2,"ion-label"),M.pd(3),M.Pc(4,"translate"),M.Dc(),M.Dc(),M.Ec(5,"ion-button",11),M.pd(6),M.Pc(7,"translate"),M.Dc(),M.Dc()),2&e){const e=M.Oc(2);M.lc(3),M.rd(" ",M.Qc(4,4,"core.login.signuprequiredfieldnotsupported")," "),M.lc(2),M.Vc("href",e.signupUrl)("showBrowserWarning",!1),M.lc(1),M.rd(" ",M.Qc(7,6,"core.openinbrowser")," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_23_Template(e,o){if(1&e&&(M.Ec(0,"ion-select-option",23),M.pd(1),M.Dc()),2&e){const e=o.$implicit;M.Vc("value",e.code),M.lc(1),M.qd(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template(e,o){if(1&e){const e=M.Fc();M.Ec(0,"form",13,14),M.Mc("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template_form_ngSubmit_0_listener(o){M.fd(e);return M.Oc(3).verifyAge(o)})),M.Ec(2,"ion-item-divider",10),M.Ec(3,"ion-label"),M.Ec(4,"h3"),M.pd(5),M.Pc(6,"translate"),M.Dc(),M.Dc(),M.Dc(),M.Ec(7,"ion-item",10),M.Ec(8,"ion-label",15),M.Ec(9,"span",16),M.pd(10),M.Pc(11,"translate"),M.Dc(),M.Dc(),M.zc(12,"ion-input",17),M.Dc(),M.Ec(13,"ion-item",10),M.Ec(14,"ion-label",15),M.Ec(15,"span",16),M.pd(16),M.Pc(17,"translate"),M.Dc(),M.Dc(),M.Ec(18,"ion-select",18),M.Pc(19,"translate"),M.Ec(20,"ion-select-option",19),M.pd(21),M.Pc(22,"translate"),M.Dc(),M.nd(23,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_23_Template,2,2,"ion-select-option",20),M.Dc(),M.Dc(),M.Ec(24,"ion-button",21),M.pd(25),M.Pc(26,"translate"),M.Dc(),M.Ec(27,"ion-item",10),M.Ec(28,"ion-label"),M.Ec(29,"h3",22),M.pd(30),M.Pc(31,"translate"),M.Dc(),M.Ec(32,"p"),M.pd(33),M.Pc(34,"translate"),M.Dc(),M.Dc(),M.Dc(),M.Dc()}if(2&e){const e=M.Oc(3);M.Vc("formGroup",e.ageVerificationForm),M.lc(5),M.qd(M.Qc(6,11,"core.agelocationverification")),M.lc(5),M.qd(M.Qc(11,13,"core.whatisyourage")),M.lc(6),M.qd(M.Qc(17,15,"core.wheredoyoulive")),M.lc(2),M.Vc("placeholder",M.Qc(19,17,"core.login.selectacountry")),M.lc(3),M.qd(M.Qc(22,19,"core.login.selectacountry")),M.lc(2),M.Vc("ngForOf",e.countries),M.lc(1),M.Vc("disabled",!e.ageVerificationForm.valid),M.lc(1),M.rd(" ",M.Qc(26,21,"core.proceed")," "),M.lc(5),M.qd(M.Qc(31,23,"core.whyisthisrequired")),M.lc(3),M.qd(M.Qc(34,25,"core.explanationdigitalminor"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template(e,o){if(1&e&&(M.Ec(0,"p",41),M.pd(1),M.Dc()),2&e){const e=M.Oc(4);M.lc(1),M.qd(e.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template(e,o){if(1&e&&(M.Ec(0,"p",41),M.zc(1,"core-format-text",42),M.Dc()),2&e){const e=M.Oc(4);M.lc(1),M.Vc("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template(e,o){if(1&e&&(M.Ec(0,"p"),M.pd(1),M.Dc()),2&e){const e=M.Oc(4);M.lc(1),M.qd(e.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_28_Template(e,o){if(1&e&&(M.Ec(0,"p",43),M.pd(1),M.Dc()),2&e){const e=M.Oc(4);M.lc(1),M.rd(" ",e.settings.passwordpolicy," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_51_Template(e,o){if(1&e&&(M.Ec(0,"ion-item",10),M.Ec(1,"ion-label",15),M.Ec(2,"span",16),M.pd(3),M.Pc(4,"translate"),M.Dc(),M.Dc(),M.zc(5,"ion-input",44),M.Pc(6,"translate"),M.zc(7,"core-input-errors",28),M.Dc()),2&e){const e=o.$implicit,n=M.Oc(4);M.lc(3),M.qd(M.Qc(4,5,"core.user."+e)),M.lc(2),M.Wc("placeholder",M.Qc(6,7,"core.user."+e)),M.Wc("formControlName",e),M.lc(2),M.Vc("control",n.signupForm.controls[e])("errorMessages",n.namefieldsErrors[e])}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_67_Template(e,o){if(1&e&&(M.Ec(0,"ion-select-option",23),M.pd(1),M.Dc()),2&e){const e=o.$implicit;M.Vc("value",e.code),M.lc(1),M.qd(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_68_core_user_profile_field_5_Template(e,o){if(1&e&&M.zc(0,"core-user-profile-field",46),2&e){const e=o.$implicit,n=M.Oc(5);M.Vc("field",e)("edit",!0)("signup",!0)("form",n.signupForm)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_68_Template(e,o){if(1&e&&(M.Cc(0),M.Ec(1,"ion-item-divider",10),M.Ec(2,"ion-label"),M.Ec(3,"p",22),M.pd(4),M.Dc(),M.Dc(),M.Dc(),M.nd(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_68_core_user_profile_field_5_Template,1,4,"core-user-profile-field",45),M.Bc()),2&e){const e=o.$implicit;M.lc(4),M.qd(e.name),M.lc(1),M.Vc("ngForOf",e.fields)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_69_Template(e,o){if(1&e&&(M.Cc(0),M.Ec(1,"ion-item-divider",10),M.Ec(2,"ion-label"),M.Ec(3,"h3"),M.Ec(4,"span",47),M.pd(5),M.Pc(6,"translate"),M.Dc(),M.Dc(),M.Dc(),M.Dc(),M.zc(7,"core-recaptcha",48),M.Bc()),2&e){const e=M.Oc(4);M.lc(4),M.Vc("core-mark-required",!0),M.lc(1),M.qd(M.Qc(6,5,"core.login.security_question")),M.lc(2),M.Vc("publicKey",e.settings.recaptchapublickey)("model",e.captcha)("siteUrl",e.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_Template(e,o){if(1&e&&(M.Cc(0),M.Ec(1,"ion-item-divider",10),M.Ec(2,"ion-label"),M.Ec(3,"h3"),M.pd(4),M.Pc(5,"translate"),M.Dc(),M.Dc(),M.Dc(),M.Ec(6,"ion-item",10),M.Ec(7,"ion-label"),M.Ec(8,"a",49),M.pd(9),M.Pc(10,"translate"),M.Dc(),M.Dc(),M.Dc(),M.Ec(11,"ion-item",10),M.Ec(12,"ion-label"),M.Ec(13,"span",47),M.pd(14),M.Pc(15,"translate"),M.Dc(),M.zc(16,"core-input-errors",28),M.Dc(),M.zc(17,"ion-checkbox",50),M.Dc(),M.Bc()),2&e){const e=M.Oc(4);M.lc(4),M.qd(M.Qc(5,7,"core.login.policyagreement")),M.lc(4),M.Vc("href",e.settings.sitepolicy,M.id),M.lc(1),M.rd(" ",M.Qc(10,9,"core.login.policyagreementclick")," "),M.lc(4),M.Vc("core-mark-required",!0),M.lc(1),M.qd(M.Qc(15,11,"core.login.policyacceptmandatory")),M.lc(2),M.Vc("control",e.signupForm.controls.policyagreed)("errorMessages",e.policyErrors)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template(e,o){if(1&e){const e=M.Fc();M.Ec(0,"form",13,24),M.Mc("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template_form_ngSubmit_0_listener(o){M.fd(e);return M.Oc(3).create(o)})),M.Ec(2,"ion-item",25),M.Ec(3,"ion-label"),M.nd(4,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template,2,1,"p",26),M.nd(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template,2,2,"p",26),M.nd(6,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template,2,1,"p",6),M.Dc(),M.Dc(),M.Ec(7,"ion-item-divider",10),M.Ec(8,"ion-label"),M.Ec(9,"h3"),M.pd(10),M.Pc(11,"translate"),M.Dc(),M.Dc(),M.Dc(),M.Ec(12,"ion-item",10),M.Ec(13,"ion-label",15),M.Ec(14,"span",16),M.pd(15),M.Pc(16,"translate"),M.Dc(),M.Dc(),M.zc(17,"ion-input",27),M.Pc(18,"translate"),M.zc(19,"core-input-errors",28),M.Dc(),M.Ec(20,"ion-item",10),M.Ec(21,"ion-label",15),M.Ec(22,"span",16),M.pd(23),M.Pc(24,"translate"),M.Dc(),M.Dc(),M.Ec(25,"core-show-password",29),M.zc(26,"ion-input",30),M.Pc(27,"translate"),M.Dc(),M.nd(28,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_28_Template,2,1,"p",31),M.zc(29,"core-input-errors",28),M.Dc(),M.Ec(30,"ion-item-divider",10),M.Ec(31,"ion-label"),M.Ec(32,"h3"),M.pd(33),M.Pc(34,"translate"),M.Dc(),M.Dc(),M.Dc(),M.Ec(35,"ion-item",10),M.Ec(36,"ion-label",15),M.Ec(37,"span",16),M.pd(38),M.Pc(39,"translate"),M.Dc(),M.Dc(),M.zc(40,"ion-input",32),M.Pc(41,"translate"),M.zc(42,"core-input-errors",28),M.Dc(),M.Ec(43,"ion-item",10),M.Ec(44,"ion-label",15),M.Ec(45,"span",16),M.pd(46),M.Pc(47,"translate"),M.Dc(),M.Dc(),M.zc(48,"ion-input",33),M.Pc(49,"translate"),M.zc(50,"core-input-errors",28),M.Dc(),M.nd(51,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_51_Template,8,9,"ion-item",34),M.Ec(52,"ion-item",10),M.Ec(53,"ion-label",15),M.pd(54),M.Pc(55,"translate"),M.Dc(),M.zc(56,"ion-input",35),M.Pc(57,"translate"),M.Dc(),M.Ec(58,"ion-item",10),M.Ec(59,"ion-label",36),M.pd(60),M.Pc(61,"translate"),M.Dc(),M.Ec(62,"ion-select",37),M.Pc(63,"translate"),M.Ec(64,"ion-select-option",19),M.pd(65),M.Pc(66,"translate"),M.Dc(),M.nd(67,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_67_Template,2,2,"ion-select-option",20),M.Dc(),M.Dc(),M.nd(68,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_68_Template,6,2,"ng-container",38),M.nd(69,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_69_Template,8,7,"ng-container",6),M.nd(70,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_Template,18,13,"ng-container",6),M.Ec(71,"ion-button",39),M.pd(72),M.Pc(73,"translate"),M.Dc(),M.zc(74,"input",40),M.Dc()}if(2&e){const e=M.Oc(3);M.Vc("formGroup",e.signupForm),M.lc(4),M.Vc("ngIf",!e.siteName),M.lc(1),M.Vc("ngIf",e.siteName),M.lc(1),M.Vc("ngIf",e.siteName),M.lc(4),M.qd(M.Qc(11,36,"core.login.createuserandpass")),M.lc(5),M.qd(M.Qc(16,38,"core.login.username")),M.lc(2),M.Wc("placeholder",M.Qc(18,40,"core.login.username")),M.lc(2),M.Vc("control",e.signupForm.controls.username)("errorMessages",e.usernameErrors),M.lc(4),M.qd(M.Qc(24,42,"core.login.password")),M.lc(3),M.Wc("placeholder",M.Qc(27,44,"core.login.password")),M.Vc("clearOnEdit",!1),M.lc(2),M.Vc("ngIf",e.settings.passwordpolicy),M.lc(1),M.Vc("control",e.signupForm.controls.password)("errorMessages",e.passwordErrors),M.lc(4),M.qd(M.Qc(34,46,"core.login.supplyinfo")),M.lc(5),M.qd(M.Qc(39,48,"core.user.email")),M.lc(2),M.Wc("placeholder",M.Qc(41,50,"core.user.email")),M.lc(2),M.Vc("control",e.signupForm.controls.email)("errorMessages",e.emailErrors),M.lc(4),M.qd(M.Qc(47,52,"core.user.emailagain")),M.lc(2),M.Wc("placeholder",M.Qc(49,54,"core.user.emailagain")),M.Vc("pattern",e.escapeMail(e.signupForm.controls.email.value)),M.lc(2),M.Vc("control",e.signupForm.controls.email2)("errorMessages",e.email2Errors),M.lc(1),M.Vc("ngForOf",e.settings.namefields),M.lc(3),M.qd(M.Qc(55,56,"core.user.city")),M.lc(2),M.Wc("placeholder",M.Qc(57,58,"core.user.city")),M.lc(4),M.qd(M.Qc(61,60,"core.user.country")),M.lc(2),M.Vc("placeholder",M.Qc(63,62,"core.login.selectacountry")),M.lc(3),M.qd(M.Qc(66,64,"core.login.selectacountry")),M.lc(2),M.Vc("ngForOf",e.countries),M.lc(1),M.Vc("ngForOf",e.categories),M.lc(1),M.Vc("ngIf",e.settings.recaptchapublickey),M.lc(1),M.Vc("ngIf",e.settings.sitepolicy),M.lc(2),M.qd(M.Qc(73,66,"core.login.createaccount"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template(e,o){if(1&e&&(M.Cc(0),M.nd(1,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template,35,27,"form",12),M.nd(2,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template,75,68,"form",12),M.Bc()),2&e){const e=M.Oc(2);M.lc(1),M.Vc("ngIf",e.ageDigitalConsentVerification),M.lc(1),M.Vc("ngIf",!e.ageDigitalConsentVerification)}}function CoreLoginEmailSignupPage_core_loading_12_Template(e,o){if(1&e&&(M.Ec(0,"core-loading",9),M.Ec(1,"div",5),M.nd(2,CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template,8,8,"ion-list",6),M.nd(3,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template,3,2,"ng-container",6),M.Dc(),M.Dc()),2&e){const e=M.Oc();M.Vc("hideUntil",e.settingsLoaded),M.lc(2),M.Vc("ngIf",!e.allRequiredSupported),M.lc(1),M.Vc("ngIf",e.allRequiredSupported&&e.settingsLoaded&&e.settings)}}function CoreLoginEmailSignupPage_ion_list_14_h3_3_Template(e,o){if(1&e&&(M.Ec(0,"h3",53),M.zc(1,"core-format-text",42),M.Dc()),2&e){const e=M.Oc(2);M.lc(1),M.Vc("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_ion_list_14_p_12_Template(e,o){if(1&e&&(M.Ec(0,"p"),M.pd(1),M.Dc()),2&e){const e=M.Oc(2);M.lc(1),M.qd(e.supportName)}}function CoreLoginEmailSignupPage_ion_list_14_p_13_Template(e,o){if(1&e&&(M.Ec(0,"p"),M.pd(1),M.Dc()),2&e){const e=M.Oc(2);M.lc(1),M.qd(e.supportEmail)}}function CoreLoginEmailSignupPage_ion_list_14_ion_button_14_Template(e,o){if(1&e){const e=M.Fc();M.Ec(0,"ion-button",54),M.Mc("click",(function CoreLoginEmailSignupPage_ion_list_14_ion_button_14_Template_ion_button_click_0_listener(){M.fd(e);return M.Oc(2).showContactOnSite()})),M.pd(1),M.Pc(2,"translate"),M.Dc()}2&e&&(M.lc(1),M.rd(" ",M.Qc(2,1,"core.openinbrowser")," "))}function CoreLoginEmailSignupPage_ion_list_14_Template(e,o){if(1&e&&(M.Ec(0,"ion-list"),M.Ec(1,"ion-item-divider",10),M.Ec(2,"ion-label"),M.nd(3,CoreLoginEmailSignupPage_ion_list_14_h3_3_Template,2,2,"h3",51),M.Dc(),M.Dc(),M.Ec(4,"ion-item",10),M.Ec(5,"ion-label"),M.Ec(6,"h3",22),M.pd(7),M.Pc(8,"translate"),M.Dc(),M.Ec(9,"p"),M.pd(10),M.Pc(11,"translate"),M.Dc(),M.nd(12,CoreLoginEmailSignupPage_ion_list_14_p_12_Template,2,1,"p",6),M.nd(13,CoreLoginEmailSignupPage_ion_list_14_p_13_Template,2,1,"p",6),M.Dc(),M.Dc(),M.nd(14,CoreLoginEmailSignupPage_ion_list_14_ion_button_14_Template,3,3,"ion-button",52),M.Dc()),2&e){const e=M.Oc();M.lc(3),M.Vc("ngIf",e.siteName),M.lc(4),M.qd(M.Qc(8,6,"core.considereddigitalminor")),M.lc(3),M.qd(M.Qc(11,8,"core.digitalminor_desc")),M.lc(2),M.Vc("ngIf",e.supportName),M.lc(1),M.Vc("ngIf",e.supportEmail),M.lc(1),M.Vc("ngIf",!e.supportName&&!e.supportEmail)}}let U=(()=>{class CoreLoginEmailSignupPage{constructor(e,o,n){this.fb=e,this.elementRef=o,this.changeDetector=n,this.authInstructions="",this.settingsLoaded=!1,this.allRequiredSupported=!0,this.captcha={recaptcharesponse:""},this.isMinor=!1,this.ageVerificationForm=this.fb.group({age:["",a.F.required]}),this.countryControl=this.fb.control("",a.F.required),this.ageVerificationForm.addControl("country",this.countryControl),this.signupForm=this.fb.group({username:["",a.F.required],password:["",a.F.required],email:["",a.F.compose([a.F.required,a.F.email])],email2:["",a.F.compose([a.F.required,a.F.email])]}),this.usernameErrors=f.a.getErrorMessages("core.login.usernamerequired"),this.passwordErrors=f.a.getErrorMessages("core.login.passwordrequired"),this.emailErrors=f.a.getErrorMessages("core.login.missingemail"),this.policyErrors=f.a.getErrorMessages("core.login.policyagree"),this.email2Errors=f.a.getErrorMessages("core.login.missingemail",void 0,"core.login.emailnotmatch")}ngOnInit(){const e=h.a.getRouteParam("siteUrl");if(!e)return s.a.showErrorModal("Site URL not supplied."),h.a.back(),void 0;this.siteUrl=e,this.fetchData().finally((()=>{this.settingsLoaded=!0}))}completeFormGroup(){var e,o,n,i,t;this.signupForm.addControl("city",this.fb.control((null===(e=this.settings)||void 0===e?void 0:e.defaultcity)||"")),this.signUpCountryControl=this.fb.control((null===(o=this.settings)||void 0===o?void 0:o.country)||""),this.signupForm.addControl("country",this.signUpCountryControl);for(const e in null===(n=this.settings)||void 0===n?void 0:n.namefields)this.signupForm.addControl(null===(i=this.settings)||void 0===i?void 0:i.namefields[e],this.fb.control("",a.F.required));(null===(t=this.settings)||void 0===t?void 0:t.sitepolicy)&&this.signupForm.addControl("policyagreed",this.fb.control(!1,a.F.requiredTrue))}fetchData(){return Object(r.a)(this,void 0,void 0,(function*(){try{if(this.siteConfig=yield l.b.getSitePublicConfig(this.siteUrl),this.signupUrl=P.a.concatenatePaths(this.siteConfig.httpswwwroot,"login/signup.php"),this.treatSiteConfig()){if(void 0===this.ageDigitalConsentVerification){const e=yield _.a.ignoreErrors(p.a.callAjax("core_auth_is_age_digital_consent_verification_enabled",{},{siteUrl:this.siteUrl}));this.ageDigitalConsentVerification=!!(null==e?void 0:e.status)}yield this.getSignupSettings()}this.completeFormGroup()}catch(e){this.allRequiredSupported&&s.a.showErrorModal(e)}}))}getSignupSettings(){return Object(r.a)(this,void 0,void 0,(function*(){if(this.settings=yield p.a.callAjax("auth_email_get_signup_settings",{},{siteUrl:this.siteUrl}),u.a.hasRequiredUnsupportedField(this.settings.profilefields))throw this.allRequiredSupported=!1,new Error(m.J.instant("core.login.signuprequiredfieldnotsupported"));this.categories=f.a.formatProfileFieldsForSignup(this.settings.profilefields),this.settings.recaptchapublickey&&(this.captcha.recaptcharesponse=""),this.countryControl.value||this.countryControl.setValue(this.settings.country||""),this.namefieldsErrors={},this.settings.namefields&&this.settings.namefields.forEach((e=>{this.namefieldsErrors[e]=f.a.getErrorMessages("core.login.missing"+e)})),this.countries=yield _.a.getCountryListSorted()}))}treatSiteConfig(){var e;return"email"!=(null===(e=this.siteConfig)||void 0===e?void 0:e.registerauth)||f.a.isEmailSignupDisabled(this.siteConfig)?(s.a.showErrorModal(m.J.instant("core.login.signupplugindisabled",{$a:m.J.instant("core.login.auth_email")})),h.a.back(),!1):(this.siteName=d.a.CONFIG.sitename?d.a.CONFIG.sitename:this.siteConfig.sitename,this.authInstructions=this.siteConfig.authinstructions,this.ageDigitalConsentVerification=this.siteConfig.agedigitalconsentverification,this.supportName=this.siteConfig.supportname,this.supportEmail=this.siteConfig.supportemail,this.countryControl.setValue(this.siteConfig.country||""),!0)}create(e){var o,n,i,t,c,a;return Object(r.a)(this,void 0,void 0,(function*(){if(e.preventDefault(),e.stopPropagation(),!this.signupForm.valid||(null===(o=this.settings)||void 0===o?void 0:o.recaptchapublickey)&&!this.captcha.recaptcharesponse){for(const e in this.signupForm.controls)this.signupForm.controls[e].markAsDirty();this.changeDetector.detectChanges();return(yield b.a.scrollToInputError(this.elementRef.nativeElement))||s.a.showErrorModal("core.errorinvalidform",!0),void 0}const r=yield s.a.showModalLoading("core.sending",!0),l={username:this.signupForm.value.username.trim().toLowerCase(),password:this.signupForm.value.password,firstname:g.a.cleanTags(this.signupForm.value.firstname),lastname:g.a.cleanTags(this.signupForm.value.lastname),email:this.signupForm.value.email.trim(),city:g.a.cleanTags(this.signupForm.value.city),country:this.signupForm.value.country};(null===(n=this.siteConfig)||void 0===n?void 0:n.launchurl)&&(l.redirect=f.a.prepareForSSOLogin(this.siteUrl,void 0,this.siteConfig.launchurl)),(null===(i=this.settings)||void 0===i?void 0:i.recaptchapublickey)&&this.captcha.recaptcharesponse&&(l.recaptcharesponse=this.captcha.recaptcharesponse);try{l.customprofilefields=yield u.a.getDataForFields(null===(t=this.settings)||void 0===t?void 0:t.profilefields,!0,"email",this.signupForm.value);const e=yield p.a.callAjax("auth_email_signup_user",l,{siteUrl:this.siteUrl});if(e.success){E.a.triggerFormSubmittedEvent(this.signupFormElement,!0);const e=m.J.instant("core.login.emailconfirmsent",{$a:l.email});s.a.showAlert(m.J.instant("core.success"),e),h.a.back()}else{null===(c=this.recaptchaComponent)||void 0===c?void 0:c.expireRecaptchaAnswer();const o=null===(a=e.warnings)||void 0===a?void 0:a[0];if(o){let e=o.message;("incorrect-captcha-sol"==e||!e&&"recaptcharesponse"==o.item)&&(e=m.J.instant("core.login.recaptchaincorrect")),s.a.showErrorModal(e)}else s.a.showErrorModal("core.login.usernotaddederror",!0)}}catch(e){s.a.showErrorModalDefault(e,"core.login.usernotaddederror",!0)}finally{r.dismiss()}}))}escapeMail(e){return g.a.escapeForRegex(e)}showAuthInstructions(){g.a.viewText(m.J.instant("core.login.instructions"),this.authInstructions)}showContactOnSite(){_.a.openInBrowser(P.a.concatenatePaths(this.siteUrl,"/login/verify_age_location.php"),{showBrowserWarning:!1})}verifyAge(e){var o;return Object(r.a)(this,void 0,void 0,(function*(){if(e.preventDefault(),e.stopPropagation(),!this.ageVerificationForm.valid)return s.a.showErrorModal("core.errorinvalidform",!0),void 0;const n=yield s.a.showModalLoading("core.sending",!0),i=this.ageVerificationForm.value;i.age=parseInt(i.age,10);try{const e=yield p.a.callAjax("core_auth_is_minor",i,{siteUrl:this.siteUrl});E.a.triggerFormSubmittedEvent(this.ageFormElement,!0),e.status?this.isMinor=!0:(this.countryControl.value&&(null===(o=this.signUpCountryControl)||void 0===o?void 0:o.setValue(this.countryControl.value)),this.ageDigitalConsentVerification=!1)}catch(e){s.a.showErrorModal("There was an error verifying your age, please try again using the browser.")}finally{n.dismiss()}}))}}return CoreLoginEmailSignupPage.ɵfac=function CoreLoginEmailSignupPage_Factory(e){return new(e||CoreLoginEmailSignupPage)(M.yc(a.f),M.yc(M.r),M.yc(M.j))},CoreLoginEmailSignupPage.ɵcmp=M.sc({type:CoreLoginEmailSignupPage,selectors:[["page-core-login-email-signup"]],viewQuery:function CoreLoginEmailSignupPage_Query(e,o){var n;(1&e&&(M.ud(C.a,!0),M.ud(Q,!0),M.ud(I,!0)),2&e)&&(M.dd(n=M.Nc())&&(o.recaptchaComponent=n.first),M.dd(n=M.Nc())&&(o.ageFormElement=n.first),M.dd(n=M.Nc())&&(o.signupFormElement=n.first))},decls:15,vars:9,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[3,"hideUntil",4,"ngIf"],[1,"list-item-limited-width"],[4,"ngIf"],["fill","clear",3,"click"],["slot","icon-only","name","far-question-circle","aria-hidden","true"],[3,"hideUntil"],[1,"ion-text-wrap"],["expand","block","core-link","","autoLogin","no",1,"ion-margin",3,"href","showBrowserWarning"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["ageForm",""],["position","stacked"],["core-mark-required","true"],["type","number","name","age","placeholder","0","formControlName","age","autocapitalize","none","autocorrect","off"],["name","country","formControlName","country",3,"placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],["expand","block","type","submit",1,"ion-margin",3,"disabled"],[1,"item-heading"],[3,"value"],["signupFormEl",""],[1,"ion-text-wrap","ion-text-center"],["class","ion-padding item-heading",4,"ngIf"],["type","text","name","username","formControlName","username","autocapitalize","none","autocorrect","off",3,"placeholder"],[3,"control","errorMessages"],["name","password"],["name","password","type","password","formControlName","password","autocomplete","new-password","required","true",3,"placeholder","clearOnEdit"],["class","core-input-footnote",4,"ngIf"],["type","email","name","email","formControlName","email","autocapitalize","none","autocorrect","off",3,"placeholder"],["type","email","name","email2","autocapitalize","none","formControlName","email2","autocorrect","off",3,"placeholder","pattern"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["type","text","name","city","formControlName","city","autocorrect","off",3,"placeholder"],["position","stacked","id","core-login-signup-country"],["name","country","formControlName","country","aria-labelledby","core-login-signup-country",3,"placeholder"],[4,"ngFor","ngForOf"],["expand","block","type","submit",1,"ion-margin"],["type","submit",1,"core-submit-hidden-enter"],[1,"ion-padding","item-heading"],[3,"text","filter"],[1,"core-input-footnote"],["type","text","name","nameField","autocorrect","off",3,"placeholder","formControlName"],["registerAuth","email",3,"field","edit","signup","form",4,"ngFor","ngForOf"],["registerAuth","email",3,"field","edit","signup","form"],[3,"core-mark-required"],[3,"publicKey","model","siteUrl"],["core-link","","capture","false",3,"href"],["slot","end","name","policyagreed","formControlName","policyagreed"],["class","item-heading ion-padding",4,"ngIf"],["expand","block","class","ion-margin",3,"click",4,"ngIf"],[1,"item-heading","ion-padding"],["expand","block",1,"ion-margin",3,"click"]],template:function CoreLoginEmailSignupPage_Template(e,o){1&e&&(M.Ec(0,"ion-header"),M.Ec(1,"ion-toolbar"),M.Ec(2,"ion-buttons",0),M.zc(3,"ion-back-button",1),M.Pc(4,"translate"),M.Dc(),M.Ec(5,"ion-title"),M.Ec(6,"h1"),M.pd(7),M.Pc(8,"translate"),M.Dc(),M.Dc(),M.Ec(9,"ion-buttons",2),M.nd(10,CoreLoginEmailSignupPage_ion_button_10_Template,3,3,"ion-button",3),M.Dc(),M.Dc(),M.Dc(),M.Ec(11,"ion-content"),M.nd(12,CoreLoginEmailSignupPage_core_loading_12_Template,4,3,"core-loading",4),M.Ec(13,"div",5),M.nd(14,CoreLoginEmailSignupPage_ion_list_14_Template,15,10,"ion-list",6),M.Dc(),M.Dc()),2&e&&(M.lc(3),M.Vc("text",M.Qc(4,5,"core.back")),M.lc(4),M.qd(M.Qc(8,7,"core.login.newaccount")),M.lc(3),M.Vc("ngIf",o.authInstructions),M.lc(2),M.Vc("ngIf",!o.isMinor),M.lc(2),M.Vc("ngIf",o.allRequiredSupported&&o.isMinor))},directives:[O.C,O.Ab,O.m,O.h,O.i,O.yb,y.t,v.a,O.v,D.a,O.l,O.D,S.a,F.a,O.P,O.I,O.O,w.a,a.H,a.s,a.k,O.J,L.a,O.H,O.Jb,a.r,a.i,O.lb,O.Ob,O.mb,y.s,O.Pb,V.a,T.a,a.C,a.y,q.a,k.a,C.a,O.s,O.d],pipes:[x.d],styles:["[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background:var(--core-login-background);--ion-item-background:var(--core-login-background)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color:var(--core-login-text-color);-webkit-text-decoration-color:var(--core-login-text-color);text-decoration-color:var(--core-login-text-color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item.item-input[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.ios[_ngcontent-%COMP%]{--inner-border-width:0 0 1px 0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background:var(--core-login-input-background);--color:var(--core-login-input-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:unset;-webkit-padding-start:8px;padding-inline-start:8px}}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%] + .core-siteurl[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:0}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:5px auto}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}body.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], body.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background:var(--core-login-background-dark);--loading-text-color:#fff;--loading-spinner:#fff}"]}),CoreLoginEmailSignupPage})();const z=[{path:"",component:U}];let N=(()=>{class CoreLoginEmailSignupPageModule{}return CoreLoginEmailSignupPageModule.ɵmod=M.wc({type:CoreLoginEmailSignupPageModule}),CoreLoginEmailSignupPageModule.ɵinj=M.vc({factory:function CoreLoginEmailSignupPageModule_Factory(e){return new(e||CoreLoginEmailSignupPageModule)},imports:[[i.m.forChild(z),t.a,c.a],i.m]}),CoreLoginEmailSignupPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&M.kd(N,{declarations:[U],imports:[i.m,t.a,c.a],exports:[i.m]}))}}]);