(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{fArg:function(s,e,n){"use strict";n.r(e),n.d(e,"AddonMessagesDiscussions35PageModule",(function(){return G}));var t=n("tyNb"),o=n("Y+03"),i=n("vY5A"),a=n("muSn"),c=n("L3Fv"),d=n("PM4H"),r=n("mrSG"),g=n("fjkH"),l=n("9+EE"),_=n("KMk0"),u=n("3LXp"),m=n("bFG1"),h=n("nvXB"),M=n("2eZG"),P=n("j3ag"),p=n("pHTc"),f=n("YyYz"),O=n("r2Z7"),C=n("fXoL"),b=n("TEn/"),D=n("C1x5"),v=n("nt/U"),x=n("46ml"),A=n("9zps"),I=n("PgjG"),E=n("3CSS"),w=n("ofXK"),y=n("FeAf"),T=n("hMzs"),k=n("r8G5"),V=n("sYmb"),R=n("Cg42");function AddonMessagesDiscussions35Page_ng_container_27_ion_item_9_Template(s,e){if(1&s){const s=C.Fc();C.Ec(0,"ion-item",15),C.Mc("click",(function AddonMessagesDiscussions35Page_ng_container_27_ion_item_9_Template_ion_item_click_0_listener(){C.fd(s);const n=e.$implicit;return C.Oc(2).gotoDiscussion(n.userid,n.messageid)})),C.zc(1,"core-user-avatar",16),C.Ec(2,"ion-label"),C.Ec(3,"p",17),C.pd(4),C.Dc(),C.Ec(5,"p"),C.zc(6,"core-format-text",18),C.Dc(),C.Dc(),C.Dc()}if(2&s){const s=e.$implicit,n=C.Oc(2);C.mc("aria-label",s.fullname)("aria-current",s.userid==n.discussionUserId?"page":"false"),C.lc(1),C.Vc("user",s)("checkOnline",s.showonlinestatus),C.lc(3),C.qd(s.fullname),C.lc(2),C.Vc("text",s.lastmessage)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_27_Template(s,e){if(1&s&&(C.Cc(0),C.Ec(1,"ion-item-divider"),C.Ec(2,"ion-label"),C.Ec(3,"h2"),C.pd(4),C.Pc(5,"translate"),C.Dc(),C.Dc(),C.Ec(6,"ion-note",13),C.Ec(7,"ion-badge"),C.pd(8),C.Dc(),C.Dc(),C.Dc(),C.nd(9,AddonMessagesDiscussions35Page_ng_container_27_ion_item_9_Template,7,7,"ion-item",14),C.Bc()),2&s){const s=C.Oc();C.lc(4),C.qd(C.Qc(5,3,"core.searchresults")),C.lc(4),C.qd(s.search.results.length),C.lc(1),C.Vc("ngForOf",s.search.results)}}function AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_ion_note_6_span_1_Template(s,e){if(1&s&&(C.Ec(0,"span",24),C.pd(1),C.Pc(2,"coreDateDayOrTime"),C.Dc()),2&s){const s=C.Oc(2).$implicit;C.lc(1),C.rd(" ",C.Qc(2,1,s.message.timecreated/1e3)," ")}}function AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_ion_note_6_ion_icon_2_Template(s,e){1&s&&C.zc(0,"ion-icon",25)}function AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_ion_note_6_span_3_Template(s,e){1&s&&(C.Ec(0,"span",26),C.pd(1),C.Pc(2,"translate"),C.Dc()),2&s&&(C.lc(1),C.rd(" ",C.Qc(2,1,"addon.messages.unreadmessages")," "))}function AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_ion_note_6_Template(s,e){if(1&s&&(C.Ec(0,"ion-note"),C.nd(1,AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_ion_note_6_span_1_Template,3,3,"span",21),C.nd(2,AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_ion_note_6_ion_icon_2_Template,1,0,"ion-icon",22),C.nd(3,AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_ion_note_6_span_3_Template,3,3,"span",23),C.Dc()),2&s){const s=C.Oc().$implicit;C.lc(1),C.Vc("ngIf",s.message.timecreated>0),C.lc(1),C.Vc("ngIf",s.unread),C.lc(1),C.Vc("ngIf",s.unread)}}function AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_Template(s,e){if(1&s){const s=C.Fc();C.Ec(0,"ion-item",15),C.Mc("click",(function AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_Template_ion_item_click_0_listener(){C.fd(s);const n=e.$implicit;return C.Oc(2).gotoDiscussion(n.message.user)})),C.zc(1,"core-user-avatar",19),C.Ec(2,"ion-label"),C.Ec(3,"div",20),C.Ec(4,"p",17),C.pd(5),C.Dc(),C.nd(6,AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_ion_note_6_Template,4,3,"ion-note",10),C.Dc(),C.Ec(7,"p"),C.zc(8,"core-format-text",18),C.Dc(),C.Dc(),C.Dc()}if(2&s){const s=e.$implicit,n=C.Oc(2);C.mc("aria-label",s.fullname)("aria-current",s.message.user==n.discussionUserId?"page":"false"),C.lc(1),C.Vc("user",s),C.lc(4),C.qd(s.fullname),C.lc(1),C.Vc("ngIf",s.message.timecreated>0||s.unread),C.lc(2),C.Vc("text",s.message.message)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_28_Template(s,e){if(1&s&&(C.Cc(0),C.nd(1,AddonMessagesDiscussions35Page_ng_container_28_ion_item_1_Template,9,7,"ion-item",14),C.Bc()),2&s){const s=C.Oc();C.lc(1),C.Vc("ngForOf",s.discussions)}}function AddonMessagesDiscussions35Page_core_empty_box_29_Template(s,e){1&s&&(C.zc(0,"core-empty-box",27),C.Pc(1,"translate")),2&s&&C.Vc("message",C.Qc(1,1,"addon.messages.nomessagesfound"))}function AddonMessagesDiscussions35Page_core_empty_box_30_Template(s,e){1&s&&(C.zc(0,"core-empty-box",28),C.Pc(1,"translate")),2&s&&C.Vc("message",C.Qc(1,1,"core.noresults"))}let z=(()=>{class AddonMessagesDiscussions35Page{constructor(s){this.route=s,this.loaded=!1,this.loadingMessage="",this.discussions=[],this.search={showResults:!1,results:[],loading:"",text:""},this.search.loading=P.J.instant("core.searching"),this.loadingMessages=P.J.instant("core.loading"),this.siteId=l.b.getCurrentSiteId(),this.newMessagesObserver=g.b.on(_.b.NEW_MESSAGE_EVENT,(s=>{if(s.userId&&this.discussions){const e=this.discussions.find((e=>e.message.user==s.userId));void 0===e?(this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0}))):(e.message.message=s.message,e.message.timecreated=s.timecreated)}}),this.siteId),this.readChangedObserver=g.b.on(_.b.READ_CHANGED_EVENT,(s=>{if(s.userId&&this.discussions){const e=this.discussions.find((e=>e.message.user==s.userId));void 0!==e&&(e.unread=!1,_.a.invalidateConversations(this.siteId),_.a.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.appResumeSubscription=O.a.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData())})),this.pushObserver=M.a.on("receive").subscribe((s=>{m.a.isFalseOrZero(s.notif)&&s.site==this.siteId&&this.refreshData(void 0,!1)}))}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){this.route.queryParams.subscribe((s=>Object(r.a)(this,void 0,void 0,(function*(){var e;this.discussionUserId=null!==(e=p.a.getRouteNumberParam("userId",{params:s}))&&void 0!==e?e:this.discussionUserId}))));const s=new f.a;yield this.fetchData(),!this.discussionUserId&&this.discussions.length>0&&o.a.isTablet&&(yield this.gotoDiscussion(this.discussions[0].message.user)),s.treatLink()}))}refreshData(s,e=!0){return Object(r.a)(this,void 0,void 0,(function*(){const n=[];n.push(_.a.invalidateDiscussionsCache(this.siteId)),e&&n.push(_.a.invalidateUnreadConversationCounts(this.siteId)),yield m.a.allPromises(n).finally((()=>this.fetchData().finally((()=>{s&&(null==s?void 0:s.complete())}))))}))}fetchData(){return Object(r.a)(this,void 0,void 0,(function*(){this.loadingMessage=this.loadingMessages;const s=[];s.push(_.a.getDiscussions(this.siteId).then((s=>{const e=[];for(const n in s)s[n].unread=!!s[n].unread,e.push(s[n]);this.discussions=e.sort(((s,e)=>{var n,t;return((null===(n=e.message)||void 0===n?void 0:n.timecreated)||0)-((null===(t=s.message)||void 0===t?void 0:t.timecreated)||0)}))}))),s.push(_.a.getUnreadConversationCounts(this.siteId));try{yield Promise.all(s)}catch(s){u.a.showErrorModalDefault(s,"addon.messages.errorwhileretrievingdiscussions",!0)}this.loaded=!0}))}clearSearch(){this.loaded=!1,this.search.showResults=!1,this.search.text="",this.fetchData().finally((()=>{this.loaded=!0}))}searchMessage(s){return Object(r.a)(this,void 0,void 0,(function*(){h.a.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.search.loading;try{const e=yield _.a.searchMessages(s,void 0,void 0,void 0,this.siteId);this.search.showResults=!0,this.search.results=e.messages}catch(s){u.a.showErrorModalDefault(s,"addon.messages.errorwhileretrievingmessages",!0)}this.loaded=!0}))}gotoDiscussion(s,e){return Object(r.a)(this,void 0,void 0,(function*(){this.discussionUserId=s;const n={userId:s};e&&(n.message=e);const t=(p.a.isCurrentPathInTablet("**/messages/index/discussion")?"../":"")+"discussion";yield p.a.navigate(t,{params:n})}))}gotoContacts(){const s={};o.a.isTablet&&this.discussionUserId&&(s.discussionUserId=this.discussionUserId),p.a.navigateToSitePath("contacts-35",{params:s})}ngOnDestroy(){var s,e,n,t;null===(s=this.newMessagesObserver)||void 0===s?void 0:s.off(),null===(e=this.readChangedObserver)||void 0===e||e.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe(),null===(t=this.pushObserver)||void 0===t||t.unsubscribe()}}return AddonMessagesDiscussions35Page.ɵfac=function AddonMessagesDiscussions35Page_Factory(s){return new(s||AddonMessagesDiscussions35Page)(C.yc(t.a))},AddonMessagesDiscussions35Page.ɵcmp=C.sc({type:AddonMessagesDiscussions35Page,selectors:[["addon-messages-discussions"]],decls:31,vars:27,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesDiscussions",3,"placeholder","disabled","autoFocus","onSubmit","onClear"],[3,"hideUntil","message"],[1,"ion-no-margin"],["detail","true","button","",1,"ion-text-wrap","addon-message-discussion",3,"click"],["name","fas-address-book","slot","start","aria-hidden","true"],[4,"ngIf"],["icon","far-comments",3,"message",4,"ngIf"],["icon","fas-search",3,"message",4,"ngIf"],["slot","end",1,"ion-padding-end"],["class","ion-text-wrap addon-message-discussion","button","","detail","false",3,"click",4,"ngFor","ngForOf"],["button","","detail","false",1,"ion-text-wrap","addon-message-discussion",3,"click"],["slot","start",3,"user","checkOnline"],[1,"item-heading"],["clean","true","singleLine","true","contextLevel","system",3,"text","contextInstanceId"],["slot","start","checkOnline","false",3,"user"],[1,"flex-row","ion-justify-content-between"],["class","addon-message-last-message-date",4,"ngIf"],["name","fas-circle","color","primary","aria-hidden","true",4,"ngIf"],["class","sr-only",4,"ngIf"],[1,"addon-message-last-message-date"],["name","fas-circle","color","primary","aria-hidden","true"],[1,"sr-only"],["icon","far-comments",3,"message"],["icon","fas-search",3,"message"]],template:function AddonMessagesDiscussions35Page_Template(s,e){1&s&&(C.Ec(0,"ion-header"),C.Ec(1,"ion-toolbar"),C.Ec(2,"ion-buttons",0),C.zc(3,"ion-back-button",1),C.Pc(4,"translate"),C.Dc(),C.Ec(5,"ion-title"),C.Ec(6,"h1"),C.pd(7),C.Pc(8,"translate"),C.Dc(),C.Dc(),C.Ec(9,"ion-buttons",2),C.zc(10,"core-user-menu-button"),C.Dc(),C.Dc(),C.Dc(),C.Ec(11,"ion-content"),C.Ec(12,"core-split-view"),C.Ec(13,"ion-refresher",3),C.Mc("ionRefresh",(function AddonMessagesDiscussions35Page_Template_ion_refresher_ionRefresh_13_listener(s){return e.refreshData(s.target)})),C.zc(14,"ion-refresher-content",4),C.Pc(15,"translate"),C.Dc(),C.Ec(16,"core-search-box",5),C.Mc("onSubmit",(function AddonMessagesDiscussions35Page_Template_core_search_box_onSubmit_16_listener(s){return e.searchMessage(s)}))("onClear",(function AddonMessagesDiscussions35Page_Template_core_search_box_onClear_16_listener(){return e.clearSearch()})),C.Pc(17,"translate"),C.Dc(),C.Ec(18,"core-loading",6),C.Ec(19,"ion-list",7),C.Ec(20,"ion-item",8),C.Mc("click",(function AddonMessagesDiscussions35Page_Template_ion_item_click_20_listener(){return e.gotoContacts()})),C.Pc(21,"translate"),C.zc(22,"ion-icon",9),C.Ec(23,"ion-label"),C.Ec(24,"h2"),C.pd(25),C.Pc(26,"translate"),C.Dc(),C.Dc(),C.Dc(),C.nd(27,AddonMessagesDiscussions35Page_ng_container_27_Template,10,5,"ng-container",10),C.nd(28,AddonMessagesDiscussions35Page_ng_container_28_Template,2,1,"ng-container",10),C.Dc(),C.nd(29,AddonMessagesDiscussions35Page_core_empty_box_29_Template,2,3,"core-empty-box",11),C.nd(30,AddonMessagesDiscussions35Page_core_empty_box_30_Template,2,3,"core-empty-box",12),C.Dc(),C.Dc(),C.Dc()),2&s&&(C.lc(3),C.Vc("text",C.Qc(4,15,"core.back")),C.lc(4),C.qd(C.Qc(8,17,"addon.messages.messages")),C.lc(6),C.Vc("disabled",!e.loaded),C.lc(1),C.Wc("pullingText",C.Qc(15,19,"core.pulltorefresh")),C.lc(2),C.Vc("placeholder",C.Qc(17,21,"addon.messages.message"))("disabled",!e.loaded)("autoFocus",!1),C.lc(2),C.Vc("hideUntil",e.loaded)("message",e.loadingMessage),C.lc(2),C.mc("aria-label",C.Qc(21,23,"addon.messages.contacts")),C.lc(5),C.qd(C.Qc(26,25,"addon.messages.contacts")),C.lc(2),C.Vc("ngIf",e.search.showResults),C.lc(1),C.Vc("ngIf",!e.search.showResults),C.lc(1),C.Vc("ngIf",(!e.discussions||e.discussions.length<=0)&&!e.search.showResults),C.lc(1),C.Vc("ngIf",(!e.search.results||e.search.results.length<=0)&&e.search.showResults))},directives:[b.C,b.Ab,b.m,b.h,b.i,b.yb,D.a,v.a,b.v,x.a,b.bb,b.cb,A.a,I.a,b.P,b.I,b.D,E.a,b.O,w.t,b.J,b.W,b.k,w.s,y.a,T.a,k.a],pipes:[V.d,R.a],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesDiscussions35Page})();var S=n("OQOI"),U=n("dQ3M");const j=[{path:"",data:{mainMenuTabRoot:S.b.PAGE_NAME},component:z},a.AddonMessagesDiscussionRoute],F=[{path:"",data:{mainMenuTabRoot:S.b.PAGE_NAME},component:z,children:[a.AddonMessagesDiscussionRoute]}],Q=[...Object(i.c)(j,(()=>o.a.isMobile)),...Object(i.c)(F,(()=>o.a.isTablet))];let G=(()=>{class AddonMessagesDiscussions35PageModule{}return AddonMessagesDiscussions35PageModule.ɵmod=C.wc({type:AddonMessagesDiscussions35PageModule}),AddonMessagesDiscussions35PageModule.ɵinj=C.vc({factory:function AddonMessagesDiscussions35PageModule_Factory(s){return new(s||AddonMessagesDiscussions35PageModule)},imports:[[t.m.forChild(Q),c.a,d.a,U.a],t.m]}),AddonMessagesDiscussions35PageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&C.kd(G,{declarations:[z],imports:[t.m,c.a,d.a,U.a],exports:[t.m]}))}}]);