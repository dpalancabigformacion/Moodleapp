(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{"N/A2":function(e,n,o){"use strict";o.r(n),o.d(n,"AddonModLessonUserRetakePageModule",(function(){return x}));var t=o("tyNb"),c=o("L3Fv"),s=o("mrSG"),a=o("93ts"),d=o("4pns"),i=o("pHTc"),_=o("9+EE"),r=o("3LXp"),l=o("vuGA"),g=o("bFG1"),m=o("j3ag"),u=o("ovS5"),p=o("2kx2"),f=o("8vmT"),h=o("fXoL"),v=o("TEn/"),k=o("nt/U"),I=o("PgjG"),P=o("ofXK"),M=o("nu3w"),E=o("FeAf"),R=o("TKc2"),b=o("3Pt+"),D=o("hMzs"),L=o("edOc"),A=o("ACYt"),U=o("sYmb"),T=o("uYHD");function AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_6_Template(e,n){if(1&e&&(h.Ec(0,"ion-select-option",16),h.pd(1),h.Dc()),2&e){const e=n.$implicit;h.Vc("value",e.try),h.lc(1),h.rd(" ",e.label," ")}}const _c0=function(e){return{header:e}};function AddonModLessonUserRetakePage_div_14_ion_item_7_Template(e,n){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",12),h.Ec(1,"ion-label",13),h.pd(2),h.Pc(3,"translate"),h.Dc(),h.Ec(4,"ion-select",14),h.Mc("ngModelChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ngModelChange_4_listener(n){h.fd(e);return h.Oc(2).selectedRetake=n}))("ionChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ionChange_4_listener(){h.fd(e);const n=h.Oc(2);return n.changeRetake(n.selectedRetake)})),h.Pc(5,"translate"),h.nd(6,AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_6_Template,2,2,"ion-select-option",15),h.Dc(),h.Dc()}if(2&e){const e=h.Oc(2);h.lc(2),h.qd(h.Qc(3,4,"addon.mod_lesson.attemptheader")),h.lc(2),h.Vc("ngModel",e.selectedRetake)("interfaceOptions",h.ad(8,_c0,h.Qc(5,6,"addon.mod_lesson.attemptheader"))),h.lc(2),h.Vc("ngForOf",e.student.attempts)}}const _c1=function(e){return{$a:e}};function AddonModLessonUserRetakePage_div_14_ion_list_8_Template(e,n){if(1&e&&(h.Ec(0,"ion-list",17),h.Ec(1,"ion-item"),h.Ec(2,"ion-label",12),h.Ec(3,"ion-grid",18),h.Ec(4,"ion-row"),h.Ec(5,"ion-col"),h.Ec(6,"h3",19),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Ec(9,"p"),h.pd(10),h.Pc(11,"translate"),h.Dc(),h.Dc(),h.Ec(12,"ion-col"),h.Ec(13,"h3",19),h.pd(14),h.Pc(15,"translate"),h.Dc(),h.Ec(16,"p"),h.pd(17),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Ec(18,"ion-item",12),h.Ec(19,"ion-label"),h.Ec(20,"h3",19),h.pd(21),h.Pc(22,"translate"),h.Dc(),h.Ec(23,"p"),h.pd(24),h.Dc(),h.Dc(),h.Dc(),h.Ec(25,"ion-item",12),h.Ec(26,"ion-label"),h.Ec(27,"h3",19),h.pd(28),h.Pc(29,"translate"),h.Dc(),h.Ec(30,"p"),h.pd(31),h.Pc(32,"coreFormatDate"),h.Dc(),h.Dc(),h.Dc(),h.Dc()),2&e){const e=h.Oc(2);h.lc(7),h.qd(h.Qc(8,9,"addon.mod_lesson.grade")),h.lc(3),h.qd(h.Rc(11,11,"core.percentagenumber",h.ad(22,_c1,e.retake.userstats.grade))),h.lc(4),h.qd(h.Qc(15,14,"addon.mod_lesson.rawgrade")),h.lc(3),h.sd("",e.retake.userstats.gradeinfo.earned," / ",e.retake.userstats.gradeinfo.total,""),h.lc(4),h.qd(h.Qc(22,16,"addon.mod_lesson.timetaken")),h.lc(3),h.qd(e.timeTakenReadable),h.lc(4),h.qd(h.Qc(29,18,"addon.mod_lesson.completed")),h.lc(3),h.qd(h.Qc(32,20,1e3*e.retake.userstats.completed))}}function AddonModLessonUserRetakePage_div_14_ion_item_9_Template(e,n){1&e&&(h.Ec(0,"ion-item",12),h.Ec(1,"ion-label"),h.pd(2),h.Pc(3,"translate"),h.Dc(),h.Dc()),2&e&&(h.lc(2),h.qd(h.Qc(3,1,"addon.mod_lesson.notcompleted")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template(e,n){1&e&&(h.Ec(0,"ion-item",12),h.Ec(1,"ion-label"),h.Ec(2,"p"),h.pd(3),h.Pc(4,"translate"),h.Dc(),h.Dc(),h.Dc()),2&e&&(h.lc(3),h.qd(h.Qc(4,1,"addon.mod_lesson.didnotanswerquestion")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template(e,n){if(1&e&&(h.Ec(0,"ion-item"),h.Ec(1,"ion-label",12),h.Ec(2,"ion-grid",18),h.Ec(3,"ion-row"),h.Ec(4,"ion-col"),h.Ec(5,"ion-button",26),h.pd(6),h.Dc(),h.Dc(),h.Ec(7,"ion-col"),h.zc(8,"p",27),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Dc()),2&e){const e=h.Oc().$implicit;h.lc(5),h.Vc("disabled",!0),h.lc(1),h.rd(" ",e[0].buttonText," "),h.lc(2),h.Vc("innerHTML",e[0].content,h.gd)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template(e,n){if(1&e&&(h.Ec(0,"ion-badge",33),h.zc(1,"core-format-text",30),h.Dc()),2&e){const e=h.Oc(3).$implicit,n=h.Oc(5);h.lc(1),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}const _c2=function(e){return{"addon-mod_lesson-highlight":e}};function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template(e,n){if(1&e&&(h.Ec(0,"ion-item",29),h.Ec(1,"ion-label"),h.Ec(2,"p"),h.zc(3,"core-format-text",30),h.Dc(),h.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template,2,5,"ion-badge",31),h.Dc(),h.zc(5,"ion-checkbox",32),h.Dc()),2&e){const e=h.Oc(2).$implicit,n=h.Oc(5);h.Vc("ngClass",h.ad(10,_c2,e[0].highlight)),h.lc(3),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),h.lc(1),h.Vc("ngIf",e[1]),h.lc(1),h.Vc("ngModel",e[0].checked)("disabled",!0),h.mc("name",e[0].name)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template(e,n){if(1&e&&(h.Ec(0,"ion-badge",33),h.zc(1,"core-format-text",30),h.Dc()),2&e){const e=h.Oc(3).$implicit,n=h.Oc(5);h.lc(1),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template(e,n){if(1&e&&(h.Ec(0,"ion-item",12),h.Ec(1,"ion-label"),h.Ec(2,"p"),h.pd(3),h.Dc(),h.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template,2,5,"ion-badge",31),h.Dc(),h.Dc()),2&e){const e=h.Oc(2).$implicit;h.lc(3),h.qd(e[0].value),h.lc(1),h.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template(e,n){if(1&e&&(h.Ec(0,"ion-badge",33),h.zc(1,"core-format-text",30),h.Dc()),2&e){const e=h.Oc(3).$implicit,n=h.Oc(5);h.lc(1),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template(e,n){if(1&e&&(h.Ec(0,"ion-item"),h.Ec(1,"ion-label",12),h.Ec(2,"ion-grid",18),h.Ec(3,"ion-row"),h.Ec(4,"ion-col"),h.Ec(5,"p"),h.zc(6,"core-format-text",30),h.Dc(),h.Dc(),h.Ec(7,"ion-col"),h.Ec(8,"p"),h.pd(9),h.Dc(),h.nd(10,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template,2,5,"ion-badge",31),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Dc()),2&e){const e=h.Oc(2).$implicit,n=h.Oc(5);h.lc(6),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),h.lc(3),h.qd(e[0].value),h.lc(1),h.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template(e,n){if(1&e&&(h.Ec(0,"ion-badge",33),h.zc(1,"core-format-text",30),h.Dc()),2&e){const e=h.Oc(3).$implicit,n=h.Oc(5);h.lc(1),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template(e,n){if(1&e&&(h.Ec(0,"ion-item",12),h.Ec(1,"ion-label"),h.Ec(2,"p"),h.zc(3,"core-format-text",30),h.Dc(),h.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template,2,5,"ion-badge",31),h.Dc(),h.Dc()),2&e){const e=h.Oc(2).$implicit,n=h.Oc(5);h.lc(3),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),h.lc(1),h.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template(e,n){if(1&e&&(h.Cc(0),h.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template,6,12,"ion-item",28),h.nd(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template,5,2,"ion-item",10),h.nd(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template,11,7,"ion-item",6),h.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template,5,6,"ion-item",10),h.Bc()),2&e){const e=h.Oc().$implicit;h.lc(1),h.Vc("ngIf",e[0].isCheckbox),h.lc(1),h.Vc("ngIf",e[0].isText),h.lc(1),h.Vc("ngIf",e[0].isSelect),h.lc(1),h.Vc("ngIf",!e[0].isCheckbox&&!e[0].isText&&!e[0].isSelect)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template(e,n){if(1&e&&(h.Ec(0,"ion-badge",33),h.zc(1,"core-format-text",30),h.Dc()),2&e){const e=h.Oc(2).$implicit,n=h.Oc(5);h.lc(1),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template(e,n){if(1&e&&(h.Ec(0,"ion-item",12),h.Ec(1,"ion-label"),h.Ec(2,"p"),h.zc(3,"core-format-text",30),h.Dc(),h.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template,2,5,"ion-badge",31),h.Dc(),h.Dc()),2&e){const e=h.Oc().$implicit,n=h.Oc(5);h.lc(3),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),h.lc(1),h.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template(e,n){if(1&e&&(h.Cc(0),h.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template,9,3,"ion-item",6),h.nd(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template,5,4,"ng-container",6),h.nd(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template,5,6,"ion-item",10),h.Bc()),2&e){const e=h.Oc(2).$implicit;h.lc(1),h.Vc("ngIf",e.isContent),h.lc(1),h.Vc("ngIf",e.isQuestion),h.lc(1),h.Vc("ngIf",!e.isContent&&!e.isQuestion)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template(e,n){if(1&e&&(h.Ec(0,"ion-item",12),h.Ec(1,"ion-label"),h.Ec(2,"h3",19),h.pd(3),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"p"),h.zc(6,"core-format-text",30),h.Dc(),h.Dc(),h.Dc()),2&e){const e=h.Oc(2).$implicit,n=h.Oc(3);h.lc(3),h.qd(h.Qc(4,6,"addon.mod_lesson.response")),h.lc(3),h.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e.answerdata.response)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template(e,n){if(1&e&&(h.Ec(0,"ion-item",12),h.Ec(1,"ion-label"),h.Ec(2,"p"),h.pd(3),h.Dc(),h.Dc(),h.Dc()),2&e){const e=h.Oc(2).$implicit;h.lc(3),h.qd(e.answerdata.score)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template(e,n){if(1&e&&(h.Ec(0,"div",24),h.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template,4,3,"ng-container",25),h.nd(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template,7,8,"ion-item",10),h.nd(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template,4,1,"ion-item",10),h.Dc()),2&e){const e=h.Oc().$implicit;h.lc(1),h.Vc("ngForOf",e.answerdata.answers),h.lc(1),h.Vc("ngIf",e.answerdata.response),h.lc(1),h.Vc("ngIf",e.answerdata.score)}}const _c3=function(e){return{"text-dimmed":e}};function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template(e,n){if(1&e&&(h.Ec(0,"ion-card",21),h.Ec(1,"ion-card-header",12),h.Ec(2,"ion-card-title"),h.pd(3),h.Dc(),h.Dc(),h.Ec(4,"ion-item",12),h.Ec(5,"ion-label"),h.Ec(6,"h3",19),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Ec(9,"p"),h.zc(10,"core-format-text",22),h.Dc(),h.Dc(),h.Dc(),h.Ec(11,"ion-item",12),h.Ec(12,"ion-label"),h.Ec(13,"h3",19),h.pd(14),h.Pc(15,"translate"),h.Dc(),h.Dc(),h.Dc(),h.nd(16,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template,5,3,"ion-item",10),h.nd(17,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template,4,3,"div",23),h.Dc()),2&e){const e=n.$implicit,o=h.Oc(3);h.Vc("ngClass",h.ad(16,_c3,e.grayout)),h.lc(3),h.sd("",e.qtype,": ",e.title,""),h.lc(4),h.qd(h.Qc(8,12,"addon.mod_lesson.question")),h.lc(3),h.Vc("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e.contents)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),h.lc(4),h.qd(h.Qc(15,14,"addon.mod_lesson.answer")),h.lc(2),h.Vc("ngIf",!e.answerdata||!e.answerdata.answers||!e.answerdata.answers.length),h.lc(1),h.Vc("ngIf",e.answerdata&&e.answerdata.answers&&e.answerdata.answers.length)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_Template(e,n){if(1&e&&(h.Cc(0),h.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template,18,18,"ion-card",20),h.Bc()),2&e){const e=h.Oc(2);h.lc(1),h.Vc("ngForOf",e.retake.answerpages)}}function AddonModLessonUserRetakePage_div_14_Template(e,n){if(1&e&&(h.Ec(0,"div"),h.Ec(1,"ion-item",7),h.zc(2,"core-user-avatar",8),h.Ec(3,"ion-label"),h.Ec(4,"h2"),h.pd(5),h.Dc(),h.zc(6,"core-progress-bar",9),h.Dc(),h.Dc(),h.nd(7,AddonModLessonUserRetakePage_div_14_ion_item_7_Template,7,10,"ion-item",10),h.nd(8,AddonModLessonUserRetakePage_div_14_ion_list_8_Template,33,24,"ion-list",11),h.nd(9,AddonModLessonUserRetakePage_div_14_ion_item_9_Template,4,3,"ion-item",10),h.nd(10,AddonModLessonUserRetakePage_div_14_ng_container_10_Template,2,1,"ng-container",6),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.Vc("userId",e.student.id)("courseId",e.courseId),h.mc("aria-label",e.student.fullname),h.lc(1),h.Vc("user",e.student)("userId",e.student.id)("courseId",e.courseId)("linkProfile",!1),h.lc(3),h.qd(e.student.fullname),h.lc(1),h.Vc("progress",e.student.bestgrade),h.lc(1),h.Vc("ngIf",e.student.attempts&&e.student.attempts.length>1),h.lc(1),h.Vc("ngIf",e.retake&&e.retake.userstats&&e.retake.userstats.gradeinfo),h.lc(1),h.Vc("ngIf",e.retake&&(!e.retake.userstats||!e.retake.userstats.gradeinfo)),h.lc(1),h.Vc("ngIf",e.retake)}}let w=(()=>{class AddonModLessonUserRetakePage{constructor(){this.component=u.b.COMPONENT}ngOnInit(){try{this.cmId=i.a.getRequiredRouteNumberParam("cmId"),this.courseId=i.a.getRequiredRouteNumberParam("courseId"),this.userId=i.a.getRouteNumberParam("userId")||_.b.getCurrentSiteUserId(),this.retakeNumber=i.a.getRouteNumberParam("retake")}catch(e){return r.a.showErrorModal(e),i.a.back(),void 0}this.fetchData().finally((()=>{this.loaded=!0}))}changeRetake(e){return Object(s.a)(this,void 0,void 0,(function*(){this.loaded=!1;try{yield this.setRetake(e)}catch(e){this.selectedRetake=this.previousSelectedRetake,r.a.showErrorModal(g.a.addDataNotDownloadedError(e,"Error getting attempt."))}finally{this.loaded=!0}}))}doRefresh(e){this.refreshData().finally((()=>{null==e?void 0:e.complete()}))}fetchData(){var e;return Object(s.a)(this,void 0,void 0,(function*(){try{this.lesson=yield u.a.getLesson(this.courseId,this.cmId);const n=yield u.a.getRetakesOverview(this.lesson.id,{cmId:this.cmId}),o=null===(e=null==n?void 0:n.students)||void 0===e?void 0:e.find((e=>e.id==this.userId));if(!o)throw new a.a(m.J.instant("addon.mod_lesson.cannotfinduser"));if(!o.attempts.length)throw new a.a(m.J.instant("addon.mod_lesson.cannotfindattempt"));o.bestgrade=l.a.roundToDecimals(o.bestgrade,2),o.attempts.forEach((e=>{this.selectedRetake||this.retakeNumber!=e.try||(this.selectedRetake=this.retakeNumber),e.label=p.a.getRetakeLabel(e)})),this.selectedRetake||(this.selectedRetake=o.attempts[o.attempts.length-1].try);const t=yield g.a.ignoreErrors(d.a.getProfile(o.id,this.courseId,!0));this.student=o,this.student.profileimageurl=null==t?void 0:t.profileimageurl,yield this.setRetake(this.selectedRetake)}catch(e){r.a.showErrorModalDefault(e,"Error getting data.",!0)}}))}refreshData(){return Object(s.a)(this,void 0,void 0,(function*(){const e=[];e.push(u.a.invalidateLessonData(this.courseId)),this.lesson&&(e.push(u.a.invalidateRetakesOverview(this.lesson.id)),e.push(u.a.invalidateUserRetakesForUser(this.lesson.id,this.userId))),yield g.a.ignoreErrors(Promise.all(e)),yield this.fetchData()}))}setRetake(e){return Object(s.a)(this,void 0,void 0,(function*(){this.selectedRetake=e;const n=yield u.a.getUserRetake(this.lesson.id,e,{cmId:this.cmId,userId:this.userId});this.retake=this.formatRetake(n),this.previousSelectedRetake=this.selectedRetake}))}formatRetake(e){const n=e;return n.userstats.gradeinfo&&(n.userstats.grade=l.a.roundToDecimals(n.userstats.grade,2),this.timeTakenReadable=f.a.formatTime(n.userstats.timetotake)),n.answerpages.forEach((e=>{var n,o;u.a.answerPageIsContent(e)?(e.isContent=!0,(null===(n=e.answerdata)||void 0===n?void 0:n.answers)&&e.answerdata.answers.forEach((e=>{e[0]=p.a.getContentPageAnswerDataFromHtml(e[0])}))):u.a.answerPageIsQuestion(e)&&(e.isQuestion=!0,(null===(o=e.answerdata)||void 0===o?void 0:o.answers)&&e.answerdata.answers.forEach((e=>{e[0]=p.a.getQuestionPageAnswerDataFromHtml(e[0])})))})),n}}return AddonModLessonUserRetakePage.ɵfac=function AddonModLessonUserRetakePage_Factory(e){return new(e||AddonModLessonUserRetakePage)},AddonModLessonUserRetakePage.ɵcmp=h.sc({type:AddonModLessonUserRetakePage,selectors:[["page-addon-mod-lesson-user-retake"]],decls:15,vars:12,consts:[["slot","start"],[3,"text"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["core-user-link","",1,"ion-text-wrap",3,"userId","courseId"],["slot","start",3,"user","userId","courseId","linkProfile"],["a11yText","addon.mod_lesson.grade",3,"progress"],["class","ion-text-wrap",4,"ngIf"],["class","addon-mod_lesson-userstats",4,"ngIf"],[1,"ion-text-wrap"],["id","addon-mod_lesson-retakeslabel"],["aria-labelledby","addon-mod_lesson-retakeslabel","interface","action-sheet",3,"ngModel","interfaceOptions","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"addon-mod_lesson-userstats"],[1,"ion-no-padding"],[1,"item-heading"],["class","addon-mod_lesson-answerpage",3,"ngClass",4,"ngFor","ngForOf"],[1,"addon-mod_lesson-answerpage",3,"ngClass"],["collapsible-item","","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["class","addon-mod_lesson-answer",4,"ngIf"],[1,"addon-mod_lesson-answer"],[4,"ngFor","ngForOf"],["expand","block","fill","outline",1,"ion-text-wrap",3,"disabled"],[3,"innerHTML"],["class","ion-text-wrap",3,"ngClass",4,"ngIf"],[1,"ion-text-wrap",3,"ngClass"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["color","dark",4,"ngIf"],["slot","end",3,"ngModel","disabled"],["color","dark"]],template:function AddonModLessonUserRetakePage_Template(e,n){1&e&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-buttons",0),h.zc(3,"ion-back-button",1),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"ion-title"),h.Ec(6,"h1"),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Ec(9,"ion-content",2),h.Ec(10,"ion-refresher",3),h.Mc("ionRefresh",(function AddonModLessonUserRetakePage_Template_ion_refresher_ionRefresh_10_listener(e){return n.doRefresh(e.target)})),h.zc(11,"ion-refresher-content",4),h.Pc(12,"translate"),h.Dc(),h.Ec(13,"core-loading",5),h.nd(14,AddonModLessonUserRetakePage_div_14_Template,11,13,"div",6),h.Dc(),h.Dc()),2&e&&(h.lc(3),h.Vc("text",h.Qc(4,6,"core.back")),h.lc(4),h.qd(h.Qc(8,8,"addon.mod_lesson.detailedstats")),h.lc(3),h.Vc("disabled",!n.loaded),h.lc(1),h.Wc("pullingText",h.Qc(12,10,"core.pulltorefresh")),h.lc(2),h.Vc("hideUntil",n.loaded),h.lc(1),h.Vc("ngIf",n.student))},directives:[v.C,v.Ab,v.m,v.h,v.i,v.yb,k.a,v.v,v.bb,v.cb,I.a,P.t,v.I,M.a,E.a,v.O,R.a,v.lb,v.Ob,b.r,b.u,P.s,v.mb,v.P,v.B,v.hb,v.u,v.n,P.q,v.p,v.r,D.a,L.a,A.a,v.l,v.s,v.d,v.k],pipes:[U.d,T.a],styles:["[_nghost-%COMP%]   .button-disabled[_ngcontent-%COMP%]{opacity:.4}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]{--background:var(--primary-tint)}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--primary-shade)}[_nghost-%COMP%]   .item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:.5}"]}),AddonModLessonUserRetakePage})();const O=[{path:"",component:w}];let x=(()=>{class AddonModLessonUserRetakePageModule{}return AddonModLessonUserRetakePageModule.ɵmod=h.wc({type:AddonModLessonUserRetakePageModule}),AddonModLessonUserRetakePageModule.ɵinj=h.vc({factory:function AddonModLessonUserRetakePageModule_Factory(e){return new(e||AddonModLessonUserRetakePageModule)},imports:[[t.m.forChild(O),c.a],t.m]}),AddonModLessonUserRetakePageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&h.kd(x,{declarations:[w],imports:[t.m,c.a],exports:[t.m]}))}}]);